<!DOCTYPE html>
<html>
  <!-- meta/link... -->
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <title>Java-Concurrent | Hexo</title>

  <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://cdn.jsdelivr.net/gh/inkss/fontawesome@5.15.3/css/all.min.css" rel="stylesheet">

  
    <script>
        var themeModelId = '';
        if (themeModelId) {
            localStorage.setItem('modelId', themeModelId);
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/gh/yuang01/live2d-widget@latest/autoload.js"></script>
    <script>
        var live2dOpen = eval('true') || false;
        if (!live2dOpen) {
            localStorage.setItem('waifu-display', 1609323474481);
        }
    </script>
  
  
  
<link rel="stylesheet" href="/css/animate.min.css">

  
<link rel="stylesheet" href="/css/style.css">

  
  
    
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/js/shareJs/share.min.css">

  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

    

    <!-- import link -->
    
        
            
        
            
        
    
    <!-- import script -->
    
        
            
        
            
        
    

<meta name="generator" content="Hexo 6.0.0"></head>

  
  <!-- ‰æùËµñ‰∫éjqueryÂíåvue -->
  <script src="/js/jquery3.5.1.js"></script>
  <script src="/js/vue2.6.11.js"></script>
  
  <body>
    <!-- È¢ÑÂä†ËΩΩÂä®Áîª -->
    <!-- È°µÈù¢È¢ÑÂä†ËΩΩÂä®Áîª -->

    
    <!-- Âà§Êñ≠ÊòØÂê¶‰∏∫ÊöóÈªëÈ£éÊ†º -->
    <!-- Âà§Êñ≠ÊòØÂê¶‰∏∫ÈªëÂ§úÊ®°Âºè -->
<script>
  let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }
</script>

    <!-- Â§¥ÈÉ®ÂØºËà™Á≠â -->
    
<header class="header " id="navHeader"
  style="position: fixed;
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <div class="drawer-box-icon">
    <i class="fas fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  </div>
  
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo lazyload placeholder" src="/medias/logo.png" class="lazyload placeholder" data-srcset="/medias/logo.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo">
      <h3 class="drawer-box-head_title">Hexo</h3>
      <h5 class="drawer-box-head_desc"></h5>
    </div>
    
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/" class="drawer-menu-item-link">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">È¶ñÈ°µ</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/archives" class="drawer-menu-item-link">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">ÂΩíÊ°£</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/tags" class="drawer-menu-item-link">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">Ê†áÁ≠æ</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/categories" class="drawer-menu-item-link">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">ÂàÜÁ±ª</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/about" class="drawer-menu-item-link">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">ÂÖ≥‰∫é</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/friends" class="drawer-menu-item-link">
                  
                  <span class="name">ÂèãÊÉÖÈìæÊé•</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="javascript:;" class="drawer-menu-item-link has-children" @click="openOrCloseMenu(6)">
                  <span>
                    
                    <span class="name">üê±Êõ¥Â§ö</span>
                  </span>
                  <i class="fas fa-chevron-left arrow " :class="{'icon-rotate': isOpen(6)}" aria-hidden="true"></i>
                </a>
                <ul class="drawer-sub-menu" v-if="isOpen(6)">
                  
                  <li>
                    <a href="/gallery">
                      
                      <span>üì∑ÂõæÂ∫ì</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/me">
                      
                      <span>üßíüèªÂÖ≥‰∫éÊàë</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
        
          <li class="drawer-box-content_item">
            <a target="_blank" rel="noopener" href="https://github.com/ctrl-github">
              <i class="fas fa-github" aria-hidden="true"></i>
              <span>Github</span>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // Èò≤Ê≠¢È°µÈù¢ÊªöÂä®ÔºåÂè™ËÉΩËÆ©ÂºπÊ°ÜÊªöÂä®
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>

    </div>
    <div class="blog-title" id="author-avatar">
      
        <div class="avatar">
          <img src="/medias/logo.png" class="lazyload placeholder" data-srcset="/medias/logo.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo">
        </div>
      
      <a href="/" class="logo">Hexo</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/" class="menu-item-link" title="È¶ñÈ°µ">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">È¶ñÈ°µ</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/archives" class="menu-item-link" title="ÂΩíÊ°£">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">ÂΩíÊ°£</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/tags" class="menu-item-link" title="Ê†áÁ≠æ">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">Ê†áÁ≠æ</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/categories" class="menu-item-link" title="ÂàÜÁ±ª">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">ÂàÜÁ±ª</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/about" class="menu-item-link" title="ÂÖ≥‰∫é">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">ÂÖ≥‰∫é</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/friends" class="menu-item-link" title="ÂèãÊÉÖÈìæÊé•">
                  
                  <span class="name">ÂèãÊÉÖÈìæÊé•</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="javascript:;" class="menu-item-link" title="üê±Êõ¥Â§ö">
                  
                  <span class="name">üê±Êõ¥Â§ö</span>
                  <i class="fas fa-chevron-down arrow" aria-hidden="true"></i>
                </a>
                <ul class="sub-menu">
                  
                  <li>
                    <a href="/gallery">
                      
                      <span>üì∑ÂõæÂ∫ì</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="/me">
                      
                      <span>üßíüèªÂÖ≥‰∫éÊàë</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
      </ul>
      
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fas fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <h2>
          <span>
            <i class="fas fa-search" aria-hidden="true"></i>
            <span class="title">Êú¨Âú∞ÊêúÁ¥¢</span>
          </span>
          <i class="fas fa-times close" pointer style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i>
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="ËØ∑ËæìÂÖ•ÂÖ≥ÈîÆÂ≠ó"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="/js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
      window.addEventListener('pjax:complete', () => {
        this.cancelDialogVisible();
      })
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // Èò≤Ê≠¢È°µÈù¢ÊªöÂä®ÔºåÂè™ËÉΩËÆ©ÂºπÊ°ÜÊªöÂä®
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("/search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- Ëß£ÂÜ≥Âà∑Êñ∞È°µÈù¢Èó™ÁÉÅÈóÆÈ¢òÔºåÂèØ‰ª•Âú®ÂÖÉÁ¥†‰∏äÊ∑ªÂä†display: none, ÊàñËÄÖÁî®vue.extendÊñπÊ≥ïÔºåËØ¶ÊÉÖÔºöhttps://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- ‰∏ãÈù¢ÊòØÊêúÁ¥¢Âü∫Êú¨ÂÜôÊ≥ï -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
    <a target="_blank" rel="noopener" href="https://github.com/ctrl-github" class="github-corner color-primary" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  
  
    <div id="he-plugin-simple"></div>
    <script>
      WIDGET = {
        CONFIG: {
          "modules": "012",
          "background": 5,
          "tmpColor": "4A4A4A",
          "tmpSize": 16,
          "cityColor": "4A4A4A",
          "citySize": 16,
          "aqiSize": 16,
          "weatherIconSize": 24,
          "alertIconSize": 18,
          "padding": "10px 10px 10px 10px",
          "shadow": "1",
          "language": "auto",
          "borderRadius": 5,
          "fixed": "false",
          "vertical": "middle",
          "horizontal": "center",
          "key": "2784dd3fcb1e4f0f9a9b579bf69641f2"
        }
      }
    </script>
    <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script> 
    

    <!-- ÂΩìÂ§¥ÈÉ®ÂØºËà™ËÆæÁΩÆ‰∏∫ËÉåÊôØÈÄèÊòéÁöÑÊó∂ÂÄô  -->
    
      <script src="/js/header/index.js" data-pjax></script>
    
</header>

    <!-- ÈúÄË¶ÅÂú®‰∏äÈù¢Âä†ËΩΩÁöÑjs -->
    <script>
  function loadScript(src, cb) {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }

  //https://github.com/filamentgroup/loadCSS
  var loadCSS = function (href, before, media, attributes) {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  };

</script> 

<!-- ËΩÆÊí≠ÂõæÊâÄÈúÄË¶ÅÁöÑjs -->
<script src="/js/swiper/swiper.min.js"></script>
<script src="/js/swiper/vue-awesome-swiper.js"></script>
<script src="/js/swiper/swiper.animate1.0.3.min.js"></script>


  <script src="/js/vue-typed-js/index.js"></script>


<!-- È¶ñÈ°µÁöÑÂÖ¨ÂëäÊªöÂä®Êèí‰ª∂ÁöÑjsÈúÄË¶ÅÈáçÊñ∞Âä†ËΩΩ -->
<script src="/js/vue-seamless-scroll/index.js"></script>

<!-- ÊâìÂ≠óÊú∫ÊïàÊûújs -->
<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>


    <!-- ÂÜÖÂÆπÂå∫Âüü -->
    <div id="safearea">
      <main class="main" id="pjax-container" style="margin-top: 0;">
        
 <!-- prismjs ‰ª£Á†ÅÈ´ò‰∫Æ -->
 
    
    <link href="/js/prism/prism-line-numbers.css" rel="stylesheet">
    
        <link href="/js/prism/prism.min.css" rel="stylesheet">
    

    <style>
        pre[class*="language-"] {
            overflow-y: hidden;
        }
        .line-numbers .line-numbers-rows {
            border: none;
        }
    </style>
  


<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>

<!-- ÊñáÁ´†ËØ¶ÊÉÖÈ°µÈ°∂ÈÉ®ÂõæÁâáÂíåÊ†áÈ¢ò -->




<div class="post-detail-header" id="thumbnail_canvas" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;background-image:url('/medias/7.jpg')">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0;pointer-events:none;"></canvas>
  
  <div class="post-detail-header_info-box">
    <div class="title-box">
      <span class="title">
        Java-Concurrent
      </span>
    </div>
    
    
      
        <span class="post-detail-header_date">
          <i class="fas fa-calendar"></i> ÂèëË°®‰∫éÔºö2022-11-23 |
        </span>
      

      
        <span class="post-detail-header_categories">
          <i class="iconfont iconbookmark1"></i> ÂàÜÁ±ªÔºö
          
            <a href="/categories/Java-Concurrent/" class="post-detail-header_category">
              Java-Concurrent
            </a>
          
        </span>
      

      
        <div class="post-detail-header_wordcount">
          <span class="totalcount">
            <i class="fas fa-file-text-o"></i> Â≠óÊï∞ÁªüËÆ°: 95.7k |
          </span>
  
          <span class="min2read">
            <i class="fas fa-clock"></i> ÈòÖËØªÊó∂Èïø: 380ÂàÜÈíü |
          </span>
  
          
            <span class="reading">
              <i class="fas fa-eye"></i> ÈòÖËØªÈáèÔºö<span id="busuanzi_value_page_pv"></span>
            </span>
          
        </div>
      
    
  </div>
  
  
    <script src="/js/bubble/bubble.js"></script>
  
</div>



<div class="row justify-position">
  <div class="main-content">
    <article class="post post-detail">
      <div class="post-content">
        <h1 id="JavaÂπ∂ÂèëÁºñÁ®ã"><a href="#JavaÂπ∂ÂèëÁºñÁ®ã" class="headerlink" title="JavaÂπ∂ÂèëÁºñÁ®ã"></a>JavaÂπ∂ÂèëÁºñÁ®ã</h1><h1 id="Á∫øÁ®ãÂπ∂ÂèëÂü∫Á°Ä"><a href="#Á∫øÁ®ãÂπ∂ÂèëÂü∫Á°Ä" class="headerlink" title="Á∫øÁ®ãÂπ∂ÂèëÂü∫Á°Ä"></a>Á∫øÁ®ãÂπ∂ÂèëÂü∫Á°Ä</h1><h2 id="Âü∫Á°ÄÊ¶ÇÂøµ"><a href="#Âü∫Á°ÄÊ¶ÇÂøµ" class="headerlink" title="Âü∫Á°ÄÊ¶ÇÂøµ"></a>Âü∫Á°ÄÊ¶ÇÂøµ</h2><h3 id="CPUÊ†∏ÂøÉÊï∞ÂíåÁ∫øÁ®ãÊï∞ÁöÑÂÖ≥Á≥ª"><a href="#CPUÊ†∏ÂøÉÊï∞ÂíåÁ∫øÁ®ãÊï∞ÁöÑÂÖ≥Á≥ª" class="headerlink" title="CPUÊ†∏ÂøÉÊï∞ÂíåÁ∫øÁ®ãÊï∞ÁöÑÂÖ≥Á≥ª"></a>CPUÊ†∏ÂøÉÊï∞ÂíåÁ∫øÁ®ãÊï∞ÁöÑÂÖ≥Á≥ª</h3><p>Ê†∏ÂøÉÊï∞:Á∫øÁ®ãÊï∞&#x3D;1:1 ;‰ΩøÁî®‰∫ÜË∂ÖÁ∫øÁ®ãÊäÄÊúØÂêé‚Äî&gt; 1:2</p>
<h3 id="CPUÊó∂Èó¥ÁâáËΩÆËΩ¨Êú∫Âà∂"><a href="#CPUÊó∂Èó¥ÁâáËΩÆËΩ¨Êú∫Âà∂" class="headerlink" title="CPUÊó∂Èó¥ÁâáËΩÆËΩ¨Êú∫Âà∂"></a>CPUÊó∂Èó¥ÁâáËΩÆËΩ¨Êú∫Âà∂</h3><p>ÂèàÁß∞RRË∞ÉÂ∫¶Ôºå‰ºöÂØºËá¥‰∏ä‰∏ãÊñáÂàáÊç¢</p>
<blockquote>
<h3 id="Êó∂Èó¥ÁâáËΩÆËΩ¨Êú∫Âà∂-RR-Ë∞ÉÂ∫¶"><a href="#Êó∂Èó¥ÁâáËΩÆËΩ¨Êú∫Âà∂-RR-Ë∞ÉÂ∫¶" class="headerlink" title="Êó∂Èó¥ÁâáËΩÆËΩ¨Êú∫Âà∂(RR Ë∞ÉÂ∫¶)"></a>Êó∂Èó¥ÁâáËΩÆËΩ¨Êú∫Âà∂(RR Ë∞ÉÂ∫¶)</h3><p>Êó∂Èó¥ÁâáËΩÆËΩ¨Ê≥ïÔºàRound-RobinÔºåRRÔºâ‰∏ªË¶ÅÁî®‰∫éÂàÜÊó∂Á≥ªÁªü‰∏≠ÁöÑËøõÁ®ãË∞ÉÂ∫¶„ÄÇ‰∏∫‰∫ÜÂÆûÁé∞ËΩÆËΩ¨Ë∞ÉÂ∫¶ÔºåÁ≥ªÁªüÊääÊâÄÊúâÂ∞±Áª™ËøõÁ®ãÊåâÂÖàÂÖ•ÂÖàÂá∫ÁöÑÂéüÂàôÊéíÊàê‰∏Ä‰∏™ÈòüÂàó„ÄÇÊñ∞Êù•ÁöÑËøõÁ®ãÂä†Âà∞Â∞±Áª™ÈòüÂàóÊú´Â∞æ„ÄÇÊØèÂΩìÊâßË°åËøõÁ®ãË∞ÉÂ∫¶Êó∂ÔºåËøõÁ®ãË∞ÉÂ∫¶Á®ãÂ∫èÊÄªÊòØÈÄâÂá∫Â∞±Áª™ÈòüÂàóÁöÑÈòüÈ¶ñËøõÁ®ãÔºåËÆ©ÂÆÉÂú® CPU ‰∏äËøêË°å‰∏Ä‰∏™Êó∂Èó¥ÁâáÁöÑÊó∂Èó¥„ÄÇÊó∂Èó¥ÁâáÊòØ‰∏Ä‰∏™Â∞èÁöÑÊó∂Èó¥Âçï‰ΩçÔºåÈÄöÂ∏∏‰∏∫ 10~100ms Êï∞ÈáèÁ∫ß„ÄÇÂΩìËøõÁ®ãÁî®ÂÆåÂàÜÁªôÂÆÉÁöÑÊó∂Èó¥ÁâáÂêéÔºåÁ≥ªÁªüÁöÑËÆ°Êó∂Âô®ÂèëÂá∫Êó∂Èíü‰∏≠Êñ≠ÔºåË∞ÉÂ∫¶Á®ãÂ∫è‰æøÂÅúÊ≠¢ËØ•ËøõÁ®ãÁöÑËøêË°åÔºåÊääÂÆÉÊîæÂÖ•Â∞±Áª™ÈòüÂàóÁöÑÊú´Â∞æÔºõÁÑ∂ÂêéÔºåÊää CPU ÂàÜÁªôÂ∞±Áª™ÈòüÂàóÁöÑÈòüÈ¶ñËøõÁ®ãÔºåÂêåÊ†∑‰πüËÆ©ÂÆÉËøêË°å‰∏Ä‰∏™Êó∂Èó¥ÁâáÔºåÂ¶ÇÊ≠§ÂæÄÂ§ç„ÄÇ</p>
<p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%97%B6%E9%97%B4%E7%89%87%E8%BD%AE%E8%BD%AC%E8%B0%83%E5%BA%A6/3059054">Êó∂Èó¥ÁâáËΩÆËΩ¨Ë∞ÉÂ∫¶</a>ÊòØ‰∏ÄÁßçÊúÄÂè§ËÄÅÔºåÊúÄÁÆÄÂçïÔºåÊúÄÂÖ¨Âπ≥‰∏î‰ΩøÁî®ÊúÄÂπøÁöÑÁÆóÊ≥ï„ÄÇÊØè‰∏™ËøõÁ®ãË¢´ÂàÜÈÖç‰∏ÄÊó∂Èó¥ÊÆµÔºåÁß∞‰ΩúÂÆÉÁöÑÊó∂Èó¥ÁâáÔºåÂç≥ËØ•ËøõÁ®ãÂÖÅËÆ∏ËøêË°åÁöÑÊó∂Èó¥„ÄÇ</p>
<p>Êó∂Èó¥ÁâáËÆæÂæóÂ§™Áü≠‰ºöÂØºËá¥ËøáÂ§öÁöÑËøõÁ®ãÂàáÊç¢ÔºåÈôç‰Ωé‰∫ÜCPUÊïàÁéáÔºõËÄåËÆæÂæóÂ§™ÈïøÂèàÂèØËÉΩÂºïËµ∑ÂØπÁü≠ÁöÑ‰∫§‰∫íËØ∑Ê±ÇÁöÑÂìçÂ∫îÂèòÂ∑Æ„ÄÇÂ∞ÜÊó∂Èó¥ÁâáËÆæ‰∏∫100ÊØ´ÁßíÈÄöÂ∏∏ÊòØ‰∏Ä‰∏™ÊØîËæÉÂêàÁêÜÁöÑÊäò‰∏≠„ÄÇ</p>
</blockquote>
<h3 id="‰ªÄ‰πàÊòØËøõÁ®ãÂíåÁ∫øÁ®ã"><a href="#‰ªÄ‰πàÊòØËøõÁ®ãÂíåÁ∫øÁ®ã" class="headerlink" title="‰ªÄ‰πàÊòØËøõÁ®ãÂíåÁ∫øÁ®ã"></a>‰ªÄ‰πàÊòØËøõÁ®ãÂíåÁ∫øÁ®ã</h3><p>ËøõÁ®ãÔºöÁ®ãÂ∫èËøêË°åËµÑÊ∫êÂàÜÈÖçÁöÑÊúÄÂ∞èÂçï‰ΩçÔºåËøõÁ®ãÂÜÖÈÉ®ÊúâÂ§ö‰∏™Á∫øÁ®ãÔºå‰ºöÂÖ±‰∫´Ëøô‰∏™ËøõÁ®ãÁöÑËµÑÊ∫ê</p>
<p>Á∫øÁ®ãÔºöCPUË∞ÉÂ∫¶ÁöÑÊúÄÂ∞èÂçï‰ΩçÔºåÂøÖÈ°ª‰æùËµñËøõÁ®ãËÄåÂ≠òÂú®„ÄÇ</p>
<h3 id="ÊæÑÊ∏ÖÂπ∂Ë°åÂíåÂπ∂Âèë"><a href="#ÊæÑÊ∏ÖÂπ∂Ë°åÂíåÂπ∂Âèë" class="headerlink" title="ÊæÑÊ∏ÖÂπ∂Ë°åÂíåÂπ∂Âèë"></a>ÊæÑÊ∏ÖÂπ∂Ë°åÂíåÂπ∂Âèë</h3><p>Âπ∂Ë°åÔºöÂêå‰∏ÄÊó∂ÂàªÔºåÂèØ‰ª•ÂêåÊó∂Â§ÑÁêÜ‰∫ãÊÉÖÁöÑËÉΩÂäõ</p>
<p>Âπ∂ÂèëÔºö‰∏éÂçï‰ΩçÊó∂Èó¥Áõ∏ÂÖ≥ÔºåÂú®Âçï‰ΩçÊó∂Èó¥ÂÜÖÂèØ‰ª•Â§ÑÁêÜ‰∫ãÊÉÖÁöÑËÉΩÂäõ</p>
<h3 id="È´òÂπ∂ÂèëÁºñÁ®ãÁöÑÊÑè‰πâ„ÄÅÂ•ΩÂ§ÑÂíåÊ≥®ÊÑè‰∫ãÈ°π"><a href="#È´òÂπ∂ÂèëÁºñÁ®ãÁöÑÊÑè‰πâ„ÄÅÂ•ΩÂ§ÑÂíåÊ≥®ÊÑè‰∫ãÈ°π" class="headerlink" title="È´òÂπ∂ÂèëÁºñÁ®ãÁöÑÊÑè‰πâ„ÄÅÂ•ΩÂ§ÑÂíåÊ≥®ÊÑè‰∫ãÈ°π"></a>È´òÂπ∂ÂèëÁºñÁ®ãÁöÑÊÑè‰πâ„ÄÅÂ•ΩÂ§ÑÂíåÊ≥®ÊÑè‰∫ãÈ°π</h3><p>Â•ΩÂ§ÑÔºöÂÖÖÂàÜÂà©Áî®cpuÁöÑËµÑÊ∫ê„ÄÅÂä†Âø´Áî®Êà∑ÂìçÂ∫îÁöÑÊó∂Èó¥ÔºåÁ®ãÂ∫èÊ®°ÂùóÂåñÔºåÂºÇÊ≠•Âåñ</p>
<p>ÈóÆÈ¢òÔºö</p>
<p>Á∫øÁ®ãÂÖ±‰∫´ËµÑÊ∫êÔºåÂ≠òÂú®ÂÜ≤Á™ÅÔºõ</p>
<p>ÂÆπÊòìÂØºËá¥Ê≠ªÈîÅÔºõ</p>
<p>ÂêØÁî®Â§™Â§öÁöÑÁ∫øÁ®ãÔºåÂ∞±ÊúâÊêûÂûÆÊú∫Âô®ÁöÑÂèØËÉΩ</p>
<h2 id="ËÆ§ËØÜJavaÈáåÈù¢ÁöÑThread"><a href="#ËÆ§ËØÜJavaÈáåÈù¢ÁöÑThread" class="headerlink" title="ËÆ§ËØÜJavaÈáåÈù¢ÁöÑThread"></a>ËÆ§ËØÜJavaÈáåÈù¢ÁöÑThread</h2><h3 id="JavaÈáåÁöÑÁ®ãÂ∫èÂ§©ÁîüÂ∞±ÊòØÂ§öÁ∫øÁ®ãÁöÑ"><a href="#JavaÈáåÁöÑÁ®ãÂ∫èÂ§©ÁîüÂ∞±ÊòØÂ§öÁ∫øÁ®ãÁöÑ" class="headerlink" title="JavaÈáåÁöÑÁ®ãÂ∫èÂ§©ÁîüÂ∞±ÊòØÂ§öÁ∫øÁ®ãÁöÑ"></a><strong>JavaÈáåÁöÑÁ®ãÂ∫èÂ§©ÁîüÂ∞±ÊòØÂ§öÁ∫øÁ®ãÁöÑ</strong></h3><h4 id="No1-OnlyMain-java"><a href="#No1-OnlyMain-java" class="headerlink" title="No1_OnlyMain.java"></a>No1_OnlyMain.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>management<span class="token punctuation">.</span></span><span class="token class-name">ManagementFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>management<span class="token punctuation">.</span></span><span class="token class-name">ThreadInfo</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>management<span class="token punctuation">.</span></span><span class="token class-name">ThreadMXBean</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ctrl
 * javaÁöÑÂ§öÁ∫øÁ®ãÊó†Â§Ñ‰∏çÂú®
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnlyMain</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Ëé∑Âèñ Java Á∫øÁ®ãÁÆ°ÁêÜ MXBean ËôöÊãüÊú∫Á∫øÁ®ãÁÆ°ÁêÜÁöÑÊé•Âè£</span>
        <span class="token class-name">ThreadMXBean</span> threadMXBean <span class="token operator">=</span> <span class="token class-name">ManagementFactory</span><span class="token punctuation">.</span><span class="token function">getThreadMXBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ‰∏çÈúÄË¶ÅËé∑ÂèñÂêåÊ≠•ÁöÑ monitor Âíå synchronizer ‰ø°ÊÅØÔºå‰ªÖËé∑ÂèñÁ∫øÁ®ãÂíåÁ∫øÁ®ãÂ†ÜÊ†à‰ø°ÊÅØ</span>
        <span class="token class-name">ThreadInfo</span><span class="token punctuation">[</span><span class="token punctuation">]</span> threadInfos <span class="token operator">=</span> threadMXBean<span class="token punctuation">.</span><span class="token function">dumpAllThreads</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ÈÅçÂéÜÁ∫øÁ®ã‰ø°ÊÅØÔºå‰ªÖÊâìÂç∞Á∫øÁ®ã ID ÂíåÁ∫øÁ®ãÂêçÁß∞‰ø°ÊÅØ</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ThreadInfo</span> threadInfo <span class="token operator">:</span> threadInfos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"["</span> <span class="token operator">+</span> threadInfo<span class="token punctuation">.</span><span class="token function">getThreadId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"] "</span> <span class="token operator">+</span> threadInfo<span class="token punctuation">.</span><span class="token function">getThreadName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‰∏äËø∞Á®ãÂ∫èËæìÂá∫Â¶Ç‰∏ãÔºàËæìÂá∫ÂÜÖÂÆπÂèØËÉΩ‰∏çÂêåÔºå‰∏çÁî®Â§™Á∫†Áªì‰∏ãÈù¢ÊØè‰∏™Á∫øÁ®ãÁöÑ‰ΩúÁî®ÔºåÂè™Áî®Áü•ÈÅì main Á∫øÁ®ãÊâßË°å main ÊñπÊ≥ïÂç≥ÂèØÔºâÔºö</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//[6] Monitor Ctrl-Break //ÁõëÂê¨‰∏≠Êñ≠</span>
<span class="token comment">//[5] Attach Listener //Ê∑ªÂä†‰∫ã‰ª∂</span>
<span class="token comment">//[4] Signal Dispatcher // ÂàÜÂèëÂ§ÑÁêÜÁªô JVM ‰ø°Âè∑ÁöÑÁ∫øÁ®ã</span>
<span class="token comment">//[3] Finalizer //Ë∞ÉÁî®ÂØπË±° finalize ÊñπÊ≥ïÁöÑÁ∫øÁ®ã</span>
<span class="token comment">//[2] Reference Handler //Ê∏ÖÈô§ reference Á∫øÁ®ã</span>
<span class="token comment">//[1] main //main Á∫øÁ®ã,Á®ãÂ∫èÂÖ•Âè£</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p> <strong>‰ªé‰∏äÈù¢ÁöÑËæìÂá∫ÂÜÖÂÆπÂèØ‰ª•ÁúãÂá∫Ôºö‰∏Ä‰∏™ Java Á®ãÂ∫èÁöÑËøêË°åÊòØ main Á∫øÁ®ãÂíåÂ§ö‰∏™ÂÖ∂‰ªñÁ∫øÁ®ãÂêåÊó∂ËøêË°å„ÄÇ</strong></p>
</blockquote>
<h3 id="Á∫øÁ®ãÁÆÄÂçïÂÆûÁé∞ÁöÑ‰∏âÁßçÊñπÊ≥ï"><a href="#Á∫øÁ®ãÁÆÄÂçïÂÆûÁé∞ÁöÑ‰∏âÁßçÊñπÊ≥ï" class="headerlink" title="Á∫øÁ®ãÁÆÄÂçïÂÆûÁé∞ÁöÑ‰∏âÁßçÊñπÊ≥ï"></a>Á∫øÁ®ãÁÆÄÂçïÂÆûÁé∞ÁöÑ‰∏âÁßçÊñπÊ≥ï</h3><p>‚Äã        Á∫øÁ®ãÊòØÁ®ãÂ∫è‰∏≠ÁöÑÊâßË°åÁ∫øÁ®ã„ÄÇJava ËôöÊãüÊú∫ÂÖÅËÆ∏Â∫îÁî®Á®ãÂ∫èÂπ∂ÂèëÂú∞ËøêË°åÂ§ö‰∏™ÊâßË°åÁ∫øÁ®ã„ÄÇÊØè‰∏™Á∫øÁ®ãÈÉΩÊúâ‰∏Ä‰∏™‰ºòÂÖàÁ∫ßÔºåÈ´ò‰ºòÂÖàÁ∫ßÁ∫øÁ®ãÁöÑÊâßË°å‰ºòÂÖà‰∫é‰Ωé‰ºòÂÖàÁ∫ßÁ∫øÁ®ã„ÄÇÊØè‰∏™Á∫øÁ®ãÈÉΩÂèØ‰ª•Êàñ‰∏çÂèØ‰ª•Ê†áËÆ∞‰∏∫‰∏Ä‰∏™ÂÆàÊä§Á®ãÂ∫è„ÄÇÂΩìÊüê‰∏™Á∫øÁ®ã‰∏≠ËøêË°åÁöÑ‰ª£Á†ÅÂàõÂª∫‰∏Ä‰∏™Êñ∞ThreadÂØπË±°Êó∂ÔºåËØ•Êñ∞Á∫øÁ®ãÁöÑÂàùÂßã‰ºòÂÖàÁ∫ßË¢´ËÆæÂÆö‰∏∫ÂàõÂª∫Á∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ßÔºåÂπ∂‰∏îÂΩì‰∏î‰ªÖÂΩìÂàõÂª∫Á∫øÁ®ãÊòØÂÆàÊä§Á∫øÁ®ãÊó∂ÔºåÊñ∞Á∫øÁ®ãÊâçÊòØÂÆàÊä§Á®ãÂ∫è„ÄÇÂΩìJava ËôöÊãüÊú∫ÂêØÂä®Êó∂ÔºåÈÄöÂ∏∏ÈÉΩ‰ºöÊúâÂçï‰∏™ÈùûÂÆàÊä§Á∫øÁ®ãÔºàÂÆÉÈÄöÂ∏∏‰ºöË∞ÉÁî®Êüê‰∏™ÊåáÂÆöÁ±ªÁöÑ mainÊñπÊ≥ï)„ÄÇJavaËôöÊãüÊú∫‰ºöÁªßÁª≠ÊâßË°åÁ∫øÁ®ãÔºåÁõ¥Âà∞‰∏ãÂàó‰ªª‰∏ÄÊÉÖÂÜµÂá∫Áé∞Êó∂‰∏∫Ê≠¢:Ë∞ÉÁî®‰∫Ü RuntimeÁ±ªÁöÑ exitÊñπÊ≥ïÔºåÂπ∂‰∏îÂÆâÂÖ®ÁÆ°ÁêÜÂô®ÂÖÅËÆ∏ÈÄÄÂá∫Êìç‰ΩúÂèëÁîü„ÄÇÈùûÂÆàÊä§Á∫øÁ®ãÁöÑÊâÄÊúâÁ∫øÁ®ãÈÉΩÂ∑≤ÂÅúÊ≠¢ËøêË°åÔºåÊó†ËÆ∫ÊòØÈÄöËøá‰ªéÂØπrunÊñπÊ≥ïÁöÑË∞ÉÁî®‰∏≠ËøîÂõûÔºåËøòÊòØÈÄöËøáÊäõÂá∫‰∏Ä‰∏™‰º†Êí≠Âà∞ runÊñπÊ≥ï‰πãÂ§ñÁöÑÂºÇÂ∏∏„ÄÇ</p>
<p>‰∏âÁßç</p>
<ul>
<li>Á±ªThread</li>
<li>Êé•Âè£Runnable</li>
<li>Êé•Âè£Callable</li>
</ul>
<h4 id="No2-CreateThread-java"><a href="#No2-CreateThread-java" class="headerlink" title="No2_CreateThread.java"></a>No2_CreateThread.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Callable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">FutureTask</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author ctrl
 * javaÊñ∞ÂêØÁ∫øÁ®ãÁöÑÊñπÂºè
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No2_CreateThread</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/*Êâ©Â±ïËá™ThreadÁ±ª*/</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"I am extends Thread!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">/*ÂÆûÁé∞RunnableÊé•Âè£*/</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"I am implements Runnable!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/*ÂÆûÁé∞CallableÊé•Âè£ÔºåÂÖÅËÆ∏ÊúâËøîÂõûÂÄº*/</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyCallable</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"I am implements Callable"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">"CallResult"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//Á∫øÁ®ãÊòØÁ®ãÂ∫è‰∏≠ÊâßË°åÁöÑÁ∫øÁ®ã„ÄÇ</span>
    <span class="token comment">//JavaËôöÊãüÊú∫ÂÖÅËÆ∏Â∫îÁî®Á®ãÂ∫èÂêåÊó∂ÊâßË°åÂ§ö‰∏™ÊâßË°åÁ∫øÁ®ã„ÄÇ</span>
    <span class="token comment">//ÊØè‰∏™Á∫øÁ®ãÈÉΩÊúâ‰ºòÂÖàÊùÉ„ÄÇ</span>
    <span class="token comment">//ÂÖ∑ÊúâËæÉÈ´ò‰ºòÂÖàÁ∫ßÁöÑÁ∫øÁ®ã‰ºòÂÖà‰∫é‰ºòÂÖàÁ∫ßËæÉ‰ΩéÁöÑÁ∫øÁ®ãÊâßË°å„ÄÇ ÊØè‰∏™Á∫øÁ®ãÂèØËÉΩ‰πüÂèØËÉΩ‰∏ç‰ºöË¢´Ê†áËÆ∞‰∏∫ÂÆàÊä§Á®ãÂ∫è„ÄÇ</span>
    <span class="token comment">//ÂΩìÂú®Êüê‰∏™Á∫øÁ®ã‰∏≠ËøêË°åÁöÑ‰ª£Á†ÅÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑThreadÂØπË±°Êó∂ÔºåÊñ∞Á∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ßÊúÄÂàùËÆæÁΩÆ‰∏∫Á≠â‰∫éÂàõÂª∫Á∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ßÔºåÂπ∂‰∏îÂΩì‰∏î‰ªÖÂΩìÂàõÂª∫Á∫øÁ®ãÊòØÂÆàÊä§ËøõÁ®ãÊó∂ÊâçÊòØÂÆàÊä§Á∫øÁ®ã„ÄÇ</span>

    <span class="token comment">//ÂΩìJavaËôöÊãüÊú∫ÂêØÂä®Êó∂ÔºåÈÄöÂ∏∏Êúâ‰∏Ä‰∏™ÈùûÂÆàÊä§ËøõÁ®ãÁ∫øÁ®ãÔºàÈÄöÂ∏∏Ë∞ÉÁî®Êüê‰∫õÊåáÂÆöÁ±ªÁöÑÂêç‰∏∫mainÁöÑÊñπÊ≥ïÔºâ„ÄÇ</span>
    <span class="token comment">//JavaËôöÊãüÊú∫Â∞ÜÁªßÁª≠ÊâßË°åÁ∫øÁ®ãÔºåÁõ¥Âà∞ÂèëÁîü‰ª•‰∏ã‰ªª‰∏ÄÊÉÖÂÜµÔºö</span>
    <span class="token comment">// - Â∑≤ÁªèË∞ÉÁî®‰∫ÜRuntimeÁ±ªÁöÑexitÊñπÊ≥ïÔºåÂπ∂‰∏îÂÆâÂÖ®ÁÆ°ÁêÜÂô®Â∑≤ÁªèÂÖÅËÆ∏ËøõË°åÈÄÄÂá∫Êìç‰Ωú„ÄÇ</span>
    <span class="token comment">// - ÊâÄÊúâ‰∏çÊòØÂÆàÊä§ËøõÁ®ãÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÈÉΩÂ∑≤ÁªèÊ≠ª‰∫°ÔºåÊó†ËÆ∫ÊòØ‰ªéË∞ÉÁî®ËøîÂõûÂà∞runÊñπÊ≥ïËøòÊòØÊäõÂá∫Ë∂ÖÂá∫runÊñπÊ≥ïÁöÑrun</span>

    <span class="token comment">//ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÊâßË°åÁ∫øÁ®ãÊúâ‰∏§ÁßçÊñπÊ≥ï„ÄÇ ‰∏Ä‰∏™ÊòØÂ∞Ü‰∏Ä‰∏™Á±ªÂ£∞Êòé‰∏∫ThreadÁöÑÂ≠êÁ±ª„ÄÇ Ëøô‰∏™Â≠êÁ±ªÂ∫îËØ•ÈáçÂÜôrunÁ±ªÁöÑÊñπÊ≥ïThread „ÄÇ ÁÑ∂ÂêéÂèØ‰ª•ÂàÜÈÖçÂπ∂ÂêØÂä®Â≠êÁ±ªÁöÑÂÆû‰æã„ÄÇ</span>
    <span class="token comment">//Âè¶‰∏ÄÁßçÊñπÊ≥ïÊù•ÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ãÊòØÂ£∞ÊòéÂÆûÁé∞Á±ªRunnableÊé•Âè£„ÄÇ ÈÇ£‰∏™Á±ªÁÑ∂ÂêéÂÆûÁé∞‰∫ÜrunÊñπÊ≥ï„ÄÇ ÁÑ∂ÂêéÂèØ‰ª•ÂàÜÈÖçÁ±ªÁöÑÂÆû‰æãÔºåÂú®ÂàõÂª∫ThreadÊó∂‰Ωú‰∏∫ÂèÇÊï∞‰º†ÈÄíÔºåÂπ∂ÂêØÂä®</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//start() ÂØºËá¥ËØ•Á∫øÁ®ãÂºÄÂßãÊâßË°å;JavaËôöÊãüÊú∫Ë∞ÉÁî®ËØ•Á∫øÁ®ãÁöÑrunÊñπÊ≥ï„ÄÇ</span>
        <span class="token comment">//ÁªìÊûúÊòØ‰∏§‰∏™Á∫øÁ®ãÂπ∂ÂèëËøêË°å:ÂΩìÂâçÁ∫øÁ®ã(‰ªéË∞ÉÁî®startÊñπÊ≥ïËøîÂõû)ÂíåÂè¶‰∏Ä‰∏™Á∫øÁ®ã(ÊâßË°åÂÆÉÁöÑrunÊñπÊ≥ï)„ÄÇ</span>
        <span class="token comment">//Â§öÊ¨°ÂêØÂä®‰∏Ä‰∏™Á∫øÁ®ãÊòØ‰∏çÂêàÊ≥ïÁöÑ„ÄÇÁâπÂà´ÊòØÔºåÁ∫øÁ®ã‰∏ÄÊó¶ÂÆåÊàêÊâßË°åÔºåÂ∞±‰∏çËÉΩÈáçÊñ∞ÂêØÂä®„ÄÇ</span>
        <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello Lambda!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">MyCallable</span> useCallable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyCallable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> futureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>useCallable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Thread-ÈáåÈù¢ÁöÑÂ±ûÊÄßÂíåÊñπÊ≥ï"><a href="#Thread-ÈáåÈù¢ÁöÑÂ±ûÊÄßÂíåÊñπÊ≥ï" class="headerlink" title="Thread ÈáåÈù¢ÁöÑÂ±ûÊÄßÂíåÊñπÊ≥ï"></a>Thread ÈáåÈù¢ÁöÑÂ±ûÊÄßÂíåÊñπÊ≥ï</h3><p>Á¨¨‰∏ÄÊ≠•:ÂÖàÁúã‰∏Ä‰∏ã ThreadÁöÑAPIÊúâÂì™‰∫õÂ∏∏Áî®ÁöÑÊñπÊ≥ïÔºåÊé•‰∏ãÊù•Êàë‰ª¨ÊâæÂá†‰∏™ÊñπÊ≥ïÂÅö‰∏Ä‰∏ãÊµãËØï„ÄÇ„ÄÇ<br>ÊûÑÈÄ†ÊñπÊ≥ïÂ∏∏Áî®ÁöÑÊúâ:</p>
<p>1„ÄÅThread() ÂàÜÈÖçÊñ∞ÁöÑThreadÂØπË±°„ÄÇ<br>2„ÄÅThread(Runnable target) ÂàÜÈÖçÊñ∞ÁöÑ ThreadÂØπË±°„ÄÇ<br>3„ÄÅThread(Runnable target,String name) ÂàÜÈÖçÊñ∞ÁöÑ ThreadÂØπË±°„ÄÇ<br>4„ÄÅThread(String name) ÂàÜÈÖçÊñ∞ÁöÑ ThreadÂØπË±°„ÄÇ<br>5„ÄÅThread(ThreadGroup group, String name) ÂàÜÈÖçÊñ∞ÁöÑThreadÂØπË±°„ÄÇ</p>
<p>‰∏ªË¶ÅÁöÑÊñπÊ≥ïÊúâÂ¶Ç‰∏ãË°®ÊâÄÁ§∫:</p>
<p><img src="/image/Concurrent/Concurrent0.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent0.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p><img src="/image/Concurrent/Concurrent1.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent1.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<blockquote>
<p><strong>ÂçïÁã¨ËØ¥‰∏Ä‰∏ãÁ∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ß:ÂèØ‰ª•Ë∞ÉÁî® ThreadÁ±ªÁöÑÊñπÊ≥ï getPriority() Âíå setPriority()Êù•Â≠òÂèñÁ∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ß„ÄÇÁ∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ß‰ª£Ë°®ËØ•Á∫øÁ®ãÁöÑÈáçË¶ÅÁ®ãÂ∫¶ÔºåÂΩìÊúâÂ§ö‰∏™Á∫øÁ®ãÂêåÊó∂Â§Ñ‰∫éÂèØÊâßË°åÁä∂ÊÄÅÂπ∂Á≠âÂæÖËé∑ÂæóCPUÊó∂Èó¥Êó∂ÔºåÁ∫øÁ®ãË∞ÉÂ∫¶Á≥ªÁªüÊ†πÊçÆÂêÑ‰∏™Á∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ßÊù•ÂÜ≥ÂÆöÁªôË∞ÅÂàÜÈÖç CPUÊó∂Èó¥Ôºå‰ºòÂÖàÁ∫ßÈ´òÁöÑÁ∫øÁ®ãÊúâÊõ¥Â§ßÁöÑÊú∫‰ºöËé∑ÂæóCPU Êó∂Èó¥Ôºå‰ºòÂÖàÁ∫ß‰ΩéÁöÑÁ∫øÁ®ã‰πü‰∏çÊòØÊ≤°ÊúâÊú∫‰ºöÔºåÂè™ÊòØÊú∫‰ºöË¶ÅÂ∞è‰∏Ä‰∫õÁΩ¢‰∫Ü„ÄÇ‰Ω†ÂèØ‰ª•Ë∞ÉÁî®ThreadÁ±ªÁöÑÊñπÊ≥ï getPriority()ÂíåsetPriority()Êù•Â≠òÂèñÁ∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ßÔºåÁ∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ßÁïå‰∫é1(MIN_PRIORITY)Âíå 10(MAX_PRIORITY)‰πãÈó¥,Áº∫ÁúÅÊòØ5(NORM_PRIORITY).</strong></p>
</blockquote>
<p>Á¨¨‰∫åÊ≠•:Êàë‰ª¨Êñ∞Âª∫5‰∏™Á∫øÁ®ãÂÆû‰æãÊù•‰Ωì‰ºö‰∏Ä‰∏ãÂêÑ‰∏™Á∫øÁ®ãÁöÑÂ±ûÊÄß:</p>
<h4 id="No3-Thread-PropertiesAndMethods-java"><a href="#No3-Thread-PropertiesAndMethods-java" class="headerlink" title="No3_Thread_PropertiesAndMethods.java"></a>No3_Thread_PropertiesAndMethods.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No3_Thread_PropertiesAndMethods</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Thread_PropertiesAndMethods</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">//Ê®°ÊãüÂÅö‰∫ãÊÉÖÊâßË°å‰∫Ü30s,‰ª•‰æø‰∏Ä‰ºöÊàë‰ª¨ÁöÑÁõëÊéßÂ∑•ÂÖ∑ÁõëÊéßÂà∞!</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">30000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">Thread</span> currentThread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> currentThreadName <span class="token operator">=</span> currentThread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ËøôÊòØÁ∫øÁ®ãÁöÑÂêçÁß∞:"</span> <span class="token operator">+</span> currentThread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ËøîÂõûÂΩìÂâçÁ∫øÁ®ã"</span> <span class="token operator">+</span> currentThreadName <span class="token operator">+</span> <span class="token string">"ÁöÑÁ∫øÁ®ãÁªÑ‰∏≠Ê¥ªÂä®Á∫øÁ®ãÁöÑÊï∞ÁõÆ:"</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">activeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ËøîÂõûËØ•Á∫øÁ®ã"</span> <span class="token operator">+</span> currentThreadName <span class="token operator">+</span> <span class="token string">"ÁöÑÊ†áËØÜÁ¨¶:"</span> <span class="token operator">+</span> currentThread<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ËøîÂõûÁ∫øÁ®ã"</span> <span class="token operator">+</span> currentThreadName <span class="token operator">+</span> <span class="token string">"ÁöÑ‰ºòÂÖàÁ∫ß:"</span> <span class="token operator">+</span> currentThread<span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ËøîÂõûËØ•Á∫øÁ®ã "</span> <span class="token operator">+</span> currentThreadName <span class="token operator">+</span> <span class="token string">"ÁöÑÁä∂ÊÄÅ:"</span> <span class="token operator">+</span> currentThread<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ËøîÂõûËØ•Á∫øÁ®ã"</span> <span class="token operator">+</span> currentThreadName <span class="token operator">+</span> <span class="token string">"ÊâÄÂ±ûÁöÑÁ∫øÁ®ãÁªÑ:"</span> <span class="token operator">+</span> currentThread<span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÊµãËØïÁ∫øÁ®ã"</span> <span class="token operator">+</span> currentThreadName <span class="token operator">+</span> <span class="token string">"ÊòØÂê¶Â§Ñ‰∫éÊ¥ªÂä®Áä∂ÊÄÅ:"</span> <span class="token operator">+</span> currentThread<span class="token punctuation">.</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÊµãËØïÁ∫øÁ®ã"</span> <span class="token operator">+</span> currentThreadName <span class="token operator">+</span> <span class="token string">"ÊòØÂê¶ÊµãËØïËØ•Á∫øÁ®ãÊòØÂê¶‰∏∫ÂÆàÊä§Á∫øÁ®ã:"</span> <span class="token operator">+</span> currentThread<span class="token punctuation">.</span><span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Thread_PropertiesAndMethods</span> threadb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread_PropertiesAndMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>threadb<span class="token punctuation">,</span> <span class="token string">"Á∫øÁ®ãÂêçÁß∞:("</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">//ËøîÂõûÂØπÂΩìÂâçÊ≠£Âú®ÊâßË°åÁöÑÁ∫øÁ®ãÂØπË±°ÁöÑÂºïÁî®„ÄÇÊ≠§Â§ÑËé∑ÂæóÊàë‰ª¨ÁöÑ‰∏ªÁ∫øÁ®ã</span>
        <span class="token class-name">Thread</span> threadMain <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ËøôÊòØ‰∏ªÁ∫øÁ®ã:threadMain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ËøîÂõûÂΩìÂâçÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÁªÑ‰∏≠Ê¥ªÂä®Á∫øÁ®ãÁöÑÊï∞ÁõÆ:"</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">activeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"‰∏ªÁ∫øÁ®ãÁöÑÂêçÁß∞:"</span> <span class="token operator">+</span> threadMain<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ËøîÂõûËØ•Á∫øÁ®ãÁöÑÊ†áËØÜÁ¨¶:"</span> <span class="token operator">+</span> threadMain<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ËøîÂõûÁ∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ß:"</span> <span class="token operator">+</span> threadMain<span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ËøîÂõûËØ•Á∫øÁ®ãÁöÑÁä∂ÊÄÅ:"</span> <span class="token operator">+</span> threadMain<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ËøîÂõûËØ•Á∫øÁ®ãÊâÄÂ±ûÁöÑÁ∫øÁ®ãÁªÑ:"</span> <span class="token operator">+</span> threadMain<span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÊµãËØïËØ•Á∫øÁ®ãÊòØÂê¶‰∏∫ÂÆàÊä§Á∫øÁ®ã:"</span> <span class="token operator">+</span> threadMain<span class="token punctuation">.</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//‰ºëÊÅØ10s‰ª•‰æøÊàë‰ª¨ÁöÑÁõëÊéßÂ∑•ÂÖ∑ËÉΩÁõëÊéßÂà∞</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÊâìÂç∞</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ËøôÊòØ‰∏ªÁ∫øÁ®ã<span class="token operator">:</span>threadMain
ËøîÂõûÂΩìÂâçÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÁªÑ‰∏≠Ê¥ªÂä®Á∫øÁ®ãÁöÑÊï∞ÁõÆ<span class="token operator">:</span><span class="token number">7</span>
‰∏ªÁ∫øÁ®ãÁöÑÂêçÁß∞<span class="token operator">:</span>main
ËøîÂõûËØ•Á∫øÁ®ãÁöÑÊ†áËØÜÁ¨¶<span class="token operator">:</span><span class="token number">1</span>
ËøîÂõûÁ∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ß<span class="token operator">:</span><span class="token number">5</span>
ËøîÂõûËØ•Á∫øÁ®ãÁöÑÁä∂ÊÄÅ<span class="token operator">:</span>RUNNABLE
ËøîÂõûËØ•Á∫øÁ®ãÊâÄÂ±ûÁöÑÁ∫øÁ®ãÁªÑ<span class="token operator">:</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ThreadGroup</span><span class="token punctuation">[</span>name<span class="token operator">=</span>main<span class="token punctuation">,</span>maxpri<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">]</span>
ÊµãËØïËØ•Á∫øÁ®ãÊòØÂê¶‰∏∫ÂÆàÊä§Á∫øÁ®ã<span class="token operator">:</span><span class="token boolean">true</span>
ËøôÊòØÁ∫øÁ®ãÁöÑÂêçÁß∞<span class="token operator">:</span>Á∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
ËøôÊòØÁ∫øÁ®ãÁöÑÂêçÁß∞<span class="token operator">:</span>Á∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
ËøôÊòØÁ∫øÁ®ãÁöÑÂêçÁß∞<span class="token operator">:</span>Á∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
ËøôÊòØÁ∫øÁ®ãÁöÑÂêçÁß∞<span class="token operator">:</span>Á∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
ËøôÊòØÁ∫øÁ®ãÁöÑÂêçÁß∞<span class="token operator">:</span>Á∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
ËøîÂõûÂΩìÂâçÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>ÁöÑÁ∫øÁ®ãÁªÑ‰∏≠Ê¥ªÂä®Á∫øÁ®ãÁöÑÊï∞ÁõÆ<span class="token operator">:</span><span class="token number">7</span>
ËøîÂõûÂΩìÂâçÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>ÁöÑÁ∫øÁ®ãÁªÑ‰∏≠Ê¥ªÂä®Á∫øÁ®ãÁöÑÊï∞ÁõÆ<span class="token operator">:</span><span class="token number">7</span>
ËøîÂõûËØ•Á∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>ÁöÑÊ†áËØÜÁ¨¶<span class="token operator">:</span><span class="token number">12</span>
ËøîÂõûÂΩìÂâçÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>ÁöÑÁ∫øÁ®ãÁªÑ‰∏≠Ê¥ªÂä®Á∫øÁ®ãÁöÑÊï∞ÁõÆ<span class="token operator">:</span><span class="token number">7</span>
ËøîÂõûÂΩìÂâçÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>ÁöÑÁ∫øÁ®ãÁªÑ‰∏≠Ê¥ªÂä®Á∫øÁ®ãÁöÑÊï∞ÁõÆ<span class="token operator">:</span><span class="token number">7</span>
ËøîÂõûËØ•Á∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>ÁöÑÊ†áËØÜÁ¨¶<span class="token operator">:</span><span class="token number">14</span>
ËøîÂõûÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>ÁöÑ‰ºòÂÖàÁ∫ß<span class="token operator">:</span><span class="token number">5</span>
ËøîÂõûËØ•Á∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>ÁöÑÊ†áËØÜÁ¨¶<span class="token operator">:</span><span class="token number">15</span>
ËøîÂõûÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>ÁöÑ‰ºòÂÖàÁ∫ß<span class="token operator">:</span><span class="token number">5</span>
ËøîÂõûËØ•Á∫øÁ®ã Á∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>ÁöÑÁä∂ÊÄÅ<span class="token operator">:</span>RUNNABLE
ËøîÂõûÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>ÁöÑ‰ºòÂÖàÁ∫ß<span class="token operator">:</span><span class="token number">5</span>
ËøîÂõûËØ•Á∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>ÁöÑÊ†áËØÜÁ¨¶<span class="token operator">:</span><span class="token number">16</span>
ËøîÂõûÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>ÁöÑ‰ºòÂÖàÁ∫ß<span class="token operator">:</span><span class="token number">5</span>
ËøîÂõûËØ•Á∫øÁ®ã Á∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>ÁöÑÁä∂ÊÄÅ<span class="token operator">:</span>RUNNABLE
ËøîÂõûÂΩìÂâçÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>ÁöÑÁ∫øÁ®ãÁªÑ‰∏≠Ê¥ªÂä®Á∫øÁ®ãÁöÑÊï∞ÁõÆ<span class="token operator">:</span><span class="token number">7</span>
ËøîÂõûËØ•Á∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>ÁöÑÊ†áËØÜÁ¨¶<span class="token operator">:</span><span class="token number">13</span>
ËøîÂõûÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>ÁöÑ‰ºòÂÖàÁ∫ß<span class="token operator">:</span><span class="token number">5</span>
ËøîÂõûËØ•Á∫øÁ®ã Á∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>ÁöÑÁä∂ÊÄÅ<span class="token operator">:</span>RUNNABLE
ËøîÂõûËØ•Á∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>ÊâÄÂ±ûÁöÑÁ∫øÁ®ãÁªÑ<span class="token operator">:</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ThreadGroup</span><span class="token punctuation">[</span>name<span class="token operator">=</span>main<span class="token punctuation">,</span>maxpri<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">]</span>
ÊµãËØïÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>ÊòØÂê¶Â§Ñ‰∫éÊ¥ªÂä®Áä∂ÊÄÅ<span class="token operator">:</span><span class="token boolean">true</span>
ÊµãËØïÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>ÊòØÂê¶ÊµãËØïËØ•Á∫øÁ®ãÊòØÂê¶‰∏∫ÂÆàÊä§Á∫øÁ®ã<span class="token operator">:</span><span class="token boolean">false</span>
ËøîÂõûËØ•Á∫øÁ®ã Á∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>ÁöÑÁä∂ÊÄÅ<span class="token operator">:</span>RUNNABLE
ËøîÂõûËØ•Á∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>ÊâÄÂ±ûÁöÑÁ∫øÁ®ãÁªÑ<span class="token operator">:</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ThreadGroup</span><span class="token punctuation">[</span>name<span class="token operator">=</span>main<span class="token punctuation">,</span>maxpri<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">]</span>
ÊµãËØïÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>ÊòØÂê¶Â§Ñ‰∫éÊ¥ªÂä®Áä∂ÊÄÅ<span class="token operator">:</span><span class="token boolean">true</span>
ÊµãËØïÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>ÊòØÂê¶ÊµãËØïËØ•Á∫øÁ®ãÊòØÂê¶‰∏∫ÂÆàÊä§Á∫øÁ®ã<span class="token operator">:</span><span class="token boolean">false</span>
ËøîÂõûËØ•Á∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>ÊâÄÂ±ûÁöÑÁ∫øÁ®ãÁªÑ<span class="token operator">:</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ThreadGroup</span><span class="token punctuation">[</span>name<span class="token operator">=</span>main<span class="token punctuation">,</span>maxpri<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">]</span>
ÊµãËØïÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>ÊòØÂê¶Â§Ñ‰∫éÊ¥ªÂä®Áä∂ÊÄÅ<span class="token operator">:</span><span class="token boolean">true</span>
ÊµãËØïÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>ÊòØÂê¶ÊµãËØïËØ•Á∫øÁ®ãÊòØÂê¶‰∏∫ÂÆàÊä§Á∫øÁ®ã<span class="token operator">:</span><span class="token boolean">false</span>
ËøîÂõûËØ•Á∫øÁ®ã Á∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>ÁöÑÁä∂ÊÄÅ<span class="token operator">:</span>RUNNABLE
ËøîÂõûËØ•Á∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>ÊâÄÂ±ûÁöÑÁ∫øÁ®ãÁªÑ<span class="token operator">:</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ThreadGroup</span><span class="token punctuation">[</span>name<span class="token operator">=</span>main<span class="token punctuation">,</span>maxpri<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">]</span>
ËøîÂõûËØ•Á∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>ÊâÄÂ±ûÁöÑÁ∫øÁ®ãÁªÑ<span class="token operator">:</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ThreadGroup</span><span class="token punctuation">[</span>name<span class="token operator">=</span>main<span class="token punctuation">,</span>maxpri<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">]</span>
ÊµãËØïÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>ÊòØÂê¶Â§Ñ‰∫éÊ¥ªÂä®Áä∂ÊÄÅ<span class="token operator">:</span><span class="token boolean">true</span>
ÊµãËØïÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>ÊòØÂê¶ÊµãËØïËØ•Á∫øÁ®ãÊòØÂê¶‰∏∫ÂÆàÊä§Á∫øÁ®ã<span class="token operator">:</span><span class="token boolean">false</span>
ÊµãËØïÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>ÊòØÂê¶Â§Ñ‰∫éÊ¥ªÂä®Áä∂ÊÄÅ<span class="token operator">:</span><span class="token boolean">true</span>
ÊµãËØïÁ∫øÁ®ãÁ∫øÁ®ãÂêçÁß∞<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>ÊòØÂê¶ÊµãËØïËØ•Á∫øÁ®ãÊòØÂê¶‰∏∫ÂÆàÊä§Á∫øÁ®ã<span class="token operator">:</span><span class="token boolean">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>Á¨¨‰∏âÊ≠•ÔºåÁúã‰∏Ä‰∏ãÊàë‰ª¨ÁõëÊéßÁöÑÁªìÊûúÔºåÂõ†‰∏∫Êàë‰ª¨ËÆæÁΩÆ‰∫ÜÊó∂Èó¥Êà≥‰ºöÁúãÂà∞‰∏çÂêåÁöÑÁõëÊéßÁªìÊûú„ÄÇ<br>Âú®‰∏äÈù¢5‰∏™Á∫øÁ®ãÂíå‰∏Ä‰∏™main‰∏ªÁ∫øÁ®ã‰∏≠ÔºåÊàë‰ª¨ÂèØ‰ª•ÂèëÁé∞‰∏ªÁ∫øÁ®ãÂÖà‰∫éÂè¶Â§ñ5‰∏™Á∫øÁ®ãÂÖàÁªìÊùü‰∫Ü,Â¶Ç‰∏ãÂõæÊâÄÁ§∫ÔºöÂ§ßÂÆ∂‰ªîÁªÜÁúãÁúã‰ª£Á†ÅÂ∞±ËÉΩ‰Ωì‰ºöÂá∫Êù•‰∫ÜÔºåËøôÊòØÊó∂Èó¥‰∏äÊéßÂà∂ÁöÑÔºåËøôÈáåÂÖàÊúâ‰∏™Âç∞Ë±°ÔºåÂêéÈù¢‰ºöËÆ≤Á∫øÁ®ãÁöÑÂÖ∑‰ΩìÁõëÊéßÊñπÊ≥ï„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent2.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent2.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Thread‰ΩøÁî®Êó∂ÁöÑÊ≥®ÊÑè‰∫ãÈ°πÂ¶Ç‰∏ã:<br>(1ÔºâÂºÄÂêØ‰∏Ä‰∏™Êñ∞ÁöÑÁ∫øÁ®ãÁöÑÊó∂ÂÄôÔºå‰∏ÄÂÆöË¶ÅÁªôÂÆÉ‰∏Ä‰∏™ÂêçÂ≠ó,ÈÄöËøá‰∏äÈù¢ÁöÑÂõæÊàë‰ª¨‰πüÁúãÂà∞‰∫ÜÔºåÊñπ‰æøÊàë‰ª¨Ë∑üË∏™ËßÇÂØüÁ∫øÁ®ãÔºåÂØπÂè∑ÂÖ•Â∫ßÔºåÊñπ‰æøÊéíÊü•ÈóÆÈ¢ò„ÄÇÂê¶ÂàôÁõëÊéßÁöÑÊó∂ÂÄôÂ∞±Ê≤°ÊúâÂäûÊ≥ïÂæàÁõ¥ËßÇÂú∞Áü•ÈÅìÊüê‰∏™Á∫øÁ®ãÁöÑÁî®ÈÄî„ÄÇ<br>(2ÔºâÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØ,<code>thread.stop()</code>Ôºå<code>thread.resume()</code>,<code>thread.suspend()</code>Â∑≤ÁªèË¢´Â∫üÈô§„ÄÅ‰∏çÂª∫ËÆÆ‰ΩøÁî®Ôºå<code>thread.stop()</code>‰ºöÂØºËá¥Á∫øÁ®ã‰∏ç‰ºöÊ≠£Á°ÆÈáäÊîæËµÑÊ∫êÔºå<code>thread.suspend()</code>ÂÆπÊòìÂØºËá¥Ê≠ªÈîÅ„ÄÇÂª∫ËÆÆ‰ΩøÁî®‰ø°Âè∑ÈáèÔºàÂÖ±‰∫´ÂèòÈáè)ÊàñinterruptÊñπÊ≥ïÊù•‰ª£ÊõøstopÊñπÊ≥ïÁ≠â„ÄÇ<br>(3ÔºâmainÊñπÊ≥ï‰∏ªÁ∫øÁ®ãÁªìÊùü‰∫Ü,Êñ∞ÂºÄÂêØÁöÑÂ≠êÁ∫øÁ®ã‰∏ç‰∏ÄÂÆöÁªìÊùü„ÄÇ</p>
<blockquote>
<p><strong>ÂÆàÊä§Á∫øÁ®ã</strong></p>
<p>Âíå‰∏ªÁ∫øÁ®ãÂÖ±Ê≠ªÔºåfinally‰∏çËÉΩ‰øùËØÅ‰∏ÄÂÆöÊâßË°å</p>
</blockquote>
<h3 id="ÂÖ≥‰∫éÁ∫øÁ®ãÁöÑ‰∏≠Êñ≠Êú∫Âà∂"><a href="#ÂÖ≥‰∫éÁ∫øÁ®ãÁöÑ‰∏≠Êñ≠Êú∫Âà∂" class="headerlink" title="ÂÖ≥‰∫éÁ∫øÁ®ãÁöÑ‰∏≠Êñ≠Êú∫Âà∂"></a>ÂÖ≥‰∫éÁ∫øÁ®ãÁöÑ‰∏≠Êñ≠Êú∫Âà∂</h3><p><strong>ÊÄé‰πàÊ†∑ÊâçËÉΩËÆ©JavaÈáåÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÂÅúÊ≠¢Â∑•‰ΩúÂë¢</strong></p>
<p>Á∫øÁ®ãËá™ÁÑ∂ÁªàÊ≠¢ÔºöËá™ÁÑ∂ÊâßË°åÂÆåÊàñÊäõÂá∫Êú™Â§ÑÁêÜÂºÇÂ∏∏</p>
<p><strong>javaÁ∫øÁ®ãÊòØÂçè‰ΩúÂºèÔºåËÄåÈùûÊä¢Âç†Âºè</strong></p>
<p>Ë∞ÉÁî®‰∏Ä‰∏™Á∫øÁ®ãÁöÑ<code>thread.interrupt()</code> ÊñπÊ≥ï‰∏≠Êñ≠‰∏Ä‰∏™Á∫øÁ®ãÔºåÂπ∂‰∏çÊòØÂº∫Ë°åÂÖ≥Èó≠Ëøô‰∏™Á∫øÁ®ãÔºåÂè™ÊòØË∑üËøô‰∏™Á∫øÁ®ãÊâì‰∏™ÊãõÂëºÔºåÂ∞ÜÁ∫øÁ®ãÁöÑ‰∏≠Êñ≠Ê†áÂøó‰ΩçÁΩÆ‰∏∫trueÔºåÁ∫øÁ®ãÊòØÂê¶‰∏≠Êñ≠ÔºåÁî±Á∫øÁ®ãÊú¨Ë∫´ÂÜ≥ÂÆö„ÄÇ</p>
<p><code>isInterrupted()</code> Âà§ÂÆöÂΩìÂâçÁ∫øÁ®ãÊòØÂê¶Â§Ñ‰∫é‰∏≠Êñ≠Áä∂ÊÄÅ„ÄÇ</p>
<p>staticÊñπÊ≥ï<code>thread.interrupted()</code> Âà§ÂÆöÂΩìÂâçÁ∫øÁ®ãÊòØÂê¶Â§Ñ‰∫é‰∏≠Êñ≠Áä∂ÊÄÅÔºåÂêåÊó∂‰∏≠Êñ≠Ê†áÂøó‰ΩçÊîπ‰∏∫false„ÄÇ</p>
<p>ÊñπÊ≥ïÈáåÂ¶ÇÊûúÊäõÂá∫<code>thread.InterruptedException</code>ÔºåÁ∫øÁ®ãÁöÑ‰∏≠Êñ≠Ê†áÂøó‰Ωç‰ºöË¢´Â§ç‰ΩçÊàêfalseÔºåÂ¶ÇÊûúÁ°ÆÂÆûÊòØÈúÄË¶Å‰∏≠Êñ≠Á∫øÁ®ãÔºåË¶ÅÊ±ÇÊàë‰ª¨Ëá™Â∑±Âú®catchËØ≠Âè•ÂùóÈáåÂÜçÊ¨°Ë∞ÉÁî®<code>thread.interrupt()</code>„ÄÇ</p>
<p>‚Äã        Ë¶Å‰Ωø‰ªªÂä°ÂíåÁ∫øÁ®ãËÉΩÂÆâÂÖ®„ÄÅÂø´ÈÄü„ÄÅÂèØÈù†Âú∞ÂÅúÊ≠¢‰∏ãÊù•ÔºåÂπ∂‰∏çÊòØ‰∏Ä‰ª∂ÂÆπÊòìÁöÑ‰∫ã„ÄÇJavaÊ≤°ÊúâÊèê‰æõ‰ªª‰ΩïÊú∫Âà∂Êù•ÂÆâÂÖ®Âú∞ÁªàÊ≠¢Á∫øÁ®ãÔºåÈÇ£‰πàÊàë‰ª¨ÂèàËØ•Â¶Ç‰Ωï‰ΩøÁî®Á∫øÁ®ãÁöÑÂÅúÊ≠¢ÊàñËÄÖ‰∏≠Êñ≠Âë¢?</p>
<h4 id="Á¨¨‰∏ÄÁßçÊñπÂºè-Ë∞ÉÁî®Thread-stop"><a href="#Á¨¨‰∏ÄÁßçÊñπÂºè-Ë∞ÉÁî®Thread-stop" class="headerlink" title="Á¨¨‰∏ÄÁßçÊñπÂºè:Ë∞ÉÁî®Thread.stop()"></a>Á¨¨‰∏ÄÁßçÊñπÂºè:Ë∞ÉÁî®Thread.stop()</h4><p>‚Äã        ËØ•ÊñπÊ≥ïÂº∫Ëø´ÂÅúÊ≠¢‰∏Ä‰∏™Á∫øÁ®ãÔºåÂπ∂ÊäõÂá∫‰∏Ä‰∏™Êñ∞ÂàõÂª∫ÁöÑ ThreadDeathÂØπË±°‰Ωú‰∏∫ÂºÇÂ∏∏„ÄÇÂÅúÊ≠¢‰∏Ä‰∏™Â∞öÊú™ÂêØÂä®ÁöÑÁ∫øÁ®ãÊòØÂÖÅËÆ∏ÁöÑÔºåÂ¶ÇÊûúÁ®çÂêéÂêØÂä®ËØ•Á∫øÁ®ãÔºåÂÆÉ‰ºöÁ´ãÂç≥ÁªàÊ≠¢„ÄÇÈÄöÂ∏∏‰∏çÂ∫îËØïÂõæÊçïËé∑ThreadDeathÔºåÈô§ÈùûÂÆÉÂøÖÈ°ªÊâßË°åÊüê‰∫õÂºÇÂ∏∏ÁöÑÊ∏ÖÈô§Êìç‰Ωú„ÄÇÂ¶ÇÊûúcatchÂ≠êÂè•ÊçïËé∑‰∫Ü‰∏Ä‰∏™ThreadDeathÂØπË±°,ÂàôÂøÖÈ°ªÈáçÊñ∞ÊäõÂá∫ËØ•ÂØπË±°ÔºåËøôÊ†∑ËØ•Á∫øÁ®ãÊâç‰ºöÁúüÊ≠£ÁªàÊ≠¢„ÄÇ<br>‚Äã        ÁÑ∂ËÄåÔºåThread.stop()‰∏çÂÆâÂÖ®ÔºåÂ∑≤‰∏çÂÜçÂª∫ËÆÆ‰ΩøÁî®,ËøôÊÑèÂë≥ÁùÄÂú®Êú™Êù•ÁöÑJAVAÁâàÊú¨‰∏≠,ÂÆÉÂ∞Ü‰∏çÂ§çÂ≠òÂú®„ÄÇÊâÄ‰ª•Êàë‰ª¨‰πü‰∏çÂ§öËØ¥‰∫Ü„ÄÇ</p>
<h4 id="Á¨¨‰∫åÁßçÊñπÂºè-Âà©Áî®Thread-interrupt-ÊñπÊ≥ïÂíåÊú∫Âà∂"><a href="#Á¨¨‰∫åÁßçÊñπÂºè-Âà©Áî®Thread-interrupt-ÊñπÊ≥ïÂíåÊú∫Âà∂" class="headerlink" title="Á¨¨‰∫åÁßçÊñπÂºè:Âà©Áî®Thread.interrupt()ÊñπÊ≥ïÂíåÊú∫Âà∂"></a>Á¨¨‰∫åÁßçÊñπÂºè:Âà©Áî®Thread.interrupt()ÊñπÊ≥ïÂíåÊú∫Âà∂</h4><p>‚Äã        Java‰∏≠Êñ≠Êú∫Âà∂ÊòØ‰∏ÄÁßçÂçè‰ΩúÊú∫Âà∂Ôºå‰πüÂ∞±ÊòØËØ¥ÈÄöËøá‰∏≠Êñ≠Âπ∂‰∏çËÉΩÁõ¥Êé•ÁªàÊ≠¢Âè¶‰∏Ä‰∏™Á∫øÁ®ãÔºåËÄåÈúÄË¶ÅË¢´‰∏≠Êñ≠ÁöÑÁ∫øÁ®ãËá™Â∑±Â§ÑÁêÜ‰∏≠Êñ≠„ÄÇ<br>‚Äã        Java‰∏≠Êñ≠Ê®°Âûã‰πüÂèØ‰ª•ÁÆÄÂçïÂÅöÂ¶Ç‰∏ãÁêÜËß£ÔºåÊØè‰∏™Á∫øÁ®ãÂØπË±°ÈáåÈÉΩÊúâ‰∏Ä‰∏™booleanÁ±ªÂûãÁöÑÊ†áËØÜ(‰∏ç‰∏ÄÂÆöÂ∞±Ë¶ÅÊòØThreadÁ±ªÁöÑÂ≠óÊÆµ,ÂÆûÈôÖ‰∏ä‰πüÁöÑÁ°Æ‰∏çÊòØ,ËøôÂá†‰∏™ÊñπÊ≥ïÊúÄÁªàÈÉΩÊòØÈÄöËøánativeÊñπÊ≥ïÊù•ÂÆåÊàêÁöÑ)Ôºå‰ª£Ë°®ÁùÄÊòØÂê¶Êúâ‰∏≠Êñ≠ËØ∑Ê±Ç(ËØ•ËØ∑Ê±ÇÂèØ‰ª•Êù•Ëá™ÊâÄÊúâÁ∫øÁ®ã,ÂåÖÊã¨Ë¢´‰∏≠Êñ≠ÁöÑÁ∫øÁ®ãÊú¨Ë∫´)„ÄÇ‰æãÂ¶ÇÔºåÂΩìÁ∫øÁ®ãt1ÊÉ≥‰∏≠Êñ≠Á∫øÁ®ãt2ÔºåÂè™ÈúÄË¶ÅÂú®Á∫øÁ®ãt1‰∏≠Â∞ÜÁ∫øÁ®ãt2ÂØπË±°ÁöÑ‰∏≠Êñ≠Ê†áËØÜÁΩÆ‰∏∫trueÔºåÁÑ∂ÂêéÁ∫øÁ®ã2ÂèØ‰ª•ÈÄâÊã©Âú®ÂêàÈÄÇÁöÑÊó∂ÂÄôÂ§ÑÁêÜËØ•‰∏≠Êñ≠ËØ∑Ê±Ç,ÁîöËá≥ÂèØ‰ª•‰∏çÁêÜ‰ºöËØ•ËØ∑Ê±ÇÔºåÂ∞±ÂÉèËøô‰∏™Á∫øÁ®ãÊ≤°ÊúâË¢´‰∏≠Êñ≠‰∏ÄÊ†∑„ÄÇ<br>‚Äã        Êé•‰∏ãÊù•Êàë‰ª¨ÈÄöËøá‰æãÂ≠êÊÖ¢ÊÖ¢ËØ¥Êòé„ÄÇ</p>
<blockquote>
<p>‚Äã        ThreadÁ±ª‰∏≠Êèê‰æõ‰∫Ü‰∏â‰∏™‰∏≠Êñ≠ÊñπÊ≥ïÂ¶Ç‰∏ã:</p>
<ul>
<li>public static boolean interrupted(); ÊµãËØïÂΩìÂâçÁ∫øÁ®ãÊòØÂê¶Â∑≤Áªè‰∏≠Êñ≠„ÄÇÁ∫øÁ®ãÁöÑ‰∏≠Êñ≠Áä∂ÊÄÅÁî±ËØ•ÊñπÊ≥ïÊ∏ÖÈô§„ÄÇÊç¢Âè•ËØùËØ¥,Â¶ÇÊûúËøûÁª≠‰∏§Ê¨°Ë∞ÉÁî®ËØ•ÊñπÊ≥ï,ÂàôÁ¨¨‰∫åÊ¨°Ë∞ÉÁî®Â∞ÜËøîÂõû false(Âú®Á¨¨‰∏ÄÊ¨°Ë∞ÉÁî®Â∑≤Ê∏ÖÈô§‰∫ÜÂÖ∂‰∏≠Êñ≠Áä∂ÊÄÅ‰πãÂêéÔºå‰∏îÁ¨¨‰∫åÊ¨°Ë∞ÉÁî®Ê£ÄÈ™åÂÆå‰∏≠Êñ≠Áä∂ÊÄÅÂâç,ÂΩìÂâçÁ∫øÁ®ãÂÜçÊ¨°‰∏≠Êñ≠ÁöÑÊÉÖÂÜµÈô§Â§ñÔºâ„ÄÇ</li>
<li>public boolean isInterrupted(); ÊµãËØïÁ∫øÁ®ãÊòØÂê¶Â∑≤Áªè‰∏≠Êñ≠Á∫øÁ®ãÁöÑ‰∏≠Êñ≠Áä∂ÊÄÅ‰∏çÂèóËØ•ÊñπÊ≥ïÁöÑÂΩ±Âìç„ÄÇ</li>
<li>public void interrupt(): ‰∏≠Êñ≠Á∫øÁ®ãÔºå‰ΩÜÊòØÊ≤°ÊúâËøîÂõûÁªìÊûú„ÄÇÊòØÂîØ‰∏ÄËÉΩÂ∞Ü‰∏≠Êñ≠Áä∂ÊÄÅËÆæÁΩÆ‰∏∫trueÁöÑÊñπÊ≥ï„ÄÇ</li>
</ul>
</blockquote>
<p>‚Äã        ‰∏äÈù¢ÁöÑ‰æãÂ≠ê‰∏≠ÔºåÁ∫øÁ®ãt1ÈÄöËøáË∞ÉÁî®interruptÊñπÊ≥ïÂ∞ÜÁ∫øÁ®ãt2ÁöÑ‰∏≠Êñ≠Áä∂ÊÄÅÁΩÆ‰∏∫trueÔºåt2ÂèØ‰ª•Âú®ÂêàÈÄÇÁöÑÊó∂ÂÄôË∞ÉÁî®interrupted ÊàñisInterruptedÊù•Ê£ÄÊµãÁä∂ÊÄÅÂπ∂ÂÅöÁõ∏Â∫îÁöÑÂ§ÑÁêÜ„ÄÇ<br>‚Äã        Êàë‰ª¨ÂÖàÊù•ÁúãÁúã‰∏ãÈù¢ÁöÑÂÆû‰æã„ÄÇ<br>‚Äã        <strong>ÈúÄÊ±Ç:Êàë‰ª¨Áî®mainÁ∫øÁ®ã1Êù•‰∏≠Êñ≠InterruptDemoÁ∫øÁ®ã2Ôºå</strong>‰ª£Á†ÅÂ¶Ç‰∏ã:</p>
<h5 id="No4-ThreadInterruptDemoOne-java"><a href="#No4-ThreadInterruptDemoOne-java" class="headerlink" title="No4_ThreadInterruptDemoOne.java"></a>No4_ThreadInterruptDemoOne.java</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No4_ThreadInterruptDemoOne</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">No4_ThreadInterruptDemoOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"InterruptDemo Thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Starting thread..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Interrupting thread..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Á∫øÁ®ãÊòØÂê¶‰∏≠Êñ≠Ôºö"</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Stopping application..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">boolean</span> stop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>stop<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"My Thread is running..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">long</span> time <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> time <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// ËÆ©ËØ•Âæ™ÁéØÊåÅÁª≠‰∏ÄÊÆµÊó∂Èó¥Ôºå‰Ωø‰∏äÈù¢ÁöÑËØùÊâìÂç∞Ê¨°Êï∞Â∞ëÁÇπ</span>
            <span class="token punctuation">&#125;</span>

        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"My Thread exiting under request..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">Starting thread<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
My Thread is running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
My Thread is running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
My Thread is running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Interrupting thread<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Á∫øÁ®ãÊòØÂê¶‰∏≠Êñ≠Ôºötrue
My Thread is running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
My Thread is running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
My Thread is running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Stopping application<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
My Thread is running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰ªéËøêË°åÁªìÊûú‰∏äÁúãÂà∞ÔºåInterruptDemoÁ∫øÁ®ã2Ê∞∏ËøúÊ≤°ÊúâÁªìÊùü„ÄÇÂ∞±ÂÉèÊàë‰ª¨ÂâçÈù¢ÊâÄÊèèËø∞ÁöÑ‰∏ÄÊ†∑,Á∫øÁ®ã2Ê≤°ÊúâÂ§ÑÁêÜËØ•‰∏≠Êñ≠ËØ∑Ê±ÇÔºåÂ∞±ÂÉèËøô‰∏™Á∫øÁ®ãÊ≤°ÊúâË¢´‰∏≠Êñ≠‰∏ÄÊ†∑„ÄÇÊé•‰∏ãÊù•ÔºåÊàë‰ª¨Â∞Ü‰∏äÈù¢ÁöÑ‰æãÂ≠êÁ®ç‰ΩúÊîπËøõÔºåËÆ©Á∫øÁ®ã2Â§ÑÁêÜÁªàÊ≠¢ËØ∑Ê±Ç„ÄÇ<br>Ê∑ªÂä†Â¶Ç‰∏ã‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>stop<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"My Thread is running..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">long</span> time <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> time <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// ËÆ©ËØ•Âæ™ÁéØÊåÅÁª≠‰∏ÄÊÆµÊó∂Èó¥Ôºå‰Ωø‰∏äÈù¢ÁöÑËØùÊâìÂç∞Ê¨°Êï∞Â∞ëÁÇπ</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// ÈúÄË¶ÅÁ∫øÁ®ãÊú¨Ë∫´ÂéªÂ§ÑÁêÜ‰∏Ä‰∏ãÂÆÉÁöÑÁªàÊ≠¢Áä∂ÊÄÅ</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Starting</span> thread<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">My</span> <span class="token class-name">Thread</span> is running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">My</span> <span class="token class-name">Thread</span> is running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">My</span> <span class="token class-name">Thread</span> is running<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Interrupting</span> thread<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Á∫øÁ®ãÊòØÂê¶‰∏≠Êñ≠Ôºö<span class="token boolean">true</span>
<span class="token class-name">My</span> <span class="token class-name">Thread</span> exiting under request<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Stopping</span> application<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰ªéËøêË°åÁªìÊûú‰∏äÁúãÂà∞ÔºåInterruptDemoÁ∫øÁ®ã2ÁúüÊ≠£ÁöÑÁªàÊ≠¢ÁªìÊùü‰∫Ü„ÄÇÂ∞±ÂÉèÊàë‰ª¨ÂâçÈù¢ÊâÄÊèèËø∞ÁöÑ‰∏ÄÊ†∑ÔºåÁ∫øÁ®ã2Â§ÑÁêÜ‰∫ÜËØ•‰∏≠Êñ≠ËØ∑Ê±Ç,‰ªéËÄåÂ∞±‰ºöÁúüÊ≠£ÁöÑ‰∏≠Êñ≠„ÄÇ<br>‚Äã        ÂÖ∂ÂÆû interruptËøòÂèØ‰ª•Â§ÑÁêÜ‰∏Ä‰∫õÊõ¥‰∏∫Â§çÊùÇÁöÑÈÄªËæëÔºåÂΩìÂ§ñÈÉ®Á∫øÁ®ãÂØπÊüêÁ∫øÁ®ãË∞ÉÁî®‰∫Üthread.interrupt()ÊñπÊ≥ïÂêéÔºåJavaËØ≠Ë®ÄÁöÑÂ§ÑÁêÜÊú∫Âà∂ÊòØËøôÊ†∑ÁöÑÔºö<br>‚Äã        Â¶ÇÊûúËØ•Á∫øÁ®ãÂ§ÑÂú®ÂèØ‰∏≠Êñ≠Áä∂ÊÄÅ‰∏ãÔºàË∞ÉÁî®‰∫Ü Thread.wait(0ÊàñËÄÖ Thread.sleep()Á≠âÁâπÂÆö‰ºöÂèëÁîüÈòªÂ°ûÁöÑapi)ÔºåÈÇ£‰πàËØ•Á∫øÁ®ã‰ºöÁ´ãÂç≥Ë¢´Âî§ÈÜíÔºåÂêåÊó∂‰ºöÂèóÂà∞‰∏Ä‰∏™InterruptedExceptionÔºåÂêåÊó∂ÔºåÂ¶ÇÊûúÊòØÈòªÂ°ûÂú®IO‰∏äÔºåÂØπÂ∫îÁöÑËµÑÊ∫ê‰ºöË¢´ÂÖ≥Èó≠„ÄÇÂ¶ÇÊûúËØ•Á∫øÁ®ãÊé•‰∏ãÊù•‰∏çÊâßË°åThread.interrupted()ÊñπÊ≥ï(‰∏çÊòØ interrupt),ÈÇ£‰πàËØ•Á∫øÁ®ãÂ§ÑÁêÜ‰ªª‰ΩïIOËµÑÊ∫êÁöÑÊó∂ÂÄôÔºåÈÉΩ‰ºöÂØºËá¥Ëøô‰∫õËµÑÊ∫êÂÖ≥Èó≠„ÄÇÂΩìÁÑ∂ÔºåËß£ÂÜ≥ÁöÑÂäûÊ≥ïÂ∞±ÊòØË∞ÉÁî®‰∏Ä‰∏ãinterrupted()Ôºå‰∏çËøáËøôÈáåÈúÄË¶ÅÁ®ãÂ∫èÂëòËá™Ë°åÊ†πÊçÆ‰ª£Á†ÅÁöÑÈÄªËæëÊù•ËÆæÂÆöÔºåÊ†πÊçÆËá™Â∑±ÁöÑÈúÄÊ±ÇÁ°ÆËÆ§ÊòØÂê¶ÂèØ‰ª•Áõ¥Êé•ÂøΩÁï•ËØ•‰∏≠Êñ≠,ËøòÊòØÂ∫îËØ•È©¨‰∏äÈÄÄÂá∫„ÄÇ<br>ÁÆÄÂçïÁöÑÂºÇÂ∏∏Â§ÑÁêÜÊñπÂºèÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-ja" data-language="ja"><code class="language-ja">@Override
    public void run() &#123;
        boolean stop &#x3D; false;
        while (!stop) &#123;
&#x2F;&#x2F;            System.out.println(&quot;My Thread is running...&quot;);
&#x2F;&#x2F;
&#x2F;&#x2F;            long time &#x3D; System.currentTimeMillis();
&#x2F;&#x2F;            while (System.currentTimeMillis() - time &lt; 1000) &#123;
&#x2F;&#x2F;                &#x2F;&#x2F; ËÆ©ËØ•Âæ™ÁéØÊåÅÁª≠‰∏ÄÊÆµÊó∂Èó¥Ôºå‰Ωø‰∏äÈù¢ÁöÑËØùÊâìÂç∞Ê¨°Êï∞Â∞ëÁÇπ
&#x2F;&#x2F;            &#125;
&#x2F;&#x2F;            if (Thread.currentThread().isInterrupted()) &#123;
&#x2F;&#x2F;                &#x2F;&#x2F; ÈúÄË¶ÅÁ∫øÁ®ãÊú¨Ë∫´ÂéªÂ§ÑÁêÜ‰∏Ä‰∏ãÂÆÉÁöÑÁªàÊ≠¢Áä∂ÊÄÅ
&#x2F;&#x2F;                break;
&#x2F;&#x2F;            &#125;
            try &#123;
                Thread.sleep(3L);
            &#125; catch (InterruptedException e) &#123;
                &#x2F;&#x2F; ÈúÄË¶ÅÁ∫øÁ®ãÊú¨Ë∫´ÂéªÂ§ÑÁêÜ‰∏Ä‰∏ãÂÆÉÁöÑÁªàÊ≠¢Áä∂ÊÄÅ
                &#x2F;&#x2F;InterruptedException‚Äî‚ÄîÂ¶ÇÊûúÊúâÁ∫øÁ®ã‰∏≠Êñ≠‰∫ÜÂΩìÂâçÁ∫øÁ®ã„ÄÇÂΩìÊäõÂá∫Ê≠§ÂºÇÂ∏∏Êó∂ÔºåÂΩìÂâçÁ∫øÁ®ãÁöÑ‰∏≠Êñ≠Áä∂ÊÄÅÂ∞ÜË¢´Ê∏ÖÈô§„ÄÇ
                break;
            &#125;
        &#125;
        System.out.println(&quot;My Thread exiting under request...&quot;);
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ËøêË°åÂÆå‰πãÂêé,ËøêË°åÁªìÊûúÂèØ‰ª•ËææÂà∞‰∏çÂèòÁöÑÊïàÊûú„ÄÇ<br>‚Äã        ÊúÄÂêéÔºåÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåË¢´ÁªàÊ≠¢ÁöÑÁ∫øÁ®ã‰∏ÄÂÆöË¶ÅÂØπ isInterrupted Áä∂ÊÄÅËøõË°åÂ§ÑÁêÜÔºåÂê¶ÂàôÂ¶ÇÊûú‰ª£Á†ÅÊòØÊ≠ªÂæ™ÁéØÁöÑÊÉÖÂÜµ‰∏ãÔºåÁ∫øÁ®ãÂ∞ÜÊ∞∏ËøúÈÉΩ‰∏ç‰ºöÁªìÊùü„ÄÇ</p>
<p>Ëã•‰ª•‰∏ä‰æãÂ≠êÁúãÁöÑÁπÅÁêêËØ∑Áúã‰∏Ä‰∏ã‰ª£Á†Å</p>
<h5 id="No4-ThreadInterruptDemoTwo-java"><a href="#No4-ThreadInterruptDemoTwo-java" class="headerlink" title="No4_ThreadInterruptDemoTwo.java"></a>No4_ThreadInterruptDemoTwo.java</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No4_ThreadInterruptDemoTwo</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UseThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">public</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> threadName <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>threadName<span class="token operator">+</span><span class="token string">" interrput flag is "</span><span class="token operator">+</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>threadName<span class="token operator">+</span><span class="token string">" is run!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>threadName<span class="token operator">+</span><span class="token string">" interrput flag is "</span><span class="token operator">+</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UseRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> threadName <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>threadName<span class="token operator">+</span><span class="token string">" interrput flag is "</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>threadName<span class="token operator">+</span><span class="token string">" is run!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>threadName<span class="token operator">+</span><span class="token string">" interrput flag is "</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Thread</span> endThreadOne <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span><span class="token string">"endThread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endThreadOne<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endThreadOne<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">UseRunnable</span> useRunnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UseRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> endThreadTwo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>useRunnable<span class="token punctuation">,</span><span class="token string">"endThread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endThreadTwo<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endThreadTwo<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>


<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<blockquote>
<ul>
<li>Áª≠ No4_ThreadInterruptDemoOne.java ÁöÑÂºÇÂ∏∏ÈóÆÈ¢ò</li>
</ul>
<blockquote>
<p><strong>ÊäõÂá∫InterruptedExceptionÂºÇÂ∏∏ÁöÑÊó∂ÂÄôÔºåË¶ÅÊ≥®ÊÑè‰∏≠Êñ≠Ê†áÂøó‰Ωç</strong></p>
</blockquote>
<p> ÂºïÁî®‰∏äÊñá    <code>  Â¶ÇÊûúËØ•Á∫øÁ®ãÂ§ÑÂú®ÂèØ‰∏≠Êñ≠Áä∂ÊÄÅ‰∏ãÔºàË∞ÉÁî®‰∫Ü Thread.wait(0ÊàñËÄÖ Thread.sleep()Á≠âÁâπÂÆö‰ºöÂèëÁîüÈòªÂ°ûÁöÑapi)ÔºåÈÇ£‰πàËØ•Á∫øÁ®ã‰ºöÁ´ãÂç≥Ë¢´Âî§ÈÜíÔºåÂêåÊó∂‰ºöÂèóÂà∞‰∏Ä‰∏™InterruptedExceptionÔºåÂêåÊó∂ÔºåÂ¶ÇÊûúÊòØÈòªÂ°ûÂú®IO‰∏äÔºåÂØπÂ∫îÁöÑËµÑÊ∫ê‰ºöË¢´ÂÖ≥Èó≠„ÄÇÂ¶ÇÊûúËØ•Á∫øÁ®ãÊé•‰∏ãÊù•‰∏çÊâßË°åThread.interrupted()ÊñπÊ≥ï(‰∏çÊòØ interrupt),ÈÇ£‰πàËØ•Á∫øÁ®ãÂ§ÑÁêÜ‰ªª‰ΩïIOËµÑÊ∫êÁöÑÊó∂ÂÄôÔºåÈÉΩ‰ºöÂØºËá¥Ëøô‰∫õËµÑÊ∫êÂÖ≥Èó≠„ÄÇÂΩìÁÑ∂ÔºåËß£ÂÜ≥ÁöÑÂäûÊ≥ïÂ∞±ÊòØË∞ÉÁî®‰∏Ä‰∏ãinterrupted()Ôºå‰∏çËøáËøôÈáåÈúÄË¶ÅÁ®ãÂ∫èÂëòËá™Ë°åÊ†πÊçÆ‰ª£Á†ÅÁöÑÈÄªËæëÊù•ËÆæÂÆöÔºåÊ†πÊçÆËá™Â∑±ÁöÑÈúÄÊ±ÇÁ°ÆËÆ§ÊòØÂê¶ÂèØ‰ª•Áõ¥Êé•ÂøΩÁï•ËØ•‰∏≠Êñ≠,ËøòÊòØÂ∫îËØ•È©¨‰∏äÈÄÄÂá∫„ÄÇ</code></p>
</blockquote>
<h5 id="No4-ThreadHasInterruptedExceptionDemo-java"><a href="#No4-ThreadHasInterruptedExceptionDemo-java" class="headerlink" title="No4_ThreadHasInterruptedExceptionDemo.java"></a>No4_ThreadHasInterruptedExceptionDemo.java</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No4_ThreadHasInterruptedExceptionDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UseThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">&#123;</span>

        <span class="token keyword">public</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> threadName <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"UseThread:"</span><span class="token operator">+</span>threadName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">//Â¶ÇÊûúÊúâ‰ªª‰ΩïÁ∫øÁ®ã‰∏≠Êñ≠‰∫ÜÂΩìÂâçÁ∫øÁ®ã„ÄÇÂΩìÊäõÂá∫Ê≠§ÂºÇÂ∏∏Êó∂ÔºåÂΩìÂâçÁ∫øÁ®ãÁöÑ‰∏≠Êñ≠Áä∂ÊÄÅÂ∞ÜË¢´Ê∏ÖÈô§</span>
                    <span class="token comment">//Á∫øÁ®ãÁöÑ‰∏≠Êñ≠Ê†áÂøó‰Ωç‰ºöË¢´Â§ç‰ΩçÊàêfalseÔºåÂ¶ÇÊûúÁ°ÆÂÆûÊòØÈúÄË¶Å‰∏≠Êñ≠Á∫øÁ®ãÔºåË¶ÅÊ±ÇÊàë‰ª¨Ëá™Â∑±Âú®catchËØ≠Âè•ÂùóÈáåÂÜçÊ¨°Ë∞ÉÁî®`thread.interrupt()`„ÄÇ</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>threadName<span class="token operator">+</span><span class="token string">" catch interrput flag is "</span><span class="token operator">+</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>threadName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>threadName<span class="token operator">+</span><span class="token string">" interrput flag is "</span><span class="token operator">+</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Thread</span> endThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span><span class="token string">"HasInterruptedException"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endThread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endThread<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÊâìÂç∞Â¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<p><img src="/image/Concurrent/Concurrent3.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent3.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">UseThread</span><span class="token operator">:</span><span class="token class-name">HasInterruptedException</span>
<span class="token class-name">HasInterruptedException</span> <span class="token keyword">catch</span> interrput flag is <span class="token boolean">false</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>InterruptedException</span><span class="token operator">:</span> sleep interrupted
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>No4_ThreadHasInterruptedExceptionDemo</span>$<span class="token class-name">UseThread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">No4_ThreadHasInterruptedExceptionDemo</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token class-name">HasInterruptedException</span>
<span class="token class-name">HasInterruptedException</span> interrput flag is <span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><strong>Â¶ÇÊûúÊúâ‰ªª‰ΩïÁ∫øÁ®ã‰∏≠Êñ≠‰∫ÜÂΩìÂâçÁ∫øÁ®ã„ÄÇÂΩìÊäõÂá∫Ê≠§ÂºÇÂ∏∏Êó∂ÔºåÂΩìÂâçÁ∫øÁ®ãÁöÑ‰∏≠Êñ≠Áä∂ÊÄÅÂ∞ÜË¢´Ê∏ÖÈô§</strong><br><strong>Á∫øÁ®ãÁöÑ‰∏≠Êñ≠Ê†áÂøó‰Ωç‰ºöË¢´Â§ç‰ΩçÊàêfalseÔºåÂ¶ÇÊûúÁ°ÆÂÆûÊòØÈúÄË¶Å‰∏≠Êñ≠Á∫øÁ®ãÔºåË¶ÅÊ±ÇÊàë‰ª¨Ëá™Â∑±Âú®catchËØ≠Âè•ÂùóÈáåÂÜçÊ¨°Ë∞ÉÁî®<code>thread.interrupt()</code>„ÄÇ</strong></p>
</blockquote>
<h3 id="Á∫øÁ®ãÁöÑÁîüÂëΩÂë®Êúü"><a href="#Á∫øÁ®ãÁöÑÁîüÂëΩÂë®Êúü" class="headerlink" title="Á∫øÁ®ãÁöÑÁîüÂëΩÂë®Êúü"></a>Á∫øÁ®ãÁöÑÁîüÂëΩÂë®Êúü</h3><h4 id="Á∫øÁ®ãÁîüÂëΩÂë®ÊúüÁöÑÁä∂ÊÄÅ"><a href="#Á∫øÁ®ãÁîüÂëΩÂë®ÊúüÁöÑÁä∂ÊÄÅ" class="headerlink" title="Á∫øÁ®ãÁîüÂëΩÂë®ÊúüÁöÑÁä∂ÊÄÅ"></a>Á∫øÁ®ãÁîüÂëΩÂë®ÊúüÁöÑÁä∂ÊÄÅ</h4><blockquote>
<p> **6 ÁßçÊàñËÄÖ5Áßç **</p>
<p><strong>NEW RUNNABLE (running) BLOCKED WAITING|TIMED_WAITING TERMINATED</strong></p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">‰∏Ä‰∏™Á∫øÁ®ãÁöÑÁä∂ÊÄÅ„ÄÇÁ∫øÁ®ãÂèØ‰ª•Â§Ñ‰∫é‰ª•‰∏ãÁä∂ÊÄÅ‰πã‰∏Ä<span class="token operator">:</span>
   NEW                Êú™ÂêØÂä®ÁöÑÁ∫øÁ®ãÂ§Ñ‰∫éÊ≠§Áä∂ÊÄÅ
   <span class="token operator">--</span>Â∞öÊú™ÂêØÂä®ÁöÑÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÁä∂ÊÄÅ„ÄÇ   ÂΩìÂàõÂª∫<span class="token class-name">Thread</span>Á±ªÁöÑ‰∏Ä‰∏™ÂÆû‰æãÔºàÂØπË±°ÔºâÊó∂ÔºåÊ≠§Á∫øÁ®ãËøõÂÖ•Êñ∞Âª∫Áä∂ÊÄÅ<span class="token operator">-</span>Êú™Ë¢´ÂêØÂä®<span class="token punctuation">,</span>‰πüÂ∞±ËØ¥Â§Ñ‰∫éÊñ∞ÁîüÁä∂ÊÄÅÁöÑÁ∫øÁ®ãÊúâËá™Â∑±ÁöÑÂÜÖÂ≠òÁ©∫Èó¥Ôºå‰ΩÜËØ•Á∫øÁ®ãÂπ∂Ê≤°ÊúâËøêË°å„ÄÇÊ≠§Êó∂Á∫øÁ®ãËøò‰∏çÊòØÊ¥ªÁùÄÁöÑÔºànot alive<span class="token punctuation">)</span>„ÄÇ

   RUNNABLE           Âú®<span class="token class-name">Java</span>ËôöÊãüÊú∫‰∏≠ÊâßË°åÁöÑÁ∫øÁ®ãÂ§Ñ‰∫éËøôÁßçÁä∂ÊÄÅ
   <span class="token operator">--</span>ÂèØËøêË°åÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÁä∂ÊÄÅ„ÄÇÂ§Ñ‰∫éÂèØËøêË°åÁä∂ÊÄÅÁöÑÁ∫øÁ®ãÊ≠£Âú®<span class="token class-name">Java</span>ËôöÊãüÊú∫‰∏≠ÊâßË°åÔºå‰ΩÜÂÆÉÂèØËÉΩÊ≠£Âú®Á≠âÂæÖÊìç‰ΩúÁ≥ªÁªüÁöÑÂÖ∂‰ªñËµÑÊ∫êÔºåÂ¶ÇÂ§ÑÁêÜÂô®„ÄÇ				 Á∫øÁ®ãÂ∑≤ÁªèË¢´ÂêØÂä®ÔºåÊ≠£Âú®Á≠âÂæÖË¢´ÂàÜÈÖçÁªôCPUÊó∂Èó¥Áâá„ÄÇÂ§Ñ‰∫éÂ∞±Áª™Áä∂ÊÄÅÁöÑÁ∫øÁ®ãÂ∑≤ÁªèÂÖ∑Â§á‰∫ÜËøêË°åÊù°‰ª∂Ôºå‰ΩÜËøòÊ≤°ÊúâË¢´ÂàÜÈÖçÂà∞CPU<span class="token punctuation">,</span>‰∏çÂÆö‰ºöË¢´Á´ãÂç≥ÊâßË°åÔºåÊ≠§Êó∂Â§Ñ‰∫éÁ∫øÁ®ãÂ∞±Áª™ÈòüÂàóÔºåÁ≠âÂæÖÁ≥ªÁªü‰∏∫ÂÖ∂ÂàÜÈÖçCPUÔºåÁ≠âÂæÖÁä∂ÊÄÅÂπ∂‰∏çÊòØÊâßË°åÁä∂ÊÄÅ„ÄÇÊ≠§Êó∂Á∫øÁ®ãÊòØÊ¥ªÁùÄÁöÑÔºàaliveÔºâ„ÄÇ
       
       Èô§Ê≠§‰πãÂ§ñËøòÊúâ‰∏ÄÁßçÁä∂ÊÄÅ<span class="token operator">--</span>ËøêË°åÔºàrunning<span class="token punctuation">)</span><span class="token operator">:</span>Á∫øÁ®ãËé∑ÂæóCPUËµÑÊ∫êÊ≠£Âú®ÊâßË°å‰ªªÂä°Ôºà<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ÊñπÊ≥ï<span class="token punctuation">)</span><span class="token punctuation">,</span>Ê≠§Êó∂Èô§ÈùûÊ≠§Á∫øÁ®ãËá™Âä®ÊîæÂºÉCPUËµÑÊ∫êÊàñËÄÖÊúâ‰ºòÂÖàÁ∫ßÊõ¥È´òÁöÑÁ∫øÁ®ãËøõÂÖ•ÔºåÁ∫øÁ®ãÂ∞Ü‰∏ÄÁõ¥ËøêË°åÂà∞ÁªìÊùü„ÄÇÊ≠§Êó∂Á∫øÁ®ãÊòØÊ¥ªÁùÄÁöÑÔºàaliveÔºâ„ÄÇ


   BLOCKED            Á≠âÂæÖÁõëËßÜÂô®ÈîÅÂÆöËÄåÈòªÂ°ûÁöÑÁ∫øÁ®ãÂ§Ñ‰∫éËøôÁßçÁä∂ÊÄÅ
   <span class="token operator">--</span>Á≠âÂæÖÁõëËßÜÂô®ÈîÅÂÆöËÄåÈòªÂ°ûÁöÑÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÁä∂ÊÄÅ„ÄÇÁ∫øÁ®ãÂ§Ñ‰∫éÈòªÂ°ûÁä∂ÊÄÅÔºåÁ≠âÂæÖÁõëËßÜÂô®ÈîÅËøõÂÖ•ÂêåÊ≠•Âùó<span class="token operator">/</span>ÊñπÊ≥ïÔºåÊàñËÄÖÂú®Ë∞ÉÁî®<span class="token class-name">Object</span><span class="token punctuation">.</span>waitÂêéÈáçÊñ∞ËøõÂÖ•ÂêåÊ≠•Âùó<span class="token operator">/</span>ÊñπÊ≥ï„ÄÇ
           Â§Ñ‰∫éBLOCKEDÁä∂ÊÄÅÁöÑÁ∫øÁ®ã‰ªçÁÑ∂ÊòØÊ¥ªÁùÄÁöÑÔºàaliveÔºâ„ÄÇ


   WAITING    Á≠âÂæÖÁä∂ÊÄÅ        ‰∏Ä‰∏™Á∫øÁ®ãÊ≠£Âú®Êó†ÈôêÊúüÂú∞Á≠âÂæÖÂè¶‰∏Ä‰∏™Á∫øÁ®ãÊâßË°å‰∏Ä‰∏™ÁâπÂÆöÁöÑÂä®‰ΩúÂ∞±ÊòØÂú®Ëøô‰∏™Áä∂ÊÄÅ
   <span class="token operator">--</span>Á≠âÂæÖÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÁä∂ÊÄÅ„ÄÇÁ∫øÁ®ãÁî±‰∫éË∞ÉÁî®‰ª•‰∏ãÊñπÊ≥ï‰πã‰∏ÄËÄåÂ§Ñ‰∫éÁ≠âÂæÖÁä∂ÊÄÅ<span class="token operator">:</span>
        <span class="token class-name">Object</span><span class="token punctuation">.</span>wait <span class="token keyword">with</span> <span class="token namespace">no</span> timeout
        <span class="token class-name">Thread</span><span class="token punctuation">.</span>join <span class="token keyword">with</span> <span class="token namespace">no</span> timeout
        <span class="token class-name">LockSupport</span><span class="token punctuation">.</span>park

        Â§Ñ‰∫éÁ≠âÂæÖÁä∂ÊÄÅÁöÑÁ∫øÁ®ãÊ≠£Âú®Á≠âÂæÖÂè¶‰∏Ä‰∏™Á∫øÁ®ãÊâßË°åÁâπÂÆöÁöÑÊìç‰Ωú„ÄÇ
        ‰æãÂ¶ÇÔºåÂú®‰∏Ä‰∏™ÂØπË±°‰∏äË∞ÉÁî®object<span class="token punctuation">.</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ÁöÑÁ∫øÁ®ãÊ≠£Âú®Á≠âÂæÖÂè¶‰∏Ä‰∏™Á∫øÁ®ãÂú®ËØ•ÂØπË±°‰∏äË∞ÉÁî®object<span class="token punctuation">.</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Êàñobject<span class="token punctuation">.</span> <span class="token function">notifyall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>„ÄÇ   
        <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ÊòØÈöèÊú∫Âî§ÈÜíÁöÑÔºå‰∏çÂêåÁöÑ JDK ÁâàÊú¨ÔºåÂú®Á≠âÂæÖÈòüÂàó‰∏≠Âî§ÈÜíÁöÑÁ∫øÁ®ãÔºåÂÖ∂‰ΩçÁΩÆÂú®Á≠âÂæÖÈòüÂàó‰∏≠‰∏çÂêå„ÄÇJDK1<span class="token punctuation">.</span><span class="token number">8</span> ‰∏≠ <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Âî§ÈÜíÁöÑÊòØÁ≠âÂæÖÈòüÂàó‰∏≠ÁöÑÂ§¥ËäÇÁÇπÔºàÁ≠âÂæÖÊó∂Èó¥ÊúÄÈïøÁöÑÈÇ£‰∏™Á∫øÁ®ãÔºâ    
        Ë∞ÉÁî®‰∫Üthread <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ÁöÑÁ∫øÁ®ãÊ≠£Âú®Á≠âÂæÖÊåáÂÆöÁöÑÁ∫øÁ®ãÁªàÊ≠¢„ÄÇ

   TIMED_WAITING  ÂÖ∑ÊúâÊåáÂÆöÊó∂Èó¥ÁöÑÁ≠âÂæÖÁä∂ÊÄÅ    Á≠âÂæÖÂè¶‰∏Ä‰∏™Á∫øÁ®ãÊâßË°åÊìç‰ΩúÁöÑÁ∫øÁ®ãÂú®ÊåáÂÆöÁöÑÁ≠âÂæÖÊó∂Èó¥ÂÜÖÂ§Ñ‰∫éÊ≠§Áä∂ÊÄÅ
   <span class="token operator">--</span>ÂÖ∑ÊúâÊåáÂÆöÁ≠âÂæÖÊó∂Èó¥ÁöÑÁ≠âÂæÖÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÁä∂ÊÄÅ„ÄÇÁ∫øÁ®ãÁî±‰∫éË∞ÉÁî®‰∫Ü‰ª•‰∏ãÊñπÊ≥ï‰∏≠ÁöÑ‰∏Ä‰∏™ÔºåÂπ∂‰∏îÊåáÂÆö‰∫ÜÊ≠£Á≠âÂæÖÊó∂Èó¥ËÄåÂ§Ñ‰∫éÂÆöÊó∂Á≠âÂæÖÁä∂ÊÄÅ<span class="token operator">:</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span>sleep
        <span class="token class-name">Object</span><span class="token punctuation">.</span>wait <span class="token keyword">with</span> <span class="token namespace">timeout</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span>join <span class="token keyword">with</span> <span class="token namespace">timeout</span>
        <span class="token class-name">LockSupport</span><span class="token punctuation">.</span>parkNanos
        <span class="token class-name">LockSupport</span><span class="token punctuation">.</span>parkUntil

   TERMINATED  Â∑≤ÁªàÊ≠¢Á∫øÁ®ãÁöÑÁ∫øÁ®ãÁä∂ÊÄÅÊàñÁ∫øÁ®ãÂ∑≤ÂÆåÊàêÊâßË°å       Â∑≤ÈÄÄÂá∫ÁöÑÁ∫øÁ®ãÂ§Ñ‰∫éËøôÁßçÁä∂ÊÄÅ
   <span class="token operator">--</span>ÁªàÊ≠¢Á∫øÁ®ãÁöÑÁ∫øÁ®ãÁä∂ÊÄÅ„ÄÇÁ∫øÁ®ãÂ∑≤ÁªèÂÆåÊàêÊâßË°å„ÄÇ  Ê≠§Êó∂Á∫øÁ®ãËøò‰∏çÊòØÊ¥ªÁùÄÁöÑÔºànot aliveÔºâ„ÄÇ

   Á∫øÁ®ãÂú®ÁªôÂÆöÁöÑÊó∂Èó¥ÁÇπÂè™ËÉΩÂ§Ñ‰∫é‰∏ÄÁßçÁä∂ÊÄÅ„ÄÇËøô‰∫õÁä∂ÊÄÅÊòØ‰∏çÂèçÊò†ÁöÑËôöÊãüÊú∫Áä∂ÊÄÅ‰ªª‰ΩïÊìç‰ΩúÁ≥ªÁªüÁöÑÁ∫øÁ®ãÁä∂ÊÄÅ„ÄÇ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="No5-ThreadState-java"><a href="#No5-ThreadState-java" class="headerlink" title="No5_ThreadState.java"></a>No5_ThreadState.java</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No5_ThreadState</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ãÁä∂ÊÄÅ„ÄÇËØ•ÊñπÊ≥ïÁî®‰∫éÁõëÊéßÁ≥ªÁªüÁä∂ÊÄÅÔºåËÄå‰∏çÊòØÁî®‰∫éÂêåÊ≠•ÊéßÂà∂„ÄÇ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÊâìÂç∞Â¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">NEW
RUNNABLE
<span class="token number">0</span>
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">4</span>
<span class="token number">5</span>
<span class="token number">6</span>
<span class="token number">7</span>
<span class="token number">8</span>
<span class="token number">9</span>
TERMINATED<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="Á∫øÁ®ãÂ∏∏Áî®ÊñπÊ≥ï"><a href="#Á∫øÁ®ãÂ∏∏Áî®ÊñπÊ≥ï" class="headerlink" title="Á∫øÁ®ãÂ∏∏Áî®ÊñπÊ≥ï"></a>Á∫øÁ®ãÂ∏∏Áî®ÊñπÊ≥ï</h4><p>‚Äã        ‰∏éÁ∫øÁ®ãÁä∂ÊÄÅÂØπÂ∫îÁöÑÂ∏∏Áî®ÊñπÊ≥ïÊúâ:</p>
<ul>
<li><code>void run()</code>:ÂàõÂª∫ËØ•Á±ªÁöÑÂ≠êÁ±ªÊó∂ÂøÖÈ°ªÂÆûÁé∞ÁöÑÊñπÊ≥ï„ÄÇ</li>
<li><code>void start()</code>:ÂºÄÂêØÁ∫øÁ®ãÁöÑÊñπÊ≥ï„ÄÇ</li>
<li><code>static void sleep(long t)</code> <strong>&#x2F;</strong> <code>static void sleep(long millis,int nanos)</code>Ôºö<strong>ÈáäÊîæCPUÁöÑÊâßË°åÊùÉÔºå‰ΩÜ‰∏çÈáäÊîæÈîÅ„ÄÇ</strong>ÂΩìÂâçÁ∫øÁ®ãÁù°Áú† <strong>X</strong> <strong>millis</strong> ÁöÑÊó∂Èó¥Ôºà millis ÊåáÂÆöÁù°Áú†Êó∂Èó¥ÊòØÂÖ∂ÊúÄÂ∞èÁöÑ‰∏çÊâßË°åÊó∂Èó¥ÔºåÂõ†‰∏∫sleep(millis)‰ºëÁú†Âà∞ËææÂêéÔºåÊó†Ê≥ï‰øùËØÅ‰ºöË¢´JVMÁ´ãÂç≥Ë∞ÉÂ∫¶)Ôºåsleep()ÊòØ‰∏Ä‰∏™ÈùôÊÄÅÊñπÊ≥ï(static method)ÔºåÊâÄ‰ª•ÂÆÉ‰∏ç‰ºöÂÅúÊ≠¢ÂÖ∂‰ªñÁöÑÁ∫øÁ®ã‰πüÂ§Ñ‰∫é‰ºëÁú†Áä∂ÊÄÅ„ÄÇ<strong>Á∫øÁ®ãsleep()Êó∂‰∏ç‰ºöÂ§±ÂéªÊã•ÊúâÁöÑÂØπË±°ÈîÅ„ÄÇ</strong>‰ΩúÁî®ÊòØ:‰øùÊåÅÂØπË±°ÈîÅÔºåËÆ©Âá∫ CPUÔºåË∞ÉÁî®ÁõÆÁöÑÊòØ‰∏çËÆ©ÂΩìÂâçÁ∫øÁ®ãÁã¨Ëá™Èú∏Âç†ËØ•ËøõÁ®ãÊâÄËé∑ÂèñÁöÑCPUËµÑÊ∫êÔºå‰ª•Áïô‰∏ÄÂÆöÁöÑÊó∂Èó¥ÁªôÂÖ∂‰ªñÁ∫øÁ®ãÊâßË°åÁöÑÊú∫‰ºö„ÄÇ</li>
<li><code>final void wait()</code>Ôºö<strong>ÈáäÊîæCPUÁöÑÊâßË°åÊùÉÔºåÈáäÊîæÈîÅ</strong>„ÄÇÂΩì‰∏Ä‰∏™Á∫øÁ®ãÊâßË°åÂà∞wait()ÊñπÊ≥ïÊó∂ÔºåÂÆÉÂ∞±ËøõÂÖ•Âà∞‰∏Ä‰∏™ÂíåËØ•ÂØπË±°Áõ∏ÂÖ≥ÁöÑÁ≠âÂæÖÊ±†(Waiting PoolÔºâ)‰∏≠ÔºåÂêåÊó∂Â§±Âéª‰∫ÜÂØπË±°ÁöÑÊú∫ÈîÅ‚ÄîÊöÇÊó∂ÁöÑÔºåwaitÂêéËøòË¶ÅËøîËøòÂØπË±°ÈîÅ„ÄÇ<strong>ÂΩìÂâçÁ∫øÁ®ãÂøÖÈ°ªÊã•ÊúâÂΩìÂâçÂØπË±°ÁöÑÈîÅ,Â¶ÇÊûúÂΩìÂâçÁ∫øÁ®ã‰∏çÊòØÊ≠§ÈîÅÁöÑÊã•ÊúâËÄÖÔºå‰ºöÊäõÂá∫IllegalMonitorStateExceptionÂºÇÂ∏∏ÔºåÊâÄ‰ª• wait()ÂøÖÈ°ªÂú®synchronized block‰∏≠Ë∞ÉÁî®„ÄÇ</strong></li>
<li><code>final void notify()</code> <strong>&#x2F;</strong> <code>notifyAll()</code>ÔºöÂî§ÈÜíÂú®ÂΩìÂâçÂØπË±°Á≠âÂæÖÊ±†‰∏≠Á≠âÂæÖÁöÑÁ¨¨‰∏Ä‰∏™Á∫øÁ®ã**&#x2F;<strong>ÊâÄÊúâÁ∫øÁ®ã„ÄÇ</strong><code>notify()</code> &#x2F; <code>notifyAll()</code>‰πüÂøÖÈ°ªÊã•ÊúâÁõ∏ÂêåÂØπË±°ÈîÅÔºåÂê¶Âàô‰πü‰ºöÊäõÂá∫IllegalMonitorStateExceptionÂºÇÂ∏∏„ÄÇ**</li>
<li><code>static void yied()</code>ÔºöÂèØ‰ª•ÂØπÂΩìÂâçÁ∫øÁ®ãËøõË°å‰∏¥Êó∂ÊöÇÂÅúÔºåËÆ©Âá∫CPUÁöÑ‰ΩøÁî®ÊùÉÔºåÁªôÂÖ∂‰ªñÁ∫øÁ®ãÊâßË°åÊú∫‰ºö„ÄÅËÆ©ÂêåÁ≠â‰ºòÂÖàÊùÉÁöÑÁ∫øÁ®ãËøêË°å(‰ΩÜÂπ∂‰∏ç‰øùËØÅÂΩìÂâçÁ∫øÁ®ã‰ºöË¢´JVMÂÜçÊ¨°Ë∞ÉÂ∫¶„ÄÅ‰ΩøËØ•Á∫øÁ®ãÈáçÊñ∞ËøõÂÖ• Running Áä∂ÊÄÅ)ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂêåÁ≠â‰ºòÂÖàÊùÉÁöÑÁ∫øÁ®ãÔºåÈÇ£‰πà <code>yield()</code>ÊñπÊ≥ïÂ∞Ü‰∏ç‰ºöËµ∑‰ΩúÁî®„ÄÇ</li>
<li><code>final void join()</code>ÔºöÊåáÂÆöÊó∂Èó¥ÂÜÖÁ≠âÂæÖÊ≠§Á∫øÁ®ãÊ≠ª‰∫°„ÄÇÊ≠§ÊñπÊ≥ïÁöÑË∞ÉÁî®Ë°å‰∏∫‰∏éË∞ÉÁî®join(0)ÂÆåÂÖ®Áõ∏Âêå</li>
</ul>
<h5 id="No5-ThreadState-Sleep-Yield-Join-Method-java"><a href="#No5-ThreadState-Sleep-Yield-Join-Method-java" class="headerlink" title="No5_ThreadState_Sleep_Yield_Join_Method.java"></a>No5_ThreadState_Sleep_Yield_Join_Method.java</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No5_ThreadState_Sleep_Yield_Join_Method</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">//        testSleep();</span>
<span class="token comment">//        testYield();</span>
<span class="token comment">//        testJoin();</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//Thread.sleep()ÊñπÊ≥ïÔºö</span>
    <span class="token comment">// ‰ΩøÂΩìÂâçÊâßË°åÁöÑÁ∫øÁ®ãÂú®ÊåáÂÆöÁöÑÊØ´ÁßíÊï∞ÂÜÖ‰ºëÁú†(ÊöÇÊó∂ÂÅúÊ≠¢ÊâßË°å)ÔºåËøôÂèñÂÜ≥‰∫éÁ≥ªÁªüËÆ°Êó∂Âô®ÂíåË∞ÉÂ∫¶Âô®ÁöÑÁ≤æÂ∫¶ÂíåÂáÜÁ°ÆÊÄß„ÄÇÁ∫øÁ®ã‰∏ç‰ºöÂ§±Âéª‰ªª‰ΩïÁõëËßÜÂô®ÁöÑÊâÄÊúâÊùÉ„ÄÇ</span>
    <span class="token comment">// ÂèÇÊï∞:ÊØ´Áßí-‰ºëÁú†Êó∂Èó¥ÁöÑÈïøÂ∫¶Ôºå‰ª•ÊØ´Áßí‰∏∫Âçï‰Ωç</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testSleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"A"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//TimeUnit.Milliseconds.sleep(500)</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//Thread.yield( )ÊñπÊ≥ïÔºö</span>
    <span class="token comment">// ‰ΩøÂΩìÂâçÁ∫øÁ®ã‰ªéÊâßË°åÁä∂ÊÄÅÔºàËøêË°åÁä∂ÊÄÅÔºâÂèò‰∏∫ÂèØÊâßË°åÊÄÅÔºàÂ∞±Áª™Áä∂ÊÄÅÔºâ„ÄÇ</span>
    <span class="token comment">// cpu‰ºö‰ªé‰ºóÂ§öÁöÑÂèØÊâßË°åÊÄÅÈáåÈÄâÊã©Ôºå‰πüÂ∞±ÊòØËØ¥ÔºåÂΩìÂâç‰πüÂ∞±ÊòØÂàöÂàöÁöÑÈÇ£‰∏™Á∫øÁ®ãËøòÊòØÊúâÂèØËÉΩ‰ºöË¢´ÂÜçÊ¨°ÊâßË°åÂà∞ÁöÑÔºåÂπ∂‰∏çÊòØËØ¥‰∏ÄÂÆö‰ºöÊâßË°åÂÖ∂‰ªñÁ∫øÁ®ãËÄåËØ•Á∫øÁ®ãÂú®‰∏ã‰∏ÄÊ¨°‰∏≠‰∏ç‰ºöÊâßË°åÂà∞‰∫Ü„ÄÇ</span>
    <span class="token comment">//</span>
    <span class="token comment">// JavaÁ∫øÁ®ã‰∏≠Êúâ‰∏Ä‰∏™Thread.yield( )ÊñπÊ≥ïÔºåÂæàÂ§ö‰∫∫ÁøªËØëÊàêÁ∫øÁ®ãËÆ©Ê≠•„ÄÇ</span>
    <span class="token comment">// È°æÂêçÊÄù‰πâÔºåÂ∞±ÊòØËØ¥ÂΩì‰∏Ä‰∏™Á∫øÁ®ã‰ΩøÁî®‰∫ÜËøô‰∏™ÊñπÊ≥ï‰πãÂêéÔºåÂÆÉÂ∞±‰ºöÊääËá™Â∑±CPUÊâßË°åÁöÑÊó∂Èó¥ËÆ©ÊéâÔºåËÆ©Ëá™Â∑±ÊàñËÄÖÂÖ∂ÂÆÉÁöÑÁ∫øÁ®ãËøêË°å„ÄÇ</span>
    <span class="token comment">//</span>
    <span class="token comment">// Êâì‰∏™ÊØîÊñπÔºöÁé∞Âú®ÊúâÂæàÂ§ö‰∫∫Âú®ÊéíÈòü‰∏äÂéïÊâÄÔºåÂ•Ω‰∏çÂÆπÊòìËΩÆÂà∞Ëøô‰∏™‰∫∫‰∏äÂéïÊâÄ‰∫ÜÔºåÁ™ÅÁÑ∂Ëøô‰∏™‰∫∫ËØ¥Ôºö‚ÄúÊàëË¶ÅÂíåÂ§ßÂÆ∂Êù•‰∏™Á´ûËµõÔºåÁúãË∞ÅÂÖàÊä¢Âà∞ÂéïÊâÄÔºÅ‚ÄùÔºå</span>
    <span class="token comment">// ÁÑ∂ÂêéÊâÄÊúâÁöÑ‰∫∫Âú®Âêå‰∏ÄËµ∑Ë∑ëÁ∫øÂÜ≤ÂêëÂéïÊâÄÔºåÊúâÂèØËÉΩÊòØÂà´‰∫∫Êä¢Âà∞‰∫ÜÔºå‰πüÊúâÂèØËÉΩ‰ªñËá™Â∑±ÊúâÊä¢Âà∞‰∫Ü„ÄÇ</span>
    <span class="token comment">// Êàë‰ª¨ËøòÁü•ÈÅìÁ∫øÁ®ãÊúâ‰∏™‰ºòÂÖàÁ∫ßÁöÑÈóÆÈ¢òÔºåÈÇ£‰πàÊâãÈáåÊúâ‰ºòÂÖàÊùÉÁöÑËøô‰∫õ‰∫∫Â∞±‰∏ÄÂÆöËÉΩÊä¢Âà∞ÂéïÊâÄÁöÑ‰ΩçÁΩÆÂêó? ‰∏ç‰∏ÄÂÆöÁöÑÔºå‰ªñ‰ª¨Âè™ÊòØÊ¶ÇÁéá‰∏äÂ§ß‰∫õÔºå‰πüÊúâÂèØËÉΩÊ≤°ÁâπÊùÉÁöÑÊä¢Âà∞‰∫Ü„ÄÇ</span>

    <span class="token comment">// Ê∫êÁ†Å</span>
    <span class="token comment">// ÁªôË∞ÉÂ∫¶Âô®ÁöÑÊèêÁ§∫ÔºåË°®ÊòéÂΩìÂâçÁ∫øÁ®ãÊÑøÊÑèÊîæÂºÉÂΩìÂâçÂØπÂ§ÑÁêÜÂô®ÁöÑ‰ΩøÁî®„ÄÇË∞ÉÂ∫¶Á®ãÂ∫èÂèØ‰ª•ÂøΩÁï•Ëøô‰∏™ÊèêÁ§∫„ÄÇ</span>
    <span class="token comment">// YieldÊòØ‰∏ÄÁßçÂêØÂèëÂºèÁöÑÂ∞ùËØïÔºåÊó®Âú®ÊèêÈ´òÁ∫øÁ®ã‰πãÈó¥ÁöÑÁõ∏ÂØπËøõÁ®ãÔºåÂê¶ÂàôÂ∞±‰ºöËøáÂ∫¶‰ΩøÁî®CPU„ÄÇÂÆÉÁöÑ‰ΩøÁî®Â∫îËØ•‰∏éËØ¶ÁªÜÁöÑÂàÜÊûêÂíåÂü∫ÂáÜÊµãËØïÁõ∏ÁªìÂêàÔºå‰ª•Á°Æ‰øùÂÆÉÂÆûÈôÖ‰∏äÂÖ∑ÊúâÈ¢ÑÊúüÁöÑÊïàÊûú„ÄÇ</span>
    <span class="token comment">// ‰ΩøÁî®ËøôÁßçÊñπÊ≥ïÂæàÂ∞ëÂêàÈÄÇ„ÄÇÂÆÉÂèØËÉΩÂØπË∞ÉËØïÊàñÊµãËØïÊúâÁî®ÔºåÂõ†‰∏∫ÂÆÉÂèØËÉΩÊúâÂä©‰∫éÁî±‰∫éÁ´û‰∫âÊù°‰ª∂ËÄå‰∫ßÁîüÈîôËØØ„ÄÇÂú®ËÆæËÆ°Âπ∂ÂèëÊéßÂà∂Áº∫ÁÇπÊó∂ÔºåÂÆÉÂèØËÉΩ‰πüÂæàÊúâÁî®</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testYield</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"A"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//ÂΩìi % 10 ‰∏∫0Êó∂ÔºåËØ•Á∫øÁ®ãÂ∞±‰ºöÊääCPUÊó∂Èó¥ËÆ©ÊéâÔºåËÆ©ÂÖ∂‰ªñÊàñËÄÖËá™Â∑±ÁöÑÁ∫øÁ®ãÊâßË°åÔºà‰πüÂ∞±ÊòØË∞ÅÂÖàÊä¢Âà∞Ë∞ÅÊâßË°åÔºâ</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//Yield is a heuristic attempt to improve relative progression between threads that would otherwise over-utilise a CPU.</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"------------B"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"============c"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"¬∑¬∑¬∑¬∑¬∑¬∑¬∑¬∑¬∑¬∑¬∑¬∑D"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//Thread.join()ÊñπÊ≥ïÔºö</span>
    <span class="token comment">// ÊåáÂÆöÊó∂Èó¥ÂÜÖÁ≠âÂæÖÊ≠§Á∫øÁ®ãÊ≠ª‰∫°„ÄÇÊ≠§ÊñπÊ≥ïÁöÑË∞ÉÁî®Ë°å‰∏∫‰∏éË∞ÉÁî®join(0)ÂÆåÂÖ®Áõ∏Âêå</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testJoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"A"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//TimeUnit.Milliseconds.sleep(100)</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>

            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"B"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//TimeUnit.Milliseconds.sleep(500)</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‰∏Ä‰∏ãÊâìÂç∞ËØÅÊòé‰∫Ü </p>
<blockquote>
<p><strong>Thread.yield( )ÊñπÊ≥ïÔºö</strong></p>
<ul>
<li><strong>‰ΩøÂΩìÂâçÁ∫øÁ®ã‰ªéÊâßË°åÁä∂ÊÄÅÔºàËøêË°åÁä∂ÊÄÅÔºâÂèò‰∏∫ÂèØÊâßË°åÊÄÅÔºàÂ∞±Áª™Áä∂ÊÄÅÔºâ„ÄÇ</strong></li>
<li><strong>cpu‰ºö‰ªé‰ºóÂ§öÁöÑÂèØÊâßË°åÊÄÅÈáåÈÄâÊã©Ôºå‰πüÂ∞±ÊòØËØ¥ÔºåÂΩìÂâç‰πüÂ∞±ÊòØÂàöÂàöÁöÑÈÇ£‰∏™Á∫øÁ®ãËøòÊòØÊúâÂèØËÉΩ‰ºöË¢´ÂÜçÊ¨°ÊâßË°åÂà∞ÁöÑÔºåÂπ∂‰∏çÊòØËØ¥‰∏ÄÂÆö‰ºöÊâßË°åÂÖ∂‰ªñÁ∫øÁ®ãËÄåËØ•Á∫øÁ®ãÂú®‰∏ã‰∏ÄÊ¨°‰∏≠‰∏ç‰ºöÊâßË°åÂà∞‰∫Ü„ÄÇ</strong></li>
</ul>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">A0
A1
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B0
A2
A3
A4
A5
A6
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B1
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B2
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B3
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B4
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B5
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B6
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B7
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B8
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B9
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token class-name">B10</span>
A7
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c0
A8
A9
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B11
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B12
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B13
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B14
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B15
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B16
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B17
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B18
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c1
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c2
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c3
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c4
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c5
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c6
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c7
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c8
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c9
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c10
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c11
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c12
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c13
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c14
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c15
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c16
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c17
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c18
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c19
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c20
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c21
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c22
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c23
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c24
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c25
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c26
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c27
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c28
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c29
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c30
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c31
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c32
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c33
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>c34
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B19
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B20
¬∑¬∑¬∑¬∑¬∑¬∑¬∑¬∑¬∑¬∑¬∑¬∑D0
    
    <span class="token operator">--</span><span class="token operator">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>Á∫øÁ®ãÁîüÂëΩÂë®ÊúüÁî®‰∏ÄÂº†ÂõæÊù•Ë°®Á§∫ÁöÑËØùÂ∞±ÊòØ:</p>
<p><img src="/image/Concurrent/Concurrent4.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent4.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p><img src="/image/Concurrent/Concurrent5.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent5.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<blockquote>
<p><strong>Á≠âÂæÖÂíåÈÄöÁü•ÁöÑÊ†áÂáÜËåÉÂºè</strong></p>
<p><strong>Á≠âÂæÖ(wait)ÊñπÔºö</strong></p>
<p>1„ÄÅ Ëé∑ÂèñÂØπË±°ÁöÑÈîÅÔºõ</p>
<p>2„ÄÅ Âæ™ÁéØÈáåÂà§Êñ≠Êù°‰ª∂ÊòØÂê¶Êª°Ë∂≥Ôºå‰∏çÊª°Ë∂≥Ë∞ÉÁî®waitÊñπÊ≥ïÔºå</p>
<p>3„ÄÅ Êù°‰ª∂Êª°Ë∂≥ÊâßË°å‰∏öÂä°ÈÄªËæë</p>
<p><strong>ÈÄöÁü•(notify)Êñπ</strong></p>
<p>1„ÄÅ Ëé∑ÂèñÂØπË±°ÁöÑÈîÅÔºõ</p>
<p>2„ÄÅ ÊîπÂèòÊù°‰ª∂</p>
<p>3„ÄÅ ÈÄöÁü•ÊâÄÊúâÁ≠âÂæÖÂú®ÂØπË±°ÁöÑÁ∫øÁ®ã</p>
<p><strong>notifyÂíånotifyAllÂ∫îËØ•Áî®Ë∞ÅÔºü</strong></p>
<p>Â∫îËØ•Â∞ΩÈáè‰ΩøÁî®notifyAllÔºå‰ΩøÁî®notifyÂõ†‰∏∫ÊúâÂèØËÉΩÂèëÁîü<strong>‰ø°Âè∑‰∏¢Â§±</strong>ÁöÑÁöÑÊÉÖÂÜµ„ÄÇÂú®Â§öÁ∫øÁ®ãÊÉÖÂÜµ‰∏ãÔºånotifyÂè™ËÉΩÂî§ÈÜíÈöèÊú∫ÁöÑ‰∏Ä‰∏™‰ºëÁú†Á∫øÁ®ãÔºåÂÖ∂‰ªñÂ∑≤‰ºëÁú†ÁöÑÁ∫øÁ®ã‰∏çËÉΩÂî§ÈÜíÔºåÈÄ†Êàê‰ø°Âè∑‰∏çËÉΩ‰º†ËææËÄå‰∏¢Â§±ÔºåËÄånotifyAllÂèØ‰ª•Âî§ÈÜíÊâÄÊúâÁöÑ„ÄÇ</p>
</blockquote>
<p><strong>Ë∞ÉÁî® join()„ÄÅyield() „ÄÅsleep()„ÄÅwait()„ÄÅnotify()Á≠âÊñπÊ≥ïÂØπÈîÅÊúâ‰ΩïÂΩ±ÂìçÔºü</strong></p>
<p>Èù¢ËØïÁÇπ</p>
<ul>
<li>Á∫øÁ®ãÂú®ÊâßË°åjoin()‰ª•ÂêéÔºåÊåÅÊúâÁöÑÈîÅÊòØ‰∏çÈáäÊîæÁöÑ</li>
<li>Á∫øÁ®ãÂú®ÊâßË°åyield()‰ª•ÂêéÔºåÊåÅÊúâÁöÑÈîÅÊòØ‰∏çÈáäÊîæÁöÑ</li>
<li>sleep()ÊñπÊ≥ïË¢´Ë∞ÉÁî®‰ª•ÂêéÔºåÊåÅÊúâÁöÑÈîÅÊòØ‰∏çÈáäÊîæÁöÑ</li>
<li>Ë∞ÉÂä®wait()ÊñπÊ≥ï‰πãÂâçÔºåÂøÖÈ°ªË¶ÅÊåÅÊúâÈîÅ„ÄÇË∞ÉÁî®‰∫Üwait()ÊñπÊ≥ï‰ª•ÂêéÔºåÈîÅÂ∞±‰ºöË¢´ÈáäÊîæÔºåÂΩìwaitÊñπÊ≥ïËøîÂõûÁöÑÊó∂ÂÄôÔºåÁ∫øÁ®ã‰ºöÈáçÊñ∞ÊåÅÊúâÈîÅ</li>
<li>Ë∞ÉÂä®notify()&#x2F;notifyAll()ÊñπÊ≥ï‰πãÂâçÔºåÂøÖÈ°ªË¶ÅÊåÅÊúâÈîÅÔºåË∞ÉÁî®notify()&#x2F;notifyAll()ÊñπÊ≥ïÊú¨Ë∫´‰∏ç‰ºöÈáäÊîæÈîÅÁöÑ„ÄÇËøô‰∏§‰∏™ÈÉΩËÉΩË¢´interruptÊñπÊ≥ï‰∏≠Êñ≠ÂΩìÂâçÁä∂ÊÄÅ</li>
</ul>
<h3 id="‰ªÄ‰πàÊòØÂÆàÊä§Á∫øÁ®ã"><a href="#‰ªÄ‰πàÊòØÂÆàÊä§Á∫øÁ®ã" class="headerlink" title="‰ªÄ‰πàÊòØÂÆàÊä§Á∫øÁ®ã"></a>‰ªÄ‰πàÊòØÂÆàÊä§Á∫øÁ®ã</h3><p>‚Äã        (1ÔºâÂÆàÊä§Á∫øÁ®ã,ÂèØ‰ª•ÁÆÄÂçïÂú∞ÁêÜËß£‰∏∫ÂêéÂè∞ËøêË°åÁ∫øÁ®ã„ÄÇËøõÁ®ãÁªìÊùüÔºåÂÆàÊä§Á∫øÁ®ãËá™ÁÑ∂ËÄåÁÑ∂Âú∞Â∞±‰ºöÁªìÊùüÔºå‰∏çÈúÄË¶ÅÊâãÂä®ÁöÑÂéªÂÖ≥ÂøÉÂíåÈÄöÁü•ÂÖ∂Áä∂ÊÄÅ„ÄÇ‰æãÂ¶Ç:Âú®‰Ω†ÁöÑÂ∫îÁî®Á®ãÂ∫èËøêË°åÊó∂Êí≠ÊîæËÉåÊôØÈü≥‰πêÔºåÂú®ÊñáÂ≠óÁºñËæëÂô®ÈáåÂÅöËá™Âä®ËØ≠Ê≥ïÊ£ÄÊü•„ÄÅËá™Âä®‰øùÂ≠òÁ≠âÂäüËÉΩ„ÄÇJavaÁöÑÂûÉÂúæÂõûÊî∂‰πüÊòØ‰∏Ä‰∏™ÂÆàÊä§Á∫øÁ®ã„ÄÇÂÆàÊä§Á∫øÁ®ãÁöÑÂ•ΩÂ§ÑÂ∞±ÊòØ‰Ω†‰∏çÈúÄË¶ÅÂÖ≥ÂøÉÂÆÉÁöÑÁªìÊùüÈóÆÈ¢ò„ÄÇ‰æãÂ¶Ç‰Ω†Âú®‰Ω†ÁöÑÂ∫îÁî®Á®ãÂ∫èËøêË°åÁöÑÊó∂ÂÄôÂ∏åÊúõÊí≠ÊîæËÉåÊôØÈü≥‰πêÔºåÂ¶ÇÊûúÂ∞ÜËøô‰∏™Êí≠ÊîæËÉåÊôØÈü≥‰πêÁöÑÁ∫øÁ®ãËÆæÂÆö‰∏∫ÈùûÂÆàÊä§Á∫øÁ®ãÔºåÈÇ£‰πàÂú®Áî®Êà∑ËØ∑Ê±ÇÈÄÄÂá∫ÁöÑÊó∂ÂÄôÔºå‰∏ç‰ªÖË¶ÅÈÄÄÂá∫‰∏ªÁ∫øÁ®ãÔºåËøòË¶ÅÈÄöÁü•Êí≠ÊîæËÉåÊôØÈü≥‰πêÁöÑÁ∫øÁ®ãÈÄÄÂá∫ÔºõÂ¶ÇÊûúËÆæÂÆö‰∏∫ÂÆàÊä§Á∫øÁ®ãÂàô‰∏çÈúÄË¶Å‰∫Ü„ÄÇ<br>‚Äã        (2ÔºâÂÆàÊä§Á∫øÁ®ã‰∏éÊôÆÈÄöÁ∫øÁ®ãÂÜôÊ≥ï‰∏äÂü∫Êú¨Ê≤°Âï•Âå∫Âà´ÔºåË∞ÉÁî®Á∫øÁ®ãÂØπË±°ÁöÑÊñπÊ≥ïsetDaemon(true)ÔºåÂàôÂèØ‰ª•Â∞ÜÂÖ∂ËÆæÁΩÆ‰∏∫ÂÆàÊä§Á∫øÁ®ã„ÄÇËØ•ÊñπÊ≥ïÂøÖÈ°ªÂú®ÂêØÂä®Á∫øÁ®ãÂâçË∞ÉÁî®:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> setDaemon <span class="token punctuation">(</span><span class="token keyword">boolean</span> on<span class="token punctuation">)</span><span class="token comment">//ËØ•ÊñπÊ≥ïÂøÖÈ°ªÂú®ÂêØÂä®Á∫øÁ®ãÂâçË∞ÉÁî®</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>‚Äã        Â∞ÜËØ•Á∫øÁ®ãÊ†áËÆ∞‰∏∫ÂÆàÊä§Á∫øÁ®ãÊàñÁî®Êà∑Á∫øÁ®ã„ÄÇÂΩìÊ≠£Âú®ËøêË°åÁöÑÁ∫øÁ®ãÈÉΩÊòØÂÆàÊä§Á∫øÁ®ãÊó∂, JavaËôöÊãüÊú∫ÈÄÄÂá∫„ÄÇËØ•ÊñπÊ≥ïÈ¶ñÂÖàË∞ÉÁî®ËØ•Á∫øÁ®ãÁöÑ checkAccess ÊñπÊ≥ï‰∏î‰∏çÂ∏¶‰ªª‰ΩïÂèÇÊï∞„ÄÇËøôÂèØËÉΩÊäõÂá∫ SecurityException(Âú®ÂΩìÂâçÁ∫øÁ®ã‰∏≠)„ÄÇ</p>
<ul>
<li>ÂèÇÊï∞Ôºöon - Â¶ÇÊûú‰∏∫trueÔºåÂàôÂ∞ÜËØ•Á∫øÁ®ãÊ†áËÆ∞‰∏∫ÂÆàÊä§Á∫øÁ®ã„ÄÇ</li>
<li>ÊäõÂá∫ÔºöIllegalThreadStateException -Â¶ÇÊûúËØ•Á∫øÁ®ãÂ§Ñ‰∫éÊ¥ªÂä®Áä∂ÊÄÅ„ÄÇSecurityException-Â¶ÇÊûúÂΩìÂâçÁ∫øÁ®ãÊó†Ê≥ï‰øÆÊîπËØ•Á∫øÁ®ã„ÄÇ</li>
</ul>
<p>‚Äã        (3ÔºâÂÆàÊä§Á∫øÁ®ã‰∏ªÂä®Á®ãÂ∫èÂéª‰ΩøÁî®ÁöÑÊÉÖÂÜµËæÉÂ∞ëÔºå‰ΩÜÂú®ÔºåJVM ÁöÑÂûÉÂúæÂõûÊî∂„ÄÅÂÜÖÂ≠òÁÆ°ÁêÜÁ≠âÁ∫øÁ®ãÈÉΩÊòØÂÆàÊä§Á∫øÁ®ã„ÄÇËøòÊúâÂ∞±ÊòØÂú®ÂÅöÊï∞ÊçÆÂ∫ìÂ∫îÁî®Êó∂ÂÄôÔºå‰ΩøÁî®ÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†ÔºåËøûÊé•Ê±†Êú¨Ë∫´‰πüÂåÖÂê´ÁùÄÂæàÂ§öÂêéÂè∞Á∫øÁ®ã,ÁõëÊéßËøûÊé•‰∏™Êï∞„ÄÅË∂ÖÊó∂Êó∂Èó¥„ÄÅÁä∂ÊÄÅÁ≠âÁ≠â‰ΩøÁî®ÊÉÖÂÜµ„ÄÇ</p>
<h4 id="No6-ThreadDeamon-java"><a href="#No6-ThreadDeamon-java" class="headerlink" title="No6_ThreadDeamon.java"></a>No6_ThreadDeamon.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No6_ThreadDeamon</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ThreadA</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9999999L</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÂêéÂè∞Á∫øÁ®ãAÁ¨¨"</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">"Ê¨°ÊâßË°åÔºÅ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Á∫øÁ®ãB finally"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ThreadB</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Á∫øÁ®ãBÁ¨¨"</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">"Ê¨°ÊâßË°åÔºÅ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Á∫øÁ®ãB finally"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Thread</span> tA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> tB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tA<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ËÆæÁΩÆ‰∏∫ÂÆàÊä§Á∫øÁ®ã,Ê≥®ÊÑè‰∏ÄÂÆöË¶ÅÂú®ÂºÄÂßã‰πãÂâçË∞ÉÁî®</span>

        tB<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tA<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> mainThread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Á∫øÁ®ãAÊòØ‰∏çÊòØÂÆàÊä§Á∫øÁ®ã"</span> <span class="token operator">+</span> tA<span class="token punctuation">.</span><span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Á∫øÁ®ãbÊòØ‰∏çÊòØÂÆàÊä§Á∫øÁ®ã"</span> <span class="token operator">+</span> tB<span class="token punctuation">.</span><span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Á∫øÁ®ãmainÊòØ‰∏çÊòØÂÆàÊä§Á∫øÁ®ã"</span> <span class="token operator">+</span> mainThread<span class="token punctuation">.</span><span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‰ªé‰∏äÈù¢ÁöÑÊâßË°åÁªìÊûúÂèØ‰ª•ÁúãÂá∫:ÂâçÂè∞Á∫øÁ®ãÊòØ‰øùËØÅÊâßË°åÂÆåÊØïÁöÑÔºåÂêéÂè∞Á∫øÁ®ãËøòÊ≤°ÊúâÊâßË°åÂÆåÊØïÂ∞±ÈÄÄÂá∫‰∫Ü„ÄÇ</p>
<blockquote>
<p> <strong>ÂÆàÊä§Á∫øÁ®ã</strong>Âíå‰∏ªÁ∫øÁ®ãÂÖ±Ê≠ªÔºåÁ∫øÁ®ã‰∏≠ÁöÑfinally‰∏çËÉΩ‰øùËØÅ‰∏ÄÂÆöÊâßË°å</p>
</blockquote>
<h3 id="Á∫øÁ®ãÁªÑ"><a href="#Á∫øÁ®ãÁªÑ" class="headerlink" title="Á∫øÁ®ãÁªÑ"></a>Á∫øÁ®ãÁªÑ</h3><p>‚Äã        Âú®JavaÁöÑÂ§öÁ∫øÁ®ãÂ§ÑÁêÜ‰∏≠ÊúâÁ∫øÁ®ãÁªÑ ThreadGroup ÁöÑÊ¶ÇÂøµ,ThreadGroupÊòØ‰∏∫‰∫ÜÊñπ‰æøÁ∫øÁ®ãÁÆ°ÁêÜÂá∫Áé∞ÁöÑ„ÄÇÊàë‰ª¨ÂèØ‰ª•Áªü‰∏ÄËÆæÂÆöÁ∫øÁ®ãÁªÑÁöÑ‰∏Ä‰∫õÂ±ûÊÄß,ÊØîÂ¶Ç setDaemonÔºåËÆæÁΩÆÊú™Â§ÑÁêÜÂºÇÂ∏∏ÁöÑÂ§ÑÁêÜÊñπÊ≥ïÔºåËÆæÁΩÆÁªü‰∏ÄÁöÑÂÆâÂÖ®Á≠ñÁï•Á≠âÁ≠â,‰πüÂèØ‰ª•ÈÄöËøáÁ∫øÁ®ãÁªÑÊñπ‰æøÂú∞Ëé∑ÂæóÁ∫øÁ®ãÁöÑ‰∏Ä‰∫õ‰ø°ÊÅØ„ÄÇ<br>‚Äã        ÊØè‰∏Ä‰∏™ThreadGroupÈÉΩÂèØ‰ª•ÂåÖÂê´‰∏ÄÁªÑÁöÑÂ≠êÁ∫øÁ®ãÂíå‰∏ÄÁªÑÂ≠êÁ∫øÁ®ãÁªÑÔºåÂú®‰∏Ä‰∏™ËøõÁ®ã‰∏≠Á∫øÁ®ãÁªÑÊòØ‰ª•Ê†ëÂΩ¢ÁöÑÊñπÂºèÂ≠òÂú®ÔºåÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÊ†πÁ∫øÁ®ãÁªÑÊòØsystemÁ∫øÁ®ãÁªÑ„ÄÇsystem Á∫øÁ®ãÁªÑ‰∏ãÊòØmainÁ∫øÁ®ãÁªÑÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÁ¨¨‰∏ÄÁ∫ßÂ∫îÁî®Ëá™Â∑±ÁöÑÁ∫øÁ®ãÁªÑÊòØÈÄöËøámainÁ∫øÁ®ãÁªÑÂàõÂª∫Âá∫Êù•ÁöÑ„ÄÇ‰πüÂ∞±ÊòØËØ¥systemÁ∫øÁ®ãÁªÑÊòØÊâÄÊúâÁ∫øÁ®ãÊúÄÈ°∂Á∫ßÁöÑÁà∂Á∫øÁ®ãÁªÑ„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ÂèØ‰ª•Ëé∑ÂæóÂΩìÂâçÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÁªÑ„ÄÇ</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>‚Äã        JavaÂÖÅËÆ∏Êàë‰ª¨ÂØπ‰∏Ä‰∏™Á∫øÁ®ãÁªÑ‰∏≠ÁöÑÊâÄÊúâÁ∫øÁ®ãÂêåÊó∂ËøõË°åÊìç‰ΩúÔºåÊØîÂ¶ÇÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáË∞ÉÁî®Á∫øÁ®ãÁªÑÁöÑÁõ∏Â∫îÊñπÊ≥ïÊù•ËÆæÁΩÆÂÖ∂‰∏≠ÊâÄÊúâÁ∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ßÔºå‰πüÂèØ‰ª•ÂêØÂä®ÊàñÈòªÂ°ûÂÖ∂‰∏≠ÁöÑÊâÄÊúâÁ∫øÁ®ã„ÄÇ<br>‚Äã        JavaÁöÑÂ§öÁ∫øÁ®ãÁªÑÊú∫Âà∂ÁöÑÂè¶‰∏Ä‰∏™ÈáçË¶Å‰ΩúÁî®ÊòØÁ∫øÁ®ãÂÆâÂÖ®„ÄÇÁ∫øÁ®ãÁªÑÊú∫Âà∂ÂÖÅËÆ∏Êàë‰ª¨ÈÄöËøáÂàÜÁªÑÊù•Âå∫ÂàÜÊúâ‰∏çÂêåÂÆâÂÖ®ÁâπÊÄßÁöÑÁ∫øÁ®ãÔºåÂØπ‰∏çÂêåÁªÑÁöÑÁ∫øÁ®ãËøõË°å‰∏çÂêåÁöÑÂ§ÑÁêÜÔºåËøòÂèØ‰ª•ÈÄöËøáÁ∫øÁ®ãÁªÑÁöÑÂàÜÂ±ÇÁªìÊûÑÊù•ÊîØÊåÅ‰∏çÂØπÁ≠âÂÆâÂÖ®Êé™ÊñΩÁöÑÈááÁî®„ÄÇJavaÁöÑ ThreadGroupÁ±ªÊèê‰æõ‰∫ÜÂ§ßÈáèÁöÑÊñπÊ≥ïÊù•Êñπ‰æøÊàë‰ª¨ÂØπÁ∫øÁ®ãÁªÑÊ†ë‰∏≠ÁöÑÊØè‰∏Ä‰∏™Á∫øÁ®ãÁªÑ‰ª•ÂèäÁ∫øÁ®ãÁªÑ‰∏≠ÁöÑÊØè‰∏Ä‰∏™Á∫øÁ®ãËøõË°åÊìç‰Ωú„ÄÇ<br>‚Äã        Á∫øÁ®ãÁªÑÂíåÁ∫øÁ®ãÊ±†ÁöÑÂå∫Âà´ÔºöÁ∫øÁ®ãÁªÑÂíåÁ∫øÁ®ãÊ±†ÊòØ‰∏§‰∏™‰∏çÂêåÁöÑÊ¶ÇÂøµÔºå‰ªñ‰ª¨ÁöÑ‰ΩúÁî®ÂÆåÂÖ®‰∏çÂêåÔºåÂâçËÄÖÊòØ‰∏∫‰∫ÜÊñπ‰æøÁ∫øÁ®ãÁöÑÁÆ°ÁêÜÔºåÂêéËÄÖÊòØ‰∏∫‰∫ÜÁÆ°ÁêÜÁ∫øÁ®ãÁöÑÁîüÂëΩÂë®ÊúüÔºåÂ§çÁî®Á∫øÁ®ãÔºåÂáèÂ∞ëÂàõÂª∫ÈîÄÊØÅÁ∫øÁ®ãÁöÑÂºÄÈîÄ„ÄÇ</p>
<h4 id="ÂΩìÂâçÁ∫øÁ®ãÂâØÊú¨-ThreadLocal"><a href="#ÂΩìÂâçÁ∫øÁ®ãÂâØÊú¨-ThreadLocal" class="headerlink" title="ÂΩìÂâçÁ∫øÁ®ãÂâØÊú¨:ThreadLocal"></a>ÂΩìÂâçÁ∫øÁ®ãÂâØÊú¨:ThreadLocal</h4><p>‚Äã        (1)ÂΩì‰ΩøÁî®ThreadLocalÁª¥Êä§ÂèòÈáèÊó∂ÔºåThreadLocal‰∏∫ÊØè‰∏™‰ΩøÁî®ËØ•ÂèòÈáèÁöÑÁ∫øÁ®ãÊèê‰æõÁã¨Á´ãÁöÑÂèòÈáèÂâØÊú¨ÔºåÊâÄ‰ª•ÊØè‰∏Ä‰∏™Á∫øÁ®ãÈÉΩÂèØ‰ª•Áã¨Á´ãÂú∞ÊîπÂèòËá™Â∑±ÁöÑÂâØÊú¨ÔºåËÄå‰∏ç‰ºöÂΩ±ÂìçÂÖ∂‰ªñÁ∫øÁ®ãÊâÄÂØπÂ∫îÁöÑÂâØÊú¨„ÄÇ‰ªéÁ∫øÁ®ãÁöÑËßíÂ∫¶ÁúãÔºåÁõÆÊ†áÂèòÈáèÂ∞±ÂÉèÊòØÁ∫øÁ®ãÁöÑÊú¨Âú∞ÂèòÈáèÔºåËøô‰πüÊòØÁ±ªÂêç‰∏≠LocalÊâÄË¶ÅË°®ËææÁöÑÊÑèÊÄù„ÄÇ<br>‚Äã        (2ÔºâThreadLocal<T>Á±ªÊé•Âè£ÂæàÁÆÄÂçï,Âè™Êúâ4‰∏™ÊñπÊ≥ï:</p>
<ul>
<li><p><code>void set(T value)</code>,ËÆæÁΩÆÂΩìÂâçÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÂ±ÄÈÉ®ÂèòÈáèÁöÑÂÄº„ÄÇ</p>
</li>
<li><p><code>public T get()</code>ÔºåËØ•ÊñπÊ≥ïËøîÂõûÂΩìÂâçÁ∫øÁ®ãÊâÄÂØπÂ∫îÁöÑÁ∫øÁ®ãÂ±ÄÈÉ®ÂèòÈáè„ÄÇ</p>
</li>
<li><p><code>public void remove()</code>ÔºåÂ∞ÜÂΩìÂâçÁ∫øÁ®ãÂ±ÄÈÉ®ÂèòÈáèÁöÑÂÄºÂà†Èô§ÔºåÁõÆÁöÑÊòØ‰∏∫‰∫ÜÂáèÂ∞ëÂÜÖÂ≠òÁöÑÂç†Áî®ÔºåËØ•ÊñπÊ≥ïÊòØJDK5.0Êñ∞Â¢ûÁöÑÊñπÊ≥ï„ÄÇÈúÄË¶ÅÊåáÂá∫ÁöÑÊòØÔºåÂΩìÁ∫øÁ®ãÁªìÊùüÂêéÔºåÂØπÂ∫îËØ•Á∫øÁ®ãÁöÑÂ±ÄÈÉ®ÂèòÈáèÂ∞ÜËá™Âä®Ë¢´ÂûÉÂúæÂõûÊî∂ÔºåÊâÄ‰ª•ÊòæÂºèË∞ÉÁî®ËØ•ÊñπÊ≥ïÊ∏ÖÈô§Á∫øÁ®ãÁöÑÂ±ÄÈÉ®ÂèòÈáèÂπ∂‰∏çÊòØÂøÖÈ°ªÁöÑÊìç‰ΩúÔºå‰ΩÜÂÆÉÂèØ‰ª•Âä†Âø´ÂÜÖÂ≠òÂõûÊî∂ÁöÑÈÄüÂ∫¶„ÄÇ</p>
</li>
<li><p><code>protected T initialValue()</code>,ËøîÂõûËØ•Á∫øÁ®ãÂ±ÄÈÉ®ÂèòÈáèÁöÑÂàùÂßãÂÄºÔºåËØ•ÊñπÊ≥ïÊòØ‰∏Ä‰∏™protected ÁöÑÊñπÊ≥ïÔºåÊòæÁÑ∂ÊòØ‰∏∫‰∫ÜËÆ©Â≠êÁ±ªË¶ÜÁõñËÄåËÆæËÆ°ÁöÑ„ÄÇËøô‰∏™ÊñπÊ≥ïÊòØ‰∏Ä‰∏™Âª∂ËøüË∞ÉÁî®ÊñπÊ≥ï,Âú®Á∫øÁ®ãÁ¨¨1Ê¨°Ë∞ÉÁî®get()Êàñset(Object)Êó∂ÊâçÊâßË°åÔºåÂπ∂‰∏î‰ªÖÊâßË°å1Ê¨°„ÄÇThreadLocal‰∏≠ÁöÑÁº∫ÁúÅÂÆûÁé∞Áõ¥Êé•ËøîÂõû‰∏Ä‰∏™null„ÄÇ</p>
<p>(3ÔºâÁÆÄÂçïÁöÑ‰ΩøÁî®ÊñπÊ≥ïÂ¶Ç‰∏ã:</p>
</li>
</ul>
<h5 id="No7-ThreadLocalDemo-java"><a href="#No7-ThreadLocalDemo-java" class="headerlink" title="No7_ThreadLocalDemo.java"></a>No7_ThreadLocalDemo.java</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No7_ThreadLocalDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ‚ë†ÈÄöËøáÂåøÂêçÂÜÖÈÉ®Á±ªË¶ÜÁõñThreadLocalÁöÑinitialValue()ÊñπÊ≥ïÔºåÊåáÂÆöÂàùÂßãÂÄº</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> seqNum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">initialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token function">getThreadLocl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> seqNum<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// ‚ë°Ëé∑Âèñ‰∏ã‰∏Ä‰∏™Â∫èÂàóÂÄº</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getNextNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        seqNum<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>seqNum<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> seqNum<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">No7_ThreadLocalDemo</span> sn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">No7_ThreadLocalDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ‚ë¢ 3‰∏™Á∫øÁ®ãÂÖ±‰∫´ snÔºåÂêÑËá™‰∫ßÁîüÂ∫èÂàóÂè∑</span>
        <span class="token class-name">TestClient</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestClient</span><span class="token punctuation">(</span>sn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TestClient</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestClient</span><span class="token punctuation">(</span>sn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TestClient</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestClient</span><span class="token punctuation">(</span>sn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">TestClient</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">No7_ThreadLocalDemo</span> sn<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">TestClient</span><span class="token punctuation">(</span><span class="token class-name">No7_ThreadLocalDemo</span> sn<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sn <span class="token operator">=</span> sn<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// ‚ë£ÊØè‰∏™Á∫øÁ®ãÊâìÂá∫3‰∏™Â∫èÂàóÂÄº</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"thread["</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"] --> sn["</span> <span class="token operator">+</span> sn<span class="token punctuation">.</span><span class="token function">getNextNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            sn<span class="token punctuation">.</span><span class="token function">getThreadLocl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ÊØè‰∏™Á∫øÁ®ãÁî®ÂÆåÁöÑÊó∂ÂÄôË¶ÅËÆ∞ÂæóÂà†Èô§</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÈÄöÂ∏∏Êàë‰ª¨ÈÄöËøáÂåøÂêçÂÜÖÈÉ®Á±ªÁöÑÊñπÂºèÊù•ÂÆö‰πâThreadLocal ÁöÑÂ≠êÁ±ªÔºåÊèê‰æõÂàùÂßãÁöÑÂèòÈáèÂÄº,Â¶Ç‰æãÂ≠ê‰∏≠Ê≥®Èáä1Â§ÑÊâÄÁ§∫„ÄÇTestClientÁ∫øÁ®ã‰∫ßÁîü‰∏ÄÁªÑÂ∫èÂàóÂè∑ÔºåÂú®Ê≥®Èáä3Â§ÑÔºåÊàë‰ª¨ÁîüÊàê3‰∏™TestClientÔºåÂÆÉ‰ª¨ÂÖ±‰∫´Âêå‰∏Ä‰∏™TestNum ÂÆû‰æã„ÄÇËøêË°å‰ª•‰∏ä‰ª£Á†Å,Âú®ÊéßÂà∂Âè∞‰∏äËæìÂá∫‰ª•‰∏ãÁöÑÁªìÊûú:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">thread<span class="token punctuation">[</span><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">--</span><span class="token operator">></span> sn<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
thread<span class="token punctuation">[</span><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">--</span><span class="token operator">></span> sn<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
thread<span class="token punctuation">[</span><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">--</span><span class="token operator">></span> sn<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
thread<span class="token punctuation">[</span><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">--</span><span class="token operator">></span> sn<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
thread<span class="token punctuation">[</span><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">--</span><span class="token operator">></span> sn<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
thread<span class="token punctuation">[</span><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">--</span><span class="token operator">></span> sn<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
thread<span class="token punctuation">[</span><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">--</span><span class="token operator">></span> sn<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
thread<span class="token punctuation">[</span><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">--</span><span class="token operator">></span> sn<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
thread<span class="token punctuation">[</span><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">--</span><span class="token operator">></span> sn<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ËÄÉÂØüËæìÂá∫ÁöÑÁªìÊûú‰ø°ÊÅØÔºåÊàë‰ª¨ÂèëÁé∞ÊØè‰∏™Á∫øÁ®ãÊâÄ‰∫ßÁîüÁöÑÂ∫èÂè∑ËôΩÁÑ∂ÈÉΩÂÖ±‰∫´Âêå‰∏Ä‰∏™TestNumÂÆû‰æã,‰ΩÜÂÆÉ‰ª¨Âπ∂Ê≤°ÊúâÂèëÁîüÁõ∏‰∫íÂπ≤Êâ∞ÁöÑÊÉÖÂÜµ,ËÄåÊòØÂêÑËá™‰∫ßÁîüÁã¨Á´ãÁöÑÂ∫èÂàóÂè∑,ËøôÊòØÂõ†‰∏∫Êàë‰ª¨ÈÄöËøáThreadLocal‰∏∫ÊØè‰∏Ä‰∏™Á∫øÁ®ãÊèê‰æõ‰∫ÜÂçïÁã¨ÁöÑÂâØÊú¨„ÄÇ<br>‚Äã        (4) ThreadLocalÁöÑÂÆûÁé∞ÂéüÁêÜ:ÈÇ£‰πàÂà∞Â∫ïThreadLocalÁ±ªÊòØÂ¶Ç‰ΩïÂÆûÁé∞ËøôÁßç‚Äú‰∏∫ÊØè‰∏™Á∫øÁ®ãÊèê‰æõ‰∏çÂêåÁöÑÂèòÈáèÈìÇË¥ù‚ÄùÁöÑÂë¢?<br>‚Äã        ÂÖàÊù•Áúã‰∏Ä‰∏ãThreadLocalÁöÑset()ÊñπÊ≥ïÁöÑÊ∫êÁ†ÅÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑ:</p>
<p><img src="/image/Concurrent/Concurrent6.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent6.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        Âú®Ëøô‰∏™ÊñπÊ≥ïÂÜÖÈÉ®Êàë‰ª¨ÁúãÂà∞ÔºåÈ¶ñÂÖàÈÄöËøá <code>getMap(Thread t)</code>ÊñπÊ≥ïËé∑Âèñ‰∏Ä‰∏™ÂíåÂΩìÂâçÁ∫øÁ®ãÁõ∏ÂÖ≥ÁöÑ<code>ThreadLocalMap</code>ÔºåÁÑ∂ÂêéÂ∞ÜÂèòÈáèÁöÑÂÄºËÆæÁΩÆÂà∞Ëøô‰∏™ <code>ThreadLocalMap</code>ÂØπË±°‰∏≠ÔºåÂΩìÁÑ∂Â¶ÇÊûúËé∑ÂèñÂà∞ÁöÑ<code>ThreadLocalMap</code>ÂØπË±°‰∏∫Á©∫,Â∞±ÈÄöËøá<code>createMap</code>ÊñπÊ≥ïÂàõÂª∫„ÄÇ<br>‚Äã        Á∫øÁ®ãÈöîÁ¶ªÁöÑÁßòÂØÜÔºåÂ∞±Âú®‰∫é<code>ThreadLocalMap</code>Ëøô‰∏™Á±ª„ÄÇ<code>ThreadLocalMap</code>ÊòØ<code>ThreadLocal</code>Á±ªÁöÑ‰∏Ä‰∏™ÈùôÊÄÅÂÜÖÈÉ®Á±ªÔºåÂÆÉÂÆûÁé∞‰∫ÜÈîÆÂÄºÂØπÁöÑËÆæÁΩÆÂíåËé∑Âèñ(ÂØπÊØî MapÂØπË±°Êù•ÁêÜËß£)ÔºåÊØè‰∏™Á∫øÁ®ã‰∏≠ÈÉΩÊúâ‰∏Ä‰∏™Áã¨Á´ãÁöÑ<code>ThreadLocalMap</code>ÂâØÊú¨ÔºåÂÆÉÊâÄÂ≠òÂÇ®ÁöÑÂÄºÔºåÂè™ËÉΩË¢´ÂΩìÂâçÁ∫øÁ®ãËØªÂèñÂíå‰øÆÊîπ„ÄÇ<code>ThreadLocal</code>Á±ªÈÄöËøáÊìç‰ΩúÊØè‰∏Ä‰∏™Á∫øÁ®ãÁâπÊúâÁöÑ<code>ThreadLocalMap</code>ÂâØÊú¨Ôºå‰ªéËÄåÂÆûÁé∞‰∫ÜÂèòÈáèËÆøÈóÆÂú®‰∏çÂêåÁ∫øÁ®ã‰∏≠ÁöÑÈöîÁ¶ª„ÄÇÂõ†‰∏∫ÊØè‰∏™Á∫øÁ®ãÁöÑÂèòÈáèÈÉΩÊòØËá™Â∑±ÁâπÊúâÁöÑÔºåÂÆåÂÖ®‰∏ç‰ºöÊúâÂπ∂ÂèëÈîôËØØ„ÄÇËøòÊúâ‰∏ÄÁÇπÂ∞±ÊòØÔºå<code>ThreadLocalMap</code>Â≠òÂÇ®ÁöÑÈîÆÂÄºÂØπ‰∏≠ÁöÑÈîÆÊòØ<code>this</code>ÂØπË±°ÊåáÂêëÁöÑ<code>ThreadLocal</code>ÂØπË±°ÔºåËÄåÂÄºÂ∞±ÊòØ‰Ω†ÊâÄËÆæÁΩÆÁöÑÂØπË±°‰∫Ü„ÄÇ<br>‚Äã        ‰∏∫‰∫ÜÂä†Ê∑±ÁêÜËß£,Êàë‰ª¨Êé•ÁùÄÁúã‰∏äÈù¢‰ª£Á†Å‰∏≠Âá∫Áé∞ÁöÑ<code>getMap</code>Âíå <code>createMap</code>ÊñπÊ≥ïÁöÑÂÆûÁé∞:</p>
<p><img src="/image/Concurrent/Concurrent7.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent7.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Êé•‰∏ãÊù•ÂÜçÁúã‰∏Ä‰∏ã <code>ThreadLocal</code>Á±ª‰∏≠ÁöÑ<code>get()</code>ÊñπÊ≥ï:</p>
<p><img src="/image/Concurrent/Concurrent8.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent8.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>ÂÜçÊù•Áúã<code>setInitialValue()</code>ÊñπÊ≥ï:</p>
<p><img src="/image/Concurrent/Concurrent9.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent9.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        Ëé∑ÂèñÂíåÂΩìÂâçÁ∫øÁ®ãÁªëÂÆöÁöÑÂÄºÊó∂,<code>ThreadLocalMap</code>ÂØπË±°ÊòØ‰ª• <code>this</code> ÊåáÂêëÁöÑ<code>ThreadLocal</code>ÂØπË±°‰∏∫ÈîÆËøõË°åÊü•ÊâæÁöÑÔºåËøôÂΩìÁÑ∂ÂíåÂâçÈù¢set(ÊñπÊ≥ïÁöÑ‰ª£Á†ÅÊòØÁõ∏ÂëºÂ∫îÁöÑ„ÄÇ<br>‚Äã        Ëøõ‰∏ÄÊ≠•Âú∞,Êàë‰ª¨ÂèØ‰ª•ÂàõÂª∫‰∏çÂêåÁöÑ<code>ThreadLocal</code>ÂÆû‰æãÊù•ÂÆûÁé∞Â§ö‰∏™ÂèòÈáèÂú®‰∏çÂêåÁ∫øÁ®ãÈó¥ÁöÑËÆøÈóÆÈöîÁ¶ªÔºå‰∏∫‰ªÄ‰πàÂèØ‰ª•Ëøô‰πàÂÅöÔºüÂõ†‰∏∫‰∏çÂêåÁöÑ<code>ThreadLocal</code>ÂØπË±°‰Ωú‰∏∫‰∏çÂêåÈîÆÔºåÂΩìÁÑ∂‰πüÂèØ‰ª•Âú®Á∫øÁ®ãÁöÑ<code>ThreadLocalMap</code>ÂØπË±°‰∏≠ËÆæÁΩÆ‰∏çÂêåÁöÑÂÄº‰∫Ü„ÄÇÈÄöËøá<code>ThreadLocal</code>ÂØπË±°ÔºåÂú®Â§öÁ∫øÁ®ã‰∏≠ÂÖ±‰∫´‰∏Ä‰∏™ÂÄºÂíåÂ§ö‰∏™ÂÄºÁöÑÂå∫Âà´ÔºåÂ∞±ÂÉè‰Ω†Âú®‰∏Ä‰∏™<code>HashMap</code>ÂØπË±°‰∏≠Â≠òÂÇ®‰∏Ä‰∏™ÈîÆÂÄºÂØπÂíåÂ§ö‰∏™ÈîÆÂÄºÂØπ‰∏ÄÊ†∑Ôºå‰ªÖÊ≠§ËÄåÂ∑≤„ÄÇ<br>‚Äã        (5) <code>ThreadLocal</code> Âú®Â§ÑÁêÜÁ∫øÁ®ãÁöÑÂ±ÄÈÉ®ÂèòÈáèÁöÑÊó∂ÂÄôÊØîÂêéÈù¢Ë¶ÅËÆ≤ÁöÑ <code>synchronized</code>ÂêåÊ≠•Êú∫Âà∂Ëß£ÂÜ≥Á∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢òÊõ¥ÁÆÄÂçï,Êõ¥Êñπ‰æø,‰∏îÁªìÊûúÁ®ãÂ∫èÊã•ÊúâÊõ¥È´òÁöÑÂπ∂ÂèëÊÄß„ÄÇ<br>‚Äã        (6ÔºâÊ≥®ÊÑè‰∫ãÈ°π:<strong>‰ΩøÁî® <code>ThreadLocal</code>Ôºå‰∏ÄËà¨ÈÉΩÊòØÂ£∞ÊòéÂú®ÈùôÊÄÅÂèòÈáè‰∏≠ÔºåÂ¶ÇÊûú‰∏çÊñ≠Âú∞ÂàõÂª∫<code>ThreadLocal</code>ËÄå‰∏îÊ≤°ÊúâË∞ÉÁî®ÂÖ∂<code>remove</code>ÊñπÊ≥ïÔºåÂ∞Ü‰ºöÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÈú≤ÔºåÁâπÂà´ÊòØÂú®È´òÂπ∂ÂèëÁöÑWebÂÆπÂô®ÂΩì‰∏≠Ëøô‰πàÂÅöÁöÑÊó∂ÂÄô„ÄÇ</strong></p>
<h3 id="Á∫øÁ®ãÂºÇÂ∏∏ÁöÑÂ§ÑÁêÜ"><a href="#Á∫øÁ®ãÂºÇÂ∏∏ÁöÑÂ§ÑÁêÜ" class="headerlink" title="Á∫øÁ®ãÂºÇÂ∏∏ÁöÑÂ§ÑÁêÜ"></a>Á∫øÁ®ãÂºÇÂ∏∏ÁöÑÂ§ÑÁêÜ</h3><p>‚Äã        <code>run()</code>ÊñπÊ≥ï‰∏çÂÖÅËÆ∏ <code>throw exception</code>ÔºåÊâÄÊúâÁöÑÂºÇÂ∏∏ÂøÖÈ°ªÂú®<code>run()</code>ÊñπÊ≥ïÂÜÖËøõË°åÂ§ÑÁêÜ„ÄÇ<br>‚Äã        Âú®JavaÂ§öÁ∫øÁ®ãÁ®ãÂ∫è‰∏≠ÔºåÊâÄÊúâÁ∫øÁ®ãÈÉΩ‰∏çÂÖÅËÆ∏ÊäõÂá∫Êú™ÊçïËé∑ÁöÑ<code>checked exception</code>Ôºå‰πüÂ∞±ÊòØËØ¥ÂêÑ‰∏™Á∫øÁ®ãÈúÄË¶ÅËá™Â∑±ÊääËá™Â∑±ÁöÑ<code>checked exception</code>Â§ÑÁêÜÊéâ„ÄÇËøô‰∏ÄÁÇπÊòØÈÄöËøá<code>java.lang.Runnable.run()</code>ÊñπÊ≥ïÂ£∞Êòé(Âõ†‰∏∫Ê≠§ÊñπÊ≥ïÂ£∞Êòé‰∏äÊ≤°Êúâ <code>throw exception</code>ÈÉ®ÂàÜÔºâËøõË°å‰∫ÜÁ∫¶Êùü„ÄÇ‰ΩÜÊòØÁ∫øÁ®ã‰æùÁÑ∂ÊúâÂèØËÉΩÊäõÂá∫ <code>uncheckedexception</code>ÔºåÂΩìÊäõÂá∫Ê≠§Á±ªÂºÇÂ∏∏Êó∂ÔºåÁ∫øÁ®ãÂ∞±‰ºöÁªàÁªì,ËÄåÂØπ‰∫é‰∏ªÁ∫øÁ®ãÂíåÂÖ∂‰ªñÁ∫øÁ®ãÂÆåÂÖ®‰∏çÂèóÂΩ±ÂìçÔºå‰∏îÂÆåÂÖ®ÊÑüÁü•‰∏çÂà∞Êüê‰∏™Á∫øÁ®ãÊäõÂá∫ÁöÑÂºÇÂ∏∏Ôºå‰πüÊòØËØ¥ÂÆåÂÖ®Êó†Ê≥ï <code>catch</code>Âà∞Ëøô‰∏™ÂºÇÂ∏∏„ÄÇJVMÁöÑËøôÁßçËÆæËÆ°Ê∫êËá™‰∫éËøôÊ†∑‰∏ÄÁßçÁêÜÂøµ:‚ÄúÁ∫øÁ®ãÊòØÁã¨Á´ãÊâßË°åÁöÑ‰ª£Á†ÅÁâáÊñ≠ÔºåÁ∫øÁ®ãÁöÑÈóÆÈ¢òÂ∫îËØ•Áî±Á∫øÁ®ãËá™Â∑±Êù•Ëß£ÂÜ≥ÔºåËÄå‰∏çË¶ÅÂßîÊâòÂà∞Â§ñÈÉ®„ÄÇ‚ÄùÂü∫‰∫éËøôÊ†∑ÁöÑËÆæËÆ°ÁêÜÂøµ,Âú®Java‰∏≠,Á∫øÁ®ãÊñπÊ≥ïÁöÑÂºÇÂ∏∏(Êó†ËÆ∫ÊòØ<code>checked</code>ËøòÊòØ<code>unchecked exception</code>),ÈÉΩÂ∫îËØ•Âú®Á∫øÁ®ã‰ª£Á†ÅËæπÁïå‰πãÂÜÖÔºà<code>run()</code>ÊñπÊ≥ïÂÜÖ)ËøõË°å<code>try</code> <code>catch</code>Âπ∂Â§ÑÁêÜÊéâ„ÄÇ<br>‚Äã        Âõ†Ê≠§ÔºåÂú®threadÈáåÈù¢ÔºåÂ¶ÇÊûúË¶ÅÂ§ÑÁêÜ<code>checked exception</code>ÔºåÁÆÄÂçïÁöÑ‰∏Ä‰∏™ <code>try/catch</code>ÂùóÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇÂØπ‰∫éËøôÁßç<code>unchecked exception</code>ÔºåÁõ∏ÂØπÊù•ËØ¥Â∞±‰ºöÊúâÁÇπ‰∏ç‰∏ÄÊ†∑„ÄÇ<br>ËøôÊó∂Â∞±Ë¶ÅÁî®Âà∞ Thread ÈáåÈù¢ÁöÑ<code>setUncaughtExceptionHandler(UncaughtExceptionHandler)</code>ÔºåËøô‰∏™ÊñπÊ≥ïÂèØ‰ª•Áî®Êù•Â§ÑÁêÜ‰∏Ä‰∫õ<code>unchecked exception</code>„ÄÇ<code>setUncaughtExceptionHandler()</code>ÊñπÊ≥ïÁõ∏ÂΩì‰∫é‰∏Ä‰∏™‰∫ã‰ª∂Ê≥®ÂÜåÁöÑÂÖ•Âè£„ÄÇÂú®ThreadÁ±ªÈáåÈù¢ÁöÑÊ∫êÁ†ÅÂ¶Ç‰∏ã:</p>
<p><img src="/image/Concurrent/Concurrent10.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent10.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>ËÄåUncaughtExceptionHandlerÂàôÊòØ‰∏Ä‰∏™Êé•Âè£,ÂÆÉÁöÑÂ£∞ÊòéÂ¶Ç‰∏ã:</p>
<p><img src="/image/Concurrent/Concurrent11.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent11.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        Âú®ÂºÇÂ∏∏ÂèëÁîüÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨‰º†ÂÖ•ÁöÑ<code>UncaughtExceptionHandler</code>ÂèÇÊï∞ÁöÑ<code>uncaughtException</code>ÊñπÊ≥ï‰ºöË¢´Ë∞ÉÁî®„ÄÇ<br>‚Äã        ÁªºÂêàÂâçÈù¢ÁöÑËÆ®ËÆ∫ÔºåÊàë‰ª¨ÊääË¶ÅÂÆûÁé∞ <code>handle unchecked exception</code> ÁöÑÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÊ≠•È™§ÊÄªÁªìÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>ÂÆö‰πâ‰∏Ä‰∏™Á±ªÂÆûÁé∞<code>UncaughtExceptionHandler</code>Êé•Âè£„ÄÇÂú®ÂÆûÁé∞ÁöÑÊñπÊ≥ïÈáåÂåÖÂê´ÂØπÂºÇÂ∏∏Â§ÑÁêÜÁöÑÈÄªËæëÂíåÊ≠•È™§„ÄÇ</li>
<li>ÂÆö‰πâÁ∫øÁ®ãÊâßË°åÁªìÊûÑÂíåÈÄªËæë„ÄÇËøô‰∏ÄÊ≠•ÂíåÊôÆÈÄöÁ∫øÁ®ãÂÆö‰πâ‰∏ÄÊ†∑„ÄÇ</li>
<li>Âú®ÂàõÂª∫ÂíåÊâßË°åËØ•Â≠êÁ∫øÁ®ãÁöÑÊñπÊ≥ï‰∏≠,Âú® <code>thread.start()</code>ËØ≠Âè•ÂâçÂ¢ûÂä†‰∏Ä‰∏™<code>thread.setUncaughtExceptionHandler</code>ËØ≠Âè•Êù•ÂÆûÁé∞Â§ÑÁêÜÈÄªËæëÁöÑÊ≥®ÂÜå„ÄÇ</li>
</ul>
<p>‚Äã        ‰∏ãÈù¢ÔºåÊàë‰ª¨Â∞±ÊåâÁÖßËøô‰∏™Ê≠•È™§Êù•ÂÆûÁé∞‰∏Ä‰∏™Á§∫‰æã„ÄÇ<br>‚Äã        È¶ñÂÖàÊòØÂÆûÁé∞<code>UncaughtExceptionHandler</code>Êé•Âè£ÈÉ®ÂàÜ:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">Thread<span class="token punctuation">.</span>UncaughtExceptionHandler</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No8_ExceptionHandlerThread</span> <span class="token keyword">implements</span> <span class="token class-name">UncaughtExceptionHandler</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uncaughtException</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"An exception has been captured\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread: %s\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Exception: %s: %s\n"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stack Trace: \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread status: %s\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËøôÈáåÊàë‰ª¨Ê∑ªÂä†ÁöÑÂºÇÂ∏∏Â§ÑÁêÜÈÄªËæëÂæàÁÆÄÂçïÔºåÂè™ÊòØÊääÁ∫øÁ®ãÁöÑ‰ø°ÊÅØÂíåÂºÇÂ∏∏‰ø°ÊÅØÈÉΩÊâìÂç∞Âá∫Êù•„ÄÇÁÑ∂ÂêéÔºåÊàë‰ª¨ÂÆö‰πâÁ∫øÁ®ãÁöÑÂÜÖÂÆπÔºåËøôÈáåÔºåÊàë‰ª¨ÊïÖÊÑèËÆ©ËØ•Á∫øÁ®ã‰∫ßÁîü‰∏Ä‰∏™unchecked exception:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UseThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> number0 <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">"TTT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‰ªé‰∏äÈù¢‰ª£Á†Å‰∏≠Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ Integer.parseInt)ÈáåÈù¢ÁöÑÂèÇÊï∞ÊòØÈîôËØØÁöÑ,ËÇØÂÆö‰ºöÊäõÂá∫‰∏Ä‰∏™ÂºÇÂ∏∏Êù•„ÄÇÁé∞Âú®,Êàë‰ª¨ÂÜçÊääÂàõÂª∫Á∫øÁ®ãÂíåÊ≥®ÂÜåÂ§ÑÁêÜÈÄªËæëÁöÑÈÉ®ÂàÜË°•‰∏äÊù•:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">UseThread</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">setUncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">No8_ExceptionHandlerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Áé∞Âú®Êàë‰ª¨ÊâßË°åÊï¥‰∏™Á®ãÂ∫è,‰ºöÂèëÁé∞ÊúâÂ¶Ç‰∏ãÁöÑÁªìÊûúÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">An</span> exception has been captured
<span class="token class-name">Thread</span><span class="token operator">:</span> <span class="token number">12</span>
<span class="token class-name">Exception</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NumberFormatException</span><span class="token operator">:</span> <span class="token class-name">For</span> input string<span class="token operator">:</span> <span class="token string">"TTT"</span>
<span class="token class-name">Stack</span> <span class="token class-name">Trace</span><span class="token operator">:</span> 
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NumberFormatException</span><span class="token operator">:</span> <span class="token class-name">For</span> input string<span class="token operator">:</span> <span class="token string">"TTT"</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NumberFormatException</span><span class="token punctuation">.</span><span class="token function">forInputString</span><span class="token punctuation">(</span><span class="token class-name">NumberFormatException</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">65</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">580</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">615</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>thread<span class="token punctuation">.</span></span>No8_ExceptionHandlerThread</span>$<span class="token class-name">UseThread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">No8_ExceptionHandlerThread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">17</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">748</span><span class="token punctuation">)</span>
<span class="token class-name">Thread</span> status<span class="token operator">:</span> RUNNABLE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ËøôÈÉ®ÂàÜÁöÑËæìÂá∫Ê≠£Â•ΩÂ∞±ÊòØÊàë‰ª¨ÂâçÈù¢ÂÆûÁé∞ UncaughtExceptionHandlerÊé•Âè£ÁöÑÂÆö‰πâ„ÄÇ<br>‚Äã        Âõ†Ê≠§ÔºåÂØπ‰∫éunchecked exceptionÔºåÊàë‰ª¨‰πüÂèØ‰ª•ÈááÁî®Á±ª‰ºº‰∫ã‰ª∂Ê≥®ÂÜåÁöÑÊú∫Âà∂ÂÅö‰∏ÄÂÆöÁ®ãÂ∫¶ÁöÑÂ§ÑÁêÜ„ÄÇÂΩìÁÑ∂‰πüÂèØ‰∏çÂ§ÑÁêÜÊîæ‰ªªËá™Áî±,ËØªËÄÖÂèØ‰ª•ËØïËØïÊïàÊûú‰ªÄ‰πàÊÄé‰πàÊ†∑ÁöÑ,ËøôÈáå‰∏çÂÆûÈ™å‰∫Ü„ÄÇ<br>‚Äã        ÊÄª‰πãÔºåJava thread ÈáåÈù¢ÂÖ≥‰∫éÂºÇÂ∏∏ÁöÑÈÉ®ÂàÜÊØîËæÉÂ•áÁâπ„ÄÇ‰Ω†‰∏çËÉΩÁõ¥Êé•Âú®‰∏Ä‰∏™Á∫øÁ®ãÈáåÂéªÊäõÂá∫ÂºÇÂ∏∏„ÄÇ‰∏ÄËà¨Âú®Á∫øÁ®ãÈáåÁ¢∞Âà∞checked exceptionÔºåÊé®ËçêÁöÑÂÅöÊ≥ïÊòØÈááÁî® try&#x2F;catch ÂùóÊù•Â§ÑÁêÜ„ÄÇËÄåÂØπ‰∫éuncheckedexceptionÔºåÊØîËæÉÂêàÁêÜÁöÑÊñπÂºèÊòØÊ≥®ÂÜå‰∏Ä‰∏™ÂÆûÁé∞ UncaughtExceptionHandlerÊé•Âè£ÁöÑÂØπË±°ÂÆû‰æãÊù•Â§ÑÁêÜ„ÄÇ</p>
<h4 id="No8-ExceptionHandlerThread-java"><a href="#No8-ExceptionHandlerThread-java" class="headerlink" title="No8_ExceptionHandlerThread.java"></a>No8_ExceptionHandlerThread.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">Thread<span class="token punctuation">.</span>UncaughtExceptionHandler</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No8_ExceptionHandlerThread</span> <span class="token keyword">implements</span> <span class="token class-name">UncaughtExceptionHandler</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uncaughtException</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"An exception has been captured\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread: %s\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Exception: %s: %s\n"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stack Trace: \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Thread status: %s\n"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UseThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> number0 <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">"TTT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">UseThread</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">setUncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">No8_ExceptionHandlerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="ThreadÂÆâÂÖ®"><a href="#ThreadÂÆâÂÖ®" class="headerlink" title="ThreadÂÆâÂÖ®"></a>ThreadÂÆâÂÖ®</h2><p>ÂÆâÂÖ®‰∏§Â≠óÂæàÈáçË¶ÅÔºå‰∏çËÉΩÂøòËÆ∞‰πü‰∏çËÉΩ‰∏¢„ÄÇ‰∏á‰∏Ä‰Ω†ÊääÂÆÉÂøò‰∫Ü,Á®ãÂ∫èÂ∞±‰ºöÂá∫ Bug.<br><strong>È´òÂπ∂Âèë„ÄÅÂ§öÁ∫øÁ®ãÂºÄÂèëÁöÑÊó∂ÂÄôÂ¶Ç‰Ωï‰øùËØÅÂÆâÂÖ®ÂíåÁ®ãÂ∫èÁöÑÂáÜÁ°ÆÊÄß?</strong></p>
<h3 id="ÂàùËØÜJavaÂÜÖÂ≠òÊ®°Âûã‰∏éÂ§öÁ∫øÁ®ã"><a href="#ÂàùËØÜJavaÂÜÖÂ≠òÊ®°Âûã‰∏éÂ§öÁ∫øÁ®ã" class="headerlink" title="ÂàùËØÜJavaÂÜÖÂ≠òÊ®°Âûã‰∏éÂ§öÁ∫øÁ®ã"></a>ÂàùËØÜJavaÂÜÖÂ≠òÊ®°Âûã‰∏éÂ§öÁ∫øÁ®ã</h3><p>‚Äã        ÊÉ≥Ëß£ÂÜ≥ÂíåËÆ§ËØÜÂÆâÂÖ®ÊÄßÈóÆÈ¢òÔºåÂÖà‰ªéÂéüÁêÜ‰∏äÊúâ‰∏™ÂàùÊµÖÁöÑËÆ§ËØÜ„ÄÇ<br>‚Äã        Áé∞‰ª£ËÆ°ÁÆóÊú∫Ôºå<strong>CPUÂú®ËÆ°ÁÆóÁöÑÊó∂ÂÄôÔºåÂπ∂‰∏çÊÄªÊòØ‰ªéÂÜÖÂ≠òËØªÂèñÊï∞ÊçÆÔºåÂÆÉÁöÑÊï∞ÊçÆËØªÂèñÈ°∫Â∫è‰ºòÂÖàÁ∫ßÊòØ:ÂØÑÂ≠òÂô®‚ÜíÈ´òÈÄüÁºìÂ≠ò‚ÜíÂÜÖÂ≠ò</strong>ÔºåÁ∫øÁ®ãËÆ°ÁÆóÁöÑÊó∂ÂÄôÔºåÂéüÂßãÁöÑÊï∞ÊçÆÊù•Ëá™ÂÜÖÂ≠ò,Âú®ËÆ°ÁÆóËøáÁ®ã‰∏≠ÔºåÊúâ‰∫õÊï∞ÊçÆÂèØËÉΩË¢´È¢ëÁπÅËØªÂèñÔºåËøô‰∫õÊï∞ÊçÆË¢´Â≠òÂÇ®Âú®ÂØÑÂ≠òÂô®ÂíåÈ´òÈÄüÁºìÂ≠ò‰∏≠ÔºåÂΩìÁ∫øÁ®ãËÆ°ÁÆóÂÆåÂêéÔºåËøô‰∫õÁºìÂ≠òÁöÑÊï∞ÊçÆÂú®ÈÄÇÂΩìÁöÑÊó∂ÂÄôÂ∫îËØ•ÂÜôÂõûÂÜÖÂ≠òÔºåÂΩìÂ§ö‰∏™Á∫øÁ®ãÂêåÊó∂ËØªÂÜôÊüê‰∏™ÂÜÖÂ≠òÊï∞ÊçÆÊó∂ÔºåÁî±‰∫éÊ∂âÂèäÊï∞ÊçÆÁöÑÂèØËßÅÊÄß„ÄÅÊìç‰ΩúÁöÑÊúâÂ∫èÊÄßÔºåÊâÄ‰ª•Â∞±‰ºö‰∫ßÁîüÂ§öÁ∫øÁ®ãÂπ∂ÂèëÈóÆÈ¢ò„ÄÇ<br>‚Äã        <strong>Java‰Ωú‰∏∫Âπ≥Âè∞Êó†ÂÖ≥ÊÄßËØ≠Ë®ÄÔºåJLS (JavaËØ≠Ë®ÄËßÑËåÉ)ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™Áªü‰∏ÄÁöÑÂÜÖÂ≠òÁÆ°ÁêÜÊ®°Âûã<code>JMM</code> (<code>Java Memory Model</code>)Ôºå<code>JMM</code>Â±èËîΩ‰∫ÜÂ∫ïÂ±ÇÂπ≥Âè∞ÂÜÖÂ≠òÁÆ°ÁêÜÁªÜËäÇ,Âú®Â§öÁ∫øÁ®ãÁéØÂ¢É‰∏≠ÂøÖÈ°ªËß£ÂÜ≥ÂèØËßÅÊÄßÂíåÊúâÂ∫èÊÄßÁöÑÈóÆÈ¢ò„ÄÇ<code>JMM</code>ËßÑÂÆö‰∫ÜjvmÊúâ‰∏ªÂÜÖÂ≠ò(<code>Main Memory</code>)ÂíåÂ∑•‰ΩúÂÜÖÂ≠òÔºà<code>Working Memory</code>)Ôºå‰∏ªÂÜÖÂ≠òÂÖ∂ÂÆûÂ∞±ÊòØÊàë‰ª¨Âπ≥Êó∂ËØ¥ÁöÑJavaÂ†ÜÂÜÖÂ≠òÔºåÂ≠òÊîæÁ®ãÂ∫è‰∏≠ÊâÄÊúâÁöÑÁ±ªÂÆû‰æã„ÄÅÈùôÊÄÅÊï∞ÊçÆÁ≠âÂèòÈáèÔºåÊòØÂ§ö‰∏™Á∫øÁ®ãÂÖ±‰∫´ÁöÑ,ËÄåÂ∑•‰ΩúÂÜÖÂ≠òÂ≠òÊîæÁöÑÊòØËØ•Á∫øÁ®ã‰ªé‰∏ªÂÜÖÂ≠ò‰∏≠Êã∑Ë¥ùËøáÊù•ÁöÑÂèòÈáè‰ª•ÂèäËÆøÈóÆÊñπÊ≥ïÊâÄÂèñÂæóÁöÑÂ±ÄÈÉ®ÂèòÈáèÔºåÊòØÊØè‰∏™Á∫øÁ®ãÁßÅÊúâÁöÑÂÖ∂‰ªñÁ∫øÁ®ã‰∏çËÉΩËÆøÈóÆÔºåÊØè‰∏™Á∫øÁ®ãÂØπÂèòÈáèÁöÑÊìç‰ΩúÈÉΩÊòØ‰ª•ÂÖà‰ªé‰∏ªÂÜÖÂ≠òÂ∞ÜÂÖ∂Êã∑Ë¥ùÂà∞Â∑•‰ΩúÂÜÖÂ≠òÂÜçÂØπÂÖ∂ËøõË°åÊìç‰ΩúÁöÑÊñπÂºèËøõË°åÔºåÂ§ö‰∏™Á∫øÁ®ã‰πãÈó¥‰∏çËÉΩÁõ¥Êé•‰∫íÁõ∏‰º†ÈÄíÊï∞ÊçÆÈÄö‰ø°ÔºåÂè™ËÉΩÈÄöËøáÂÖ±‰∫´ÂèòÈáèÊù•ËøõË°å</strong>„ÄÇÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent12.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent12.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        ÈóÆÈ¢ò‰∏Ä:Áî±‰∫éÂ§ö‰∏™Á∫øÁ®ã‰πãÈó¥ÊòØ‰∏çËÉΩ‰∫íÁõ∏‰º†ÈÄíÊï∞ÊçÆÈÄö‰ø°ÁöÑ,ÂÆÉ‰ª¨‰πãÈó¥ÁöÑÊ≤üÈÄöÂè™ËÉΩÈÄöËøáÂÖ±‰∫´ÂèòÈáèÊù•ËøõË°å„ÄÇJavaÂÜÖÂ≠òÊ®°Âûã(<code>JMM</code>ÔºâËßÑÂÆö‰∫ÜjvmÊúâ‰∏ªÂÜÖÂ≠òÔºå‰∏ªÂÜÖÂ≠òÊòØÂ§ö‰∏™Á∫øÁ®ãÂÖ±‰∫´ÁöÑ„ÄÇÂΩì<code>new</code>‰∏Ä‰∏™ÂØπË±°ÁöÑÊó∂ÂÄôÔºå‰πüÊòØË¢´ÂàÜÈÖçÂú®‰∏ªÂÜÖÂ≠ò‰∏≠ÔºåÊØè‰∏™Á∫øÁ®ãÈÉΩÊúâËá™Â∑±ÁöÑÂ∑•‰ΩúÂÜÖÂ≠òÔºåÂ∑•‰ΩúÂÜÖÂ≠òÂ≠òÂÇ®‰∫Ü‰∏ªÂ≠òÁöÑÊüê‰∫õÂØπË±°ÁöÑÂâØÊú¨ÔºåÂΩìÁÑ∂Á∫øÁ®ãÁöÑÂ∑•‰ΩúÂÜÖÂ≠òÂ§ßÂ∞èÊòØÊúâÈôêÂà∂ÁöÑ„ÄÇÂΩìÁ∫øÁ®ãÊìç‰ΩúÊüê‰∏™ÂØπË±°Êó∂,ÊâßË°åÈ°∫Â∫èÂ¶Ç‰∏ã:</p>
<ul>
<li><strong>(1Ôºâ‰ªé‰∏ªÂ≠òÂ§çÂà∂ÂèòÈáèÂà∞ÂΩìÂâçÂ∑•‰ΩúÂÜÖÂ≠òÔºàread and load)</strong></li>
<li><strong>(2ÔºâÊâßË°å‰ª£Á†Å,ÊîπÂèòÂÖ±‰∫´ÂèòÈáèÂÄº Ôºà(use and assign)</strong></li>
<li><strong>(3ÔºâÁî®Â∑•‰ΩúÂÜÖÂ≠òÊï∞ÊçÆÂà∑Êñ∞‰∏ªÂ≠òÁõ∏ÂÖ≥ÂÜÖÂÆπ(store and writeÔºâ</strong></li>
</ul>
<p>‚Äã        ÊâÄ‰ª•Âçï‰∏™Á∫øÁ®ã‰∏éÁ∫øÁ®ãÁöÑÂ∑•‰ΩúÂÜÖÂ≠ò‰πãÈó¥Â∞±Êúâ‰∫ÜÁõ∏‰∫íÁöÑÈöîÁ¶ªÊïàÊûúÔºå‰∏ì‰∏öÊúØËØ≠‰∏äÂ∞±Áß∞‰πã‰∏∫‚Äú<strong>ÂèØËßÅÊÄßÈóÆÈ¢ò</strong>‚Äù„ÄÇ<br>‚Äã        ÈóÆÈ¢ò‰∫å:Á∫øÁ®ãÂú®ÂºïÁî®ÂèòÈáèÊó∂‰∏çËÉΩÁõ¥Êé•‰ªé‰∏ªÂÜÖÂ≠ò‰∏≠ÂºïÁî®ÔºåÂ¶ÇÊûúÁ∫øÁ®ãÂ∑•‰ΩúÂÜÖÂ≠ò‰∏≠Ê≤°ÊúâËØ•ÂèòÈáèÔºåÂàô‰ºö‰ªé‰∏ªÂÜÖÂ≠ò‰∏≠Êã∑Ë¥ù‰∏Ä‰∏™ÂâØÊú¨Âà∞Â∑•‰ΩúÂÜÖÂ≠ò‰∏≠ÔºåËøô‰∏™ËøáÁ®ã‰∏∫<code>read-load</code>ÔºåÂÆåÊàêÂêéÁ∫øÁ®ã‰ºöÂºïÁî®ËØ•ÂâØÊú¨„ÄÇÂΩìÂêå‰∏ÄÁ∫øÁ®ãÂÜçÂ∫¶ÂºïÁî®ËØ•Â≠óÊÆµÊó∂ÔºåÊúâÂèØËÉΩÈáçÊñ∞‰ªé‰∏ªÂ≠ò‰∏≠Ëé∑ÂèñÂèòÈáèÂâØÊú¨(<code>read-load-use</code>)Ôºå‰πüÊúâÂèØËÉΩÁõ¥Êé•ÂºïÁî®ÂéüÊù•ÁöÑÂâØÊú¨Ôºà<code>use</code>)Ôºå‰πüÂ∞±ÊòØËØ¥<code>read</code>„ÄÅ<code>load</code>„ÄÅ<code>use</code>È°∫Â∫èÂèØ‰ª•Áî±<code>JVM</code>ÂÆûÁé∞Á≥ªÁªüÂÜ≥ÂÆö„ÄÇËøô‰∏™Êó∂ÂÄôÁ∫øÁ®ã‰∏éÁ∫øÁ®ã‰πãÈó¥ÁöÑÊìç‰ΩúÁöÑÂÖàÂêéÈ°∫Â∫èÔºåÂ∞±‰ºöÂÜ≥ÂÆö‰∫Ü‰Ω†Á®ãÂ∫èÂØπ‰∏ªÂÜÖÂ≠òÂå∫ÊúÄÂêéÁöÑ‰øÆÊîπÊòØ‰∏çÊòØÊ≠£Á°ÆÁöÑÔºå‰∏ì‰∏öÊúØËØ≠‰∏äÂ∞±Áß∞‰πã‰∏∫‚Äú<strong>Êó∂Â∫èÊÄßÈóÆÈ¢ò</strong>‚Äù„ÄÇ</p>
<h3 id="‰ªÄ‰πàÊòØ‰∏çÂÆâÂÖ®"><a href="#‰ªÄ‰πàÊòØ‰∏çÂÆâÂÖ®" class="headerlink" title="‰ªÄ‰πàÊòØ‰∏çÂÆâÂÖ®"></a>‰ªÄ‰πàÊòØ‰∏çÂÆâÂÖ®</h3><p>‚Äã        ÂΩìÂ§ö‰∏™Á∫øÁ®ãÂêåÊó∂Êìç‰Ωú‰∏Ä‰∏™Êï∞ÊçÆÁªìÊûÑÁöÑÊó∂ÂÄô‰∫ßÁîü‰∫ÜÁõ∏‰∫í‰øÆÊîπÂíå‰∏≤Ë°åÁöÑÊÉÖÂÜµÔºåÊ≤°Êúâ‰øùËØÅÊï∞ÊçÆÁöÑ‰∏ÄËá¥ÊÄß,Êàë‰ª¨ÈÄöÂ∏∏Áß∞ËøôÁßçËÆæËÆ°ÁöÑ‰ª£Á†Å‰∏∫‚Äú<strong>Á∫øÁ®ã‰∏çÂÆâÂÖ®ÁöÑ</strong>‚Äù„ÄÇ<br>‚Äã        ÊúâËøô‰πà‰∏Ä‰∏™Âú∫ÊôØÔºåÂÅáËÆæ5‰∏™Áî®Êà∑ÔºåÈÉΩÊù•Áªô‰∏Ä‰∏™Êï∞Â≠óÂä†1ÁöÑÂ∑•‰ΩúÔºåÈÇ£‰πàÊúÄÂêéÂ∫îËØ•ÊòØÂæóÂà∞Âä†5ÁöÑÁªìÊûúÔºõÁúã‰∏Ä‰∏ã‰∏ãÈù¢ÁöÑ‰∫ã‰æã„ÄÇ<br>‚Äã        Âçï‰∏™Áî®Êà∑Âπ≤Ê¥ªÁ±ªÔºöCount „ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Ê®°‰ªøÁî®Êà∑Âπ≤Ê¥ª</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">&#125;</span>
            num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        Áî®Êà∑Á±ªÔºåÂπ≤CountÁöÑÊ¥ª„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UseThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Count</span> count<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span><span class="token class-name">Count</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        count<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        5‰∏™‰∫∫Âπ≤ÂÆåÊ¥ª:ÊúÄÂêéÁöÑÂÄº„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Count</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">UseThread</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            task<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Á≠â5‰∏™‰∫∫Âπ≤ÂÆåÊ¥ª</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"5‰∏™‰∫∫Âπ≤ÂÆåÊ¥ª:ÊúÄÂêéÁöÑÂÄº"</span> <span class="token operator">+</span> count<span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ËøêË°åÁªìÊûú-Áî±‰∫éÂ§öÁ∫øÁ®ãÔºåÊúâ‰∏çÂÆâÂÖ®ÈóÆÈ¢òÔºåÂÖ∂ÂÆûÊØèÊ¨°ËøêË°å‰∏ãÈù¢ÁöÑÁªìÊûúÈÉΩÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑ ):</p>
<p>‚Äã        <strong>ÂèØËßÅ‰∏çÊòØÊàë‰ª¨ÊÉ≥Ë¶ÅÁöÑÁªìÊûúÔºåËøôÂ∞±ÊòØÂÖ∏ÂûãÁöÑÁ∫øÁ®ã‰∏çÂÆâÂÖ®ÈóÆÈ¢ò„ÄÇ</strong>Âú®Êàë‰ª¨ÂÆûÈôÖÂ∑•‰Ωú‰∏≠ÔºåÁâπÂà´ÊòØWebÈ°πÁõÆServiceÂíå servlet‰∏ÄËà¨ÈÉΩÊòØÂçï‰æãÂÖ±‰∫´ÂèòÈáèÁöÑÊÉÖÂÜµ‰∏ãÊûÅÂÖ∂ÂÆπÊòìÂá∫Áé∞ÔºåÂ§ö‰∏™Áî®Êà∑‰πãÈó¥ÁöÑÊï∞ÊçÆ‰∏≤Êéâ‰∫ÜÔºå‰ªéËÄåÂØºËá¥ÊúÄÁªàÊï∞ÊçÆÂ∫ìÈáåÈù¢ÊâÄÈúÄË¶ÅÁªüËÆ°ÁöÑÊï∞ÊçÆ‰∏çÂØπ„ÄÇ</p>
<h4 id="No1-ThreadSecurityDemo-java"><a href="#No1-ThreadSecurityDemo-java" class="headerlink" title="No1_ThreadSecurityDemo.java"></a>No1_ThreadSecurityDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadsecurity</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No1_ThreadSecurityDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Ê®°‰ªøÁî®Êà∑Âπ≤Ê¥ª</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">&#125;</span>
            num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UseThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">Count</span> count<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span><span class="token class-name">Count</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            count<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Count</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">UseThread</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            task<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Á≠â5‰∏™‰∫∫Âπ≤ÂÆåÊ¥ª</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"5‰∏™‰∫∫Âπ≤ÂÆåÊ¥ª:ÊúÄÂêéÁöÑÂÄº"</span> <span class="token operator">+</span> count<span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="‰ªÄ‰πàÊòØÂÆâÂÖ®"><a href="#‰ªÄ‰πàÊòØÂÆâÂÖ®" class="headerlink" title="‰ªÄ‰πàÊòØÂÆâÂÖ®"></a>‰ªÄ‰πàÊòØÂÆâÂÖ®</h3><p>Êàë‰ª¨Êää‰∏ä‰∏ÄËäÇÁöÑ‰æãÂ≠êÂçï‰∏™Áî®Êà∑Âπ≤Ê¥ªÁ±ª Count ÁöÑ <code>add()</code> ÊñπÊ≥ï,Ê∑ªÂä† <code>synchronized</code>ÂÖ≥ÈîÆÂ≠ó„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Ê®°‰ªøÁî®Êà∑Âπ≤Ê¥ª</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">&#125;</span>
            num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">1</span>
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span><span class="token number">2</span>
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">3</span>
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">4</span>
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">5</span>
<span class="token number">5</span>‰∏™‰∫∫Âπ≤ÂÆåÊ¥ª<span class="token operator">:</span>ÊúÄÂêéÁöÑÂÄº<span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ËÄåËøôÊ¨°ÔºåÊØèÊ¨°Âπ≤Ê¥ªÈÉΩÊòØ‰∏ÄÊ†∑ÁöÑÁªìÊûúÔºåËøôÂ∞±Âè´Á∫øÁ®ãÂÆâÂÖ®ÔºåÂ∞±ÊòØ‰∏çÁÆ°Â§öÂ∞ë‰∏™Áî®Êà∑ËøáÊù•ÔºåÈÉΩ‰øùËØÅÊàë‰ª¨ÁöÑÊï∞ÊçÆÁöÑÈ´òÂ∫¶‰∏ÄËá¥ÊÄßÂíåÂáÜÁ°ÆÊÄßÂ∞±Âè´Á∫øÁ®ãÂÆâÂÖ®ÁöÑÔºõËøôÈáåÊàë‰ª¨ÂºïÁî®‰∫Ü<code>synchronized</code> ÁöÑÂêåÊ≠•ÈîÅÁöÑÊú∫Âà∂,Ëøô‰∏™ÂêéÈù¢‰ºöËÆ≤Âà∞ÔºåÂÆÉ‰øùËØÅ‰∫ÜÊàë‰ª¨ÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÊÄß„ÄÇ<br>‚Äã        ‰ªÄ‰πàÊòØÁ∫øÁ®ãÂÆâÂÖ®ÊÄßÂë¢ÔºüÊòØ‰∏çÊòØ‰∏ÄÂÆöË¶ÅÂä†ÈîÅÊâçÊòØÁ∫øÁ®ãÂÆâÂÖ®ÊÄßÁöÑÂë¢Ôºü‰∏™‰∫∫ÊÑüËßâÂè™Ë¶Å‰Ω†‰ª£Á†ÅÈáåÈù¢Ê≤°ÊúâÂèòÈáè‰∫í‰∏≤ÔºåÁ∫øÁ®ã‰πãÈó¥‰∫í‰∏çÂΩ±ÂìçÔºå‰æãÂ¶Ç server ÁöÑËÆæËÆ°ÊñπÊ≥ï,Â∞±ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ,‰æãÂ¶Ç‰∏äÈù¢5‰∏™‰∫∫Âπ≤‰∫ÜÂêå‰∏Ä‰ª∂‰∫ãÊÉÖÔºåÂ¶ÇÊûúËÆ©5‰∏™‰∫∫Âπ≤5‰ª∂‰∏ç‰∏ÄÊ†∑ÁöÑ‰∫ãÊÉÖÔºåÊàñËÄÖ1‰∏™‰∫∫Âπ≤5‰ª∂‰∫ãÊÉÖÔºåÈÇ£‰πüÊòØÂÆâÂÖ®ÁöÑ„ÄÇËÄå‰∏çÂÆâÂÖ®Âú®Java Â∑•‰Ωú‰∏≠‰∏ªË¶ÅÈíàÂØπÂçï‰æãÊ®°ÂºèÁöÑÂ∫îÁî®ËÄåË®ÄÁöÑÔºåÊÄé‰πà‰øùËØÅ‰∏Ä‰ª∂‰∫ãÊÉÖË¢´‰∏ÄÁæ§‰∫∫Âπ≤ÂÆåÔºåÂèàÂø´ÂèàÊ≠£Á°Æ„ÄÇ<br>‚Äã        ÊÉ≥ÂÆûÁé∞Á∫øÁ®ãÂÆâÂÖ®Â§ßËá¥Êúâ‰∏âÁßçÊñπÊ≥ï„ÄÇ</p>
<ul>
<li>Â§öÂÆû‰æãÔºå‰πüÂ∞±ÊòØ‰∏çÁî®Âçï‰æãÊ®°Âºè‰∫Ü„ÄÇ</li>
<li>‰ΩøÁî®<code>java.util.concurrent</code>‰∏ãÈù¢ÁöÑÁ±ªÂ∫ì„ÄÇ</li>
<li>‰ΩøÁî®ÈîÅÊú∫Âà∂<code>synchronized</code>„ÄÅ<code>lock</code>ÊñπÂºè„ÄÇ</li>
</ul>
<h3 id="ÈöêÂºèÈîÅ-ÂÜÖÁΩÆÈîÅ-ÔºåÂèàÁß∞Á∫øÁ®ãÂêåÊ≠•-synchronized"><a href="#ÈöêÂºèÈîÅ-ÂÜÖÁΩÆÈîÅ-ÔºåÂèàÁß∞Á∫øÁ®ãÂêåÊ≠•-synchronized" class="headerlink" title="ÈöêÂºèÈîÅ(ÂÜÖÁΩÆÈîÅ)ÔºåÂèàÁß∞Á∫øÁ®ãÂêåÊ≠• synchronized"></a>ÈöêÂºèÈîÅ(ÂÜÖÁΩÆÈîÅ)ÔºåÂèàÁß∞Á∫øÁ®ãÂêåÊ≠• synchronized</h3><p>‚Äã        <code>synchronized</code>ÊòØJavaËØ≠Ë®ÄÁöÑÂÖ≥ÈîÆÂ≠óÔºåÂΩìÂÆÉÁî®Êù•‰øÆÈ•∞‰∏Ä‰∏™ÊñπÊ≥ïÊàñËÄÖ‰∏Ä‰∏™‰ª£Á†ÅÂùóÁöÑÊó∂ÂÄôÔºåËÉΩÂ§ü‰øùËØÅÂú®Âêå‰∏ÄÊó∂ÂàªÊúÄÂ§öÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãÊâßË°åËØ•ÊÆµ‰ª£Á†Å„ÄÇÂÖ∂ÂÆûÁÆÄÂçï‰∏ÄÁÇπÁêÜËß£ÔºåÊàëÊÑüËßâÂ∞±ÊòØË¶ÅËß£ÂÜ≥Êàë‰ª¨ÂâçÈù¢ËØ¥ÁöÑÂ§öÁ∫øÁ®ãÂπ∂ÂèëÊó∂ÂÄôÁöÑ‚Äú<strong>Êó∂Â∫èÊÄßÈóÆÈ¢ò</strong>‚ÄùÔºåÂç≥ËÆøÈóÆË¶ÅÊúâ‰∏Ä‰∏™È°∫Â∫èÔºåËÆ≤Á©∂ÂÖàÊù•ÂêéÂà∞ÔºåÂ∞±ÁúãË∞ÅÂÖàËÉΩÊãøÂà∞Ëøô‰∏™ÈîÅÂØπË±°„ÄÇ<br>‚Äã        <code>synchronized</code>ÁöÑÁî®Ê≥ï,‰øÆÈ•∞Âú∞ÊñπÊúâÂè™Êúâ‰∏§‰∏™Ôºö<br>‚Äã        ‰∏ÄÊòØÂú®ÊñπÊ≥ïÂ£∞ÊòéÊó∂‰ΩøÁî®ÔºåÊîæÂú®ËåÉÂõ¥Êìç‰ΩúÁ¨¶(public Á≠â)‰πãÂêéÔºåËøîÂõûÁ±ªÂûãÂ£∞Êòé(voidÁ≠â)‰πãÂâçÁöÑÊñπÊ≥ïÂêç‰∏äÈù¢,‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">synMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//ÊñπÊ≥ï‰Ωì</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰∫åÊòØ‰øÆÈ•∞Âú®‰ª£Á†ÅÂùó‰∏äÈù¢ÁöÑÔºåÂØπÊüê‰∏Ä‰ª£Á†ÅÂùó‰ΩøÁî®<code>synchronized(Object)</code>ÔºåÊåáÂÆöÂä†ÈîÅÂØπË±°Ôºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> synMethod <span class="token punctuation">(</span><span class="token keyword">int</span> al<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//‰∏ÄÊ¨°Âè™ËÉΩÊúâ‰∏Ä‰∏™Á∫øÁ®ãËøõÂÖ•&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÂÖ∂‰∏≠ synchronized(Object)‰∏≠ÁöÑ Object ÂèØ‰ª•ÊòØ‰ªªÊÑèÂØπË±°,ÂèØ‰ª•ÊòØÂèÇÊï∞Êú¨Ë∫´ÔºåÂèØ‰ª•ÊòØÂΩìÂâçÂØπË±°this,‰πüÂèØ‰ª•ÊòØÊåáÂÆöÁöÑÂØπË±°Ôºõ‰ΩúËÄÖ‰∏çÂª∫ËÆÆ‰ΩøÁî®ÊñπÊ≥ïÂèÇÊï∞Ôºå‰πü‰∏çÂª∫ËÆÆ‰ΩøÁî®thisÂØπË±°ÔºåËÄåÊòØÂè¶Â§ñÊåáÂÆö‰∏Ä‰∏™Â∞èÁöÑÂØπË±°ÂÄº„ÄÇÂæàÂ§öËµÑÊñôÂíåÊñáÊ°£ÈÉΩÁß∞ÂÆÉ‰∏∫ÂêåÊ≠•ÈîÅÔºåËÄåÊàëÊõ¥ÊÑøÊÑèÂè´ÂÆÉÈöêÂºèÈîÅ„ÄÇÂõ†‰∏∫Â∞ΩÁÆ°ÂÆÉ‰øÆÈ•∞ÁöÑÂú∞Êñπ‰∏çÂ∞ΩÁõ∏ÂêåÔºå‰ΩÜÊòØÊúÄÁªàÂÆÉÁöÑÈîÅÈÉΩÂú®‰∏Ä‰∏™ÂØπË±°‰∏äÈù¢Ôºõ‰øÆÈ•∞Âú®ÊñπÊ≥ï‰Ωì‰∏äÁöÑsynchronized ÈªòËÆ§ÈîÅÁöÑÂØπË±°Â∞±ÊòØÂΩìÂâçÂØπË±°Êú¨Ë∫´ÔºõÁ≠âÂêå‰∫ésynchronized (this)(}‰øÆÈ•∞‰ª£Á†ÅÂùóÁöÑÁî®Ê≥ïÔºõÊàñËÄÖÊòØ‰Ω†ÊåáÂÆöÁöÑ ObjectÂØπË±°‰Ωú‰∏∫ÈîÅÔºåÂõ†‰∏∫ÂíåÂÆÉÊåÅÊúâÁõ∏ÂêåÂØπË±°ÈîÅÁöÑÂú∞ÊñπÂ∞Ü‰∫ßÁîü‰∫íÊñ•ÊÄßÔºåËÄå‰∏çÊòØÂè™ÊúâÂΩìÂâçÊâÄÊåáÁöÑ‰ª£Á†ÅÂùóÊàñËÄÖÊñπÊ≥ï‰ΩìÔºåÂè¶Â§ñ‰∏Ä‰∏™Â∞±ÊòØÁõ∏ÂØπÊòæÁ§∫ÈîÅ‰∏çÈúÄË¶ÅÂä†ÈîÅÂíåËß£ÈîÅÁöÑÊìç‰ΩúÔºåÊâÄ‰ª•Áß∞ÂÆÉ‰∏∫ÈöêÂºèÁöÑ„ÄÇ<br>‚Äã        Êúâ‰∏Ä‰∫õÈöêÂºèËßÑÂàôÂ¶Ç‰∏ã:<br>‚Äã        (1)ÂΩì‰∏§‰∏™Âπ∂ÂèëÁ∫øÁ®ãËÆøÈóÆÂêå‰∏Ä‰∏™ÂØπË±°object‰∏≠ÁöÑËøô‰∏™synchronized(this)ÂêåÊ≠•‰ª£Á†ÅÂùóÊó∂Ôºå‰∏Ä‰∏™Êó∂Èó¥ÂÜÖÂè™ËÉΩÊúâ‰∏Ä‰∏™Á∫øÁ®ãÂæóÂà∞ÊâßË°å„ÄÇÂè¶‰∏Ä‰∏™Á∫øÁ®ãÂøÖÈ°ªÁ≠âÂæÖÂΩìÂâçÁ∫øÁ®ãÊâßË°åÂÆåËøô‰∏™‰ª£Á†ÅÂùó‰ª•ÂêéÊâçËÉΩÊâßË°åËØ•‰ª£Á†ÅÂùó„ÄÇ<br>‚Äã        (2ÔºâÁÑ∂ËÄåÔºåÂΩì‰∏Ä‰∏™Á∫øÁ®ãËÆøÈóÆobject ÁöÑ‰∏Ä‰∏™synchronized(this)ÂêåÊ≠•‰ª£Á†ÅÂùóÊó∂ÔºåÂè¶‰∏Ä‰∏™Á∫øÁ®ã‰ªçÁÑ∂ÂèØ‰ª•ËÆøÈóÆËØ•object ‰∏≠ÁöÑÈùûsynchronized(this)ÂêåÊ≠•‰ª£Á†ÅÂùó„ÄÇ<br>‚Äã        (3ÔºâÂ∞§ÂÖ∂ÂÖ≥ÈîÆÁöÑÊòØÔºåÂΩì‰∏Ä‰∏™Á∫øÁ®ãËÆøÈóÆobjectÁöÑ‰∏Ä‰∏™synchronized(this)ÂêåÊ≠•‰ª£Á†ÅÂùóÊó∂ÔºåÂÖ∂‰ªñÁ∫øÁ®ãÂØπobject‰∏≠ÊâÄÊúâÂÖ∂‰ªñsynchronized(this)ÂêåÊ≠•‰ª£Á†ÅÂùóÁöÑËÆøÈóÆÂ∞ÜË¢´ÈòªÂ°û„ÄÇ<br>‚Äã        (4ÔºâÁ¨¨‰∏â‰∏™ËßÑÂàôÂêåÊ†∑ÈÄÇÁî®ÂÖ∂‰ªñÂêåÊ≠•‰ª£Á†ÅÂùó„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåÂΩì‰∏Ä‰∏™Á∫øÁ®ãËÆøÈóÆobject ÁöÑ‰∏Ä‰∏™synchronized(this)ÂêåÊ≠•‰ª£Á†ÅÂùóÊó∂ÔºåÂÆÉÂ∞±Ëé∑Âæó‰∫ÜËøô‰∏™object ÁöÑÂØπË±°ÈîÅ„ÄÇÁªìÊûúÔºåÂÖ∂‰ªñÁ∫øÁ®ãÂØπËØ•objectÂØπË±°ÊâÄÊúâÂêåÊ≠•‰ª£Á†ÅÈÉ®ÂàÜÁöÑËÆøÈóÆÈÉΩË¢´ÊöÇÊó∂ÈòªÂ°û„ÄÇ<br>‚Äã        (5)‰ª•‰∏äËßÑÂàôÂØπÂÖ∂‰ªñÂØπË±°ÈîÅÂêåÊ†∑ÈÄÇÁî®„ÄÇ</p>
<p>‚Äã        ‰∏ãÈù¢‰∏æ‰æãÂä†‰ª•ËØ¥Êòé:<br>‚Äã        Áúã‰∏Ä‰∏™Ê≠£Á°ÆÁöÑ‰æãÂ≠ê:Â∞ΩÁÆ°<code>synchronized</code>ÁöÑÂÜôÊ≥ï‰∏ç‰∏ÄÊ†∑,‰ΩÜÊòØËøô‰∏§‰∏™ÊñπÊ≥ïÂØπ‰∫éÂ§öÁ∫øÁ®ãÊù•ËØ¥ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ„ÄÇ</p>
<h4 id="No2-SynchronizedExampleOne-java"><a href="#No2-SynchronizedExampleOne-java" class="headerlink" title="No2_SynchronizedExampleOne.java"></a>No2_SynchronizedExampleOne.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadsecurity</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No2_SynchronizedExampleOne</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Ê®°‰ªøÁî®Êà∑Âπ≤Ê¥ª</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">&#125;</span>
            num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Ê®°‰ªøÁî®Êà∑Âπ≤Ê¥ª</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token punctuation">&#125;</span>
                num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UseThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">Count</span> count<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span><span class="token class-name">Count</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            count<span class="token punctuation">.</span><span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Count</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">UseThread</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            task<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Á≠â5‰∏™‰∫∫Âπ≤ÂÆåÊ¥ª</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"5‰∏™‰∫∫Âπ≤ÂÆåÊ¥ª:ÊúÄÂêéÁöÑÂÄº"</span> <span class="token operator">+</span> count<span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        Áúã‰∏Ä‰∏™ÈîôËØØÁöÑ‰æãÂ≠ê:</p>
<h4 id="No2-SynchronizedExampleTwo-java"><a href="#No2-SynchronizedExampleTwo-java" class="headerlink" title="No2_SynchronizedExampleTwo.java"></a>No2_SynchronizedExampleTwo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadsecurity</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No2_SynchronizedExampleTwo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Ê®°‰ªøÁî®Êà∑Âπ≤Ê¥ª</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">&#125;</span>
            num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//Ê≥®ÊÑèËøô‰∏™ÈîÅÁöÑÂØπË±°‰∏ç‰∏ÄÊ†∑</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Ê®°‰ªøÁî®Êà∑Âπ≤Ê¥ª</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token punctuation">&#125;</span>
                num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UseThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">Count</span> count<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span><span class="token class-name">Count</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            count<span class="token punctuation">.</span><span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Count</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">UseThread</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UseThread</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            task<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Á≠â5‰∏™‰∫∫Âπ≤ÂÆåÊ¥ª</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"5‰∏™‰∫∫Âπ≤ÂÆåÊ¥ª:ÊúÄÂêéÁöÑÂÄº"</span> <span class="token operator">+</span> count<span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        <strong>‰∏∫‰ªÄ‰πàËØ¥Ëøô‰∏§‰∏™ÊñπÊ≥ïÂØπ‰∫éÂ§öÁ∫øÁ®ãÊù•ËØ¥ÊòØÁ∫øÁ®ã‰∏çÂÆâÂÖ®ÁöÑÂë¢?Âõ†‰∏∫ÂÆÉÈîÅÂÆöÁöÑÂØπË±°‰∏ç‰∏ÄÊ†∑ÔºåÊâÄ‰ª•‰ΩúËÄÖ‰∏çÂª∫ËÆÆÁî®ÂèÇÊï∞‰Ωú‰∏∫ÈîÅÁöÑÂØπË±°ÔºåÈÇ£Ê†∑Â≠ê,‰Ω†ÁöÑÂêåÊ≠•ÈîÅÂè™‰ºöÂØπËøô‰∏™ÊñπÊ≥ïÊúâÁî®ÔºåËÄåÂ§±Âéª‰∫Ü<code>synchronized</code>ÈîÅÂÆöÂØπË±°ÁöÑÊÑè‰πâ‰∫Ü„ÄÇ</strong><br>‚Äã        ‰∏∫ÈÄÇÁî®È´òÂπ∂ÂèëÂØπÊÄßËÉΩ‰ª•ÂèäÂø´ÈÄüÂìçÂ∫îÁöÑË¶ÅÊ±ÇÔºå<code>synchronized</code>‰∏çÂêåÁöÑÂÜôÊ≥ïÁ®ãÂ∫èÂìçÂ∫îÁöÑÂø´ÊÖ¢ÂíåÂØπCPUÁ≠âËµÑÊ∫êÈ´òÂπ∂ÂèëÁöÑÂà©Áî®Á®ãÂ∫¶Âèà‰∏ç‰∏ÄÊ†∑ÔºõÊÄßËÉΩÂíåÊâßË°åÊïàÁéáÁöÑ‰ºòÂä£Á®ãÂ∫¶‰ªéÂ∑ÆÂà∞‰ºòÊúâÂ¶Ç‰∏ãÊéíÂ∫è:<br>‚Äã        ÂêåÊ≠•ÊñπÊ≥ï‰Ωì</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">synMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//ÊñπÊ≥ï‰Ωì</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        Â∞è‰∫é</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">synMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> al<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//‰∏ÄÊ¨°Âè™ËÉΩÊúâ‰∏Ä‰∏™Á∫øÁ®ãËøõÂÖ•</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        Âõ†‰∏∫‰∏Ä‰∏™ÊòØËøõÂÖ•ÊñπÊ≥ï‰ΩìÂÜÖÂä†ÈîÅÁöÑÔºå‰∏Ä‰∏™ÊòØÊéíÈòüÂú®ÊñπÊ≥ï‰ΩìÂ§ñÔºåËøôÊ†∑Âç≥‰ΩøËé∑Âæó‰∫ÜÈîÅÔºåËøõÂÖ•ÊñπÊ≥ï‰ΩìËøòÂæóÂàÜÈÖçËµÑÊ∫êÈúÄË¶Å‰∏ÄÂÆöÁöÑÊó∂Èó¥„ÄÇ<br>‚Äã        ËÄåËøôÁßçÊñπÊ≥ïÂùóÈîÅÂèàÂ∞è‰∫é‰∏ãÈù¢ÁöÑ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">byte</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> lock <span class="token operator">-</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//Ê≥®ÊÑèËøô‰∏™ÈîÅÁöÑÂØπË±°‰∏ç‰∏ÄÊ†∑</span>
    <span class="token comment">//TODO</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        Âõ†‰∏∫ÈîÅÁöÑÂØπË±°‰∏ç‰∏ÄÊ†∑ÔºåÈîÅÊòØÂØπË±°ÔºåÂä†ÈîÅÂíåÈáäÊîæÈîÅÈÉΩÈúÄË¶ÅÊ≠§ÂØπË±°ÁöÑËµÑÊ∫êÔºåÈÇ£ËÇØÂÆöÂØπË±°Ë∂äÂ∞èË∂äÂ•ΩÂïäÔºåÊâÄ‰ª•ÈÄ†‰∏Ä‰∏™‰∏Ä‰∏™Â≠óËäÇÁöÑbyteÂØπË±°ÊúÄÂ∞èÔºõÊâÄ‰ª•Â∑•‰Ωú‰∏≠ËøôÁßçÂÜôÊ≥ïÊúÄÂ∏∏ËßÅ„ÄÇ</p>
<blockquote>
<h4 id="synchronizedÂÜÖÁΩÆÈîÅ"><a href="#synchronizedÂÜÖÁΩÆÈîÅ" class="headerlink" title="synchronizedÂÜÖÁΩÆÈîÅ"></a>synchronizedÂÜÖÁΩÆÈîÅ</h4><p>ÂØπË±°ÈîÅÔºåÈîÅÁöÑÊòØÁ±ªÁöÑÂØπË±°ÂÆû‰æã„ÄÇ</p>
<p>Á±ªÈîÅ ÔºåÈîÅÁöÑÊòØÊØè‰∏™Á±ªÁöÑÁöÑClassÂØπË±°ÔºåÊØè‰∏™Á±ªÁöÑÁöÑClassÂØπË±°Âú®‰∏Ä‰∏™ËôöÊãüÊú∫‰∏≠Âè™Êúâ‰∏Ä‰∏™ÔºåÊâÄ‰ª•Á±ªÈîÅ‰πüÂè™Êúâ‰∏Ä‰∏™„ÄÇ</p>
</blockquote>
<h3 id="ÊòæÁ§∫ÈîÅLockÂíåReentrantLock"><a href="#ÊòæÁ§∫ÈîÅLockÂíåReentrantLock" class="headerlink" title="ÊòæÁ§∫ÈîÅLockÂíåReentrantLock"></a>ÊòæÁ§∫ÈîÅLockÂíåReentrantLock</h3><p>‚Äã        LockÊòØ‰∏Ä‰∏™Êé•Âè£Êèê‰æõ‰∫ÜÊó†Êù°‰ª∂ÁöÑ„ÄÅÂèØËΩÆËØ¢ÁöÑ„ÄÅÂÆöÊó∂ÁöÑ„ÄÅÂèØ‰∏≠Êñ≠ÁöÑÈîÅËé∑ÂèñÊìç‰ΩúÔºåÊâÄÊúâÂä†ÈîÅÂíåËß£ÈîÅÁöÑÊñπÊ≥ïÈÉΩÊòØÊòæÂºèÁöÑ„ÄÇÂåÖË∑ØÂæÑÊòØ:<code> java.util.concurrent.locks.Lock</code>„ÄÇÊ†∏ÂøÉÊñπÊ≥ïÊòØ<code>lock()</code>„ÄÅ<code>unlock()</code>„ÄÅ<code>tryLock()</code>,ÂÆûÁé∞Á±ªÊúâ<code>ReentrantLock</code>„ÄÅ<code>ReentrantReadWriteLock.ReadLock</code>„ÄÅ <code>ReentrantReadWriteLock.WriteLock</code><br>‚Äã        Áúã‰∏Ä‰∏ãLockÊé•Âè£ÊúâÂ¶Ç‰∏ãÊñπÊ≥ï:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 Ê≤°ÊúâÂùóÁªìÊûÑÂåñÈîÅÂÆö‰ºöÂà†Èô§‰ΩøÁî®synchronizedÊñπÊ≥ïÂíåËØ≠Âè•ÂèëÁîüÁöÑÈîÅÁöÑËá™Âä®ÈáäÊîæ„ÄÇ 
 Âú®Â§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÔºåÂ∫î‰ΩøÁî®‰ª•‰∏ãÊÉØÁî®ËØ≠Ôºö
   Lock l = ...; 
   l.lock(); 
   try &#123; 
   		// access the resource protected by this lock 
   &#125; finally &#123;
    	l.unlock(); 
   &#125; 
ÂΩìÂú®‰∏çÂêåËåÉÂõ¥ÂÜÖÂèëÁîüÈîÅÂÆöÂíåËß£ÈîÅÊó∂ÔºåÂøÖÈ°ªÊ≥®ÊÑèÁ°Æ‰øùÂú®ÈîÅÂÆöÊó∂ÊâßË°åÁöÑÊâÄÊúâ‰ª£Á†ÅÁî±try-finallyÊàñtry-catch‰øùÊä§Ôºå‰ª•Á°Æ‰øùÂú®ÂøÖË¶ÅÊó∂ÈáäÊîæÈîÅÂÆö„ÄÇ
LockÂÆûÁé∞Êèê‰æõ‰∫Ü‰ΩøÁî®synchronizedÊñπÊ≥ïÂíåËØ≠Âè•ÁöÑÈôÑÂä†ÂäüËÉΩÔºå
ÈÄöËøáÊèê‰æõÈùûÈòªÂ°ûÂ∞ùËØïÊù•Ëé∑ÂèñÈîÅÔºàtryLock()ÔºâÔºå
Â∞ùËØïËé∑ÂèñÂèØË¢´‰∏≠Êñ≠ÁöÑÈîÅÔºàlockInterruptibly()ÔºâÔºå
‰ª•ÂèäÂ∞ùËØïËé∑ÂèñÂèØ‰ª•Ë∂ÖÊó∂ÔºàtryLock(long, TimeUnit)Ôºâ„ÄÇ
*/</span>
<span class="token keyword">package</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Lock</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//Ëé∑ÂæóÈîÅ„ÄÇ Â¶ÇÊûúÈîÅ‰∏çÂèØÁî®ÔºåÂàôÂΩìÂâçÁ∫øÁ®ãÂ∞ÜË¢´Á¶ÅÁî®‰ª•ËøõË°åÁ∫øÁ®ãË∞ÉÂ∫¶ÔºåÂπ∂Â§Ñ‰∫é‰ºëÁú†Áä∂ÊÄÅÔºåÁõ¥Âà∞Ëé∑ÂèñÈîÅ„ÄÇ</span>
    <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Ëé∑ÂèñÈîÅÂÆöÔºåÈô§ÈùûÂΩìÂâçÁ∫øÁ®ãÊòØ interrupted „ÄÇ</span>
    <span class="token keyword">void</span> <span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
    <span class="token comment">/*Âè™ÊúâÂú®Ë∞ÉÁî®Êó∂ÊâçÂèØ‰ª•Ëé∑ÂæóÈîÅ„ÄÇÂè™ÊúâÂú®Ë∞ÉÁî®Êó∂ÊâçÂèØ‰ª•Ëé∑ÂæóÈîÅ„ÄÇ
   Â¶ÇÊûúÂèØÁî®ÔºåÂàôËé∑ÂèñÈîÅÂÆöÔºåÂπ∂Á´ãÂç≥ËøîÂõûÂÄº‰∏∫true „ÄÇ Â¶ÇÊûúÈîÅ‰∏çÂèØÁî®ÔºåÂàôÊ≠§ÊñπÊ≥ïÂ∞ÜÁ´ãÂç≥ËøîÂõûÂÄº‰∏∫false „ÄÇ
Ê≠§ÊñπÊ≥ïÁöÑÂÖ∏ÂûãÁî®Ê≥ïÊòØÔºö
   Lock lock = ...; 
   if (lock.tryLock()) &#123;
   		try &#123; 
   			// manipulate protected state 
   		&#125; finally &#123; 
   		lock.unlock(); 
   		&#125; 
   	&#125; else &#123; // perform alternative actions &#125; 
Ê≠§Áî®Ê≥ïÂèØÁ°Æ‰øùÈîÅÂÆöÂ∑≤Ë¢´ÂèñÊ∂àÔºåÂ¶ÇÊûúÊú™Ëé∑ÂèñÈîÅÂÆöÔºåÂàô‰∏ç‰ºöÂ∞ùËØïËß£ÈîÅ*/</span>
    <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Â¶ÇÊûúÂú®ÁªôÂÆöÁöÑÁ≠âÂæÖÊó∂Èó¥ÂÜÖÊòØÁ©∫Èó≤ÁöÑÔºåÂπ∂‰∏îÂΩìÂâçÁöÑÁ∫øÁ®ãÂ∞öÊú™ÂæóÂà∞ interruptedÔºåÂàôËé∑ÂèñËØ•ÈîÅ„ÄÇ</span>
    <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
    <span class="token comment">//ÈáäÊîæÈîÅ„ÄÇ</span>
    <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ËøîÂõû‰∏Ä‰∏™Êñ∞ConditionÁªëÂÆöÂà∞ËØ•ÂÆû‰æãLockÂÆû‰æã„ÄÇËøîÂõû‰∏Ä‰∏™Êñ∞ConditionÁªëÂÆöÂà∞ËØ•ÂÆû‰æãLockÂÆû‰æã„ÄÇ</span>
	<span class="token comment">//Âú®Á≠âÂæÖÊù°‰ª∂‰πãÂâçÔºåÈîÅÂøÖÈ°ªÁî±ÂΩìÂâçÁ∫øÁ®ã‰øùÊåÅ„ÄÇ ÂëºÂè´Condition.await()Â∞ÜÂú®Á≠âÂæÖ‰πãÂâçÂ∞ÜÂéüÂ≠êÈáäÊîæÈîÅÔºåÂπ∂Âú®Á≠âÂæÖËøîÂõû‰πãÂâçÈáçÊñ∞Ëé∑ÂèñÈîÅ„ÄÇ</span>
    <span class="token class-name">Condition</span> <span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÂØπÂ∫îÁöÑËß£ËØ¥Â¶Ç‰∏ã:<br>        <code>void lock()</code>;Ëé∑ÂèñÈîÅ„ÄÇÂ¶ÇÊûúÈîÅ‰∏çÂèØÁî®ÔºåÂá∫‰∫éÁ∫øÁ®ãË∞ÉÂ∫¶ÁõÆÁöÑ,Â∞ÜÁ¶ÅÁî®ÂΩìÂâçÁ∫øÁ®ãÔºåÂπ∂‰∏îÂú®Ëé∑ÂæóÈîÅ‰πãÂâçÔºåËØ•Á∫øÁ®ãÂ∞Ü‰∏ÄÁõ¥Â§Ñ‰∫é‰ºëÁú†Áä∂ÊÄÅ„ÄÇ<br>        <code>void lockInterruptibly( throws InterruptedException</code>;Â¶ÇÊûúÂΩìÂâçÁ∫øÁ®ãÊú™Ë¢´‰∏≠Êñ≠ÔºåÂàôËé∑ÂèñÈîÅ„ÄÇÂ¶ÇÊûúÈîÅÂèØÁî®ÔºåÂàôËé∑ÂèñÈîÅÔºåÂπ∂Á´ãÂç≥ËøîÂõû„ÄÇÂ¶ÇÊûúÈîÅ‰∏çÂèØÁî®ÔºåÂá∫‰∫éÁ∫øÁ®ãË∞ÉÂ∫¶ÁõÆÁöÑÔºåÂ∞ÜÁ¶ÅÁî®ÂΩìÂâçÁ∫øÁ®ãÔºåÂπ∂‰∏îÂú®ÂèëÁîü‰ª•‰∏ã‰∏§ÁßçÊÉÖÂÜµ‰πã‰∏Ä‰ª•ÂâçÔºåËØ•Á∫øÁ®ãÂ∞Ü‰∏ÄÁõ¥Â§Ñ‰∫é‰ºëÁú†Áä∂ÊÄÅ:ÈîÅÁî±ÂΩìÂâçÁ∫øÁ®ãËé∑Âæó;ÊàñËÄÖÂÖ∂‰ªñÊüê‰∏™Á∫øÁ®ã‰∏≠Êñ≠ÂΩìÂâçÁ∫øÁ®ãÔºåÂπ∂‰∏îÊîØÊåÅÂØπÈîÅËé∑ÂèñÁöÑ‰∏≠Êñ≠„ÄÇÂ¶ÇÊûúÂΩìÂâçÁ∫øÁ®ã:Âú®ËøõÂÖ•Ê≠§ÊñπÊ≥ïÊó∂Â∑≤ÁªèËÆæÁΩÆ‰∫ÜËØ•Á∫øÁ®ãÁöÑ‰∏≠Êñ≠Áä∂ÊÄÅ;ÊàñËÄÖÂú®Ëé∑ÂèñÈîÅÊó∂Ë¢´‰∏≠Êñ≠,Âπ∂‰∏îÊîØÊåÅÂØπÈîÅËé∑ÂèñÁöÑ‰∏≠Êñ≠ÔºåÂàôÂ∞ÜÊäõÂá∫ <code>InterruptedException</code> ,Âπ∂Ê∏ÖÈô§ÂΩìÂâçÁ∫øÁ®ãÁöÑÂ∑≤‰∏≠Êñ≠Áä∂ÊÄÅ„ÄÇ<br>        <code>boolean tryLock()</code>;‰ªÖÂú®Ë∞ÉÁî®Êó∂ÈîÅ‰∏∫Á©∫Èó≤Áä∂ÊÄÅÊâçËé∑ÂèñËØ•ÈîÅ„ÄÇÂ¶ÇÊûúÈîÅÂèØÁî®ÔºåÂàôËé∑ÂèñÈîÅÔºåÂπ∂Á´ãÂç≥ËøîÂõûÂÄº true„ÄÇÂ¶ÇÊûúÈîÅ‰∏çÂèØÁî®ÔºåÂàôÊ≠§ÊñπÊ≥ïÂ∞ÜÁ´ãÂç≥ËøîÂõûÂÄº false„ÄÇÈÄöÂ∏∏ÂØπ‰∫éÈÇ£‰∫õ‰∏çÊòØÂøÖÈ°ªËé∑ÂèñÈîÅÁöÑÊìç‰ΩúÂèØËÉΩÊúâÁî®„ÄÇ<br>        <code>boolean tryLock(long ParamLong, TimeUnit ParamTimeUnit) throws InterruptedException</code>;Â¶ÇÊûúÈîÅÂú®ÁªôÂÆöÁöÑÁ≠âÂæÖÊó∂Èó¥ÂÜÖÁ©∫Èó≤ÔºåÂπ∂‰∏îÂΩìÂâçÁ∫øÁ®ãÊú™Ë¢´‰∏≠Êñ≠ÔºåÂàôËé∑ÂèñÈîÅ„ÄÇÂ¶ÇÊûúÈîÅÂèØÁî®ÔºåÂàôÊ≠§ÊñπÊ≥ïÂ∞ÜÁ´ãÂç≥ËøîÂõûÂÄºtrue „ÄÇÂ¶ÇÊûúÈîÅ‰∏çÂèØÁî®ÔºåÂá∫‰∫éÁ∫øÁ®ãË∞ÉÂ∫¶ÁõÆÁöÑÔºåÂ∞ÜÁ¶ÅÁî®ÂΩìÂâçÁ∫øÁ®ãÔºåÂπ∂‰∏îÂú®ÂèëÁîü‰ª•‰∏ã‰∏âÁßçÊÉÖÂÜµÁöÑ‰ªª‰∏ÄÁßç‰πãÂâç,ËØ•Á∫øÁ®ãÂ∞Ü‰∏ÄÁõ¥Â§Ñ‰∫é‰ºëÁú†Áä∂ÊÄÅ:<br>        <code>void unlock()</code>;ÈáäÊîæÈîÅ„ÄÇÂØπÂ∫î‰∫é<code>lock()</code>„ÄÅ<code>tryLock()</code>„ÄÅ<code>tryLock(xx)</code>„ÄÅ<code>lockInterruptibly()</code>Á≠âÊìç‰ΩúÔºåÂ¶ÇÊûúÊàêÂäüÁöÑËØùÂ∫îËØ•ÂØπÂ∫îÁùÄ‰∏Ä‰∏™unlock()ÔºåËøôÊ†∑ÂèØ‰ª•ÈÅøÂÖçÊ≠ªÈîÅÊàñËÄÖËµÑÊ∫êÊµ™Ë¥π„ÄÇ<br>        <code>new Condition()</code>;ËøîÂõûÁî®Êù•‰∏éÊ≠§<code>Lock</code> ÂÆû‰æã‰∏ÄËµ∑‰ΩøÁî®ÁöÑ <code>Condition</code>ÂÆû‰æã„ÄÇ</p>
<p>‚Äã       <code>ReentrantLock</code>ÊòØ<code>Lock</code>ÁöÑÂÆûÁé∞Á±ª,ÊòØ‰∏Ä‰∏™‰∫íÊñ•ÁöÑÂêåÊ≠•Âô®ÔºåÂÆÉÂÖ∑ÊúâÊâ©Â±ïÁöÑËÉΩÂäõ„ÄÇÂú®Á´û‰∫âÊù°‰ª∂‰∏ãÔºå<code>ReentrantLock</code> ÁöÑÂÆûÁé∞Ë¶ÅÊØîÁé∞Âú®ÁöÑ<code>synchronized</code>ÂÆûÁé∞Êõ¥ÂÖ∑ÊúâÂèØ‰º∏Áº©ÊÄß„ÄÇ(ÊúâÂèØËÉΩÂú®JVM ÁöÑÂ∞ÜÊù•ÁâàÊú¨‰∏≠ÊîπËøõ synchronized ÁöÑÁ´û‰∫âÊÄßËÉΩÔºâËøôÊÑèÂë≥ÁùÄÂΩìËÆ∏Â§öÁ∫øÁ®ãÈÉΩÁ´û‰∫âÁõ∏ÂêåÈîÅÂÆöÊó∂,‰ΩøÁî®<code>ReentrantLock</code>ÁöÑÂêûÂêêÈáèÈÄöÂ∏∏Ë¶ÅÊØîsynchronized Â•Ω„ÄÇÊç¢Âè•ËØùËØ¥ÔºåÂΩìËÆ∏Â§öÁ∫øÁ®ãËØïÂõæËÆøÈóÆ<code>ReentrantLock</code> ‰øùÊä§ÁöÑÂÖ±‰∫´ËµÑÊ∫êÊó∂Ôºå<code>JVM</code> Â∞ÜËä±Ë¥πËæÉÂ∞ëÁöÑÊó∂Èó¥Êù•Ë∞ÉÂ∫¶Á∫øÁ®ãÔºåËÄåÁî®Êõ¥Â§ö‰∏™Êó∂Èó¥ÊâßË°åÁ∫øÁ®ã„ÄÇËôΩÁÑ∂<code>ReentrantLock</code>Á±ªÊúâËÆ∏Â§ö‰ºòÁÇπÔºå‰ΩÜÊòØ‰∏éÂêåÊ≠•Áõ∏ÊØîÔºåÂÆÉÊúâ‰∏Ä‰∏™‰∏ªË¶ÅÁº∫ÁÇπÔºöÂÆÉÂèØËÉΩÂøòËÆ∞ÈáäÊîæÈîÅÂÆö„ÄÇ<code>ReentrantLock</code>ÊòØÂú®Â∑•‰Ωú‰∏≠ÂØπÊñπÊ≥ïÂùóÂä†ÈîÅ‰ΩøÁî®È¢ëÁéáÊúÄÈ´òÁöÑ„ÄÇ<br>‚Äã        ‰ΩøÁî®ÊñπÊ≥ïÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">X</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Ëé∑ÂæóÈîÅ</span>
		<span class="token keyword">try</span><span class="token punctuation">&#123;</span>
			<span class="token comment">// ...ÊñπÊ≥ï‰Ωì</span>
		<span class="token punctuation">&#125;</span><span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
			lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Ëß£ÈîÅ</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        <code>Lock</code> ‰∏é <code>synchronized</code> ÁöÑÊØîËæÉ:</p>
<p>‚Äã        (1)<code>Lock</code>‰ΩøÁî®Ëµ∑Êù•ÊØîËæÉÁÅµÊ¥ªÔºå‰ΩÜÊòØÂøÖÈ°ªÊúâÈáäÊîæÈîÅÁöÑÂä®‰ΩúÈÖçÂêà„ÄÇ<br>‚Äã        (2)<code>Lock</code>ÂøÖÈ°ªÊâãÂä®ÈáäÊîæÂíåÂºÄÂêØÈîÅ,ËÄå<code>synchronized</code>‰∏çÈúÄË¶ÅÊâãÂä®ÈáäÊîæÂíåÂºÄÂêØÈîÅ„ÄÇ<br>‚Äã        (3)<code>Lock</code> Âè™ÈÄÇÁî®‰∏é‰ª£Á†ÅÂùóÈîÅ,ËÄå<code>synchronized</code>ÂØπË±°‰πãÈó¥ÊòØ‰∫íÊñ•ÂÖ≥Á≥ª„ÄÇ</p>
<p>‚Äã        ËØ∑Ê≥®ÊÑè‰ª•‰∏ã‰∏§ÁßçÊñπÂºèÁöÑÂå∫Âà´:<br>‚Äã        Á¨¨‰∏ÄÁßçÊñπÂºè:‰∏§‰∏™ÊñπÊ≥ï‰πãÈó¥ÁöÑÈîÅÊòØÁã¨Á´ãÁöÑ„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ã:</p>
<h4 id="No3-ReentrantLockDemo-java"><a href="#No3-ReentrantLockDemo-java" class="headerlink" title="No3_ReentrantLockDemo.java"></a>No3_ReentrantLockDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadsecurity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No3_ReentrantLockDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">Countx</span> ct <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Countx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    ct<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    ct<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Countx</span> <span class="token punctuation">&#123;</span>
<span class="token comment">//        final ReentrantLock lock = new ReentrantLock();</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Âä†ÈîÅ</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"get begin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Ê®°‰ªøÂπ≤Ê¥ª</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"get end"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ëß£ÈîÅ</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Âä†ÈîÅ</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"put begin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Ê®°‰ªøÂπ≤Ê¥ª</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"put end"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ëß£ÈîÅ</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ËøêË°åÁªìÊûúÂ¶Ç‰∏ã(ÊØèÊ¨°ËøêË°åÁªìÊûúÈÉΩÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑ,‰ªîÁªÜ‰Ωì‰ºö‰∏Ä‰∏ã):</p>
<p>‚Äã        Á¨¨‰∫åÁßçÊñπÂºè,‰∏§‰∏™ÊñπÊ≥ï‰πãÈó¥‰ΩøÁî®Áõ∏ÂêåÁöÑÈîÅ„ÄÇ<br>‚Äã        <code>ReentrantLockDemo</code>Á±ªÁöÑÂÜÖÂÆπ‰∏çÂèò,Â∞Ü<code>Count </code>‰∏≠ÁöÑ<code>ReentrantLock</code> ÊîπÊàêÂÖ®Â±ÄÂèòÈáèÔºåÂ¶Ç‰∏ãÊâÄÁ§∫:</p>
<p><img src="/image/Concurrent/Concurrent13.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent13.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>ËøêË°åÁªìÊûúÂ¶Ç‰∏ã(ÊØèÊ¨°ËøêË°åÁªìÊûúÊòØ‰∏ÄÊ†∑ÁöÑ,‰ªîÁªÜ‰Ωì‰ºö‰∏Ä‰∏ã):</p>
<h3 id="ÊòæÁ§∫ÈîÅReadWriteLockÂíå-ReentrantReadWriteLock"><a href="#ÊòæÁ§∫ÈîÅReadWriteLockÂíå-ReentrantReadWriteLock" class="headerlink" title="ÊòæÁ§∫ÈîÅReadWriteLockÂíå ReentrantReadWriteLock"></a>ÊòæÁ§∫ÈîÅReadWriteLockÂíå ReentrantReadWriteLock</h3><p>‚Äã        <code>ReadWriteLock</code>‰πüÊòØ‰∏Ä‰∏™Êé•Âè£ÔºåÊèê‰æõ‰∫Ü<code>readLock</code>Âíå <code>writeLock</code>‰∏§ÁßçÈîÅÁöÑÊìç‰ΩúÊú∫Âà∂,‰πüÂ∞±ÊòØ‰∏Ä‰∏™ËµÑÊ∫êËÉΩÂ§üË¢´Â§ö‰∏™ËØªÁ∫øÁ®ãËÆøÈóÆÔºåÊàñËÄÖË¢´‰∏Ä‰∏™ÂÜôÁ∫øÁ®ãËÆøÈóÆÔºå‰ΩÜÊòØ‰∏çËÉΩÂêåÊó∂Â≠òÂú®ËØªÂÜôÁ∫øÁ®ã„ÄÇ‰πüÂ∞±ÊòØËØ¥ËØªÂÜôÈîÅ‰ΩøÁî®ÁöÑÂú∫ÂêàÊòØ‰∏Ä‰∏™ÂÖ±‰∫´ËµÑÊ∫êË¢´Â§ßÈáèËØªÂèñÊìç‰ΩúÔºåËÄåÂè™ÊúâÂ∞ëÈáèÁöÑÂÜôÊìç‰Ωú„ÄÇÂåÖË∑ØÂæÑÊòØ<code>java.util.concurrent.locks.ReadWriteLock</code>„ÄÇ<br>Êàë‰ª¨Êù•Áúã‰∏Ä‰∏ã<code>ReadWriteLock</code>ÁöÑÊ∫êÁ†Å;</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ReadWriteLock</span><span class="token punctuation">&#123;</span>
	<span class="token class-name">Lock</span> <span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Lock</span> <span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰ªéÊ∫êÁ†Å‰∏äÈù¢Êàë‰ª¨ÂèØ‰ª•ÁúãÂá∫Êù•<code>ReadWriteLock</code>Âπ∂‰∏çÊòØ<code>Lock</code> ÁöÑÂ≠êÊé•Âè£,Âè™‰∏çËøá<code>ReadWriteLock</code>ÂÄüÂä©<code>Lock</code>Êù•ÂÆûÁé∞ËØªÂÜô‰∏§‰∏™ÈîÅÂπ∂Â≠ò„ÄÅ‰∫íÊñ•ÁöÑÊìç‰ΩúÊú∫Âà∂„ÄÇÂú®<code>ReadWriteLock</code>‰∏≠ÊØèÊ¨°ËØªÂèñÂÖ±‰∫´Êï∞ÊçÆÂ∞±ÈúÄË¶ÅËØªÂèñÈîÅÔºåÂΩìÈúÄË¶Å‰øÆÊîπÂÖ±‰∫´Êï∞ÊçÆÊó∂Â∞±ÈúÄË¶ÅÂÜôÂÖ•ÈîÅ„ÄÇÁúãËµ∑Êù•Â•ΩÂÉèÊòØ‰∏§‰∏™ÈîÅÔºå‰ΩÜÊòØÂπ∂ÈùûÂ¶ÇÊ≠§„ÄÇ<br>‚Äã        <code>ReentrantReadWriteLock</code>ÊòØ<code>ReadWriteLock</code>Âú®<code>java.util</code>ÈáåÈù¢ÁöÑÂîØ‰∏ÄÁöÑÂÆûÁé∞Á±ª‰∏ªË¶ÅÂ∫îÁî®Âú∫ÊôØÊòØÂΩìÊúâÂæàÂ§öÁ∫øÁ®ãÈÉΩ‰ªéÊüê‰∏™Êï∞ÊçÆÁªìÊûÑ‰∏≠ËØªÂèñÊï∞ÊçÆÔºåËÄåÂæàÂ∞ëÊúâÁ∫øÁ®ãÂØπÂÖ∂ËøõË°å‰øÆÊîπÊó∂„ÄÇÂú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÂÖÅËÆ∏ËØªÂèñÂô®Á∫øÁ®ãÂÖ±‰∫´ËÆøÈóÆÊòØÂêàÈÄÇÁöÑ,ÂÜôÂÖ•Âô®Á∫øÁ®ã‰æùÁÑ∂ÂøÖÈ°ªÊòØ‰∫íÊñ•ËÆøÈóÆÁöÑ„ÄÇ</p>
<p>‚Äã        <code>ReentrantReadWriteLock</code>ÁöÑÂÆûÁé∞ÈáåÈù¢Êúâ‰ª•‰∏ãÂá†‰∏™ÁâπÊÄßÔºö<br>‚Äã        (1) ÂÖ¨Âπ≥ÊÄßÔºöÈùûÂÖ¨Âπ≥ÈîÅ(ÈªòËÆ§Ôºâ„ÄÇËøô‰∏™ÂíåÁã¨Âç†ÈîÅÁöÑÈùûÂÖ¨Âπ≥ÊÄß‰∏ÄÊ†∑ÔºåÁî±‰∫éËØªÁ∫øÁ®ã‰πãÈó¥Ê≤°ÊúâÈîÅÁ´û‰∫âÔºåÊâÄ‰ª•ËØªÊìç‰ΩúÊ≤°ÊúâÂÖ¨Âπ≥ÊÄßÂíåÈùûÂÖ¨Âπ≥ÊÄßÔºåÂÜôÊìç‰ΩúÊó∂ÔºåÁî±‰∫éÂÜôÊìç‰ΩúÂèØËÉΩÁ´ãÂç≥Ëé∑ÂèñÂà∞ÈîÅÔºåÊâÄ‰ª•‰ºöÊé®Ëøü‰∏Ä‰∏™ÊàñÂ§ö‰∏™ËØªÊìç‰ΩúÊàñËÄÖÂÜôÊìç‰Ωú„ÄÇÂõ†Ê≠§,ÈùûÂÖ¨Âπ≥ÈîÅÁöÑÂêûÂêêÈáèË¶ÅÈ´ò‰∫éÂÖ¨Âπ≥ÈîÅ„ÄÇÂÖ¨Âπ≥ÈîÅÂà©Áî®<code>AQS</code>ÁöÑ<code>CLH</code>ÈòüÂàóÔºåÈáäÊîæÂΩìÂâç‰øùÊåÅÁöÑÈîÅ(ËØªÈîÅÊàñËÄÖÂÜôÈîÅ)Êó∂Ôºå‰ºòÂÖà‰∏∫Á≠âÂæÖÊó∂Èó¥ÊúÄÈïøÁöÑÈÇ£‰∏™ÂÜôÁ∫øÁ®ãÂàÜÈÖçÂÜôÂÖ•ÈîÅÔºåÂΩìÂâçÂâçÊèêÊòØÂÜôÁ∫øÁ®ãÁöÑÁ≠âÂæÖÊó∂Èó¥Ë¶ÅÊØîÊâÄÊúâËØªÁ∫øÁ®ãÁöÑÁ≠âÂæÖÊó∂Èó¥Ë¶ÅÈïø„ÄÇÂêåÊ†∑‰∏Ä‰∏™Á∫øÁ®ãÊåÅÊúâÂÜôÂÖ•ÈîÅÊàñËÄÖÊúâ‰∏Ä‰∏™ÂÜôÁ∫øÁ®ãÂ∑≤ÁªèÂú®Á≠âÂæÖ‰∫ÜÔºåÈÇ£‰πàËØïÂõæËé∑ÂèñÂÖ¨Âπ≥ÈîÅÁöÑÔºàÈùûÈáçÂÖ•ÔºâÊâÄÊúâÁ∫øÁ®ãÔºàÂåÖÊã¨ËØªÂÜôÁ∫øÁ®ãÔºâÈÉΩÂ∞ÜË¢´ÈòªÂ°ûÔºåÁõ¥Âà∞ÊúÄÂÖàÁöÑÂÜôÁ∫øÁ®ãÈáäÊîæÈîÅ„ÄÇÂ¶ÇÊûúËØªÁ∫øÁ®ãÁöÑÁ≠âÂæÖÊó∂Èó¥ÊØîÂÜôÁ∫øÁ®ãÁöÑÁ≠âÂæÖÊó∂Èó¥ËøòË¶ÅÈïøÔºåÈÇ£‰πà‰∏ÄÊó¶‰∏ä‰∏Ä‰∏™ÂÜôÁ∫øÁ®ãÈáäÊîæÈîÅ,Ëøô‰∏ÄÁªÑËØªÁ∫øÁ®ãÂ∞ÜËé∑ÂèñÈîÅ„ÄÇ<br>‚Äã        (2) ÈáçÂÖ•ÊÄßÔºöËØªÂÜôÈîÅÂÖÅËÆ∏ËØªÁ∫øÁ®ãÂíåÂÜôÁ∫øÁ®ãÊåâÁÖßËØ∑Ê±ÇÈîÅÁöÑÈ°∫Â∫èÈáçÊñ∞Ëé∑ÂèñËØªÂèñÈîÅÊàñËÄÖÂÜôÂÖ•ÈîÅ„ÄÇÂΩìÁÑ∂‰∫ÜÔºåÂè™ÊúâÂÜôÁ∫øÁ®ãÈáäÊîæ‰∫ÜÈîÅÔºåËØªÁ∫øÁ®ãÊâçËÉΩËé∑ÂèñÈáçÂÖ•ÈîÅ„ÄÇÂÜôÁ∫øÁ®ãËé∑ÂèñÂÜôÂÖ•ÈîÅÂêéÂèØ‰ª•ÂÜçÊ¨°Ëé∑ÂèñËØªÂèñÈîÅ,‰ΩÜÊòØËØªÁ∫øÁ®ãËé∑ÂèñËØªÂèñÈîÅÂêéÂç¥‰∏çËÉΩËé∑ÂèñÂÜôÂÖ•ÈîÅ„ÄÇÂè¶Â§ñËØªÂÜôÈîÅÊúÄÂ§öÊîØÊåÅ<code>65535</code>‰∏™ÈÄíÂΩíÂÜôÂÖ•ÈîÅÂíå<code>65535</code>‰∏™ÈÄíÂΩíËØªÂèñÈîÅ„ÄÇ<br>‚Äã        (3) ÈîÅÈôçÁ∫ßÔºöÂÜôÁ∫øÁ®ãËé∑ÂèñÂÜôÂÖ•ÈîÅÂêéÂèØ‰ª•Ëé∑ÂèñËØªÂèñÈîÅÔºåÁÑ∂ÂêéÈáäÊîæÂÜôÂÖ•ÈîÅÔºåËøôÊ†∑Â∞±‰ªéÂÜôÂÖ•ÈîÅÂèòÊàê‰∫ÜËØªÂèñÈîÅÔºå‰ªéËÄåÂÆûÁé∞ÈîÅÈôçÁ∫ßÁöÑÁâπÊÄß„ÄÇ<br>‚Äã        (4) ÈîÅÂçáÁ∫ßÔºöËØªÂèñÈîÅÊòØ‰∏çËÉΩÁõ¥Êé•ÂçáÁ∫ß‰∏∫ÂÜôÂÖ•ÈîÅÁöÑ„ÄÇÂõ†‰∏∫Ëé∑Âèñ‰∏Ä‰∏™ÂÜôÂÖ•ÈîÅÈúÄË¶ÅÈáäÊîæÊâÄÊúâËØªÂèñÈîÅÔºåÊâÄ‰ª•Â¶ÇÊûúÊúâ‰∏§‰∏™ËØªÂèñÈîÅËßÜÂõæËé∑ÂèñÂÜôÂÖ•ÈîÅÔºå‰∏îÈÉΩ‰∏çÈáäÊîæËØªÂèñÈîÅÊó∂Â∞±‰ºöÂèëÁîüÊ≠ªÈîÅ„ÄÇ<br>‚Äã        (5) ÈîÅËé∑Âèñ‰∏≠Êñ≠ÔºöËØªÂèñÈîÅÂíåÂÜôÂÖ•ÈîÅÈÉΩÊîØÊåÅËé∑ÂèñÈîÅÊúüÈó¥Ë¢´‰∏≠Êñ≠„ÄÇËøô‰∏™ÂíåÁã¨Âç†ÈîÅ‰∏ÄËá¥„ÄÇ<br>‚Äã        (6) Êù°‰ª∂ÂèòÈáèÔºöÂÜôÂÖ•ÈîÅÊèê‰æõ‰∫ÜÊù°‰ª∂ÂèòÈáè(<code>Condition</code>)ÁöÑÊîØÊåÅÔºåËøô‰∏™ÂíåÁã¨Âç†ÈîÅ‰∏ÄËá¥Ôºå‰ΩÜÊòØËØªÂèñÈîÅÂç¥‰∏çÂÖÅËÆ∏Ëé∑ÂèñÊù°‰ª∂ÂèòÈáè,Âê¶Âàô‰ºöÂæóÂà∞‰∏Ä‰∏™<code>UnsupportedOperationException</code>ÂºÇÂ∏∏„ÄÇ<br>‚Äã        (7) ÈáçÂÖ•Êï∞ÔºöËØªÂèñÈîÅÂíåÂÜôÂÖ•ÈîÅÁöÑÊï∞ÈáèÊúÄÂ§ßÂàÜÂà´Âè™ËÉΩÊòØ<code>65535</code>„ÄÇ</p>
<p>Ê¶ÇÊã¨Ëµ∑Êù•ÂÖ∂ÂÆûÂ∞±ÊòØËØªÂÜôÈîÅÁöÑÊú∫Âà∂:</p>
<ul>
<li>(1)ËØª-ËØª‰∏ç‰∫íÊñ•ÔºåÊØîÂ¶ÇÂΩìÂâçÊúâ10‰∏™Á∫øÁ®ãÂéªËØªÔºàÊ≤°ÊúâÁ∫øÁ®ãÂéªÂÜô)ÔºåËøô‰∏™10‰∏™Á∫øÁ®ãÂèØ‰ª•Âπ∂ÂèëËØªÔºåËÄå‰∏ç‰ºöÂ†µÂ°û„ÄÇ</li>
<li>(2)ËØª-ÂÜô‰∫íÊñ•ÔºåÂΩìÂâçÊúâÂÜôÁöÑÁ∫øÁ®ãÁöÑÊó∂ÂÄôÔºåÈÇ£‰πàËØªÂèñÁ∫øÁ®ãÂ∞±‰ºöÂ†µÂ°ûÔºåÂèçËøáÊù•ÔºåÊúâËØªÁöÑÁ∫øÁ®ãÂú®‰ΩøÁî®ÁöÑÊó∂ÂÄô,ÂÜôÁöÑÁ∫øÁ®ã‰πü‰ºöÂ†µÂ°û,Â∞±ÁúãË∞ÅÂÖàÊãøÂà∞ÈîÅ‰∫Ü„ÄÇ</li>
<li>(3)ÂÜô-ÂÜô‰∫íÊñ•ÔºåÂÜôÁ∫øÁ®ãÈÉΩÊòØ‰∫íÊñ•ÁöÑÔºåÂ¶ÇÊûúÊúâ‰∏§‰∏™Á∫øÁ®ãÂéªÂÜôÔºåAÁ∫øÁ®ãÂÖàÊãøÂà∞ÈîÅÂ∞±ÂÖàÂÜô,BÁ∫øÁ®ãÂ∞±Â†µÂ°ûÁõ¥Âà∞AÁ∫øÁ®ãÈáäÊîæÈîÅ„ÄÇ</li>
</ul>
<p>‚Äã        ‰ΩøÁî®ËØª&#x2F;ÂÜôÈîÅÁöÑÊñπÊ≥ïÂíåÊ≠•È™§;</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ÂàõÂª∫‰∏Ä‰∏™ReentrantReadwriteLockÂØπË±°</span>
<span class="token keyword">private</span> <span class="token class-name">ReentrantReadwriteLock</span> rwl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentLantReadwriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ÊäΩÂèñËØªÈîÅÂíåÂÜôÈîÅ</span>
<span class="token keyword">private</span> <span class="token class-name">Lock</span> readLock <span class="token operator">=</span> rwl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ÂæóÂà∞‰∏Ä‰∏™ÂèØË¢´Â§ö‰∏™ËØªÊìç‰ΩúÂÖ±Áî®ÁöÑËØªÈîÅÔºå‰ΩÜÂÆÉ‰ºöÊéíÊñ•ÊâÄÊúâÂÜôÊìç‰Ωú</span>
<span class="token keyword">private</span> <span class="token class-name">Lock</span> writeLock<span class="token operator">=</span> rwl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ÂæóÂà∞‰∏Ä‰∏™ÂÜôÈîÅ,ÂÆÉ‰ºöÊéíÊñ•ÊâÄÊúâÂÖ∂‰ªñÁöÑËØªÊìç‰ΩúÂíåÂÜôÊìç‰Ωú</span>

<span class="token comment">//ÂØπÊâÄÊúâËÆøÈóÆËÄÖÂä†ËØªÈîÅ</span>
<span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getTotalBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	readLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span><span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
	<span class="token keyword">finally</span><span class="token punctuation">&#123;</span>readLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span>

<span class="token comment">//ÂØπÊâÄÊúâ‰øÆÊîπËÄÖÂä†ÂÜôÈîÅ</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	writeLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span><span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
	<span class="token keyword">finally</span><span class="token punctuation">&#123;</span>writeLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÂÆû‰æã‰Ωì‰ºö:<br>‚Äã        Á¨¨‰∏ÄÁßçÊÉÖÂÜµÔºåÂÖà‰ΩìÈ™å‰∏Ä‰∏ã<code>ReadLock</code>Âíå <code>WriteLock</code>ÂçïÁã¨‰ΩøÁî®ÁöÑÊÉÖÂÜµ„ÄÇ</p>
<h4 id="No4-ReadWriteLockDemo-java"><a href="#No4-ReadWriteLockDemo-java" class="headerlink" title="No4_ReadWriteLockDemo.java"></a>No4_ReadWriteLockDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadsecurity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No4_ReadWriteLockDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantReadWriteLock</span> rwl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            rwl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ‰∏äËØªÈîÅÔºåÂÖ∂‰ªñÁ∫øÁ®ãÂè™ËÉΩËØª‰∏çËÉΩÂÜôÔºåÂÖ∑ÊúâÈ´òÂπ∂ÂèëÊÄß</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" read start."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Ê®°ÊãüÂπ≤Ê¥ª</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-read-end."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                rwl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ÈáäÊîæÂÜôÈîÅÔºåÊúÄÂ•ΩÊîæÂú®finnalyÈáåÈù¢</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            rwl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ‰∏äÂÜôÈîÅÔºåÂÖ∑ÊúâÈòªÂ°ûÊÄß</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" write start."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Ê®°ÊãüÂπ≤Ê¥ª</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-write-end."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                rwl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ÈáäÊîæÂÜôÈîÅÔºåÊúÄÂ•ΩÊîæÂú®finnalyÈáåÈù¢</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">Count</span> ct <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    ct<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    ct<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ËøêË°åÁªìÊûúÂ¶Ç‰∏ã(‰ªéÁªìÊûú‰∏äÈù¢ÂèØ‰ª•ÁúãÁöÑÂá∫Êù•ÔºåËØªÁöÑÊó∂ÂÄôÊòØÂπ∂ÂèëÁöÑ,ÂÜôÁöÑÊó∂ÂÄôÊòØÊúâÈ°∫Â∫èÁöÑÂ∏¶ÈòªÂ°ûÊú∫Âà∂ÁöÑ):</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">0</span> read <span class="token class-name"><span class="token namespace">start<span class="token punctuation">.</span></span>
Thread</span><span class="token operator">-</span><span class="token number">1</span> read <span class="token class-name"><span class="token namespace">start<span class="token punctuation">.</span></span>
Thread</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">-</span>read<span class="token operator">-</span><span class="token class-name"><span class="token namespace">end<span class="token punctuation">.</span></span>
Thread</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>read<span class="token operator">-</span><span class="token class-name"><span class="token namespace">end<span class="token punctuation">.</span></span>
Thread</span><span class="token operator">-</span><span class="token number">3</span> write <span class="token class-name"><span class="token namespace">start<span class="token punctuation">.</span></span>
Thread</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">-</span>write<span class="token operator">-</span><span class="token class-name"><span class="token namespace">end<span class="token punctuation">.</span></span>
Thread</span><span class="token operator">-</span><span class="token number">2</span> write <span class="token class-name"><span class="token namespace">start<span class="token punctuation">.</span></span>
Thread</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span>write<span class="token operator">-</span>end<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        Á¨¨‰∫åÁßçÊÉÖÂÜµÔºåÊàë‰ª¨‰Ωì‰ºö‰∏Ä‰∏™<code>ReadLock</code> Âíå <code>WriteLock</code> ÁöÑÂ§çÊùÇ‰ΩøÁî®ÊÉÖÂÜµÔºåÊ®°Êãü‰∏Ä‰∏™ÊúâËØªÂÜôÊï∞ÊçÆÁöÑÂú∫ÊôØ,‰ªîÁªÜ‰Ωì‰ºö‰∏Ä‰∏ã„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ÂÅáËÆæËøôÈáåÈù¢Â≠ò‰∫ÜÊï∞ÊçÆÁºìÂ≠ò</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantReadWriteLock</span> rwlock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">readWrite</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Object</span> value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            rwlock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// È¶ñÂÖàÂºÄÂêØËØªÈîÅÔºå‰ªéÁºìÂ≠ò‰∏≠ÂéªÂèñ</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                value <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// Â¶ÇÊûúÁºìÂ≠ò‰∏≠Ê≤°ÊúâÈáäÊîæËØªÈîÅÔºå‰∏äÂÜôÈîÅ</span>
                    rwlock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    rwlock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            value <span class="token operator">=</span> <span class="token string">"aaa"</span><span class="token operator">+</span>id<span class="token punctuation">;</span> <span class="token comment">// Ê≠§Êó∂ÂèØ‰ª•ÂéªÊï∞ÊçÆÂ∫ì‰∏≠Êü•ÊâæÔºåËøôÈáåÁÆÄÂçïÁöÑÊ®°Êãü‰∏Ä‰∏ã</span>
                        <span class="token punctuation">&#125;</span>
                        rwlock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ÁÑ∂ÂêéÂÜç‰∏äËØªÈîÅ</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                        rwlock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ÈáäÊîæÂÜôÈîÅ</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                rwlock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ÊúÄÂêéÈáäÊîæËØªÈîÅ</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>main</code>ÊñπÊ≥ï</p>
<pre class="line-numbers language-none"><code class="language-none">public static void main(String[] args) &#123;
        final Count ct &#x3D; new Count();
&#x2F;&#x2F;        for (int i &#x3D; 0; i &lt; 2; i++) &#123;
&#x2F;&#x2F;            new Thread() &#123;
&#x2F;&#x2F;                @Override
&#x2F;&#x2F;                public void run() &#123;
&#x2F;&#x2F;                    ct.get();
&#x2F;&#x2F;                &#125;
&#x2F;&#x2F;            &#125;.start();
&#x2F;&#x2F;        &#125;
&#x2F;&#x2F;        for (int i &#x3D; 0; i &lt; 2; i++) &#123;
&#x2F;&#x2F;            new Thread() &#123;
&#x2F;&#x2F;                @Override
&#x2F;&#x2F;                public void run() &#123;
&#x2F;&#x2F;                    ct.put();
&#x2F;&#x2F;                &#125;
&#x2F;&#x2F;            &#125;.start();
&#x2F;&#x2F;        &#125;

        for (int i &#x3D; 0; i &lt; 9; i++) &#123;
            int num &#x3D; i;
            new Thread() &#123;
                @Override
                public void run() &#123;
                    Object o &#x3D; ct.readWrite(String.valueOf(num));
                    System.out.println(Thread.currentThread().getName()+&quot;--&quot;+o);

                &#125;
            &#125;.start();
        &#125;
        System.out.println(&quot;---&quot;);
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÊâìÂç∞</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">--</span>aaa1
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">0</span><span class="token operator">--</span>aaa0
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">--</span>aaa2
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">--</span>aaa3
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">--</span>aaa4
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">8</span><span class="token operator">--</span>aaa8
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">5</span><span class="token operator">--</span>aaa5
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">6</span><span class="token operator">--</span>aaa6
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">7</span><span class="token operator">--</span>aaa7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>ReentrantReadWriteLock</code> ‰∏é <code>ReentrantLock</code>ÁöÑÊØîËæÉ:<br>(1ÔºâÁõ∏ÂêåÁÇπ:ÂÖ∂ÂÆûÈÉΩÊòØ‰∏ÄÁßçÊòæÁ§∫ÈîÅÔºåÊâãÂä®Âä†ÈîÅÂíåËß£ÈîÅÔºåÈÉΩÂæàÈÄÇÂêàÈ´òÂπ∂ÂèëÂú∫ÊôØ„ÄÇ<br>(2Ôºâ‰∏çÂêåÁÇπ: <code>ReentrantReadWriteLock</code>ÊòØÂØπ<code>ReentrantLock</code> ÁöÑÂ§çÊùÇÊâ©Â±ïÔºåËÉΩÈÄÇÂêàÊõ¥Âä†Â§çÊùÇÁöÑ‰∏öÂä°Âú∫ÊôØÔºå<code>ReentrantReadWriteLock</code>ÂèØ‰ª•ÂÆûÁé∞‰∏Ä‰∏™ÊñπÊ≥ï‰∏≠ËØªÂÜôÂàÜÁ¶ªÁöÑÈîÅÁöÑÊú∫Âà∂„ÄÇËÄå <code>ReentrantLock</code> Âä†ÈîÅËß£ÈîÅÂè™Êúâ‰∏ÄÁßçÊú∫Âà∂„ÄÇ</p>
<p>‰ΩøÁî®<code>ReadWriteLock</code>ÂèØ‰ª•ÊèêÈ´òËØªÂèñÊïàÁéáÔºö</p>
<ul>
<li><code>ReadWriteLock</code>Âè™ÂÖÅËÆ∏‰∏Ä‰∏™Á∫øÁ®ãÂÜôÂÖ•Ôºõ</li>
<li><code>ReadWriteLock</code>ÂÖÅËÆ∏Â§ö‰∏™Á∫øÁ®ãÂú®Ê≤°ÊúâÂÜôÂÖ•Êó∂ÂêåÊó∂ËØªÂèñÔºõ</li>
<li><code>ReadWriteLock</code>ÈÄÇÂêàËØªÂ§öÂÜôÂ∞ëÁöÑÂú∫ÊôØ„ÄÇ</li>
</ul>
<h3 id="ÊòæÁ§∫ÈîÅ-StampedLock"><a href="#ÊòæÁ§∫ÈîÅ-StampedLock" class="headerlink" title="ÊòæÁ§∫ÈîÅ StampedLock"></a>ÊòæÁ§∫ÈîÅ StampedLock</h3><p>‚Äã        ÂâçÈù¢‰ªãÁªçÁöÑ<code>ReadWriteLock</code>ÂèØ‰ª•Ëß£ÂÜ≥Â§öÁ∫øÁ®ãÂêåÊó∂ËØªÔºå‰ΩÜÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãËÉΩÂÜôÁöÑÈóÆÈ¢ò„ÄÇÂ¶ÇÊûúÊàë‰ª¨Ê∑±ÂÖ•ÂàÜÊûê<code>ReadWriteLock</code>Ôºå‰ºöÂèëÁé∞ÂÆÉÊúâ‰∏™ÊΩúÂú®ÁöÑÈóÆÈ¢òÔºöÂ¶ÇÊûúÊúâÁ∫øÁ®ãÊ≠£Âú®ËØªÔºåÂÜôÁ∫øÁ®ãÈúÄË¶ÅÁ≠âÂæÖËØªÁ∫øÁ®ãÈáäÊîæÈîÅÂêéÊâçËÉΩËé∑ÂèñÂÜôÈîÅÔºåÂç≥ËØªÁöÑËøáÁ®ã‰∏≠‰∏çÂÖÅËÆ∏ÂÜôÔºåËøôÊòØ‰∏ÄÁßçÊÇ≤ËßÇÁöÑËØªÈîÅ„ÄÇ</p>
<p>‚Äã        Ë¶ÅËøõ‰∏ÄÊ≠•ÊèêÂçáÂπ∂ÂèëÊâßË°åÊïàÁéáÔºåJava 8ÂºïÂÖ•‰∫ÜÊñ∞ÁöÑËØªÂÜôÈîÅÔºö<code>StampedLock</code>„ÄÇ</p>
<p>‚Äã        <code>StampedLock</code>Âíå<code>ReadWriteLock</code>Áõ∏ÊØîÔºåÊîπËøõ‰πãÂ§ÑÂú®‰∫éÔºöËØªÁöÑËøáÁ®ã‰∏≠‰πüÂÖÅËÆ∏Ëé∑ÂèñÂÜôÈîÅÂêéÂÜôÂÖ•ÔºÅËøôÊ†∑‰∏ÄÊù•ÔºåÊàë‰ª¨ËØªÁöÑÊï∞ÊçÆÂ∞±ÂèØËÉΩ‰∏ç‰∏ÄËá¥ÔºåÊâÄ‰ª•ÔºåÈúÄË¶Å‰∏ÄÁÇπÈ¢ùÂ§ñÁöÑ‰ª£Á†ÅÊù•Âà§Êñ≠ËØªÁöÑËøáÁ®ã‰∏≠ÊòØÂê¶ÊúâÂÜôÂÖ•ÔºåËøôÁßçËØªÈîÅÊòØ‰∏ÄÁßç‰πêËßÇÈîÅ„ÄÇ</p>
<p>‚Äã        ‰πêËßÇÈîÅÁöÑÊÑèÊÄùÂ∞±ÊòØ‰πêËßÇÂú∞‰º∞ËÆ°ËØªÁöÑËøáÁ®ã‰∏≠Â§ßÊ¶ÇÁéá‰∏ç‰ºöÊúâÂÜôÂÖ•ÔºåÂõ†Ê≠§Ë¢´Áß∞‰∏∫‰πêËßÇÈîÅ„ÄÇÂèçËøáÊù•ÔºåÊÇ≤ËßÇÈîÅÂàôÊòØËØªÁöÑËøáÁ®ã‰∏≠ÊãíÁªùÊúâÂÜôÂÖ•Ôºå‰πüÂ∞±ÊòØÂÜôÂÖ•ÂøÖÈ°ªÁ≠âÂæÖ„ÄÇÊòæÁÑ∂‰πêËßÇÈîÅÁöÑÂπ∂ÂèëÊïàÁéáÊõ¥È´òÔºå‰ΩÜ‰∏ÄÊó¶ÊúâÂ∞èÊ¶ÇÁéáÁöÑÂÜôÂÖ•ÂØºËá¥ËØªÂèñÁöÑÊï∞ÊçÆ‰∏ç‰∏ÄËá¥ÔºåÈúÄË¶ÅËÉΩÊ£ÄÊµãÂá∫Êù•ÔºåÂÜçËØª‰∏ÄÈÅçÂ∞±Ë°å„ÄÇ</p>
<p>‚Äã        Âú®ÁêÜËß£StampedLock‰πãÂâçÔºå‰∏çÁü•ÈÅìÂ§ßÂÆ∂‰πãÂâçÊé•Ëß¶ËøáÊÇ≤ËßÇÈîÅÂíå‰πêËßÇÈîÅÊ≤°ÊúâÔºåÊàë‰ª¨Âú®ËøôÈáåÂÖàÂÅö‰∏Ä‰∏™ÁÆÄÂçïËØ¥Êòé:</p>
<p>‚Äã        ‚óèÊÇ≤ËßÇÈîÅÔºöÂÅáÂÆö‰ºöÂèëÁîüÂπ∂ÂèëÂÜ≤Á™ÅÔºåÂ±èËîΩ‰∏ÄÂàáÂèØËÉΩËøùÂèçÊï∞ÊçÆÂÆåÊï¥ÊÄßÁöÑÊìç‰Ωú„ÄÇ<br>‚Äã        ‚óèËØªÂèñÊÇ≤ËßÇÈîÅÔºöÂú®ËØªÂèñ‰πãÂâç‰∏ÄÂÆöË¶ÅÂà§Êñ≠‰∏Ä‰∏ãÔºåÊï∞ÊçÆÂèàÊ≤°ÊúâÊ≠£Âú®Ë¢´Êõ¥Êîπ„ÄÇ<br>‚Äã        ‚óè‰πêËßÇÈîÅÔºöÂÅáËÆæ‰∏ç‰ºöÂèëÁîüÂπ∂ÂèëÂÜ≤Á™ÅÔºåÂè™Âú®Êèê‰∫§Êìç‰ΩúÊó∂Ê£ÄÊü•ÊòØÂê¶ËøùÂèçÊï∞ÊçÆÂÆåÊï¥ÊÄß„ÄÇ<br>‚Äã        ‚óèËØªÂèñ‰πêËßÇÈîÅÔºöÂú®ËØªÂèñ‰πãÂâçÂ∞±‰∏çÈúÄË¶ÅÊù•Âà§Êñ≠Êï∞ÊçÆÁöÑ‰∏ÄËá¥ÊÄßÔºåÊàëÂè™ÁÆ°ËØªÊàëËá™Â∑±ÁöÑÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇ</p>
<p>‚Äã        <code>StampedLock</code>ÊòØÂü∫‰∫éËÉΩÂäõÁöÑÈîÅÔºåÂèØ‰ª•ÂæàÂ•ΩÂú∞ÂÆûÁé∞ÊÇ≤ËßÇÈîÅÂíå‰πêËßÇÈîÅÁöÑÈÄªËæë„ÄÇÂÆÉ‰ΩøÁî®‰∏âÁßçÊ®°ÂºèÊù•ÊéßÂà∂ËØª&#x2F;ÂÜôËÆøÈóÆ„ÄÇ<code>StampedLock</code>ÁöÑÁä∂ÊÄÅÂåÖÂê´‰∫ÜÁâàÊú¨ÂíåÊ®°Âºè„ÄÇÈîÅËé∑ÂèñÊñπÊ≥ïÊ†πÊçÆÈîÅÁöÑÁä∂ÊÄÅËøîÂõû‰∏Ä‰∏™Ë°®Á§∫ÂíåÊéßÂà∂ËÆøÈóÆÁöÑÊ†áÂøó(<code>stamp</code>),‚Äú<code>try</code>‚Äú ÁâàÊú¨ÁöÑËøô‰∫õÊñπÊ≥ïÂèØËÉΩËøîÂõû‰∏Ä‰∏™ÁâπÊÆäÁöÑÂÄº<code>0</code>Êù•Ë°®Á§∫Ëé∑ÂèñÂ§±Ë¥•„ÄÇÈîÅÈáäÊîæÂíåÂÆÉÁöÑÂèòÊç¢ÊñπÊ≥ïË¶ÅÊ±Ç‰∏Ä‰∏Ä‰∏™Ê†áÂøó‰Ωú‰∏∫ÂèÇÊï∞Ôºå Â¶ÇÊûúÂÆÉ‰ª¨‰∏çÁ¨¶ÂêàÈîÅÁöÑÁä∂ÊÄÅÂ∞±Â§±Ë¥•„ÄÇËøô‰∏âÁßçÊ®°ÂºèÂàÜÂà´ÊòØ:</p>
<blockquote>
<p>ÂÜôÈîÅ„ÄÅÊÇ≤ËßÇËØªÈîÅÂíå‰πêËßÇËØª„ÄÇ</p>
</blockquote>
<p>‚Äã        ‚óèÂÜô:ÊñπÊ≥ï<code>writeLock</code>ÂèØËÉΩÈòªÂ°ûÁ≠âÂæÖÁã¨Âç†ËÆøÈóÆÔºåËøîÂõû‰∏Ä‰∏™Ê†áÂøóÔºåÂèØÁî®ÊñπÊ≥ï<code>unlockWrite</code> ‰ª•ÈáäÊîæÈîÅ„ÄÇ‰πüÊèê‰æõ‰∫ÜÊó†Êó∂Èó¥ÂíåÂ∏¶Êó∂Èó¥ÁâàÊú¨ÁöÑ<code>tryWriteLock</code> ÊñπÊ≥ï„ÄÇÂΩìÈîÅ‰ª•ÂÜôÊ®°ÂºèÊåÅÊúâÊó∂ÔºåÊ≤°ÊúâËØªÈîÅÂèØ‰ª•Ëé∑ÂèñÔºåÊâÄÊúâ‰πêËßÇÊÄßËØªÁ°ÆËÆ§Â∞ÜÂ§±Ë¥•„ÄÇ<br>‚Äã        ‚óèËØªÊñπÊ≥ï<code>readLock</code>ÂèØËÉΩ‰∏∫ÈùûÁã¨Âç†ËÆøÈóÆËÄåÈòªÂ°ûÁ≠âÂæÖËøîÂõû‰∏Ä‰∏™Ê†áÂøóÁî®‰∫éÊñπÊ≥ï<code>unlockRead</code>‰ª•ÈáäÊîæÈîÅ„ÄÇ‰πüÊèê‰æõ‰∫ÜÊó†Êó∂Èó¥ÂíåÂ∏¶Êó∂Èó¥ÁâàÊú¨ÁöÑ<code>tryWriteLock</code> ÊñπÊ≥ï„ÄÇ<br>‚Äã        ‚óè‰πêËßÇËØª:Âè™ÊúâÂú®ÈîÅÂΩìÂâçÊ≤°Êúâ‰ª•ÂÜôÊ®°ÂºèÊåÅÊúâÊó∂ÔºåÊñπÊ≥ï<code>tryopimisticRead</code> ËøîÂõû‰∏Ä‰∏™Èùû0Ê†áÂøó„ÄÇÂ¶ÇÊûúÈîÅËá™ÁªôÂÆöÊ†áÂøó‰ª•Êù•Ê≤°Êúâ‰ª•ÂÜôÊ®°ÂºèÊåÅÊúâÔºåÊñπÊ≥ï<code>validate</code> ËøîÂõû<code>true</code>. ËøôÁßçÊ®°ÂºèÂèØ‰ª•ËÆ§‰∏∫ÊòØ‰∏Ä-ÁßçÊûÅÂº±ÁâàÊú¨ÁöÑËØªÈîÅÔºåÂèØ‰ª•Âú®‰ªªÊÑèÊó∂Èó¥Ë¢´ÂÜôËÄÖÊâìÁ†¥Âú®Áü≠ÁöÑÂè™ËØª‰ª£Á†ÅÊÆµ‰ΩøÁî®‰πêËßÇÊ®°ÂºèÂ∏∏Â∏∏ÂèØ‰ª•ÂáèÂ∞ëÁ´û‰∫âÂπ∂ÊèêÂçáÂêûÂêêÈáè„ÄÇÁÑ∂ËÄåÔºåÂÆÉÁöÑ‰ΩøÁî®Â§©ÁîüÊòØËÑÜÂº±ÁöÑ„ÄÇ‰πêËßÇËØªÁâáÊÆµ<code>section</code>Â∫îËØ•Âè™ËØªÂ≠óÊÆµÂπ∂ÊåÅÊúâÂà∞Êú¨Âú∞ÂèòÈáèÔºåÁî®‰∫é‰ª•Âêé‰ΩøÁî®ÔºåÂú®Á°ÆËÆ§‰ª•Âêé„ÄÇ‰πêËßÇËØªÊ®°ÂºèÈáåÁöÑÂ≠óÊÆµËØªÂèñÂèØËÉΩÂæà‰∏ç‰∏ÄËá¥ÔºåÊâÄ‰ª•ÊÉØ‰æãÂè™Áî®‰∫éÂΩì‰Ω†ÂØπÊï∞ÊçÆË°®Á§∫Ë∂≥Â§üÁÜüÊÇâÔºåÂèØ‰ª•Ê£ÄÊü•‰∏ÄËá¥ÊÄßÂíå&#x2F;ÊàñÈáç Â§çË∞ÉÁî®<code>validate()</code> ÊñπÊ≥ï„ÄÇ‰æãÂ¶ÇÔºåËøô‰∫õÊ≠•È™§ÂÖ∏ÂûãÂú∞Âú®Á¨¨‰∏ÄÊ¨°ËØªÂèñÂØπË±°ÊàñÊï∞ÁªÑÂºïÁî®ÔºåÁÑ∂ÂêéËÆøÈóÆÂÖ∂‰∏≠Â≠óÊÆµ„ÄÅÂÖÉÁ¥†ÊàñÊñπÊ≥ïÊó∂Ë¶ÅÊ±Ç„ÄÇ</p>
<p>‚Äã        Êàë‰ª¨Êù•Áúã‰∏Ä‰∏ã<code>StampedLock</code>ÁöÑÈÉ®ÂàÜÊ∫êÁ†Å:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StampedLock</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>
	
	<span class="token comment">/** Lock sequence/state */</span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">long</span> state<span class="token punctuation">;</span><span class="token comment">//Ê†áÂøó(`stamp`);</span>
	<span class="token comment">// views</span>
    <span class="token keyword">transient</span> <span class="token class-name">ReadLockView</span> readLockView<span class="token punctuation">;</span>
    <span class="token keyword">transient</span> <span class="token class-name">WriteLockView</span> writeLockView<span class="token punctuation">;</span>
    <span class="token keyword">transient</span> <span class="token class-name">ReadWriteLockView</span> readWriteLockView<span class="token punctuation">;</span>
	
	<span class="token comment">// view classes</span>

    <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ReadLockView</span> <span class="token keyword">implements</span> <span class="token class-name">Lock</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
            <span class="token function">readLockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">tryReadLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0L</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token function">tryReadLock</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> unit<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">unstampedUnlockRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token class-name">Condition</span> <span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">WriteLockView</span> <span class="token keyword">implements</span> <span class="token class-name">Lock</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
            <span class="token function">writeLockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">tryWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0L</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token function">tryWriteLock</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> unit<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">unstampedUnlockWrite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token class-name">Condition</span> <span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ReadWriteLockView</span> <span class="token keyword">implements</span> <span class="token class-name">ReadWriteLock</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token class-name">Lock</span> <span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">asReadLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token class-name">Lock</span> <span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">asWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        Áî±Ê≠§ÂèØ‰ª•ÁúãÂæóÂá∫Êù•<code>StampedLock</code>‰πüÊòØÂà©Áî®<code>Lock</code>Êú∫Âà∂ÂÜçÂä†‰∏ä<code>stamp</code>‰Ωú‰∏∫ÈîÅÁöÑÊ†áÂøóÁä∂ÊÄÅÔºåÂÆûÁé∞‰∫ÜÈîÅ‰∏éÈîÅ‰πãÈó¥ÁöÑÊÇ≤ËßÇÂíå‰πêËßÇ„ÄÇ<br>‚Äã        Ëøô‰∏™Á±ª‰πüÊîØÊåÅÊñπÊ≥ï‰ª•ÊúâÊù°‰ª∂Âú∞Êèê‰æõ‰∏âÁßçÊ®°Âºè‰πãÈó¥ÁöÑËΩ¨Êç¢„ÄÇ‰æãÂ¶ÇÔºåÊñπÊ≥ï<code>tryConvertToWriteLock</code>Â∞ùËØï‚ÄúÂçáÁ∫ß‚ÄùÊ®°ÂºèÔºåËøîÂõû‰∏Ä‰∏Ä‰∏™ÊúâÊïàÁöÑÂÜôÊ†áÂøó„ÄÇ</p>
<blockquote>
<p> [1]Ë°®Á§∫Â∑≤ÁªèÊòØÂÜôÊ®°ÂºèÔºå</p>
<p>[2]Ë°®Á§∫Âú®ËØªÊ®°Âºè‰∏îÊ≤°ÊúâÂÖ∂‰ªñËØªËÄÖÔºå</p>
<p>[3]Ë°®Á§∫Âú®‰πêËßÇÊ®°Âºè‰∏îÈîÅÂèØÂæó„ÄÇËøô‰∫õÊñπÊ≥ïÁöÑÂΩ¢ÂºèÊòØËÆæËÆ°Áî®‰∫éÂ∏ÆÂä©ÂáèÂ∞ë‰∏Ä‰∫õ‰ª£Á†ÅËÜ®ËÉÄÔºå Âê¶ÂàôÂ∞ÜÂá∫Áé∞Âú®Âü∫‰∫éÈáçËØïÁöÑËÆæËÆ°„ÄÇ</p>
</blockquote>
<p><code>StampedLock</code>ËÆæËÆ°Áî®‰ΩúÂºÄÂèëÁ∫øÁ®ãÂÆâÂÖ®ÁªÑ‰ª∂ÁöÑÂÜÖÈÉ®Â∑•ÂÖ∑„ÄÇÂÆÉ‰ª¨ÁöÑ‰ΩøÁî®‰æùËµñ‰∫éÂØπÊï∞ÊçÆ„ÄÅÂØπË±°ÂíåÂÆÉ‰ª¨ÊâÄ‰øùÊä§ÊñπÊ≥ïÁöÑÂÜÖÂú®Â±ûÊÄßÁöÑÁü•ËØÜ„ÄÇÂÆÉ‰ª¨‰∏çÊòØÂèØÈáçÂÖ•ÁöÑÔºåÊâÄ‰ª•ÈîÅ‰øùÊä§Âùó‰∏çÂ∫îËØ•Ë∞ÉÁî®ÂÖ∂‰ªñÂèØËÉΩÂ∞ùËØïÂÜçÊ¨°Ëé∑ÂèñÈîÅ(ËôΩÁÑ∂‰Ω†ÂèØ‰ª•‰º†ÈÄíÊ†áÂøóÁªôÂÖ∂‰ªñÊñπÊ≥ïÔºåÁÑ∂Âêé‰ΩøÁî®ÊàñËΩ¨Êç¢ÂÆÉ)ÁöÑÊú™Áü•ÊñπÊ≥ï„ÄÇ‰ΩøÁî®ËØªÈîÅÊ®°Âºè‰æùËµñ‰∫éÂÖ≥ËÅîÁöÑ‰ª£Á†ÅÁâáÊÆµÊòØÊó†ËæπÈôÖÊïàÂ∫îÁöÑ( ‰πüÂ∞±ÊòØÊó†ÂâØ‰ΩúÁî®)„ÄÇÊó†ÊïàÁöÑ‰πêËßÇËØªÁâáÊÆµ‰∏çËÉΩË∞ÉÁî®ÈÇ£‰∫õ‰∏çÁü•ÈÅìÂøçÂèóÊΩúÂú®‰∏ç‰∏ÄËá¥ÁöÑÊñπÊ≥ï„ÄÇÊ†áÂøó‰ΩøÁî®ÊúâÈôêÁöÑË°®Á§∫Ôºå‰∏î‰∏çÊòØÂØÜÁ†ÅÂä†ÂØÜÂÆâÂÖ®ÁöÑ( ‰æãÂ¶ÇÔºå‰∏Ä‰∏Ä‰∏™ÊúâÊïàÁöÑÊ†áÂøóÊòØÂèØÁåúÊµãÁöÑ)„ÄÇÂú®(‰∏çÊó©‰∫é) -‰∏ÄÂπ¥ÁöÑÊåÅÁª≠Êìç‰ΩúÂêéÔºåÊ†áÂøóÁöÑÂÄºÂèØËÉΩ‰ºöÂæ™ÁéØ„ÄÇÊåÅÊúâÊ†áÂøóËÄå‰∏ç‰ΩøÁî®Êàñ<br>Á°ÆËÆ§ÔºåÂú®Â§ß‰∫éËøô‰∏™Âë®ÊúüÂèØËÉΩÂ∞Ü‰∏çËÉΩÊ≠£Á°ÆÁ°ÆËÆ§„ÄÇ<code>StampedLock</code> ÊòØÂèØÂ∫èÂàóÂåñÁöÑÔºå‰ΩÜÊÄªÊòØÂèçÂ∫èÂàóÂåñ‰∏∫ÂàùÂßãÊú™ÈîÅÂÆöÁä∂ÊÄÅÔºåÊâÄ‰ª•ÂØπ‰∫éËøúÁ®ãÈîÅÂÆöÊ≤°ÊúâÂ∏ÆÂä©„ÄÇ<br>        <code>StampedLock</code>ÁöÑË∞ÉÂ∫¶Á≠ñÁï•‰∏çÊòØ‰∏ÄÊÉØÂú∞ÂÄæÂêë‰∫éÈÄâÊã©ËØªËÄå‰∏çÊòØÂÜôÔºå ÊàñÁõ∏Âèç„ÄÇÊâÄÊúâ‚Äú<code>try</code>‚Äú ÊñπÊ≥ïÈÉΩÊòØÂ∞ΩÊúÄÂ§ßÂä™ÂäõÁöÑÔºå‰∏çÂøÖÂêë‰ªª‰ΩïË∞ÉÂ∫¶ÊàñÂÖ¨Âπ≥Á≠ñÁï•Á°ÆËÆ§„ÄÇ‰ªª‰ΩïÁî®‰∫éËé∑ÂèñÁöÑ‚Äú<code>try</code>‚Äú ÊñπÊ≥ïÊàñ‰∏çÂ∏¶‰ªª‰ΩïÂÖ≥‰∫éÈîÅÁä∂ÊÄÅÁöÑ‰ø°ÊÅØÁöÑËΩ¨Êç¢ÈîÅÊ®°ÂºèÁöÑÊñπÊ≥ïËøîÂõû0 ;ÂêéÁª≠ÁöÑË∞ÉÁî®ÂèØËÉΩÊàêÂäü„ÄÇ<br>        Âõ†‰∏∫ÂÆÉÊîØÊåÅÂçèË∞ÉË∑®Â§öÁßçÈîÅÊ®°Âºè‰ΩøÁî®ÔºåËøô‰∏™Á±ª‰∏çÁõ¥Êé•‰ΩøÁî®Lock ÊàñReadWriteLockÊé•Âè£„ÄÇÁÑ∂ËÄåÔºåÂú®Ë¶ÅÊ±ÇËøôÊ†∑- - ÁªÑÂÖ≥ËÅîÂäüËÉΩÁöÑÂ∫îÁî®ÈáåÔºå<code>StampedLock</code> ÂèØ‰ª•Áúã‰Ωú<code>asReadLock()</code>„ÄÅ <code>asWriteLock()</code>Êàñ<code>asReadWriteLock()</code>„ÄÇ</p>
<p>‚Äã        ‰∏ãÈù¢ÊòØJavaÁöÑdoc‰∏≠Êèê‰æõÁöÑ‰∏Ä‰∏Ä‰∏™‰æãÂ≠ê: </p>
<h4 id="No5-StampedLockDemo-java"><a href="#No5-StampedLockDemo-java" class="headerlink" title="No5_StampedLockDemo.java"></a>No5_StampedLockDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadsecurity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">StampedLock</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No5_StampedLockDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">Point</span> ct <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    ct<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    ct<span class="token punctuation">.</span><span class="token function">distanceFromOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StampedLock</span> sl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StampedLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword">double</span> deltaX<span class="token punctuation">,</span> <span class="token keyword">double</span> deltaY<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// an exclusively locked method</span>
            <span class="token keyword">long</span> stamp <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"get writeLock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                x <span class="token operator">+=</span> deltaX<span class="token punctuation">;</span>
                y <span class="token operator">+=</span> deltaY<span class="token punctuation">;</span>

                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000l</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"write  OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"unlockWrite"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                sl<span class="token punctuation">.</span><span class="token function">unlockWrite</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">//‰∏ãÈù¢ÁúãÁúã‰πêËßÇËØªÈîÅÊ°à‰æã</span>
        <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">distanceFromOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// A read-only method</span>
            <span class="token comment">//Â∞ùËØï‰πêËßÇËØª</span>
            <span class="token comment">//ËøîÂõû‰∏Ä‰∏™ÂèØ‰ª•Á®çÂêéÈ™åËØÅÁöÑÊà≥ËÆ∞ÔºåÂ¶ÇÊûúÊéí‰ªñÊÄßÈîÅÂÆöÔºåÂàôËøîÂõû0„ÄÇ</span>
            <span class="token comment">//ËøîÂõû:‰∏Ä‰∏™Êà≥ËÆ∞ÔºåÂ¶ÇÊûúË¢´Êéí‰ªñÊÄßÈîÅÂÆöÔºåÂàôËøîÂõû0</span>
            <span class="token keyword">long</span> stamp <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">tryOptimisticRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Ëé∑Âæó‰∏Ä‰∏™‰πêËßÇËØªÈîÅ</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"Ëé∑Âæó‰∏Ä‰∏™‰πêËßÇËØªÈîÅ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">double</span> currentX <span class="token operator">=</span> x<span class="token punctuation">,</span> currentY <span class="token operator">=</span> y<span class="token punctuation">;</span><span class="token comment">//Â∞Ü‰∏§‰∏™Â≠óÊÆµËØªÂÖ•Êú¨Âú∞Â±ÄÈÉ®ÂèòÈáè</span>
            <span class="token comment">// Â¶ÇÊûúËá™ÁªôÂÆöÁöÑÊà≥ËÆ∞ÂèëÂá∫ÂêéÈîÅËøòÊ≤°ÊúâË¢´Áã¨Âç†Ëé∑ÂèñÔºåÂàôËøîÂõûtrue„ÄÇ</span>
            <span class="token comment">// Â¶ÇÊûúÊà≥ËÆ∞‰∏∫Èõ∂ÔºåÂàôÊÄªÊòØËøîÂõûfalse„ÄÇÂ¶ÇÊûúÊà≥ËÆ∞Ë°®Á§∫ÂΩìÂâçÊåÅÊúâÁöÑÈîÅÔºåÂàôÂßãÁªàËøîÂõûtrue„ÄÇ</span>
            <span class="token comment">// ‰ΩøÁî®Êú™‰ªétryOptimisticReadËé∑ÂæóÁöÑÂÄºÊàñÊ≠§ÈîÅÁöÑÈîÅÂÆöÊñπÊ≥ïË∞ÉÁî®Ê≠§ÊñπÊ≥ïÊ≤°ÊúâÂÆö‰πâ‰ªª‰ΩïÊïàÊûúÊàñÁªìÊûú„ÄÇ</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sl<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//Ê£ÄÊü•ÂèëÂá∫‰πêËßÑËØªÈîÅÂêéÂêåÊó∂ÊòØÂê¶ÊúâÂÖ∂‰ªñÂÜôÈîÅÂèëÁîü?</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>sl<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                stamp <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Â¶ÇÊûúÊ≤°ÊúâÔºåÊàë‰ª¨ÂÜçÊ¨°Ëé∑Âæó‰∏Ä‰∏™ËØªÊÇ≤ËßÇÈîÅ</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"ÂÜçÊ¨°Ëé∑Âæó‰∏Ä‰∏™ËØªÊÇ≤ËßÇÈîÅ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">//Â∞Ü‰∏§‰∏™Â≠óÊÆµËØªÂÖ•Êú¨Âú∞Â±ÄÈÉ®ÂèòÈáè</span>
                    currentX <span class="token operator">=</span> x<span class="token punctuation">;</span>
                    currentY <span class="token operator">=</span> y<span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"unlockRead"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    sl<span class="token punctuation">.</span><span class="token function">unlockRead</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>sl<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>currentX <span class="token operator">*</span> currentX <span class="token operator">+</span> currentY <span class="token operator">*</span> currentY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">//‰∏ãÈù¢ÊòØÊÇ≤ËßÇËØªÈîÅÊ°à‰æã</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">moveIfAtOrigin</span><span class="token punctuation">(</span><span class="token keyword">double</span> newX<span class="token punctuation">,</span> <span class="token keyword">double</span> newY<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// upgrade</span>
            <span class="token comment">// Could instead start with optimistic, not read mode</span>
            <span class="token keyword">long</span> stamp <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">0.0</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">==</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//Âæ™ÁéØÔºåÊ£ÄÊü•ÂΩìÂâçÁä∂ÊÄÅÊòØÂê¶Á¨¶Âêà</span>
                    <span class="token keyword">long</span> ws <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">tryConvertToWriteLock</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Â∞ùËØïÂ∞ÜËØªÈîÅËΩ¨‰∏∫ÂÜôÈîÅ</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>ws <span class="token operator">!=</span> <span class="token number">0L</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//ËøôÊòØÁ°ÆËÆ§ËΩ¨‰∏∫ÂÜôÈîÅÊòØÂê¶ÊàêÂäü</span>
                        stamp <span class="token operator">=</span> ws<span class="token punctuation">;</span><span class="token comment">//Â¶ÇÊûúÊàêÂäü ËΩ¨Êç¢Á•®ÊçÆ</span>
                        <span class="token comment">//ËøõË°åÁä∂ÊÄÅÊîπÂèò</span>
                        x <span class="token operator">=</span> newX<span class="token punctuation">;</span>
                        y <span class="token operator">=</span> newY<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token comment">//Â¶ÇÊûú‰∏çËÉΩÊàêÂäüËΩ¨‰∏∫ÂÜôÈîÅ</span>
                        sl<span class="token punctuation">.</span><span class="token function">unlockRead</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Êàë‰ª¨ÊòæÁ§∫ÁöÑÈáäÊîæËØªÈîÅ</span>
                        stamp <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ÊòæÁ§∫Áõ¥Êé•ËøõË°åÂÜôÈîÅ,ÁÑ∂ÂêéÂÜçÈÄöËøáÂæ™ÁéØÂÜçÂ∞ùËØï</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                sl<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ÈáäÊîæËØªÈîÅÊàñËÄÖÂÜôÈîÅ</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        <code>StampedLock</code>ÊòØJDK 1.8‰πãÂêéÊñ∞Êé®Âá∫ÁöÑ‰∏Ä‰∏™ APLÂèØÂ§ßÂπÖÂ∫¶ÊèêÈ´òÁ®ãÂ∫èÁöÑËØªÂèñÈîÅÁöÑÂêûÂêêÈáè„ÄÇÂú®Â§ßÂ§öÊï∞ÈÉΩÊòØËØªÂèñ„ÄÅÂæàÂ∞ëÂÜôÂÖ•ÁöÑÊÉÖÂÜµ‰∏ãÔºå‰πêËßÇËØªÈîÅÊ®°ÂºèÂèØ‰ª•ÊûÅÂ§ßÊèê‰æõÂêûÂêêÈáèÔºå‰πüÂèØ‰ª•ÂáèÂ∞ëËøôÁßçÊÉÖÂÜµ‰∏ãÂÜôÈ••È•øÁöÑÁé∞Ë±°(Áî±‰∫éËØªËÄÖ‰∏ÄËà¨‰∏çÂä†ËØªÈîÅÔºå ÂÜôÂèØ‰ª•È©¨‰∏äËé∑ÂèñÂà∞ÈîÅ)„ÄÇ<br>‚Äã        ÊúÄÂêé<code>Synchronized</code>„ÄÅ<code>ReentrantLock</code>„ÄÅ <code>ReentrantReadWritelock</code>„ÄÅ<code>StampedLock</code>ÁÆÄÂçïÂØπÊØîÂ¶Ç‰∏ã:<br>‚Äã        (1)<code> Synchronized</code> ÊòØÂú®<code>JVM</code>Â±ÇÈù¢‰∏äÂÆûÁé∞ÁöÑÔºåÂèØ‰ª•ÈÄöËøá‰∏Ä‰∫õÁõëÊéßÂ∑•ÂÖ∑ÁõëÊéß<code>synchronized</code>ÁöÑÈîÅÂÆöÔºåÂΩì‰ª£Á†ÅÊâßË°åÊó∂Âá∫Áé∞ÂºÇÂ∏∏Ôºå<code>JVM</code>‰ºöËá™Âä®ÈáäÊîæÈîÅÂÆö„ÄÇÂΩìÂè™ÊúâÂ∞ëÈáèÁ´û‰∫âËÄÖÁöÑÊó∂ÂÄôÔºå<code>synchronized</code> ÊòØ‰∏Ä‰∏™ÂæàÂ•ΩÁöÑÈÄöÁî®ÁöÑÈîÅÂÆûÁé∞„ÄÇ<code>Synchronized</code> ÁöÑÈîÅÊòØÈíàÂØπ‰∏Ä‰∏Ä‰∏™ÂØπË±°ÁöÑ„ÄÇ<br>‚Äã        (2) <code>ReentrantLock</code>„ÄÅ<code>ReentrantReadWriteLock</code>„ÄÅ <code>StampedLock</code> ÈÉΩÊòØ‰ª£Á†ÅÂùóÂ±ÇÈù¢ÁöÑÈîÅÂÆöÔºåË¶Å‰øùËØÅÈîÅÂÆö‰∏ÄÂÆö‰ºöË¢´ÈáäÊîæÔºå Â∞±ÂøÖÈ°ªÂ∞Ü<code>unLock()</code>ÊîæÂà∞<code>finally&#123;&#125;</code>‰∏≠„ÄÇ<br>‚Äã        (3) <code>ReentrantLock</code>ÊòØ‰∏Ä‰∏™ÂæàÂ•ΩÁöÑÈÄöÁî®ÁöÑÈîÅÂÆûÁé∞Ôºå‰ΩøÁî®‰∫éÊØîËæÉÁÆÄÂçïÁöÑÂä†ÈîÅ„ÄÅËß£ÈîÅÁöÑ‰∏öÂä°ÈÄªËæëÔºåÂ¶ÇÊûúÂÆûÁé∞Â§çÊùÇÁöÑÈîÅÊú∫Âà∂ÔºåÂΩìÁ∫øÁ®ãÂ¢ûÈïøËÉΩÂ§üÈ¢Ñ‰º∞Êó∂‰πüÊòØÂèØ‰ª•ÁöÑ„ÄÇ<br>‚Äã        (4) <code>ReentrantReadWrteLock</code> ÂØπ<code>Lock</code>ÂèàËøõË°å‰∫ÜÊâ©Â±ïÔºåÂºïÂÖ•‰∫Ü<code>read</code> Âíå <code>write</code>ÈòªÂ°ûÂíåÂπ∂ÂèëÊú∫Âà∂ÔºåÁõ∏ÂØπ‰∫é<code>ReentrantLock</code>ÂÆÉÂèØ‰ª•ÂÆûÁé∞Êõ¥Â§çÊùÇÁöÑÈîÅÊú∫Âà∂Ôºå‰∏îÂπ∂ÂèëÊÄß‰πüÊõ¥È´ò‰∫õ„ÄÇ<br>‚Äã        (5) <code>StampedLock</code>ÂèàÂú®<code>Lock</code>ÁöÑÂü∫Á°Ä‰∏ä,ÂÆûÁé∞‰∫ÜÂèØ‰ª•Êª°Ë∂≥‰πêËßÇÈîÅÂíåÊÇ≤ËßÇÈîÅÁ≠â‰∏Ä‰∏Ä‰∫õÂú®ËØªÁ∫øÁ®ãË∂äÊù•Ë∂äÂ§öÁöÑ‰∏öÂä°Âú∫ÊôØÔºåÂØπÂêûÂêêÈáèÊúâÂ∑®Â§ßÁöÑÊîπËøõÔºå‰ΩÜÂπ∂‰∏çÊòØËØ¥Ë¶ÅÊõø‰ª£‰πãÂâçÁöÑ<code>Lock</code>, ÊØïÁ´üÂÆÉËøòÊòØÊúâ‰∫õÂ∫îÁî®Âú∫ÊôØÁöÑ„ÄÇ<br>‚Äã        (6) <code>StampedLock</code> Êúâ‰∏Ä‰∏™Â§çÊùÇÁöÑAPIÁõ∏ÂØπ‰∫éÂâçÈù¢‰∏§Áßç<code>Lock</code>ÈîÅÔºåÂØπ‰∫éÂä†ÈîÅÊìç‰ΩúÔºåÂæàÂÆπÊòìËØØÁî®ÂÖ∂‰ªñÊñπÊ≥ïÔºåÂ¶ÇÊûúÁêÜËß£‰∏çÊ∑±ÂÖ•‰πüÊõ¥ÂÆπÊòìÂá∫Áé∞Ê≠ªÈîÅÂíå‰∏çÂøÖË¶ÅÁöÑÈ∫ªÁÉ¶„ÄÇ<br>‚Äã        (7)Êé®ËçêÂ¶ÇÊûú‰∏çÊòØ‰∏öÂä°ÈùûÂæóÈúÄË¶ÅÔºåÂª∫ËÆÆ‰ΩøÁî®<code>ReentrantLock</code>Âíå<code>ReentrantReadWriteLock</code>Âç≥ÂèØ<br>Êª°Ë∂≥Â§ßÈÉ®ÂàÜ‰∏öÂä°Âú∫ÊôØÁöÑÈúÄË¶Å„ÄÇ</p>
<h3 id="‰ªÄ‰πàÊòØÊ≠ªÈîÅ"><a href="#‰ªÄ‰πàÊòØÊ≠ªÈîÅ" class="headerlink" title="‰ªÄ‰πàÊòØÊ≠ªÈîÅ"></a>‰ªÄ‰πàÊòØÊ≠ªÈîÅ</h3><p>‚Äã        Âú®‰∏§ÊÆµ‰∏çÂêåÁöÑÈÄªËæëÈÉΩÂú®Á≠âÂæÖÂØπÊñπÁöÑÈîÅÈáäÊîæÊâçËÉΩÁªßÁª≠ÂæÄ‰∏ãÂ∑•‰ΩúÊó∂ÔºåËøô‰∏™Êó∂ÂÄôÂ∞±‰ºö‰∫ßÁîüÊ≠ªÈîÅÔºåË°®Èù¢Áé∞Ë±°Â∞±ÊòØÁ®ãÂ∫èÂÜç‰πüÊâßË°å‰∏ç‰∏ãÂéª‰∫Ü„ÄÇ<br>‚Äã        ËØ∑ÁúãÂ¶Ç‰∏ã‰∫ã‰æã:Êñ∞Âª∫‰∏Ä‰∏™Âπ≤Ê¥ªÁ±ªÁöÑ‰∏§‰∏™‰∏çÂêåÊñπÊ≥ïÂú®Á≠âÂæÖÈîÅ„ÄÇ</p>
<h4 id="No6-Deadlock-java"><a href="#No6-Deadlock-java" class="headerlink" title="No6_Deadlock.java"></a>No6_Deadlock.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadsecurity</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No6_Deadlock</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Count</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> lock1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> lock2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// Ê≥®ÊÑèËøô‰∏™ÈîÅÁöÑÂØπË±°‰∏ç‰∏ÄÊ†∑</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Ê®°‰ªøÁî®Êà∑Âπ≤Ê¥ª</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// ‰∫ßÁîüÊ≠ªÈîÅÁ≠âÂæÖlock2ÂØπË±°ÈáäÊîæÈîÅ</span>
                    num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lockMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// Ê≥®ÊÑèËøô‰∏™ÈîÅÁöÑÂØπË±°‰∏ç‰∏ÄÊ†∑</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100l</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Ê®°‰ªøÁî®Êà∑Âπ≤Ê¥ª</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// ‰∫ßÁîüÊ≠ªÈîÅÁ≠âÂæÖlock1ÂØπË±°ÈáäÊîæÈîÅ</span>
                    num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ThreadA</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">Count</span> count<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">ThreadA</span><span class="token punctuation">(</span><span class="token class-name">Count</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">=</span>count<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ThreadA run"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            count<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ThreadB</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">Count</span> count<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">ThreadB</span><span class="token punctuation">(</span><span class="token class-name">Count</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">=</span>count<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ThreadB run"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            count<span class="token punctuation">.</span><span class="token function">lockMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Count</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadA</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadA</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        task<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Á∫øÁ®ãA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        task<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadB</span> taskB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadB</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        taskB<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Á∫øÁ®ãB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        taskB<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÈÄöËøáÂ∑•ÂÖ∑Êù•ÁõëÊéßÁ∫øÁ®ãAÂíåÁ∫øÁ®ãBÊ∞∏ËøúÂú®ËøôÈáå:</p>
<p><img src="/image/Concurrent/Concurrent14.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent14.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>ÈÄöËøáÊâßË°å‰∏äÈù¢ÁöÑmainÊñπÊ≥ï‰Ω†‰ºöÂèëÁé∞ÔºåÁ®ãÂ∫èÊ≠ªÂú®ÈÇ£ÈáåÔºåÊ∞∏Ëøú‰∏ç‰ºöÊâßË°å‰∏ãÂéª‰∫ÜÔºåËÄåÂÆûÈôÖÂ∑•‰Ωú‰∏≠Â∫îËØ•Ê≥®ÊÑèÁöÑÊòØÊñπÊ≥ï‰πãÈó¥ÂµåÂ•óË∞ÉÁî®‰∏ä‰∏çËÉΩ‰∫ßÁîüÊ≠ªÈîÅ„ÄÇ</p>
<h3 id="JavaÂÖ≥ÈîÆÂ≠óvolatile‰øÆÈ•∞ÂèòÈáè"><a href="#JavaÂÖ≥ÈîÆÂ≠óvolatile‰øÆÈ•∞ÂèòÈáè" class="headerlink" title="JavaÂÖ≥ÈîÆÂ≠óvolatile‰øÆÈ•∞ÂèòÈáè"></a>JavaÂÖ≥ÈîÆÂ≠óvolatile‰øÆÈ•∞ÂèòÈáè</h3><p>‚Äã        JavaÂÖ≥ÈîÆÂ≠óvolatile‰øÆÈ•∞ÂèòÈáèÔºå‰ªéË°®Èù¢ÊÑèÊÄù‰∏äÊòØËØ¥Ëøô‰∏™ÂèòÈáèÊòØÊòìÂèòÁöÑÔºå‰∏çÁ®≥ÂÆöÁöÑÔºå‰∫ãÂÆû‰∏äÔºåÁ°ÆÂÆûÂ¶ÇÊ≠§ÔºåËøô‰∏™ÂÖ≥ÈîÆÂ≠óÁöÑ‰ΩúÁî®Â∞±ÊòØÂëäËØâÁºñËØëÂô®ÔºåÂá°ÊòØË¢´ËØ•ÂÖ≥ÈîÆÂ≠óÂ£∞ÊòéÁöÑÂèòÈáèÈÉΩÊòØÊòìÂèòÁöÑ„ÄÅ‰∏çÁ®≥ÂÆöÁöÑ„ÄÇÊâÄ‰ª•‰∏çË¶ÅËØïÂõæÂØπËØ•ÂèòÈáè‰ΩøÁî®ÁºìÂ≠òÁ≠â‰ºòÂåñÊú∫Âà∂ÔºåËÄåÂ∫îÂΩìÊØèÊ¨°ÈÉΩ‰ªéÂÆÉÁöÑÂÜÖÂ≠òÂú∞ÂùÄ‰∏≠ÂéªËØªÂèñÂÄº„ÄÇ‰ΩøÁî®volatile Ê†áËÆ∞ÁöÑÂèòÈáèÂú®ËØªÂèñÊàñÂÜôÂÖ•Êó∂‰∏çÈúÄË¶Å‰ΩøÁî®ÈîÅÔºåËøôÂ∞ÜÂáèÂ∞ë‰∫ßÁîüÊ≠ªÈîÅÁöÑÊ¶ÇÁéáÔºå‰Ωø‰ª£Á†Å‰øùÊåÅÁÆÄÊ¥Å„ÄÇ<br>‚Äã        ËØ∑Ê≥®ÊÑèÔºåËøôÈáåÂè™ÊòØËØ¥ÊØèÊ¨°ËØªÂèñvolatileÁöÑÂèòÈáèÊó∂ÈÉΩË¶Å‰ªéÂÆÉÁöÑÂÜÖÂ≠òÂú∞ÂùÄ‰∏≠ËØªÂèñÔºåÂπ∂Ê≤°ÊúâËØ¥ÊØèÊ¨°‰øÆÊîπÂÆåvolatile ÁöÑÂèòÈáèÂêéÈÉΩË¶ÅÁ´ãÂàªÂ∞ÜÂÆÉÁöÑÂÄºÂÜôÂõûÂÜÖÂ≠ò„ÄÇ‰πüÂ∞±ÊòØËØ¥volatile Âè™Êèê‰æõ‰∫ÜÂÜÖÂ≠òÂèØËßÅÊÄßÔºåËÄåÊ≤°ÊúâÊèê‰æõÂéüÂ≠êÊÄß„ÄÇÊâÄ‰ª•ËØ¥Â¶ÇÊûúÁî®Ëøô‰∏™ÂÖ≥ÈîÆÂ≠óÂÅöÈ´òÂπ∂ÂèëÁöÑÂÆâÂÖ®Êú∫Âà∂ÁöÑËØùÊòØ‰∏çÂèØÈù†ÁöÑ„ÄÇ<br>‚Äã        volatileÁöÑÁî®Ê≥ïÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>‚Äã        Âú®Â£∞ÊòéÂèòÈáèÁöÑÊó∂ÂÄôÂ∏¶‰∏ävolatile ÂÖ≥ÈîÆÂ≠óÂç≥ÂèØ„ÄÇ‰ªÄ‰πàÊó∂ÂÄô‰ΩøÁî®volatile ÂÖ≥ÈîÆÂ≠ó?ÂΩìÊàë‰ª¨Áü•ÈÅì‰∫ÜvolatileÁöÑ‰ΩúÁî®ÔºåÊàë‰ª¨‰πüÂ∞±Áü•ÈÅì‰∫ÜÂÆÉÂ∫îËØ•Áî®Âú®Âì™‰∫õÂú∞Êñπ„ÄÇÂæàÊòæÁÑ∂ÔºåÊúÄÂ•ΩÊòØÈÇ£ÁßçÂè™Êúâ‰∏Ä‰∏Ä‰∏™Á∫øÁ®ã‰øÆÊîπÂèòÈáèÔºåÂ§ö‰∏™Á∫øÁ®ãËØªÂèñËØ•ÂèòÈáèÁöÑÂú∞Êñπ„ÄÇ‰πüÂ∞±ÊòØÂØπÂÜÖÂ≠òÂèØËßÅÊÄßË¶ÅÊ±ÇÈ´òÔºåËÄåÂØπÂéüÂ≠êÊÄßË¶ÅÊ±Ç‰ΩéÁöÑÂú∞Êñπ„ÄÇ<br>‚Äã        volatile‰∏éÂä†ÈîÅÊú∫Âà∂ÁöÑ‰∏ªË¶ÅÂå∫Âà´ÊòØÔºöÂä†ÈîÅÊú∫Âà∂Êó¢ÂèØ‰ª•Á°Æ‰øùÂèØËßÅÊÄßÂèàÂèØ‰ª•Á°Æ‰øùÂéüÂ≠êÊÄßÔºåËÄåvolatileÂèòÈáèÂè™ÊúâÁ°Æ‰øùÂèØËßÅÊÄß„ÄÇ</p>
<h3 id="ÂéüÂ≠êÊìç‰Ωú-atomic"><a href="#ÂéüÂ≠êÊìç‰Ωú-atomic" class="headerlink" title="ÂéüÂ≠êÊìç‰Ωú : atomic"></a>ÂéüÂ≠êÊìç‰Ωú : atomic</h3><p>‚Äã        <code>atomic</code>  ÊòØ‰∏ç‰ºöÈòªÂ°ûÁ∫øÁ®ãÔºàÊàñËÄÖËØ¥Âè™ÊòØÂú®Á°¨‰ª∂Á∫ßÂà´‰∏äÈòªÂ°û‰∫ÜÔºâÔºåÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂä†Âº∫ÁâàÁöÑ <code>volatile</code> ÂéüÂ≠êÊìç‰Ωú„ÄÇ<code>java.util.concurrent.atomic</code>ÂåÖÈáåÔºåÂ§ö‰∫Ü‰∏ÄÊâπÂéüÂ≠êÂ§ÑÁêÜÁ±ªÔºå‰∏ªË¶ÅÁî®‰∫éÂú®È´òÂπ∂ÂèëÁéØÂ¢É‰∏ãÁöÑÈ´òÊïàÁ®ãÂ∫èÂ§ÑÁêÜ„ÄÇ</p>
<p>Ëøô‰∫õÂ§ÑÁêÜÁ±ª‰∏ªË¶ÅÊúâ‰ª•‰∏ãÂá†Áßç: <strong>12</strong></p>
<ul>
<li>Âü∫Êú¨Á±ªÔºö<code>AtomicInteger</code>„ÄÅ <code>AtomicLong</code>„ÄÅ<code>AtomicBoolean</code>. </li>
<li>ÂºïÁî®Á±ªÂûãÔºö<code>AtomicReference</code>„ÄÅ<code>AtomicReference</code> ÁöÑABAÂÆû‰æã„ÄÅ<code>AtomicStampedReference</code>„ÄÅ<code>AtomicMarkableReference</code>.</li>
<li>Êï∞ÁªÑÁ±ªÂûãÔºö<code>AtomicIntegerArray</code>„ÄÅ<code>AtomicLongArray</code>„ÄÅ<code>AtomicReferenceArray</code>.</li>
<li>Â±ûÊÄßÂéüÂ≠ê‰øÆÊîπÂô®( Updater )Ôºö<code>AtomicIntegerFieldUpdater</code>„ÄÅ<code>AtomicLongFieldUpdater</code>„ÄÅ<br><code>AtomicReferenceFieldUpdater</code>.</li>
</ul>
<p>‚Äã        Êàë‰ª¨‰ª•ÂÖ∂‰∏≠‰∏Ä‰∏™‰∏∫‰ΩøÁî®‰æãÂ≠ê<code>AtomicInteger</code>.ÂÖ∂‰ΩôÁöÑÊñπÊ≥ïÂíå‰ΩøÁî®ÈÉΩÊòØÂ§ßÂêåÂ∞èÂºÇÁöÑÔºåÁõ∏ÂÖ≥ÁöÑÁ±ª‰ºö‰ªãÁªçÂÆÉ‰ª¨‰πãÈó¥ÁöÑÂå∫Âà´Âú®Âì™ÈáåÔºåÂú®‰ΩøÁî®‰∏≠ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÂú∞ÊñπÂç≥ÂèØ„ÄÇËÄå<code>AtomicInteger</code>Ëøô‰∏™Á±ªÔºåÁâπÂà´ÈÄÇÁî®‰∫éÈ´òÂπ∂ÂèëËÆøÈóÆ„ÄÇ<br>‚Äã        AtomicIntegerÁöÑ‰∏ªË¶ÅÊñπÊ≥ïÊúâÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//Ëé∑ÂèñÂΩìÂâçÁöÑÂÄº</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//ÂèñÂΩìÂâçÁöÑÂÄºÔºåÂπ∂ËÆæÁΩÆÊñ∞ÁöÑÂÄº</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> getAndSet <span class="token punctuation">(</span><span class="token keyword">int</span> newValue<span class="token punctuation">)</span>
<span class="token comment">//Ëé∑ÂèñÂΩìÂâçÁöÑÂÄºÔºåÂπ∂Ëá™Â¢û</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> getAndIncrement <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//Ëé∑ÂèñÂΩìÂâçÁöÑÂÄºÔºåÂπ∂Ëá™Âáè</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> getAndDecrement <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//Ëé∑ÂèñÂΩìÂâçÁöÑÂÄºÔºåÂπ∂Âä†‰∏äÈ¢ÑÊúüÁöÑÂÄº</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> getAndAdd <span class="token punctuation">(</span><span class="token keyword">int</span> delta<span class="token punctuation">)</span>
<span class="token comment">//Â¶ÇÊûúÂΩìÂâçÂÄº==È¢ÑÊúüÂÄºÔºåÂàôËá™Âä®Â∞ÜÂÄºËÆæÁΩÆ‰∏∫ÁªôÂÆöÁöÑÊõ¥Êñ∞ÂÄº„ÄÇ</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> expect<span class="token punctuation">,</span> <span class="token keyword">int</span> update<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‰ΩøÁî®ÊñπÊ≥ïÂ¶Ç‰∏ãÔºö</p>
<h4 id="No7-AtomicUseDemo-java"><a href="#No7-AtomicUseDemo-java" class="headerlink" title="No7_AtomicUseDemo.java"></a>No7_AtomicUseDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadsecurity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">AtomicInteger</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No7_AtomicUseDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">AtomicInteger</span> ai <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ai<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ai<span class="token punctuation">.</span><span class="token function">getAndSet</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ai<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ai<span class="token punctuation">.</span><span class="token function">getAndDecrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ai<span class="token punctuation">.</span><span class="token function">getAndAdd</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ai<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ai<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ai<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËæìÂá∫ÁöÑÁªìÊûú‰∏∫Ôºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">0</span>
<span class="token number">0</span>
<span class="token number">5</span>
<span class="token number">6</span>
<span class="token number">5</span>
<span class="token number">15</span>
<span class="token boolean">true</span>
<span class="token number">20</span>
<span class="token boolean">false</span>
<span class="token number">20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÂéüÂ≠êÊìç‰Ωú<code>atomic</code>ÁöÑÂÆûÁé∞ÂéüÁêÜÔºåÊòØÂà©Áî®CPUÁöÑÊØîËæÉÂπ∂‰∫§Êç¢(Âç≥<code>CAS:Compare and Swap</code>)ÂíåÈùûÈòªÂ°ûÁÆóÊ≥ï( <code>nonblocking algorithms</code>)Â¶ÇÊûúÊü•Áúã<code>AtormicInteger</code>ÁöÑÊ∫êÁ†ÅÁöÑËØù‰ºöÂèëÁé∞Êúâ‰∫õÊòØÈÄöËøáË∞ÉÁî®JNIÁöÑ‰ª£Á†ÅÂÆûÁé∞ÁöÑ„ÄÇ<code>JNI (Java Native Interface)</code> ‰∏∫JAVAÊú¨Âú∞Ë∞ÉÁî®ÔºåÂÖÅËÆ∏Java Ë∞ÉÁî®ÂÖ∂‰ªñËØ≠Ë®Ä„ÄÇËÄå<code>compareAndSwapInt</code>Â∞±ÊòØÂÄüÂä©CÊù•Ë∞ÉÁî®CPUÂ∫ïÂ±ÇÊåá‰ª§ÂÆûÁé∞ÁöÑ„ÄÇÂü∫‰∫é<code>JAVA CAS</code>ÂéüÁêÜÊ∑±Â∫¶ÂàÜÊûêËøôÈáåÂ∞±‰∏çÂ§öËØ¥‰∫ÜÔºåÊàë‰ª¨JavaÁ®ãÂ∫èÂëò‰∫ÜËß£‰∏Ä‰∫õÂ∞±Ë°å‰∫Ü„ÄÇ</p>
<h2 id="Á∫øÁ®ãÂÆâÂÖ®ÁöÑÈõÜÂêàÁ±ª"><a href="#Á∫øÁ®ãÂÆâÂÖ®ÁöÑÈõÜÂêàÁ±ª" class="headerlink" title="Á∫øÁ®ãÂÆâÂÖ®ÁöÑÈõÜÂêàÁ±ª"></a>Á∫øÁ®ãÂÆâÂÖ®ÁöÑÈõÜÂêàÁ±ª</h2><p>Áü•ËØÜÊòØÂ≠¶Âá∫Êù•ÁöÑ.ËÉΩÂäõÊòØÁªÉÂá∫Êù•ÁöÑ„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent15.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent15.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‰∏ÄËµ∑Áúã‰∏Ä‰∏ãJava‰∏≠Â∏∏Áî®ÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÈõÜÂêàÁ±ªÊúâÂì™‰∫õ,Âπ∂‰∏îÊù•‰∏ÄËµ∑ËÆ§ËØÜÂÆÉ„ÄÇ</p>
<h3 id="java-util-Hashtable"><a href="#java-util-Hashtable" class="headerlink" title="java.util.Hashtable"></a>java.util.Hashtable</h3><p>‚Äã        <code>Hashtable</code> Âíå <code>HashMap</code>‰∏ÄÊ†∑Ôºå<code>Hashtable</code>‰πüÊòØ‰∏Ä‰∏™Êï£ÂàóË°®ÔºåÂÆÉÂ≠òÂÇ®ÁöÑÂÜÖÂÆπÊòØÈîÆÂÄºÂØπ(<code>key-value</code>)Êò†Â∞Ñ„ÄÇ<br>‚Äã        <code>Hashtable</code>ÁªßÊâø‰∫é<code>Dictionary</code>ÔºåÂÆÉÂÆûÁé∞‰∫Ü<code>Map</code>„ÄÅ<code>Cloneable</code>„ÄÅ<code>java.io.Serializable</code>Êé•Âè£„ÄÇ<br>‚Äã        <code>Hashtable</code>ÁöÑÂÆû‰æãÊúâ‰∏§‰∏™ÂèÇÊï∞ÂΩ±ÂìçÂÖ∂ÊÄßËÉΩÔºöÂàùÂßãÂÆπÈáèÂíåÂä†ËΩΩÂõ†Â≠ê„ÄÇÂÆπÈáèÊòØÂìàÂ∏åË°®‰∏≠Ê°∂ÁöÑÊï∞ÈáèÔºåÂàùÂßãÂÆπÈáèÂ∞±ÊòØÂìàÂ∏åË°®ÂàõÂª∫Êó∂ÁöÑÂÆπÈáè„ÄÇÊ≥®ÊÑèÔºåÂìàÂ∏åË°®ÁöÑÁä∂ÊÄÅ‰∏∫ <strong>open</strong>„ÄÇÂú®ÂèëÁîü‚Äú<strong>ÂìàÂ∏åÂÜ≤Á™Å</strong>‚ÄùÁöÑÊÉÖÂÜµ‰∏ãÔºåÂçï‰∏™Ê°∂‰ºöÂ≠òÂÇ®Â§ö‰∏™Êù°ÁõÆÔºåËøô‰∫õÊù°ÁõÆÂøÖÈ°ªÊåâÈ°∫Â∫èÊêúÁ¥¢„ÄÇÂä†ËΩΩÂõ†Â≠êÊòØÂØπÂìàÂ∏åË°®Âú®ÂÖ∂ÂÆπÈáèËá™Âä®Â¢ûÂä†‰πãÂâçÂèØ‰ª•ËææÂà∞Â§öÊª°ÁöÑ‰∏Ä‰∏™Â∞∫Â∫¶„ÄÇÂàùÂßãÂÆπÈáèÂíåÂä†ËΩΩÂõ†Â≠êËøô‰∏§‰∏™ÂèÇÊï∞Âè™ÊòØÂØπËØ•ÂÆûÁé∞ÁöÑÊèêÁ§∫„ÄÇÂÖ≥‰∫é‰ΩïÊó∂‰ª•ÂèäÊòØÂê¶Ë∞ÉÁî®<code>rehash</code>ÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÁªÜËäÇÂàô‰æùËµñ‰∫éËØ•ÂÆûÁé∞„ÄÇ<br>‚Äã        ÈÄöÂ∏∏ÔºåÈªòËÆ§<strong>Âä†ËΩΩÂõ†Â≠ê</strong>ÊòØ<strong>0.75</strong>ÔºåËøôÊòØÂú®Êó∂Èó¥ÂíåÁ©∫Èó¥ÊàêÊú¨‰∏äÂØªÊ±Ç‰∏ÄÁßçÊäò‰∏≠„ÄÇÂä†ËΩΩÂõ†Â≠êËøáÈ´òËôΩÁÑ∂ÂáèÂ∞ë‰∫ÜÁ©∫Èó¥ÂºÄÈîÄÔºå‰ΩÜÂêåÊó∂‰πüÂ¢ûÂä†‰∫ÜÊü•ÊâæÊüê‰∏™Êù°ÁõÆÁöÑÊó∂Èó¥(Âú®Â§ßÂ§öÊï∞ <code>Hashtable</code>Êìç‰Ωú‰∏≠ÔºåÂåÖÊã¨ <code>get</code>Âíå<code>put</code>Êìç‰ΩúÔºåÈÉΩÂèçÊò†‰∫ÜËøô‰∏ÄÁÇπ)„ÄÇ<br>‚Äã        <code>Hashtable</code> ÁöÑ<strong>ÂáΩÊï∞ÈÉΩÊòØÂêåÊ≠•ÁöÑ</strong>ÔºåËøôÊÑèÂë≥ÁùÄÂÆÉÊòØ<strong>Á∫øÁ®ãÂÆâÂÖ®</strong>ÁöÑ„ÄÇÂÆÉÁöÑ <code>key„ÄÅvalue</code>ÈÉΩ<strong>‰∏çÂèØ‰ª•‰∏∫null</strong>„ÄÇÊ≠§Â§ñÔºå**<code>Hashtable</code>‰∏≠ÁöÑÊò†Â∞Ñ‰∏çÊòØÊúâÂ∫èÁöÑ**„ÄÇ</p>
<p>‚Äã        <strong>ÈÇ£‰πàHashtable Â¶Ç‰Ωï‰øùËØÅÁ∫øÁ®ãÂÆâÂÖ®ÊÄßÁöÑÂë¢?‰∏ãÈù¢ÊòØ HashtableÁöÑÊ∫êÁ†Å:</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hashtable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token keyword">extends</span> <span class="token class-name">Dictionary</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">,</span><span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
        <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">]</span> table<span class="token punctuation">;</span>

		<span class="token keyword">public</span> <span class="token keyword">synchronized</span> v get <span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">Entry</span> tab<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span>table<span class="token punctuation">;</span><span class="token comment">//Ê≠§Â§ÑÁúÅÁï•,ÂÖ∑‰ΩìÁöÑÂÆûÁé∞Ë∞êÂèÇËÄÉjdk ÂÆûÁé∞</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">synchronized</span> v <span class="token function">put</span><span class="token punctuation">(</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span>v value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token operator">--</span><span class="token operator">-</span><span class="token comment">//ÂÖ∑‰ΩìÂÆûÁé∞ÁúÅÁï•,ËØ∑ÂèÇËÄÉjdkÂÆûÁé∞</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">synchronized</span> v <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token operator">--</span><span class="token operator">-</span><span class="token comment">//ÂÖ∑‰ΩìÂÆûÁé∞ÁúÅÁï•,ËØ∑ÂèÇËÄÉjdkÂÆûÁé∞</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">putAll</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span> <span class="token punctuation">></span></span> t<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">></span></span>e<span class="token operator">:</span> t<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                put <span class="token punctuation">(</span>e<span class="token punctuation">.</span>getKey0<span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getvalue</span><span class="token punctuation">(</span><span class="token class-name">O</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token operator">--</span><span class="token operator">-</span><span class="token comment">//ÂÖ∑‰ΩìÂÆûÁé∞ÁúÅÁï•,ËØ∑ÂèÇËÄÉjdkÂÆûÁé∞ </span>
        <span class="token punctuation">&#125;</span>
                <span class="token comment">//---</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰∏äÈù¢ÊòØ <code>Hashtable</code>Êèê‰æõÁöÑÂá†‰∏™‰∏ªË¶ÅÊñπÊ≥ï,ÂåÖÊã¨ <code>get()</code>„ÄÅ<code>put()</code>„ÄÅ<code>remove()</code>Á≠â„ÄÇÊ≥®ÊÑèÂà∞ÊØè‰∏™ÊñπÊ≥ïÊú¨Ë∫´ÈÉΩÊòØ <code>synchronized</code> ÁöÑ,‰∏ç‰ºöÂá∫Áé∞‰∏§‰∏™Á∫øÁ®ãÂêåÊó∂ÂØπÊï∞ÊçÆËøõË°åÊìç‰ΩúÁöÑÊÉÖÂÜµÔºåÂõ†Ê≠§‰øùËØÅ‰∫ÜÁ∫øÁ®ãÂÆâÂÖ®ÊÄß„ÄÇ<br>‚Äã        <code>Hashtable</code>ÁöÑ‰∏ªË¶ÅÂØπÂ§ñÊé•Âè£Ôºö</p>
<ul>
<li><code>clear()</code>ÁöÑ‰ΩúÁî®ÊòØÊ∏ÖÁ©∫<code>Hashtable</code>„ÄÇÂÆÉÊòØÂ∞Ü<code>Hashtable</code>ÁöÑ <code>table</code>Êï∞ÁªÑÁöÑÂÄºÂÖ®ÈÉ®ËÆæ‰∏∫<code>null</code>.</li>
<li><code>contains()</code>Âíå<code>containsValue()</code>ÁöÑ‰ΩúÁî®ÈÉΩÊòØÂà§Êñ≠<code>Hashtable</code>ÊòØÂê¶ÂåÖÂê´‚ÄúÂÄº(<code>value</code>)‚Äù.</li>
<li><code>containsKey()</code> ÁöÑ‰ΩúÁî®ÊòØÂà§Êñ≠<code>Hashtable</code>ÊòØÂê¶ÂåÖÂê´<code>key</code>.</li>
<li><code>elements()</code>ÁöÑ‰ΩúÁî®ÊòØËøîÂõû‚ÄúÊâÄÊúâ<code>value</code>‚ÄùÁöÑÊûö‰∏æÂØπË±°.</li>
<li><code>Enumerator</code>ÁöÑ‰ΩúÁî®ÊòØÊèê‰æõ‰∫Ü‚ÄúÈÄöËøá<code>elements()</code>ÈÅçÂéÜ<code>Hashtable</code>ÁöÑÊé•Âè£‚Äù„ÄÇÂõ†‰∏∫ÔºåÂÆÉÂêåÊó∂ÂÆûÁé∞‰∫Ü‚Äú<code>Enumerator</code>Êé•Âè£‚ÄùÂíå‚Äú<code>Iterator</code>Êé•Âè£‚Äù.</li>
<li><code>entrySet()</code>„ÄÅ<code>keySet()</code>„ÄÅ<code>keys()</code>„ÄÅ<code>values()</code>ÁöÑÂÆûÁé∞ÊñπÊ≥ïÂíå<code>elements()</code>Â∑Æ‰∏çÂ§öÔºåËÄå‰∏îÊ∫êÁ†Å‰∏≠Â∑≤ÁªèÊòéÁ°ÆÂú∞ÁªôÂá∫‰∫ÜÊ≥®Èáä„ÄÇËøôÈáåÂ∞±‰∏çÂÜçÂÅöËøáÂ§öËØ¥Êòé‰∫Ü.</li>
<li><code>get()</code>ÁöÑ‰ΩúÁî®Â∞±ÊòØËé∑Âèñ<code>key</code>ÂØπÂ∫îÁöÑ <code>value</code>ÔºåÊ≤°ÊúâÁöÑËØùËøîÂõû<code>null</code>.</li>
<li><code>put()</code>ÁöÑ‰ΩúÁî®ÊòØÂØπÂ§ñÊèê‰æõÊé•Âè£ÔºåËÆ© <code>Hashtable</code>ÂØπË±°ÂèØ‰ª•ÈÄöËøá <code>put()</code>Â∞Ü‚Äú<code>key-value</code>‚ÄùÊ∑ªÂä†Âà∞<code>Hashtable</code>‰∏≠</li>
<li><code>putAll()</code>ÁöÑ‰ΩúÁî®ÊòØÂ∞Ü‚Äú<code>Map(t)</code>‚Äù‰∏≠ÁöÑÂÖ®ÈÉ®ÂÖÉÁ¥†ÈÄê‰∏ÄÊ∑ªÂä†Âà∞<code>Hashtable</code>‰∏≠.</li>
<li><code>remove()</code>ÁöÑ‰ΩúÁî®Â∞±ÊòØÂà†Èô§<code>Hashtable</code>‰∏≠ÈîÆ‰∏∫keyÁöÑÂÖÉÁ¥†.</li>
</ul>
<p>‚Äã        <code>Hashtable</code>ÂÆûÁé∞ÁöÑ<code>Cloneable</code>Êé•Âè£ÔºåÂç≥ÂÆûÁé∞‰∫Ü<code>clone()</code>ÊñπÊ≥ï„ÄÇ<code>clone()</code>ÊñπÊ≥ïÁöÑ‰ΩúÁî®ÂæàÁÆÄÂçïÔºåÂ∞±ÊòØÂÖãÈöÜ‰∏Ä‰∏™ <code>Hashtable</code>ÂØπË±°Âπ∂ËøîÂõû„ÄÇ<br>‚Äã        <code>Hashtable</code> ÂÆûÁé∞ÁöÑ<code>Serializable</code>Êé•Âè£ÂàÜÂà´ÂÆûÁé∞‰∫Ü‰∏≤Ë°åËØªÂèñ„ÄÅÂÜôÂÖ•ÂäüËÉΩ„ÄÇ</p>
<p>‚Äã        <code>Hashtable</code>ÁöÑ‰ΩøÁî®ÂÆû‰æãÂ¶Ç‰∏ãÔºö</p>
<h4 id="No1-HashtableDemo-java"><a href="#No1-HashtableDemo-java" class="headerlink" title="No1_HashtableDemo.java"></a>No1_HashtableDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>thread_safe_collection_class</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Hashtable</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No1_HashtableDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Hashtable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> numbers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hashtable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        numbers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        numbers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        numbers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> n <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"two ="</span> <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="java-util-concurrent-ConcurrentHashMap"><a href="#java-util-concurrent-ConcurrentHashMap" class="headerlink" title="java.util.concurrent.ConcurrentHashMap"></a>java.util.concurrent.ConcurrentHashMap</h3><p>‚Äã        <code>ConcurrentHashMap</code>ÁªßÊâø‰∫é<code>AbstractMap</code>ÔºåÂÆûÁé∞‰∫Ü<code>Map</code>„ÄÅ<code>java.io.Serializable</code>Êé•Âè£„ÄÇ<br>‚Äã        <code>Concurrent.ConcurrentHashMap</code>ÊòØ<strong>Âπ∂ÂèëÁºñÁ®ãÂ§ßÂ∏à Doug Lea</strong> ÁöÑ‰ΩúÂìÅ„ÄÇËøôÊòØ <code>HashMap</code> ÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÁâàÔºåÂêå <code>Hashtable</code>Áõ∏ÊØîÔºå<code>ConcurrentHashMap</code>‰∏ç‰ªÖ‰øùËØÅ‰∫ÜËÆøÈóÆÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÊÄßÔºåËÄå‰∏îÂú®ÊïàÁéá‰∏ä‰∏é<code>Hashtable</code>Áõ∏ÊØîÔºåÊúâËæÉÂ§ßÁöÑÊèêÈ´ò„ÄÇ<code>ConcurrentHashMap</code> ÂÖÅËÆ∏Â§ö‰∏™‰øÆÊîπÊìç‰ΩúÂπ∂ÂèëËøõË°åÔºåÂÖ∂ÂÖ≥ÈîÆÂú®‰∫é‰ΩøÁî®‰∫ÜÈîÅÂàÜÁ¶ªÊäÄÊúØ,Âç≥‰ª£Á†ÅÂùóÈîÅÔºåËÄå‰∏çÊòØÊñπÊ≥ïÈîÅ„ÄÇÂÆÉ‰ΩøÁî®‰∫ÜÂ§ö‰∏™ÈîÅÊù•ÊéßÂà∂ÂØπhash Ë°®ÁöÑ‰∏çÂêåÈÉ®ÂàÜËøõË°åÁöÑ‰øÆÊîπ„ÄÇ<code>ConcurrentHashMap</code>ÂÜÖÈÉ®‰ΩøÁî®ÊÆµ(<code>Segment</code>)Êù•Ë°®Á§∫Ëøô‰∫õ‰∏çÂêåÁöÑÈÉ®ÂàÜÔºåÊØè‰∏™ÊÆµÂÖ∂ÂÆûÂ∞±ÊòØ‰∏Ä‰∏™Â∞èÁöÑ<code>hash table</code>ÔºåÂÆÉ‰ª¨ÊúâËá™Â∑±ÁöÑÈîÅ(Áî±<code>ReentrantLock</code>Êù•ÂÆûÁé∞ÁöÑ)„ÄÇÂè™Ë¶ÅÂ§ö‰∏™‰øÆÊîπÊìç‰ΩúÂèëÁîüÂú®‰∏çÂêåÁöÑÊÆµ‰∏äÔºåÂÆÉ‰ª¨Â∞±ÂèØ‰ª•Âπ∂ÂèëËøõË°å„ÄÇ<br>‚Äã        <code>ConcurrentHashMap</code>ÁöÑÈÉ®ÂàÜÊ∫êÁ†ÅÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
	<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">ReentrantLock</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">2249069246763182397L</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">;</span>
        <span class="token class-name">Segment</span><span class="token punctuation">(</span><span class="token keyword">float</span> lf<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> lf<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        <code>ConcurrentHashMap</code>Â∏∏Áî®ÁöÑ‰∏ªË¶ÅÂØπÂ§ñÊé•Âè£Ôºö</p>
<ul>
<li><p><code>clear()</code>ÁöÑ‰ΩúÁî®ÊòØÊ∏ÖÁ©∫<code>ConcurrentHashMap</code>„ÄÇ</p>
</li>
<li><p><code>contains()</code>Âíå<code>containsValue()</code>ÁöÑ‰ΩúÁî®ÈÉΩÊòØÂà§Êñ≠<code>ConcurrentHashMap</code>ÊòØÂê¶ÂåÖÂê´‚Äú**ÂÄº(<code>value</code>)**‚Äù„ÄÇ</p>
</li>
<li><p><code>containsKey()</code>ÁöÑ‰ΩúÁî®ÊòØÂà§Êñ≠<code>ConcurrentHashMap</code>ÊòØÂê¶ÂåÖÂê´key„ÄÇ</p>
</li>
<li><p><code>elements()</code>ÁöÑ‰ΩúÁî®ÊòØËøîÂõû‚Äú<strong>ÊâÄÊúâvalue</strong>‚ÄùÁöÑÊûö‰∏æÂØπË±°„ÄÇ</p>
</li>
<li><p><code>Enumerator</code> ÁöÑ‰ΩúÁî®ÊòØÊèê‰æõ‰∫Ü‚ÄúÈÄöËøá<code>elements()</code>ÈÅçÂéÜ<code>Hashtable</code>ÁöÑÊé•Âè£‚ÄùÂíå‚ÄúÈÄöËøá<code>entrySet()</code>ÈÅçÂéÜ<code>ConcurrentHashMap</code>ÁöÑÊé•Âè£‚Äù„ÄÇ<strong>Âõ†‰∏∫ÔºåÂÆÉÂêåÊó∂ÂÆûÁé∞‰∫Ü‚Äú<code>EnumeratorÊé•Âè£</code>‚ÄùÂíå‚Äú<code>IteratorÊé•Âè£</code>‚Äù„ÄÇ</strong></p>
</li>
<li><p><code>entrySet()</code>„ÄÅ<code>keySet()</code>„ÄÅ<code>keys()</code>„ÄÅ <code>values()</code>ÁöÑÂÆûÁé∞ÊñπÊ≥ïÂíå<code>elements()</code>Â∑Æ‰∏çÂ§öÔºåËÄå‰∏îÊ∫êÁ†Å‰∏≠Â∑≤ÁªèÊòéÁ°ÆÂú∞ÁªôÂá∫‰∫ÜÊ≥®Èáä,ËøôÈáåÂ∞±‰∏çÂÜçÂÅöËøáÂ§öËØ¥Êòé‰∫Ü„ÄÇ</p>
</li>
<li><p><code>get()</code>ÁöÑ‰ΩúÁî®Â∞±ÊòØËé∑Âèñ<strong>key</strong>ÂØπÂ∫îÁöÑ <strong>value</strong>ÔºåÊ≤°ÊúâÁöÑËØùËøîÂõû<strong>null</strong>„ÄÇ</p>
</li>
<li><p><code>put()</code>ÁöÑ‰ΩúÁî®ÊòØÂØπÂ§ñÊèê‰æõÊé•Âè£ÔºåËÆ© <code>ConcurrentHashMap</code>ÂØπË±°ÂèØ‰ª•ÈÄöËøá<code>put()</code>Â∞Ü‚Äú<code>key-value</code>‚ÄùÊ∑ªÂä†Âà∞ <code>ConcurrentHashMap</code>‰∏≠„ÄÇ</p>
</li>
<li><p><code>putAll()</code>ÁöÑ‰ΩúÁî®ÊòØÂ∞Ü‚Äú<code>Map(t)</code>‚Äù‰∏≠ÁöÑ<strong>ÂÖ®ÈÉ®ÂÖÉÁ¥†</strong>ÈÄê‰∏ÄÊ∑ªÂä†Âà∞<code>ConcurrentHashMap</code>‰∏≠„ÄÇ</p>
</li>
<li><p><code>remove()</code>ÁöÑ‰ΩúÁî®Â∞±ÊòØ<strong>Âà†Èô§</strong><code>ConcurrentHashMap</code>‰∏≠ÈîÆ‰∏∫<strong>key</strong> ÁöÑÂÖÉÁ¥†„ÄÇ</p>
<p><code>ConcurrentHashMap</code> ÂÆûÁé∞ÁöÑ<code>Serializable</code>Êé•Âè£ÂàÜÂà´ÂÆûÁé∞‰∫Ü<strong>‰∏≤Ë°åËØªÂèñ„ÄÅÂÜôÂÖ•</strong>ÂäüËÉΩ„ÄÇ</p>
<p><code>ConcurrentHashMap</code>‰ΩøÁî®ÂÆû‰æãÂ¶Ç‰∏ãÔºö</p>
</li>
</ul>
<h4 id="No2-ConcurrentHashMapDemo-java"><a href="#No2-ConcurrentHashMapDemo-java" class="headerlink" title="No2_ConcurrentHashMapDemo.java"></a>No2_ConcurrentHashMapDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>thread_safe_collection_class</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ConcurrentHashMap</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No2_ConcurrentHashMapDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="java-util-concurrent-CopyOnWriteArrayList"><a href="#java-util-concurrent-CopyOnWriteArrayList" class="headerlink" title="java.util.concurrent.CopyOnWriteArrayList"></a>java.util.concurrent.CopyOnWriteArrayList</h3><p>‚Äã        <code>CopyOnWriteArrayList</code> ‰∏≠ÁöÑ<code>set</code>„ÄÅ<code>add</code>„ÄÅ<code>remove</code>Á≠âÊñπÊ≥ïÔºåÈÉΩ‰ΩøÁî®‰∫Ü<code>ReentrantLock</code> ÁöÑ <code>lock()</code>Êù•Âä†ÈîÅÔºå<code>unlock()</code>Êù•Ëß£ÈîÅ„ÄÇÂΩìÂ¢ûÂä†ÂÖÉÁ¥†ÁöÑÊó∂ÂÄô‰ΩøÁî®<code>Arrays.copyOf()</code>Êù•<strong>Êã∑Ë¥ù</strong>ÂâØÊú¨ÔºåÂú®ÂâØÊú¨‰∏äÂ¢ûÂä†ÂÖÉÁ¥†ÔºåÁÑ∂ÂêéÊîπÂèòÂéüÂºïÁî®ÊåáÂêëÂâØÊú¨„ÄÇËØªÊìç‰Ωú‰∏çÈúÄË¶ÅÂä†ÈîÅÔºåËÄåÂÜôÊìç‰ΩúÁ±ªÂÆûÁé∞‰∏≠ÂØπÂÖ∂ËøõË°å‰∫ÜÂä†ÈîÅ„ÄÇÂõ†Ê≠§Ôºå<code>CopyOnWriteArrayList</code> Á±ªÊòØ‰∏Ä‰∏™Á∫øÁ®ãÂÆâÂÖ®ÁöÑ <code>List</code>Êé•Âè£ÁöÑÂÆûÁé∞ÔºåËøôÂØπ‰∫éËØªÊìç‰ΩúËøúËøúÂ§ö‰∫éÂÜôÊìç‰ΩúÁöÑÂ∫îÁî®ÈùûÂ∏∏ÈÄÇÂêà„ÄÇÁâπÂà´ÊòØÂú®Âπ∂ÂèëÊÉÖÂÜµ‰∏ãÔºåÂèØ‰ª•Êèê‰æõÈ´òÊÄßËÉΩÁöÑÂπ∂ÂèëËØªÂèñÔºåÂπ∂‰∏î‰øùËØÅËØªÂèñÁöÑÂÜÖÂÆπ‰∏ÄÂÆöÊòØÊ≠£Á°ÆÁöÑ,‰∏çÂèóÂ§öÁ∫øÁ®ãÂπ∂ÂèëÈóÆÈ¢òÂΩ±ÂìçÁöÑ„ÄÇ<br>‚Äã        ‰∏îÁúã<code>CopyOnWriteArrayList</code>ÈÉ®ÂàÜÊ∫êÁ†Å,ÂÖ∂‰∏≠ÁöÑ‰∏Ä‰∏™ÁÆÄÂçï<code>add</code>ÊñπÊ≥ïÁöÑÂÆûÁé∞:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">RandomAccess</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">final</span> <span class="token keyword">transient</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">;</span>
    
    	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span><span class="token comment">//Âä†ÈîÅÁöÑÂÆâÂÖ®Êú∫Âà∂</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> len <span class="token operator">=</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
                <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newElements <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                newElements<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
                <span class="token function">setArray</span><span class="token punctuation">(</span>newElements<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">//finally ÈáåÈù¢ÈáäÊîæÈîÅ</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    
        <span class="token comment">//getÊñπÊ≥ïÊ≤°ÊúâÂä†ÈîÅ</span>
        <span class="token keyword">private</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>‚Äã        <code>CopyOnWriteArrayList</code>‰∏ªË¶ÅÁöÑÂ∏∏Áî®ÁöÑÊñπÊ≥ïÊúâÔºö</p>
<ul>
<li><code>boolean add(E e)</code>ÔºåÂú®<code>list</code>Êú´Â∞æÊ∑ªÂä†‰∏Ä‰∏™ÂÖÉÁ¥†„ÄÇ</li>
<li><code>void add(int indexÔºåE element)</code>ÔºåÂú®ÊåáÂÆö‰ΩçÁΩÆÊ∑ªÂä†ÂÖÉÁ¥†„ÄÇ</li>
<li><code>boolean addAll(Collection&lt;? extends E&gt;c)</code>ÔºåÂú®Â∞æÈÉ®Â¢ûÂä†Êï¥‰∏™ <code>Collection</code>ÂØπË±°„ÄÇ</li>
<li><code>boolean addAll(int indexÔºå Collection&lt;? extends E&gt; c)</code>ÔºåÂú®Á¥¢ÂºïÊåáÂÆöÁöÑ‰ΩçÁΩÆÊèíÂÖ•<code>Collection</code>ÂØπË±°Âπ∂ÁßªÂä®Âéü‰ΩçÁΩÆÔºàÂ¶ÇÊûúÊúâÁöÑËØùÔºâÁöÑÂØπË±°„ÄÇ</li>
<li><code>void clear()</code>ÔºåÊ∏ÖÁ©∫<code>list</code>ÈõÜÂêà„ÄÇ</li>
<li><code>Object clone()</code>ÔºåÁî±‰∫éÂÆûÁé∞‰∫Ü<code>Cloneable</code>Êé•Âè£ÔºåÊâÄ‰ª•ÊîØÊåÅÂÖãÈöÜ„ÄÇ</li>
<li><code>boolean contains(Object o)</code>ÔºåÊòØÂê¶ÂåÖÂê´ÊåáÂÆöÂÖÉÁ¥†„ÄÇ</li>
<li><code>E get(int index)</code>ÔºåËé∑ÂæóÊåáÂÆö‰ΩçÁΩÆÁöÑÂÖÉÁ¥†„ÄÇ</li>
<li><code>boolean isEmpty()</code>ÔºåÂçäÊÆµÈõÜÂêàÊòØÂê¶ÊòØÁ©∫ÁöÑ„ÄÇ</li>
<li><code>Iterator&lt;E&gt; iterator()</code>ÁöÑ‰ΩúÁî®ÊòØÊèê‰æõ‰∫Ü‚ÄúÈÄöËøá <code>elements()</code>ÈÅçÂéÜ„ÄÇÂõ†‰∏∫ÔºåÂÆÉÂêåÊó∂ÂÆûÁé∞‰∫Ü‚Äú<code>Enumerator</code>Êé•Âè£‚ÄùÂíå‚Äú<code>Iterator</code>Êé•Âè£‚Äù„ÄÇ</li>
<li><code>ListIterator&lt;E&gt; listIterator()</code>ÁöÑ‰ΩúÁî®ÊòØÊèê‰æõ‰∫Ü‚ÄúÈÄöËøá<code>elements()</code>ÈÅçÂéÜ„ÄÇÂõ†‰∏∫ÔºåÂÆÉÂêåÊó∂ÂÆûÁé∞‰∫Ü‚Äú<code>Enumerator</code>Êé•Âè£‚ÄùÂíå‚Äú<code>Iterator</code>Êé•Âè£‚Äù„ÄÇ</li>
<li><code>E remove(int index)</code>ÔºåÂà†Èô§ÊåáÂÆöÂÖÉÁ¥†„ÄÇ</li>
<li><code>&lt;T&gt; T[] toArray(T a[])</code>ÔºåÂ∞ÜÈõÜÂêàËΩ¨Êç¢ÊàêÊï∞ÁªÑ„ÄÇ</li>
</ul>
<p><code>CopyOnWriteArrayList</code>ÁÆÄÂçïÁöÑ‰ΩøÁî®ÂÆû‰æãÂ¶Ç‰∏ãÔºö</p>
<h4 id="No3-CopyOnWriteArrayListDemo-java"><a href="#No3-CopyOnWriteArrayListDemo-java" class="headerlink" title="No3_CopyOnWriteArrayListDemo.java"></a>No3_CopyOnWriteArrayListDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>thread_safe_collection_class</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CopyOnWriteArrayList</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No3_CopyOnWriteArrayListDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//list‰∏ãÊ†áÊòØ‰ªéÈõ∂ÂºÄÂßãÁöÑ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> iterator <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">two
one
two
three<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="java-util-concurrent-CopyOnWriteArraySet"><a href="#java-util-concurrent-CopyOnWriteArraySet" class="headerlink" title="java.util.concurrent.CopyOnWriteArraySet"></a>java.util.concurrent.CopyOnWriteArraySet</h3><p>‚Äã        <code>CopyOnWriteArraySet</code> ÊòØÂú® <code>CopyOnWriteArrayList</code> ÁöÑÂü∫Á°Ä‰∏ä‰ΩøÁî®‰∫Ü<code>Java</code>ÁöÑ<strong>Ë£ÖÈ•∞Ê®°Âºè</strong>ÔºåÂæàÂ§öÊñπÊ≥ïÂ¶ÇÔºöÂÇ®Â≠ò‰ªãË¥®‰ΩøÁî®‰∫Ü<code>CopyOnWriteArrayList</code> Êù•Â≠òÂÇ®Êï∞ÊçÆ, <code>remove</code>ÊñπÊ≥ïË∞ÉÁî®<code>CopyOnWriteArrayList</code>ÁöÑ<code>remove</code>ÊñπÊ≥ïÔºå<code>add</code>ÊñπÊ≥ïË∞ÉÁî®‰∫Ü<code>CopyOnWriteArrayList</code> ÁöÑ <code>addIfAbsent</code> ÊñπÊ≥ï„ÄÇÊâÄ‰ª•<code>CopyOnWriteArrayList</code> ÁöÑÂÆûÁé∞ÂéüÁêÜÈÄÇÁî®<code>CopyOnWriteArraySet</code>„ÄÇ<br>‚Äã        ‰∏îÁúã<code>CopyOnWriteArraySet</code>ÁöÑ‰∏ÄÊÆµÊ∫êÁ†Å:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CopyOnWriteArraySet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
        <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//ÁúãÁöÑÂá∫Êù•Â§ßÈÉ®ÂàÜÈÉΩÊòØË∞ÉÁî®Copy0nwriteArrayListÁöÑAPI ÂÆûÁé∞ÁöÑ</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> al<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">CopyOnWriteArraySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        al <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        al<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> al<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> al<span class="token punctuation">.</span><span class="token function">addIfAbsent</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    ‚Ä¶<span class="token comment">//Â§ßÈÉ®ÂàÜ‰ª£Á†ÅÁöÜÊòØÂ¶ÇÊ≠§</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        <code>CopyOnWriteArraySet</code>‰∏ªË¶ÅÁöÑÂ∏∏Áî®ÊñπÊ≥ïÊúâ:</p>
<ul>
<li><code>boolean add(E e)</code>ÔºåÂú® <code>list</code>Êú´Â∞æÊ∑ªÂä†‰∏Ä‰∏™ÂÖÉÁ¥†„ÄÇ</li>
<li><code>boolean addAll(Collection&lt;? extends E&gt; c)</code>ÔºåÂú®Â∞æÈÉ®Â¢ûÂä†Êï¥‰∏™<code>Collection</code>ÂØπË±°„ÄÇ</li>
<li><code>void clear()</code>ÔºåÊ∏ÖÁ©∫<code>list</code>ÈõÜÂêà„ÄÇ</li>
<li><code>boolean contains(Object o)</code>ÔºåÊòØÂê¶ÂåÖÂê´ÊåáÂÆöÂÖÉÁ¥†„ÄÇ</li>
<li><code>boolean isEmpty()</code>ÔºåÂà§Êñ≠ÈõÜÂêàÊòØÂê¶Á©∫ÁöÑ„ÄÇ</li>
<li><code>Iterator&lt;E&gt; iterator()</code>ÁöÑ‰ΩúÁî®ÊòØÊèê‰æõ‰∫ÜÂØπ<code>elements()</code>ÈÅçÂéÜ„ÄÇÂõ†‰∏∫ÔºåÂÆÉÂêåÊó∂ÂÆûÁé∞‰∫Ü‚Äú<code>Enumerator</code>Êé•Âè£‚ÄùÂíå‚Äú<code>Iterator</code>Êé•Âè£‚Äù„ÄÇ</li>
<li><code>E remove(int index)</code>ÔºåÂà†Èô§ÊåáÂÆöÂÖÉÁ¥†„ÄÇ</li>
<li><code>&lt;T&gt; T[] toArray(T a[])</code>ÔºåÂ∞ÜÈõÜÂêàËΩ¨Êç¢ÊàêÊï∞ÁªÑ„ÄÇ</li>
</ul>
<p>‚Äã        <code>CopyOnWriteArraySet</code>ÁÆÄÂçïÁöÑ‰ΩøÁî®ÂÆû‰æãÂ¶Ç‰∏ãÔºö</p>
<h4 id="No4-CopyOnWriteArraySetDemo-java"><a href="#No4-CopyOnWriteArraySetDemo-java" class="headerlink" title="No4_CopyOnWriteArraySetDemo.java"></a>No4_CopyOnWriteArraySetDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>thread_safe_collection_class</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CopyOnWriteArraySet</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No4_CopyOnWriteArraySetDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">CopyOnWriteArraySet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArraySet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> iterator <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        <strong>Java</strong>ÈáåÈù¢<code>List</code>Âíå<code>Set</code>ÁöÑÁõ∏ÂêåÂíåÂå∫Âà´ÂêåÊ†∑ÈÄÇÁî®‰∫é<code>CopyOnWriteArrayList</code>Âíå<code>CopyOnWriteArraySet</code> <strong>‰∏çÂêå‰πãÂ§ÑÊòØÂêé‰∏§ËÄÖÊòØÁ∫øÁ®ãÂÆâÂÖ®Êú∫Âà∂„ÄÇ</strong></p>
<h3 id="CopyOnWriteÊú∫Âà∂‰ªãÁªç"><a href="#CopyOnWriteÊú∫Âà∂‰ªãÁªç" class="headerlink" title="CopyOnWriteÊú∫Âà∂‰ªãÁªç"></a>CopyOnWriteÊú∫Âà∂‰ªãÁªç</h3><p>‚Äã        <code>CopyOnWrite</code>ÂÆπÂô®Âç≥ÂÜôÊó∂Â§çÂà∂ÁöÑÂÆπÂô®„ÄÇÈÄö‰øóÁöÑÁêÜËß£ÊòØÂΩìÊàë‰ª¨ÂæÄ‰∏Ä‰∏™ÂÆπÂô®Ê∑ªÂä†ÂÖÉÁ¥†ÁöÑÊó∂ÂÄôÔºå‰∏çÁõ¥Êé•ÂæÄÂΩìÂâçÂÆπÂô®Ê∑ªÂä†ÔºåËÄåÊòØÂÖàÂ∞ÜÂΩìÂâçÂÆπÂô®ËøõË°å<strong>Copy</strong>ÔºåÂ§çÂà∂Âá∫‰∏Ä‰∏™Êñ∞ÁöÑÂÆπÂô®ÔºåÁÑ∂ÂêéÊñ∞ÁöÑÂÆπÂô®ÈáåÊ∑ªÂä†ÂÖÉÁ¥†ÔºåÊ∑ªÂä†ÂÆåÂÖÉÁ¥†‰πãÂêéÔºåÂÜçÂ∞ÜÂéüÂÆπÂô®ÁöÑÂºïÁî®ÊåáÂêëÊñ∞ÁöÑÂÆπÂô®„ÄÇËøôÊ†∑ÂÅöÁöÑÂ•ΩÂ§ÑÊòØÊàë‰ª¨ÂèØ‰ª•ÂØπ<code>CopyOnWrite</code>ÂÆπÂô®ËøõË°åÂπ∂ÂèëÂú∞ËØªÔºåËÄå‰∏çÈúÄË¶ÅÂä†ÈîÅÔºåÂõ†‰∏∫ÂΩìÂâçÂÆπÂô®‰∏ç‰ºöÊ∑ªÂä†‰ªª‰ΩïÂÖÉÁ¥†„ÄÇÊâÄ‰ª•<code>CopyOnWrite</code>ÂÆπÂô®‰πüÊòØ‰∏ÄÁßçËØªÂÜôÂàÜÁ¶ªÁöÑÊÄùÊÉ≥ÔºåËØªÂíåÂÜô‰∏çÂêåÁöÑÂÆπÂô®„ÄÇ<br>‚Äã        Êàë‰ª¨‰ªé <code>CopyOnWriteArrayList</code>‰πãÂâçÁöÑÂàÜÊûêÂíåÊ∫êÁ†Å‰∏≠ÂèØ‰ª•ÁúãÂæóÂá∫Êù•Ôºå<code>ArrayList</code>ÈáåÊ∑ªÂä†ÂÖÉÁ¥†,ÂèØ‰ª•ÂèëÁé∞Âú®Ê∑ªÂä†ÁöÑÊó∂ÂÄôÊòØÈúÄË¶ÅÂä†ÈîÅÁöÑÔºåÂê¶ÂàôÂ§öÁ∫øÁ®ãÂÜôÁöÑÊó∂ÂÄô‰ºö<code>Copy</code>Âá∫<strong>N</strong>‰∏™ÂâØÊú¨Âá∫Êù•„ÄÇ<br>‚Äã        ËØªÁöÑÊó∂ÂÄô‰∏çÈúÄË¶ÅÂä†ÈîÅÔºåÂ¶ÇÊûúËØªÁöÑÊó∂ÂÄôÊúâÂ§ö‰∏™Á∫øÁ®ãÊ≠£Âú®Âêë<code>ArrayList</code>Ê∑ªÂä†Êï∞ÊçÆÔºåËøòÊòØ‰ºöËØªÂà∞ÊóßÁöÑÊï∞ÊçÆ,Âõ†‰∏∫ÂÜôÁöÑÊó∂ÂÄô‰∏ç‰ºöÈîÅ‰ΩèÊóßÁöÑ<code>ArrayList</code>„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> get <span class="token punctuation">(</span>getArray o<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        JDK‰∏≠Âπ∂Ê≤°ÊúâÊèê‰æõ<code>CopyOnWriteMap</code>ÔºåÊàë‰ª¨ÂèØ‰ª•ÂèÇËÄÉ<code>CopyOnWriteArrayList</code> Êù•ÂÆûÁé∞‰∏Ä‰∏™ÔºåÂü∫Êú¨‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>collection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CopyOnWriteMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>internalMap<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token class-name">CopyOnWriteMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		internalMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token keyword">public</span> v <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> v value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span>v<span class="token punctuation">></span></span> newMap<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>internalMap<span class="token punctuation">)</span> <span class="token punctuation">;</span>
			<span class="token class-name">V</span> val <span class="token operator">=</span> newMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
			internalMap <span class="token operator">=</span> newMap<span class="token punctuation">;</span>
			<span class="token keyword">return</span> val<span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token keyword">public</span> v get <span class="token punctuation">(</span><span class="token number">0</span>bject key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> internalMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">putAll</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> extendo v<span class="token punctuation">></span></span> nowData<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> newMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>internalMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
			newMap<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>newData<span class="token punctuation">)</span><span class="token punctuation">;</span>
			internalMap <span class="token operator">=</span> newMap<span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>‚Äã        ÂÆûÁé∞ÂæàÁÆÄÂçïÔºåÂè™Ë¶Å‰∫ÜËß£‰∫Ü<code>CopyOnWrite</code>Êú∫Âà∂ÔºåÊàë‰ª¨ÂèØ‰ª•ÂÆûÁé∞ÂêÑÁßç<code>CopyOnWrite</code>ÂÆπÂô®ÔºåÂπ∂‰∏îÂú®‰∏çÂêåÁöÑÂ∫îÁî®Âú∫ÊôØ‰∏≠‰ΩøÁî®„ÄÇ<br>‚Äã        <code>CopyOnWrite</code>ÁöÑÂ∫îÁî®Âú∫ÊôØÔºö<code>CopyOnWrite</code>Âπ∂ÂèëÂÆπÂô®Áî®‰∫éËØªÂ§öÂÜôÂ∞ëÁöÑÂπ∂ÂèëÂú∫ÊôØÔºåÊØîÂ¶ÇÁôΩÂêçÂçïÔºåÈªëÂêçÂçïÔºåÂïÜÂìÅÁ±ªÁõÆÁöÑËÆøÈóÆÂíåÊõ¥Êñ∞Á≠âÁ≠âÂú∫ÊôØ„ÄÇÂÅáÂ¶ÇÊàë‰ª¨Êúâ‰∏Ä‰∏™ÊêúÁ¥¢ÁΩëÁ´ôÔºåÁî®Êà∑Âú®Ëøô‰∏™ÁΩëÁ´ôÁöÑÊêúÁ¥¢Ê°Ü‰∏≠ÔºåËæìÂÖ•ÂÖ≥ÈîÆÂ≠óÊêúÁ¥¢ÂÜÖÂÆπÔºå‰ΩÜÊòØÊüê‰∫õÂÖ≥ÈîÆÂ≠ó‰∏çÂÖÅËÆ∏Ë¢´ÊêúÁ¥¢„ÄÇËøô‰∫õ‰∏çËÉΩË¢´ÊêúÁ¥¢ÁöÑÂÖ≥ÈîÆÂ≠ó‰ºöË¢´ÊîæÂú®‰∏Ä‰∏™ÈªëÂêçÂçïÂΩì‰∏≠ÔºåÈªëÂêçÂçïÊØèÂ§©Êôö‰∏äÊõ¥Êñ∞‰∏ÄÊ¨°„ÄÇÂΩìÁî®Êà∑ÊêúÁ¥¢Êó∂Ôºå‰ºöÊ£ÄÊü•ÂΩìÂâçÂÖ≥ÈîÆÂ≠óÂú®‰∏çÂú®ÈªëÂêçÂçïÂΩì‰∏≠,Â¶ÇÊûúÂú®,ÂàôÊèêÁ§∫‰∏çËÉΩÊêúÁ¥¢„ÄÇ<br>‚Äã        ‰ª£Á†ÅÂæàÁÆÄÂçïÔºå‰ΩÜÊòØ‰ΩøÁî®<code>CopyOnWriteMap</code>ÈúÄË¶ÅÊ≥®ÊÑè‰∏§‰ª∂‰∫ãÊÉÖÔºö</p>
<ul>
<li>ÂáèÂ∞ëÊâ©ÂÆπÂºÄÈîÄ„ÄÇÊ†πÊçÆÂÆûÈôÖÈúÄË¶ÅÔºåÂàùÂßãÂåñ <code>CopyOnWriteMap</code>ÁöÑÂ§ßÂ∞èÔºåÈÅøÂÖçÂÜôÊó∂<code>CopyOnWriteMap</code>Êâ©ÂÆπÁöÑÂºÄÈîÄ„ÄÇ</li>
<li>‰ΩøÁî®ÊâπÈáèÊ∑ªÂä†„ÄÇÂõ†‰∏∫ÊØèÊ¨°Ê∑ªÂä†,ÂÆπÂô®ÊØèÊ¨°ÈÉΩ‰ºöËøõË°åÂ§çÂà∂ÔºåÊâÄ‰ª•ÂáèÂ∞ëÊ∑ªÂä†Ê¨°Êï∞ÔºåÂèØ‰ª•ÂáèÂ∞ëÂÆπÂô®ÁöÑÂ§çÂà∂Ê¨°Êï∞„ÄÇÂ¶Ç‰ΩøÁî®‰∏äÈù¢‰ª£Á†ÅÈáåÁöÑ<code>addBlackList</code>ÊñπÊ≥ï„ÄÇ</li>
</ul>
<p>‚Äã        <code>CopyOnWrite</code>ÁöÑÁº∫ÁÇπ:<br>‚Äã        (1)ÂÜÖÂ≠òÂç†Áî®ÈóÆÈ¢ò„ÄÇÂõ†‰∏∫<code>CopyOnWrite</code>ÁöÑÂÜôÊó∂Â§çÂà∂Êú∫Âà∂ÔºåÊâÄ‰ª•Âú®ËøõË°åÂÜôÊìç‰ΩúÁöÑÊó∂ÂÄôÔºåÂÜÖÂ≠òÈáå‰ºöÂêåÊó∂È©ªÊâé‰∏§‰∏™ÂØπË±°ÁöÑÂÜÖÂ≠òÔºåÊóßÁöÑÂØπË±°ÂíåÊñ∞ÂÜôÂÖ•ÁöÑÂØπË±°ÔºàÊ≥®ÊÑèÔºöÂú®Â§çÂà∂ÁöÑÊó∂ÂÄôÂè™ÊòØÂ§çÂà∂ÂÆπÂô®ÈáåÁöÑÂºïÁî®ÔºåÂè™ÊòØÂú®ÂÜôÁöÑÊó∂ÂÄô‰ºöÂàõÂª∫Êñ∞ÂØπË±°Ê∑ªÂä†Âà∞Êñ∞ÂÆπÂô®ÈáåÔºåËÄåÊóßÂÆπÂô®ÁöÑÂØπË±°ËøòÂú®‰ΩøÁî®ÔºåÊâÄ‰ª•Êúâ‰∏§‰ªΩÂØπË±°ÂÜÖÂ≠ò)„ÄÇÂ¶ÇÊûúËøô‰∫õÂØπË±°Âç†Áî®ÁöÑÂÜÖÂ≠òÊØîËæÉÂ§ßÔºåÊØîÂ¶ÇËØ¥200MB Â∑¶Âè≥ÔºåÈÇ£‰πàÂÜçÂÜôÂÖ•100MB Êï∞ÊçÆËøõÂéªÔºåÂÜÖÂ≠òÂ∞±‰ºöÂç†Áî®300MBÔºåÈÇ£‰πàËøô‰∏™Êó∂ÂÄôÂæàÊúâÂèØËÉΩÈÄ†ÊàêÈ¢ëÁπÅÁöÑ<code>Yong GC</code>Âíå<code>Full GC</code>„ÄÇ‰πãÂâçÊàë‰ª¨Á≥ªÁªü‰∏≠‰ΩøÁî®‰∫Ü‰∏Ä‰∏™ÊúçÂä°Áî±‰∫éÊØèÊôö‰ΩøÁî®<code>CopyOnWrite</code>Êú∫Âà∂Êõ¥Êñ∞Â§ßÂØπË±°ÔºåÈÄ†Êàê‰∫Ü<strong>ÊØèÊôö15s</strong>ÁöÑ<code>Full GC</code>,Â∫îÁî®ÂìçÂ∫îÊó∂Èó¥‰πüÈöè‰πãÂèòÈïø„ÄÇÈíàÂØπÂÜÖÂ≠òÂç†Áî®ÈóÆÈ¢òÔºåÂèØ‰ª•ÈÄöËøáÂéãÁº©ÂÆπÂô®‰∏≠ÁöÑÂÖÉÁ¥†ÁöÑÊñπÊ≥ïÊù•ÂáèÂ∞ëÂ§ßÂØπË±°ÁöÑÂÜÖÂ≠òÊ∂àËÄó„ÄÇ<br>‚Äã        (2ÔºâÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÈóÆÈ¢ò„ÄÇ<code>CopyOnWrite</code>ÂÆπÂô®Âè™ËÉΩ‰øùËØÅÊï∞ÊçÆÁöÑÊúÄÁªà‰∏ÄËá¥ÊÄßÔºå‰∏çËÉΩ‰øùËØÅÊï∞ÊçÆÁöÑÂÆûÊó∂‰∏ÄËá¥ÊÄß„ÄÇÊâÄ‰ª•Â¶ÇÊûú‰Ω†Â∏åÊúõÂÜôÂÖ•ÁöÑÊï∞ÊçÆÈ©¨‰∏äËÉΩËØªÂà∞,ËØ∑‰∏çË¶Å‰ΩøÁî®<code>CopyOnWrite</code>ÂÆπÂô®„ÄÇ</p>
<h3 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h3><p>‚Äã        <code>Vector</code>ÊòØÁü¢ÈáèÈòüÂàó,ÈÄöËøáÊï∞ÁªÑ‰øùÂ≠òÊï∞ÊçÆ„ÄÇÂÆÉÁªßÊâø‰∫é<code>AbstractList</code>ÔºåÂÆûÁé∞‰∫Ü<code>List</code>„ÄÅ<code>RandomAccess</code>„ÄÅ<code>Cloneable</code>Ëøô‰∫õÊé•Âè£„ÄÇ<br>‚Äã        <code>Vector</code> ÁªßÊâø‰∫Ü<code>AbstractList</code>ÔºåÂÆûÁé∞‰∫Ü<code>List</code>ÔºõÊâÄ‰ª•ÔºåÂÆÉÊòØ‰∏Ä‰∏™ÈòüÂàóÔºåÊîØÊåÅÁõ∏ÂÖ≥ÁöÑÊ∑ªÂä†„ÄÅÂà†Èô§„ÄÅ‰øÆÊîπ„ÄÅÈÅçÂéÜÁ≠âÂäüËÉΩ„ÄÇ<br>‚Äã        <code>Vector</code> ÂÆûÁé∞‰∫Ü<code>RandmoAccess</code> Êé•Âè£Ôºå<strong>Âç≥Êèê‰æõ‰∫ÜÈöèÊú∫ËÆøÈóÆÂäüËÉΩ</strong>„ÄÇ<code>RandmoAccess</code> ÊòØ <code>Java</code>‰∏≠Áî®Êù•Ë¢´<code>List</code>ÂÆûÁé∞Ôºå‰∏∫<code>List</code>Êèê‰æõÂø´ÈÄüËÆøÈóÆÂäüËÉΩÁöÑ„ÄÇÂú®<code>Vector</code>‰∏≠ÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÂÖÉÁ¥†ÁöÑÂ∫èÂè∑Âø´ÈÄüËé∑ÂèñÂÖÉÁ¥†ÂØπË±°,ËøôÂ∞±ÊòØÂø´ÈÄüÈöèÊú∫ËÆøÈóÆ„ÄÇ<br>‚Äã        <code>Vector</code>ÂÆûÁé∞‰∫Ü<code>Cloneable</code>Êé•Âè£,Âç≥ÂÆûÁé∞<code>clone()</code>ÂáΩÊï∞„ÄÇÂÆÉËÉΩË¢´ÂÖãÈöÜ„ÄÇ<br>‚Äã        Âíå<code>ArrayList</code>‰∏çÂêåÔºå<code>Vector</code> ‰∏≠ÁöÑÊìç‰ΩúÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÔºåÂÆÉÊòØ<strong>Âà©Áî®<code>synchronized</code>ÂêåÊ≠•ÊòæÁ§∫ÈîÅ</strong>ÁöÑÊñπÊ≥ïÈîÅÁöÑÊú∫Âà∂ÂÆûÁé∞ÔºåÂÆûÁé∞ÂÆâÂÖ®Êú∫Âà∂Á±ª‰ºº<code>Hashtable</code> „ÄÇ<br>‚Äã        ‰∏ãÈù¢Áúã‰∏Ä‰∏ãÁöÑ <code>Vector</code> ÁöÑÊ∫êÁ†Å,Ê≥®ÊÑèÊñπÊ≥ïÈîÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">RandomAccess</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">protected</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elementData<span class="token punctuation">;</span>
	
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">addElement</span><span class="token punctuation">(</span><span class="token class-name">E</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">ensureCapacityHelper</span><span class="token punctuation">(</span>elementCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elementData<span class="token punctuation">[</span>elementCount<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">removeElement</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">removeElementAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
	<span class="token comment">//ÂêåÊ≠•ÊñπÊ≥ïÈîÅ</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">>=</span> elementCount<span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArrayIndexOutOfBoundsException</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">elementData</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰∏äÈù¢ÊòØ<code>Vector</code> Êèê‰æõÁöÑÂá†‰∏™‰∏ªË¶ÅÊñπÊ≥ïÔºåÂåÖÊã¨<code>addElement()</code>„ÄÅ<code>removeElement()</code>„ÄÅ<code>get()</code>Á≠â„ÄÇÊ≥®ÊÑèÂà∞ÊØè‰∏™ÊñπÊ≥ïÊú¨Ë∫´ÈÉΩÊòØ<code>synchronized</code>ÁöÑÔºå‰∏ç‰ºöÂá∫Áé∞‰∏§‰∏™Á∫øÁ®ãÂêåÊó∂ÂØπÊï∞ÊçÆËøõË°åÊìç‰ΩúÁöÑÊÉÖÂÜµÔºåÂõ†Ê≠§‰øùËØÅ‰∫ÜÁ∫øÁ®ãÂÆâÂÖ®ÊÄß„ÄÇ<br>‚Äã        <code>Vector</code>Â∏∏Áî®ÁöÑÊñπÊ≥ïÂ¶Ç‰∏ãÔºå‰∏éÂÖ∂‰ªñÈõÜÂêàÁ±ªÁöÑÊñπÊ≥ïÂ§ßÂêåÂ∞èÂºÇÔºåÊàë‰ª¨Â∞±ÁúãÂá†‰∏™‰æãÂ≠êÂêßÔºö</p>
<ul>
<li><code>void addElement(E obj)</code>ÔºåÊ∑ªÂä†ÂÖÉÁ¥†„ÄÇ</li>
<li><code>void clear()</code>ÔºåÊ∏ÖÁ©∫ÈõÜÂêà„ÄÇ</li>
<li><code>Object clone()</code>ÔºåÈõÜÂêàÂÖãÈöÜ„ÄÇ</li>
<li><code>boolean contains(Object o)</code>ÔºåÊòØÂê¶ÂåÖÂê´Êüê‰∏Ä‰∏™ÂÖÉÁ¥†„ÄÇ</li>
<li><code>E firstElement()</code>ÔºåËé∑ÂæóÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†„ÄÇ</li>
<li><code>int indexOf(Object o)</code>ÔºåÂæóÂà∞‰∏Ä‰∏™ÂÖÉÁ¥†ÁöÑ‰∏ãÊ†á„ÄÇ</li>
<li><code>boolean isEmpty()</code>ÔºåÂà§Êñ≠ÈõÜÂêàÊòØÂê¶Á©∫ÁöÑ„ÄÇ</li>
<li><code>Iterator&lt;E&gt; iterator()</code>ÔºåËé∑Âæó<code>iterator</code>ÈõÜÂêàÂØπË±°„ÄÇ</li>
<li><code>E lastElement()</code>ÔºåËé∑ÂæóÊúÄÂêé‰∏Ä‰∏™ÂÖÉÁ¥†„ÄÇ</li>
<li><code>boolean removeElement(Object obj)</code>ÔºåÂà†Èô§‰∏Ä‰∏™ÂÖÉÁ¥†„ÄÇ</li>
<li><code>Object[] toArray()</code>ÔºåÂæóÂà∞‰∏Ä‰∏™Êï∞ÁªÑÁªìÊûúÈõÜ„ÄÇ</li>
</ul>
<p><code>Vector</code>ÁöÑ‰ΩøÁî®ÂÆû‰æãÔºö</p>
<h4 id="No5-VectorDemo-java"><a href="#No5-VectorDemo-java" class="headerlink" title="No5_VectorDemo.java"></a>No5_VectorDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>thread_safe_collection_class</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Vector</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No5_VectorDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">addElement</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//add ‰πüÂèØ‰ª•</span>
        list<span class="token punctuation">.</span><span class="token function">addElement</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">addElement</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">removeElement</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> iterator <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="Â∏∏Áî®ÁöÑStringBuffer‰∏é-StringBuilder"><a href="#Â∏∏Áî®ÁöÑStringBuffer‰∏é-StringBuilder" class="headerlink" title="Â∏∏Áî®ÁöÑStringBuffer‰∏é StringBuilder"></a>Â∏∏Áî®ÁöÑStringBuffer‰∏é StringBuilder</h3><p>‚Äã        <strong>Âú®ÁºñÂÜôJAVA‰ª£Á†ÅÁöÑËøáÁ®ã‰∏≠ÊúâÊó∂Ë¶ÅÈ¢ëÁπÅÂú∞ÂØπÂ≠óÁ¨¶‰∏≤ËøõË°åÊãºÊé•</strong>ÔºåÂ¶ÇÊûúÁõ¥Êé•Áî®‚Äú**+<strong>‚Äù</strong>ÊãºÊé•<strong>ÁöÑËØù‰ºöÂª∫Á´ãÂæàÂ§öÁöÑ <strong>String</strong> Âûã</strong>ÂØπË±°<strong>Ôºå</strong>‰∏•ÈáçÁöÑËØù‰ºöÂØπÊúçÂä°Âô®ËµÑÊ∫êÂíåÊÄßËÉΩÈÄ†Êàê‰∏çÂ∞èÁöÑÂΩ±Âìç**ÔºõËÄå‰ΩøÁî® <code>StringBuilder</code>Âíå<code>StringBuffer</code>ËÉΩËß£ÂÜ≥‰ª•‰∏äÈóÆÈ¢ò„ÄÇËÄå<code>StringBuffer</code> ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÔºåËÄå<code>StringBuilder</code> ‰∏çÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ„ÄÇ<br>‚Äã        Êù•Áúã‰∏Ä‰∏ã <code>StringBuffer</code> ÁöÑ‰∏Ä‰∫õÊ∫êÁ†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">StringBuffer</span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractStringBuilder</span>
    <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span class="token punctuation">,</span> <span class="token class-name">CharSequence</span>
<span class="token punctuation">&#123;</span>
	<span class="token comment">//ÊñπÊ≥ïÂêåÊ≠•ÈîÅ</span>
	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">StringBuffer</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        toStringCache <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//ÊñπÊ≥ïÂêåÊ≠•ÈîÅ</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>toStringCache <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            toStringCache <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOfRange</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>toStringCache<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ËÄå<code>StringBuilder</code>ÁöÑÊ∫êÁ†Å‰∏ÄÈÉ®ÂàÜÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">StringBuilder</span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractStringBuilder</span>
    <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span class="token punctuation">,</span> <span class="token class-name">CharSequence</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">public</span> <span class="token class-name">StringBuilder</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Create a copy, don't share the array</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ËÄå‰∏é‰πãÂØπÂ∫îÁöÑ<code>StringBuilder</code>ÊòØ<strong>Á∫øÁ®ã‰∏çÂÆâÂÖ®</strong>ÁöÑÔºå‰πüÂ∞±ÊòØÊ≤°ÊúâÂä† <code>synchronized</code><strong>ÈîÅ</strong>„ÄÇÊâÄ‰ª•‰∏çÈöæÁúãÂá∫Êàë‰ª¨Âú®È´òÂπ∂ÂèëÁöÑÊÉÖÂÜµ‰∏ãÔºåÂ¶ÇÊûú‰∏çÈúÄË¶ÅËÄÉËôëÊï∞ÊçÆÂÆâÂÖ®ÈóÆÈ¢òÁöÑÊÉÖÂÜµ‰∏ãÔºåÂ∞ΩÈáè‰ΩøÁî®<code>StringBuffer</code>ÔºåÁî±‰∫éÊ≤°ÊúâËµÑÊ∫êÁ≠âÂæÖÁöÑÊÉÖÂÜµËÇØÂÆöÊâßË°åÊïàÁéáÂíåÊÄßËÉΩ‰ºöÈ´òÂæàÂ§öÊâÄ‰ª•ÊòØ‰ΩøÁî®<code>StringBuffer</code>ËøòÊòØ‰ΩøÁî®<code>StringBuilder</code>Ë¶ÅËßÜÊÉÖÂÜµËÄåÂÆö„ÄÇ</p>
<p>‚Äã        ‰∏ãÈù¢Êàë‰ª¨ÂØπÁ∫øÁ®ãÂÆâÂÖ®ÂÅö‰∏™Â∞èÁªìÔºö<br>‚Äã        ÈÄöËøáÁ¨¨3Á´†„ÄÅÁ¨¨4Á´†  (<strong>Á¨¨3Á´†ThreadÂÆâÂÖ®„ÄÅÁ¨¨4Á´†Á∫øÁ®ãÂÆâÂÖ®ÁöÑÈõÜÂêàÁ±ª</strong>)  Â≠¶‰π†Êàë‰ª¨‰∏çÈöæÁúãÂá∫Ôºå<strong>Âú®ÊéåÊè°‰∫ÜÁ∫øÁ®ãÁöÑÂÆâÂÖ®ÂéüÁêÜÂíåÈîÅÁöÑÊú∫Âà∂ÁöÑÊÉÖÂÜµ‰∏ãÂÜçÂéªÁêÜËß£ÂíåÊü•ÁúãJavaÈáåÈù¢ÊâÄÊèê‰æõÁöÑÁ∫øÁ®ãÁöÑÂÆâÂÖ®Á±ªÔºåÊàë‰ª¨Â∞±Áü•ÈÅìÊÄé‰πàÂõû‰∫ã‰∫ÜÔºåÊâÄ‰ª•Êàë‰ª¨Âú®Êó•Â∏∏ÁöÑWebÂºÄÂèëËøáÁ®ã‰∏≠‰πüÂèØ‰ª•ÈÄÇÂΩìÂú∞Ê†πÊçÆÂéüÁêÜÂíå‰∏öÂä°ÂÜôÂá∫Ëá™Â∑±ÁöÑÁ∫øÁ®ãÂÆâÂÖ®Á±ª</strong>„ÄÇ</p>
<p>‚Äã        ÊúÄÂêéÂÖ≥‰∫éÊâßË°åÊïàÁéáÊÄªÁªì‰∏ÄÂè•ÔºöÊúâÂÖ≥‰ª£Á†ÅÊâßË°åÊïàÁéáÔºåÊ≤°ÊúâÂä†ÈîÅÁöÑ„ÄÅ‰∏çÈúÄË¶ÅÂêåÊ≠•ÂÆâÂÖ®ÁöÑ‰ª£Á†Å   <strong>ÊâßË°åÊïàÁéáÊúÄÈ´ò&gt;ÊñπÊ≥ïÂùóÈîÅ&gt;Á±ªÈîÅÂíåÊñπÊ≥ïÈîÅ</strong>Ôºå<strong>ÂêåÊó∂Ë¶ÅÊ≥®ÊÑèËØªÂÜôÂàÜÁ¶ªÁöÑ‰∏öÂä°Âú∫ÊôØ</strong>„ÄÇÁü•ËØÜÊòØÂ≠¶Âá∫Êù•ÁöÑÔºåËÉΩÂäõÊòØÁªÉÂá∫Êù•ÁöÑ,Â≠¶‰π†‰∫ÜË¶ÅÁÜüÁªÉÁî®‰πã‰∫éÂÆûË∑µ„ÄÇ</p>
<h1 id="Á∫øÁ®ãÂπ∂ÂèëÊôãÁ∫ß‰πãÈ´òÁ∫ßÈÉ®ÂàÜ"><a href="#Á∫øÁ®ãÂπ∂ÂèëÊôãÁ∫ß‰πãÈ´òÁ∫ßÈÉ®ÂàÜ" class="headerlink" title="Á∫øÁ®ãÂπ∂ÂèëÊôãÁ∫ß‰πãÈ´òÁ∫ßÈÉ®ÂàÜ"></a>Á∫øÁ®ãÂπ∂ÂèëÊôãÁ∫ß‰πãÈ´òÁ∫ßÈÉ®ÂàÜ</h1><h2 id="Â§öÁ∫øÁ®ã‰πãÈó¥‰∫§‰∫í-Á∫øÁ®ãÈòÄ"><a href="#Â§öÁ∫øÁ®ã‰πãÈó¥‰∫§‰∫í-Á∫øÁ®ãÈòÄ" class="headerlink" title="Â§öÁ∫øÁ®ã‰πãÈó¥‰∫§‰∫í:Á∫øÁ®ãÈòÄ"></a>Â§öÁ∫øÁ®ã‰πãÈó¥‰∫§‰∫í:Á∫øÁ®ãÈòÄ</h2><p>ÊäïÂÖ•Â§öÂ∞ëÔºåÊî∂Ëé∑Â§öÂ∞ë:ÂèÇ‰∏éÂ§öÊ∑±,È¢ÜÊÇüÂ§öÊ∑±„ÄÇ</p>
<p>Á∫øÁ®ãÈòÄÊòØ‰∏ÄÁßçÁ∫øÁ®ã‰∏éÁ∫øÁ®ã‰πãÈó¥Áõ∏‰∫íÂà∂Á∫¶Âíå‰∫§‰∫íÁöÑÊú∫Âà∂„ÄÇ</p>
<h3 id="ÈòªÂ°ûÈòüÂàóBlockingQueue"><a href="#ÈòªÂ°ûÈòüÂàóBlockingQueue" class="headerlink" title="ÈòªÂ°ûÈòüÂàóBlockingQueue"></a>ÈòªÂ°ûÈòüÂàóBlockingQueue</h3><p>‚Äã        ÂÖàÁêÜËß£<code>Queue</code>„ÄÅ<code>Deque</code>„ÄÅ <code>BlockingQueue</code> ÁöÑÊ¶ÇÂøµ„ÄÇ<br>‚Äã        ‚óè<code>Queue </code>(<strong>ÈòüÂàó</strong>)ÔºöÁî®‰∫é‰øùÂ≠ò‰∏ÄÁªÑÂÖÉÁ¥†Ôºå‰∏çËøáÂú®Â≠òÂèñÂÖÉÁ¥†ÁöÑÊó∂ÂÄôÂøÖÈ°ªÈÅµÂæ™ÂÖàËøõÂÖàÂá∫ÂéüÂàô„ÄÇÈòüÂàóÊòØ‰∏Ä‰∏ÄÁßçÁâπÊÆäÁöÑÁ∫øÊÄßË°®ÔºåÂÆÉÂè™ÂÖÅËÆ∏Âú®Ë°®ÁöÑÂâçÁ´Ø(<code>front</code>)ËøõË°åÂà†Èô§Êìç‰ΩúÔºåËÄåÂú®Ë°®ÁöÑÂêéÁ´Ø(<code>rear</code>)ËøõË°åÊèíÂÖ•Êìç‰Ωú„ÄÇËøõË°åÊèíÂÖ•Êìç‰ΩúÁöÑÁ´ØÁß∞‰∏∫ÈòüÂ∞æÔºåËøõË°åÂà†Èô§Êìç‰ΩúÁöÑÁ´ØÁß∞‰∏∫ÈòüÂ§¥„ÄÇÈòüÂàó‰∏≠Ê≤°ÊúâÂÖÉÁ¥†Êó∂ÔºåÁß∞‰∏∫Á©∫ÈòüÂàó„ÄÇÂú®ÈòüÂàóËøôÁßçÊï∞ÊçÆÁªìÊûÑ‰∏≠ÔºåÊúÄÂÖàÊèíÂÖ•ÁöÑÂÖÉÁ¥†Â∞ÜÊòØÊúÄÂÖàË¢´Âà†Èô§ÁöÑÂÖÉÁ¥†ÔºõÂèç‰πãÊúÄÂêéÊèíÂÖ•ÁöÑÂÖÉÁ¥†Â∞ÜÊòØÊúÄÂêéË¢´Âà†Èô§ÁöÑÂÖÉÁ¥†ÔºåÂõ†Ê≠§ÈòüÂàóÂèàÁß∞‰∏∫‚Äú<strong>ÂÖàËøõÂÖàÂá∫</strong>‚Äù(<code>FIFO- first in first out</code>)ÁöÑ<strong>Á∫øÊÄßË°®</strong>„ÄÇ<br>‚Äã        ‚óè<code>Deque</code> (<strong>ÂèåÁ´ØÈòüÂàó</strong>)Ôºö‰∏§Á´ØÈÉΩÂèØ‰ª•ËøõÂá∫ÁöÑÈòüÂàó„ÄÇÂΩìÊàë‰ª¨Á∫¶Êùü‰ªéÈòüÂàóÁöÑ‰∏ÄÁ´ØËøõÂá∫ÈòüÊó∂ÔºåÂ∞±ÂΩ¢Êàê‰∫ÜÂè¶Â§ñ‰∏ÄÁßçÂ≠òÂèñÊ®°ÂºèÔºåÂÆÉÈÅµÂæ™<strong>ÂÖàËøõÂêéÂá∫</strong>ÂéüÂàôÔºåËøôÂ∞±ÊòØÊ†àÁªìÊûÑ„ÄÇÂèåÁ´ØÈòüÂàó‰∏ªË¶ÅÊòØÁî®‰∫éÊ†àÊìç‰Ωú„ÄÇ‰ΩøÁî®Ê†àÁªìÊûÑËÆ©Êìç‰ΩúÊúâÂèØËøΩÊ∫ØÊÄß(Â¶Ç<code>Windows</code>Á™óÂè£Âú∞ÂùÄÊ†èÂÜÖÁöÑË∑ØÂæÑÂâçËøõÊ†à„ÄÅÂêéÈÄÄÊ†à)„ÄÇ</p>
<p>‚Äã        ÈòªÂ°ûÈòüÂàó(<code>BlockingQueue</code>)ÊòØ‰∏Ä‰∏™ÊîØÊåÅ‰∏§‰∏™ÈôÑÂä†Êìç‰ΩúÁöÑÈòüÂàó„ÄÇËøô‰∏§‰∏™ÈôÑÂä†ÁöÑÊìç‰ΩúÊòØÔºöÂú®ÈòüÂàó‰∏∫Á©∫Êó∂ÔºåËé∑ÂèñÂÖÉÁ¥†ÁöÑÁ∫øÁ®ã‰ºöÁ≠âÂæÖÈòüÂàóÂèò‰∏∫ÈùûÁ©∫:ÂΩìÈòüÂàóÊª°Êó∂ÔºåÂ≠òÂÇ®ÂÖÉÁ¥†ÁöÑÁ∫øÁ®ã‰ºöÁ≠âÂæÖÈòüÂàóÂèØÁî®„ÄÇÈòªÂ°ûÈòüÂàóÂ∏∏Áî®‰∫éÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖÁöÑÂú∫ÊôØÔºåÁîü‰∫ßËÄÖÊòØÂæÄÈòüÂàóÈáåÊ∑ªÂä†ÂÖÉÁ¥†ÁöÑÁ∫øÁ®ãÔºåÊ∂àË¥πËÄÖÊòØ‰ªéÈòüÂàóÈáåÊãøÂèñÂÖÉÁ¥†ÁöÑÁ∫øÁ®ã„ÄÇÈòªÂ°ûÈòüÂàóÂ∞±ÊòØÁîü‰∫ßËÄÖÂ≠òÊîæÂÖÉÁ¥†ÁöÑÂÆπÂô®ÔºåËÄåÊ∂àË¥πËÄÖ‰πüÂè™‰ªéÂÆπÂô®ÈáåÊãøÂèñÂÖÉÁ¥†„ÄÇÈòªÂ°ûÈòüÂàóÊèê‰æõ‰∫Ü4ÁßçÂ§ÑÁêÜÊñπÊ≥ï:</p>
<p><img src="/image/Concurrent/Concurrent16.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent16.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<table>
<thead>
<tr>
<th>ÊñπÊ≥ï\Â§ÑÁêÜÊñπÂºè</th>
<th>ÊäõÂá∫ÂºÇÂ∏∏</th>
<th>ËøîÂõûÁâπÊÆäÂÄº</th>
<th>‰∏ÄÁõ¥ÈòªÂ°û</th>
<th>Ë∂ÖÊó∂ÈÄÄÂá∫</th>
</tr>
</thead>
<tbody><tr>
<td>ÊèíÂÖ•ÊñπÊ≥ï</td>
<td>add(e)</td>
<td>offer(e)</td>
<td>put(e)</td>
<td>offer(e,time,unit)</td>
</tr>
<tr>
<td>ÁßªÈô§ÊñπÊ≥ï</td>
<td>remove()</td>
<td>poll()</td>
<td>take()</td>
<td>poll(time,unit)</td>
</tr>
<tr>
<td>Ê£ÄÊü•ÊñπÊ≥ï</td>
<td>element()</td>
<td>peek()</td>
<td>‰∏çÂèØÁî®</td>
<td>‰∏çÂèØÁî®</td>
</tr>
</tbody></table>
<p>‚Äã        ‚óèÊäõÂá∫ÂºÇÂ∏∏ÔºöÊòØÊåáÂΩìÈòªÂ°ûÈòüÂàóÊª°Êó∂ÔºåÂÜçÂæÄÈòüÂàóÈáåÊèíÂÖ•ÂÖÉÁ¥†Ôºå‰ºöÊäõÂá∫<code>IllegalStateException(&quot;Queue full&quot;)</code>ÂºÇÂ∏∏„ÄÇÂΩìÈòüÂàó‰∏∫Á©∫Êó∂Ôºå‰ªéÈòüÂàóÈáåËé∑ÂèñÂÖÉÁ¥†Êó∂‰ºöÊäõÂá∫<code>NoSuchElementException</code>ÂºÇÂ∏∏.<br>‚Äã        ‚óèËøîÂõûÁâπÊÆäÂÄºÔºöÊèíÂÖ•ÊñπÊ≥ï‰ºöËøîÂõûÊòØÂê¶ÊàêÂäüÔºåËã•ÊàêÂäüÂàôËøîÂõû<code>true</code>„ÄÇÁßªÈô§ÊñπÊ≥ïÔºåÂàôÊòØ‰ªéÈòüÂàóÈáåÊãøÂá∫‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàôËøîÂõû<code>null</code>„ÄÇ<br>‚Äã        ‚óè‰∏ÄÁõ¥ÈòªÂ°ûÔºöÂΩìÈòªÂ°ûÈòüÂàóÊª°Êó∂ÔºåÂ¶ÇÊûúÁîü‰∫ßËÄÖÁ∫øÁ®ãÂæÄÈòüÂàóÈáå<code>put</code>ÂÖÉÁ¥†ÔºåÈòüÂàó‰ºö‰∏ÄÁõ¥ÈòªÂ°ûÁîü‰∫ßËÄÖÁ∫øÁ®ãÔºåÁõ¥Âà∞ÊãøÂà∞Êï∞ÊçÆÔºåÊàñËÄÖÂìçÂ∫î‰∏≠Êñ≠ÈÄÄÂá∫„ÄÇÂΩìÈòüÂàóÁ©∫Êó∂ÔºåÊ∂àË¥πËÄÖÁ∫øÁ®ãËØïÂõæ‰ªéÈòüÂàóÈáå<code>take</code>ÂÖÉÁ¥†ÔºåÈòüÂàó‰πü‰ºöÈòªÂ°ûÊ∂àË¥πËÄÖÁ∫øÁ®ãÔºåÁõ¥Âà∞ÈòüÂàóÂèØÁî®„ÄÇ<br>‚Äã        ‚óèË∂ÖÊó∂ÈÄÄÂá∫ÔºöÂΩìÈòªÂ°ûÈòüÂàóÊª°Êó∂ÔºåÈòüÂàó‰ºöÈòªÂ°ûÁîü‰∫ßËÄÖÁ∫øÁ®ã‰∏ÄÊÆµÊó∂Èó¥ÔºåÂ¶ÇÊûúË∂ÖËøá‰∏ÄÂÆöÁöÑÊó∂Èó¥ÔºåÁîü‰∫ßËÄÖÁ∫øÁ®ãÂ∞±‰ºöÈÄÄÂá∫„ÄÇ</p>
<p><strong>ÊúÄÊñ∞JDK‰∏≠Êèê‰æõ‰∫Ü7‰∏™ÈòªÂ°ûÈòüÂàó</strong>ÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="/image/Concurrent/Concurrent17.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent17.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>JDK7 Êèê‰æõ‰∫Ü 7 ‰∏™ÈòªÂ°ûÈòüÂàó„ÄÇÂàÜÂà´ÊòØ</p>
<ul>
<li>ArrayBlockingQueue Ôºö‰∏Ä‰∏™Áî±Êï∞ÁªÑÁªìÊûÑÁªÑÊàêÁöÑÊúâÁïåÈòªÂ°ûÈòüÂàó„ÄÇ</li>
<li>LinkedBlockingQueue Ôºö‰∏Ä‰∏™Áî±ÈìæË°®ÁªìÊûÑÁªÑÊàêÁöÑÊúâÁïåÈòªÂ°ûÈòüÂàó„ÄÇ</li>
<li>PriorityBlockingQueue Ôºö‰∏Ä‰∏™ÊîØÊåÅ‰ºòÂÖàÁ∫ßÊéíÂ∫èÁöÑÊó†ÁïåÈòªÂ°ûÈòüÂàó„ÄÇ</li>
<li>DelayQueueÔºö‰∏Ä‰∏™‰ΩøÁî®‰ºòÂÖàÁ∫ßÈòüÂàóÂÆûÁé∞ÁöÑÊó†ÁïåÈòªÂ°ûÈòüÂàó„ÄÇ</li>
<li>SynchronousQueueÔºö‰∏Ä‰∏™‰∏çÂ≠òÂÇ®ÂÖÉÁ¥†ÁöÑÈòªÂ°ûÈòüÂàó„ÄÇ</li>
<li>LinkedTransferQueueÔºö‰∏Ä‰∏™Áî±ÈìæË°®ÁªìÊûÑÁªÑÊàêÁöÑÊó†ÁïåÈòªÂ°ûÈòüÂàó„ÄÇ</li>
<li>LinkedBlockingDequeÔºö‰∏Ä‰∏™Áî±ÈìæË°®ÁªìÊûÑÁªÑÊàêÁöÑÂèåÂêëÈòªÂ°ûÈòüÂàó„ÄÇ</li>
</ul>
<p><code>BlockingQueue</code>Â∏∏Áî®ÁöÑÊñπÊ≥ïÊúâÂ¶Ç‰∏ã5ÁßçÔºåÊõ¥Â§öÊñπÊ≥ïËØ∑Êü•ËØ¢API„ÄÇ</p>
<p>(1) <code>add(anObject)</code>ÔºöÊää<strong>anObjcct</strong>Âä†Âà∞<code>BlockingQueue</code> ÈáåÔºåÂç≥Â¶ÇÊûú<code>BlockingQueue</code>ÂèØ‰ª•ÂÆπÁ∫≥ÔºåÂàôËøîÂõûtrue,Âê¶ÂàôÊäõÂá∫ÂºÇÂ∏∏„ÄÇ<br>(2) <code>offer(anOject)</code>ÔºöË°®Á§∫Â¶ÇÊûúÂèØËÉΩÁöÑËØùÔºåÂ∞Ü<strong>anObject</strong> Âä†Âà∞<code>BlockingQueue</code> ÈáåÔºåÂç≥Â¶ÇÊûú<code>BlockingQueue</code>ÂèØ‰ª•ÂÆπÁ∫≥ÔºåÂàôËøîÂõû<code>true</code>,Âê¶ÂàôËøîÂõû<code>false</code>„ÄÇ<br>(3) <code>put(aoObject)</code>ÔºöÊää<strong>anObject</strong>Âä†Âà∞<code>BlockingQueue</code>ÈáåÔºåÂ¶ÇÊûú<code>BlockQueue</code>Ê≤°ÊúâÁ©∫Èó¥ÔºåÂàôË∞ÉÁî®Ê≠§ÊñπÊ≥ïÁöÑÁ∫øÁ®ãË¢´ÈòªÊñ≠ÔºåÁõ¥Âà∞<code>BlockingQueue</code>ÈáåÈù¢ÊúâÁ©∫Èó¥Êó∂ÂÜçÁªßÁª≠„ÄÇ<br>(4) <code>poll(time)</code>Ôºö ÂèñËµ∞<code>BlockingQueue</code> ÈáåÊéíÂú®È¶ñ‰ΩçÁöÑÂØπË±°ÔºåËã•‰∏çËÉΩÁ´ãÂç≥ÂèñÂá∫ÔºåÂàôÂèØ‰ª•Á≠â<code>time</code>ÂèÇÊï∞ËßÑÂÆöÁöÑÊó∂Èó¥ÔºåÂèñ‰∏çÂà∞Êó∂ËøîÂõû<code>null</code>„ÄÇ<br>(5) <code>take()</code>ÔºöÂèñËµ∞<code>BlockingQueue</code>ÈáåÊéíÂú®È¶ñ‰ΩçÁöÑÂØπË±°ÔºåËã•<code>BlockingQueue</code>‰∏∫Á©∫ÔºåÈòªÊñ≠ËøõÂÖ•Á≠âÂæÖÁä∂ÊÄÅÁõ¥Âà∞<code>Blocking</code>ÊúâÊñ∞ÁöÑÂØπË±°Ë¢´Âä†ÂÖ•‰∏∫Ê≠¢„ÄÇ<br>        ÂÖ∂‰∏≠: <code>BlockingQueue</code> ‰∏çÊé•Âèó<strong>null</strong>ÂÖÉÁ¥†„ÄÇËØïÂõæ<code>add</code>„ÄÅ<code>put</code>Êàñ<code>offer</code>‰∏Ä‰∏™<strong>null</strong>ÂÖÉÁ¥†Êó∂ÔºåÊüê‰∫õÂÆûÁé∞‰ºöÊäõÂá∫<code>NullPointerException</code>ÂºÇÂ∏∏„ÄÇ<strong>null</strong>Ë¢´Áî®‰ΩúÊåáÁ§∫<code>poll</code>Êìç‰ΩúÂ§±Ë¥•ÁöÑË≠¶ÊàíÂÄº„ÄÇ</p>
<h3 id="Êï∞ÁªÑÈòªÂ°ûÈòüÂàóArrayBlockingQueue"><a href="#Êï∞ÁªÑÈòªÂ°ûÈòüÂàóArrayBlockingQueue" class="headerlink" title="Êï∞ÁªÑÈòªÂ°ûÈòüÂàóArrayBlockingQueue"></a>Êï∞ÁªÑÈòªÂ°ûÈòüÂàóArrayBlockingQueue</h3><p>‚Äã        <code>ArrayBlockingQueue</code>ÊòØ‰∏Ä‰∏Ä‰∏™Áî±Êï∞ÁªÑÊîØÊåÅÁöÑ<strong>ÊúâÁïå</strong>ÁöÑÈòªÂ°ûÈòüÂàó„ÄÇÊ≠§ÈòüÂàóÊåâ<strong>FIFO</strong> (<strong>ÂÖàËøõÂÖàÂá∫</strong>)ÂéüÂàôÂØπÂÖÉÁ¥†ËøõË°åÊéíÂ∫è„ÄÇÈòüÂàóÁöÑÂ§¥ÈÉ®ÊòØÂú®ÈòüÂàó‰∏≠Â≠òÂú®Êó∂Èó¥ÊúÄÈïøÁöÑÂÖÉÁ¥†„ÄÇÈòüÂàóÁöÑÂ∞æÈÉ®ÊòØÂú®ÈòüÂàó‰∏≠Â≠òÂú®Êó∂Èó¥ÊúÄÁü≠ÁöÑÂÖÉÁ¥†„ÄÇÊñ∞ÂÖÉÁ¥†ÊèíÂÖ•Âà∞ÈòüÂàóÁöÑÂ∞æÈÉ®ÔºåÈòüÂàóËé∑ÂèñÊìç‰ΩúÂàôÊòØ‰ªéÈòüÂàóÂ§¥ÈÉ®ÂºÄÂßãËé∑ÂæóÂÖÉÁ¥†„ÄÇ<br>‚Äã        ËøôÊòØ‰∏Ä‰∏™ÂÖ∏ÂûãÁöÑ‚ÄúÊúâÁïåÁºìÂ≠òÂå∫‚ÄùÔºåÂõ∫ÂÆöÂ§ßÂ∞èÁöÑÊï∞ÁªÑÂú®ÂÖ∂‰∏≠‰øùÊåÅÁîü‰∫ßËÄÖÊèíÂÖ•ÁöÑÂÖÉÁ¥†Âíå‰ΩøÁî®ËÄÖÊèêÂèñÁöÑÂÖÉÁ¥†„ÄÇ‰∏ÄÊó¶ÂàõÂª∫‰∫ÜËøôÊ†∑ÁöÑÁºìÂ≠òÂå∫ÔºåÂ∞±‰∏çËÉΩÂÜçÂ¢ûÂä†ÂÖ∂ÂÆπÈáè„ÄÇËØïÂõæÂêëÂ∑≤Êª°ÈòüÂàó‰∏≠ÊîæÂÖ•ÂÖÉÁ¥†‰ºöÂØºËá¥Êìç‰ΩúÂèóÈòªÂ°û;ËØïÂõæ‰ªéÁ©∫ÈòüÂàó‰∏≠ÊèêÂèñÂÖÉÁ¥†Â∞ÜÂØºËá¥Á±ª‰ººÈòªÂ°û„ÄÇ<br>‚Äã        Ê≠§Á±ªÊîØÊåÅÂØπÁ≠âÂæÖÁöÑÁîü‰∫ßËÄÖÁ∫øÁ®ãÂíå‰ΩøÁî®ËÄÖÁ∫øÁ®ãËøõË°åÊéíÂ∫èÁöÑÂèØÈÄâÂÖ¨Âπ≥Á≠ñÁï•„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºå‰∏ç‰øùËØÅÊòØËøôÁßçÊéíÂ∫è„ÄÇÁÑ∂ËÄåÔºåÈÄöËøáÂ∞ÜÂÖ¨Âπ≥ÊÄß(<code>fairness</code>)ËÆæÁΩÆ‰∏∫<code>true</code> ËÄåÊûÑÈÄ†ÁöÑÈòüÂàóÂÖÅËÆ∏ÊåâÁÖß<strong>FIFO</strong>È°∫Â∫èËÆøÈóÆÁ∫øÁ®ã„ÄÇÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ã‰∏∫‰∫Ü‰øùËØÅÂÖ¨Âπ≥ÊÄßÈÄöÂ∏∏‰ºöÈôç‰ΩéÂêûÂêêÈáèÔºå‰ΩÜ‰πüÂáèÂ∞ë‰∫ÜÂèØÂèòÊÄßÂíåÈÅøÂÖç‰∫Ü‚Äú<strong>‰∏çÂπ≥Ë°°ÊÄß</strong>‚Äù„ÄÇ<br>‚Äã        Êàë‰ª¨ÂÖàÁúã‰∏Ä‰∏ã<code>ArrayBlockingQueue</code>ÁöÑÈÉ®ÂàÜÊ∫êÁ†ÅÔºåÁêÜËß£‰∏Ä‰∏ã <code>ArrayBlockingQueue</code>ÁöÑÂÆûÁé∞ÂéüÁêÜÂíåÊú∫Âà∂„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
        <span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">/** The queued items Êï∞ÁªÑÁöÑÂÇ®Â≠òÁªìÊûÑ */</span>
    <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> items<span class="token punctuation">;</span>

	<span class="token comment">/** Main lock guarding all access ÈîÅÈááÁî®ÁöÑÊú∫Âà∂ */</span>
    <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock<span class="token punctuation">;</span>

    <span class="token comment">/** Condition for waiting takes */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> notEmpty<span class="token punctuation">;</span>

    <span class="token comment">/** Condition for waiting puts */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> notFull<span class="token punctuation">;</span>
    
    <span class="token comment">//ËÆ∞ÂΩï‰∏ã‰∏Ä‰∏™take„ÄÅremove„ÄÅpeekÁöÑÁ¥¢Âºï</span>
    <span class="token keyword">int</span> takeIndex<span class="token punctuation">;</span>

    <span class="token comment">//ËÆ∞ÂΩï‰∏ã‰∏Ä‰∏™put„ÄÅoffer„ÄÅaddÁöÑÁ¥¢Âºï</span>
    <span class="token keyword">int</span> putIndex<span class="token punctuation">;</span>

    <span class="token comment">//ÈòüÂàó‰∏≠ÂÖÉÁ¥†ÁöÑ‰∏™Êï∞</span>
    <span class="token keyword">int</span> count<span class="token punctuation">;</span>
    
    <span class="token comment">//Âè™ÊåáÂÆöÂÆπÈáè</span>
	<span class="token keyword">public</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>capacity<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">//ÊåáÂÆöÂÆπÈáèÂíåReentrantLockÊòØÂê¶ÂÖ¨Âπ≥</span>
    <span class="token keyword">public</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">,</span> <span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>capacity <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>capacity<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//ÈÄöËøáÂ∞ÜÂÖ¨Âπ≥ÊÄß(fairness) ËÆæÁΩÆ‰∏∫trueËÄåÊûÑÈÄ†ÁöÑÈòüÂàóÂÖÅËÆ∏ÊåâÁÖßFIFOÈ°∫Â∫èËÆøÈóÆÁ∫øÁ®ã</span>
        lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span>fair<span class="token punctuation">)</span><span class="token punctuation">;</span>
        notEmpty <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        notFull <span class="token operator">=</span>  lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">//Â∞ÜÈõÜÂêà‰∏≠ÁöÑÂÖÉÁ¥†ÂàùÂßãÂåñÈòüÂàóÁöÑÂÖÉÁ¥†</span>
    <span class="token keyword">public</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">,</span> <span class="token keyword">boolean</span> fair<span class="token punctuation">,</span>
                              <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">></span></span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>capacity<span class="token punctuation">,</span> fair<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Lock only for visibility, not mutual exclusion</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">E</span> e <span class="token operator">:</span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token function">checkNotNull</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    items<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ArrayIndexOutOfBoundsException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            count <span class="token operator">=</span> i<span class="token punctuation">;</span>
            putIndex <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> capacity<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//Ê£ÄÊü•ÂÖÉÁ¥†ÊòØÂê¶‰∏∫nullÔºåÂ¶ÇÊûúÊòØÔºåÊäõÂá∫NullPointerException</span>
        <span class="token function">checkNotNull</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        <span class="token comment">//Âä†ÈîÅ</span>
        lock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//Â¶ÇÊûúÈòüÂàóÂ∑≤Êª°ÔºåÈòªÂ°ûÔºåÁ≠âÂæÖÈòüÂàóÊàê‰∏∫‰∏çÊª°Áä∂ÊÄÅ</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> items<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
                notFull<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//Â∞ÜÂÖÉÁ¥†ÂÖ•Èòü</span>
            <span class="token function">enqueue</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
     <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        <span class="token comment">//È¶ñÂÖàÂä†ÈîÅ</span>
        lock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//Â¶ÇÊûúÈòüÂàó‰∏∫Á©∫ÔºåÈòªÂ°û</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                notEmpty<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//ÈòüÂàó‰∏ç‰∏∫Á©∫ÔºåË∞ÉÁî®dequeue()Âá∫Èòü</span>
            <span class="token keyword">return</span> <span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//ÈáäÊîæÈîÅ</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token class-name">E</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// assert lock.getHoldCount() == 1;</span>
        <span class="token comment">// assert items[putIndex] == null;</span>
        <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> items <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">;</span>
        items<span class="token punctuation">[</span>putIndex<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span><span class="token comment">//ÈÄöËøáÊï∞ÁªÑËøõË°åÂÇ®Â≠ò</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>putIndex <span class="token operator">==</span> items<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
            putIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>
        notEmpty<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">E</span> <span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// assert lock.getHoldCount() == 1;</span>
        <span class="token comment">// assert items[takeIndex] != null;</span>
        <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> items <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
        <span class="token comment">//ÂèñËµ∞Êï∞ÊçÆ</span>
        <span class="token class-name">E</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> items<span class="token punctuation">[</span>takeIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//ÁΩÆ‰∏∫nullÔºå‰ª•Âä©gc</span>
        items<span class="token punctuation">[</span>takeIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">//Âæ™ÁéØÂèñ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>takeIndex <span class="token operator">==</span> items<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
            takeIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        count<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>itrs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            itrs<span class="token punctuation">.</span><span class="token function">elementDequeued</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ÈÄöÁü•Âõ†ÈòüÂàóÊª°ËÄåÈòªÂ°ûÁöÑÁ∫øÁ®ã</span>
        notFull<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÂÆû‰æãÂ¶Ç‰∏ãÔºö</p>
<h4 id="No1-ArrayBlockingQueueDemo-java"><a href="#No1-ArrayBlockingQueueDemo-java" class="headerlink" title="No1_ArrayBlockingQueueDemo.java"></a>No1_ArrayBlockingQueueDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>blockingqueue</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ArrayBlockingQueue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BlockingQueue</span><span class="token punctuation">;</span>

<span class="token comment">/*
 * Áé∞ÊúâÁöÑÁ®ãÂ∫è‰ª£Á†ÅÊ®°Êãü‰∫ßÁîü‰∫Ü16‰∏™Êó•ÂøóÂØπË±°ÔºåÂπ∂‰∏îÈúÄË¶ÅËøêË°å16ÁßíÊâçËÉΩÊâìÂç∞ÂÆåËøô‰∫õÊó•ÂøóÔºå
 * ËØ∑Âú®Á®ãÂ∫è‰∏≠Â¢ûÂä†4‰∏™Á∫øÁ®ãÂéªË∞ÉÁî® parseLog() ÊñπÊ≥ïÊù•ÂàÜÂ§¥ÊâìÂç∞Ëøô16‰∏™Êó•ÂøóÂØπË±°Ôºå
 * Á®ãÂ∫èÂè™ÈúÄË¶ÅËøêË°å4ÁßíÂç≥ÂèØÊâìÂç∞ÂÆåËøô‰∫õÊó•ÂøóÂØπË±°„ÄÇ
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No1_ArrayBlockingQueueDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Êñ∞Âª∫‰∏Ä‰∏™Á≠âÂæÖÈòüÂàó</span>
        <span class="token keyword">final</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> bq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Âõõ‰∏™Á∫øÁ®ã</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                            <span class="token class-name">String</span> log <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> bq<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token function">parseLog</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> log <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" -->  "</span><span class="token punctuation">;</span>
            bq<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Â∞ÜÊï∞ÊçÆÂ≠òÂà∞ÈòüÂàóÈáåÔºÅ</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// parseLogÊñπÊ≥ïÂÜÖÈÉ®ÁöÑ‰ª£Á†Å‰∏çËÉΩÊîπÂä®</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">parseLog</span><span class="token punctuation">(</span><span class="token class-name">String</span> log<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>log <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="ÈìæË°®ÈòªÂ°ûÈòüÂàó-LinkedBlockingQueue"><a href="#ÈìæË°®ÈòªÂ°ûÈòüÂàó-LinkedBlockingQueue" class="headerlink" title="ÈìæË°®ÈòªÂ°ûÈòüÂàó LinkedBlockingQueue"></a>ÈìæË°®ÈòªÂ°ûÈòüÂàó LinkedBlockingQueue</h3><p>‚Äã        <code>LinkedBlockingQueue</code>ÊòØÂü∫‰∫é<strong>ÈìæË°®</strong>ÁöÑÈòªÂ°ûÈòüÂàóÔºåÂêå<code>ArrayListBlockingQueue</code>Á±ª‰ººÔºåÂÖ∂ÂÜÖÈÉ®‰πüÁª¥ÊåÅÁùÄ‰∏Ä‰∏™Êï∞ÊçÆÁºìÂÜ≤ÈòüÂàó(ËØ•ÈòüÂàóÁî±‰∏Ä‰∏™ÈìæË°®ÊûÑÊàê)ÔºåÂΩìÁîü‰∫ßËÄÖÂæÄÈòüÂàó‰∏≠ÊîæÂÖ•‰∏Ä‰∏Ä‰∏™Êï∞ÊçÆÊó∂ÔºåÈòüÂàó‰ºö‰ªéÁîü‰∫ßËÄÖÊâã‰∏≠Ëé∑ÂèñÊï∞ÊçÆÔºåÂπ∂ÁºìÂ≠òÂú®ÈòüÂàóÂÜÖÈÉ®ÔºåËÄåÁîü‰∫ßËÄÖÁ´ãÂç≥ËøîÂõû„ÄÇÂè™ÊúâÂΩìÈòüÂàóÁºìÂÜ≤Âå∫ËææÂà∞ÊúÄÂ§ßÂÄºÁºìÂ≠òÂÆπÈáèÊó∂(<code>LinkedBlockingQueue </code>ÂèØ‰ª•ÈÄöËøáÊûÑÈÄ†ÂáΩÊï∞ÊåáÂÆöËØ•ÂÄº)ÔºåÊâç‰ºöÈòªÂ°ûÁîü‰∫ßËÄÖÈòüÂàóÔºåÁõ¥Âà∞Ê∂àË¥πËÄÖ‰ªéÈòüÂàó‰∏≠Ê∂àË¥πÊéâ‰∏Ä‰ªΩÊï∞ÊçÆÔºå Áîü‰∫ßËÄÖÁ∫øÁ®ã‰ºöË¢´Âî§ÈÜí„ÄÇÂèç‰πãÔºåÂØπ‰∫éÊ∂àË¥πËÄÖËøôÁ´ØÁöÑÂ§ÑÁêÜ‰πüÂü∫‰∫éÂêåÊ†∑ÁöÑÂéüÁêÜ„ÄÇËÄåLinkedBlockingQueue‰πãÊâÄ‰ª•ËÉΩÂ§üÈ´òÊïàÂú∞Â§ÑÁêÜÂπ∂ÂèëÊï∞ÊçÆÔºåËøòÂõ†‰∏∫ÂÖ∂ÂØπ‰∫éÁîü‰∫ßËÄÖÁ´ØÂíåÊ∂àË¥πËÄÖÁ´ØÂàÜÂà´ÈááÁî®‰∫ÜÁã¨Á´ãÁöÑÈîÅÊù•ÊéßÂà∂Êï∞ÊçÆÂêåÊ≠•ÔºåËøô‰πüÊÑèÂë≥ÁùÄÂú®È´òÂπ∂ÂèëÁöÑÊÉÖÂÜµ‰∏ãÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖÂèØ‰ª•Âπ∂Ë°åÂú∞Êìç‰ΩúÈòüÂàó‰∏≠ÁöÑÊï∞ÊçÆÔºå‰ª•Ê≠§Êù•ÊèêÈ´òÊï¥‰∏™ÈòüÂàóÁöÑÂπ∂ÂèëÊÄßËÉΩ„ÄÇ<br>‚Äã        ‰Ωú‰∏∫ÂºÄÂèëËÄÖÔºåÊàë‰ª¨ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂ¶ÇÊûúÊûÑÈÄ†‰∏Ä‰∏Ä‰∏™<code>LinkedBlockingQueue</code>ÂØπË±°ÔºåËÄå**Ê≤°ÊúâÊåáÂÆöÂÖ∂ÂÆπÈáèÂ§ßÂ∞èÔºåLinkedBlockingQueue‰ºöÈªòËÆ§-‰∏Ä‰∏™Á±ª‰ººÊó†ÈôêÂ§ßÂ∞èÁöÑÂÆπÈáè(Integer.MAX_ VALUE)**ÔºåËøôÊ†∑ÁöÑËØùÔºåÂ¶ÇÊûúÁîü‰∫ßËÄÖÁöÑÈÄüÂ∫¶‰∏ÄÊó¶Â§ß‰∫éÊ∂àË¥πËÄÖÁöÑÈÄüÂ∫¶Ôºå‰πüËÆ∏ËøòÊ≤°ÊúâÁ≠âÂà∞ÈòüÂàóÊª°ÈòªÂ°û‰∫ßÁîüÔºåÁ≥ªÁªüÂÜÖÂ≠òÂ∞±ÊúâÂèØËÉΩÂ∑≤Ë¢´Ê∂àËÄóÊÆÜÂ∞Ω‰∫Ü„ÄÇ<br>‚Äã        Êàë‰ª¨ÂÖàÁúã‰∏Ä‰∏ã <code>LinkedBlockingDeque</code>ÁöÑÈÉ®ÂàÜÊ∫êÁ†ÅÔºåÁêÜËß£‰∏Ä‰∏ã <code>ArrayBlockingQueue</code>ÁöÑÂÆûÁé∞ÂéüÁêÜÂíåÊú∫Âà∂„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
        <span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>

	<span class="token comment">//ÂÆπÈáèÔºåÂ¶ÇÊûúÊ≤°ÊúâÊåáÂÆöÔºåËØ•ÂÄº‰∏∫Integer.MAX_VALUE;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> capacity<span class="token punctuation">;</span>

    <span class="token comment">//ÂΩìÂâçÈòüÂàó‰∏≠ÁöÑÂÖÉÁ¥†</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//ÈòüÂàóÂ§¥ËäÇÁÇπÔºåÂßãÁªàÊª°Ë∂≥head.item==null</span>
    <span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> head<span class="token punctuation">;</span>

    <span class="token comment">//ÈòüÂàóÁöÑÂ∞æËäÇÁÇπÔºåÂßãÁªàÊª°Ë∂≥last.next==null</span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> last<span class="token punctuation">;</span>

    <span class="token comment">//Áî®‰∫éÂá∫ÈòüÁöÑÈîÅ</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> takeLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//ÂΩìÈòüÂàó‰∏∫Á©∫Êó∂Ôºå‰øùÂ≠òÊâßË°åÂá∫ÈòüÁöÑÁ∫øÁ®ã</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> notEmpty <span class="token operator">=</span> takeLock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Áî®‰∫éÂÖ•ÈòüÁöÑÈîÅ</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> putLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//ÂΩìÈòüÂàóÊª°Êó∂Ôºå‰øùÂ≠òÊâßË°åÂÖ•ÈòüÁöÑÁ∫øÁ®ã</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> notFull <span class="token operator">=</span> putLock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ÂΩìË∞ÉÁî®Êó†ÂèÇÁöÑÊûÑÈÄ†ÊñπÊ≥ïÊó∂ÔºåÂÆπÈáèÊòØintÁöÑÊúÄÂ§ßÂÄº</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>capacity <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>capacity <span class="token operator">=</span> capacity<span class="token punctuation">;</span>
        last <span class="token operator">=</span> head <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//lastÂíåheadÂú®ÈòüÂàó‰∏∫Á©∫Êó∂ÈÉΩÂ≠òÂú®ÔºåÊâÄ‰ª•ÈòüÂàó‰∏≠Ëá≥Â∞ëÊúâ‰∏Ä‰∏™ËäÇÁÇπ</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">></span></span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> putLock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>putLock<span class="token punctuation">;</span>
        putLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Never contended, but necessary for visibility</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">E</span> e <span class="token operator">:</span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token comment">//‰∏çÊîØÊåÅnullÂÖÉÁ¥†</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> capacity<span class="token punctuation">)</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"Queue full"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token operator">++</span>n<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            count<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            putLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//‰∏çÂÖÅËÆ∏ÂÖÉÁ¥†‰∏∫null</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment">//‰ª•ÂΩìÂâçÂÖÉÁ¥†Êñ∞Âª∫‰∏Ä‰∏™ËäÇÁÇπ</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> putLock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>putLock<span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token punctuation">;</span>
        <span class="token comment">//Ëé∑ÂæóÂÖ•ÈòüÁöÑÈîÅ</span>
        putLock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>

            <span class="token comment">//Â¶ÇÊûúÈòüÂàóÂ∑≤Êª°ÔºåÈÇ£‰πàÂ∞ÜËØ•Á∫øÁ®ãÂä†ÂÖ•Âà∞ConditionÁöÑÁ≠âÂæÖÈòüÂàó‰∏≠</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>count<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                notFull<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token comment">//Â∞ÜËäÇÁÇπÂÖ•Èòü</span>
            <span class="token function">enqueue</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//ÂæóÂà∞ÊèíÂÖ•‰πãÂâçÈòüÂàóÁöÑÂÖÉÁ¥†‰∏™Êï∞</span>
            c <span class="token operator">=</span> count<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//Â¶ÇÊûúËøòÂèØ‰ª•ÊèíÂÖ•ÂÖÉÁ¥†ÔºåÈÇ£‰πàÈáäÊîæÁ≠âÂæÖÁöÑÂÖ•ÈòüÁ∫øÁ®ã</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> capacity<span class="token punctuation">)</span>
                notFull<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//Ëß£ÈîÅ</span>
            putLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">//ÈÄöÁü•Âá∫ÈòüÁ∫øÁ®ãÈòüÂàóÈùûÁ©∫</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token function">signalNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">signalNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> takeLock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>takeLock<span class="token punctuation">;</span>
        <span class="token comment">//Ëé∑ÂèñtakeLock</span>
        takeLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//ÈáäÊîænotEmptyÊù°‰ª∂ÈòüÂàó‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™Á≠âÂæÖÁ∫øÁ®ã</span>
            notEmpty<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            takeLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">E</span> x<span class="token punctuation">;</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> takeLock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>takeLock<span class="token punctuation">;</span>
        <span class="token comment">//Ëé∑ÂèñtakeLockÈîÅ</span>
        takeLock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//Â¶ÇÊûúÈòüÂàó‰∏∫Á©∫ÔºåÈÇ£‰πàÂä†ÂÖ•Âà∞notEmptyÊù°‰ª∂ÁöÑÁ≠âÂæÖÈòüÂàó‰∏≠</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>count<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                notEmpty<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token comment">//ÂæóÂà∞ÈòüÂ§¥ÂÖÉÁ¥†</span>
            x <span class="token operator">=</span> <span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//ÂæóÂà∞ÂèñËµ∞‰∏Ä‰∏™ÂÖÉÁ¥†‰πãÂâçÈòüÂàóÁöÑÂÖÉÁ¥†‰∏™Êï∞</span>
            c <span class="token operator">=</span> count<span class="token punctuation">.</span><span class="token function">getAndDecrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//Â¶ÇÊûúÈòüÂàó‰∏≠ËøòÊúâÊï∞ÊçÆÂèØÂèñÔºåÈáäÊîænotEmptyÊù°‰ª∂Á≠âÂæÖÈòüÂàó‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™Á∫øÁ®ã</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span>
                notEmpty<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            takeLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">//Â¶ÇÊûúÈòüÂàó‰∏≠ÁöÑÂÖÉÁ¥†‰ªéÊª°Âà∞ÈùûÊª°ÔºåÈÄöÁü•putÁ∫øÁ®ã</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> capacity<span class="token punctuation">)</span>
            <span class="token function">signalNotFull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
     <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">signalNotFull</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> putLock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>putLock<span class="token punctuation">;</span>
        putLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            notFull<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            putLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//Âõ†‰∏∫ÈòüÂàó‰∏çÂåÖÂê´nullÂÖÉÁ¥†ÔºåËøîÂõûfalse</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token comment">//Ëé∑Âèñ‰∏§ÊääÈîÅ</span>
        <span class="token function">fullyLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//‰ªéÂ§¥ÁöÑ‰∏ã‰∏Ä‰∏™ËäÇÁÇπÂºÄÂßãÈÅçÂéÜ</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> trail <span class="token operator">=</span> head<span class="token punctuation">,</span> p <span class="token operator">=</span> trail<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
                 p <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                 trail <span class="token operator">=</span> p<span class="token punctuation">,</span> p <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                 <span class="token comment">//Â¶ÇÊûúÂåπÈÖçÔºåÈÇ£‰πàÂ∞ÜËäÇÁÇπ‰ªéÈòüÂàó‰∏≠ÁßªÈô§ÔºåtrailË°®Á§∫ÂâçÈ©±ËäÇÁÇπ</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token function">unlink</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> trail<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//ÈáäÊîæ‰∏§ÊääÈîÅ</span>
            <span class="token function">fullyUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ËøôÈáå‰ΩøÁî®ÂÆû‰æã‰∏é‰∏ä‰∏ÄËäÇ‰∏≠<code>ArrayBlockingQueue</code>ÁöÑ‰æãÂ≠ê‰∏ÄÊ†∑„ÄÇ‰∏çÂêåÁöÑÊòØ,Â∞Ü<code>ArrayBlockingQueue</code>ÁöÑ‰æãÂ≠êÊç¢Êàê<code>LinkedBlockingQueue</code>Âç≥ÂèØÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span>string<span class="token punctuation">></span></span> bq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Êç¢Êàê:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> bq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="No2-LinkedBlockingQueueDemo-java"><a href="#No2-LinkedBlockingQueueDemo-java" class="headerlink" title="No2_LinkedBlockingQueueDemo.java"></a>No2_LinkedBlockingQueueDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>blockingqueue</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BlockingQueue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingQueue</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No2_LinkedBlockingQueueDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Êñ∞Âª∫‰∏Ä‰∏™Á≠âÂæÖÈòüÂàó</span>
        <span class="token keyword">final</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> bq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Âõõ‰∏™Á∫øÁ®ã</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                            <span class="token class-name">String</span> log <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> bq<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token function">parseLog</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> log <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" -->  "</span><span class="token punctuation">;</span>
            bq<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Â∞ÜÊï∞ÊçÆÂ≠òÂà∞ÈòüÂàóÈáåÔºÅ</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// parseLogÊñπÊ≥ïÂÜÖÈÉ®ÁöÑ‰ª£Á†Å‰∏çËÉΩÊîπÂä®</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">parseLog</span><span class="token punctuation">(</span><span class="token class-name">String</span> log<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>log <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="‰ºòÂÖàÁ∫ßÈòªÂ°ûÈòüÂàó-PriorityBlockingQueue"><a href="#‰ºòÂÖàÁ∫ßÈòªÂ°ûÈòüÂàó-PriorityBlockingQueue" class="headerlink" title="‰ºòÂÖàÁ∫ßÈòªÂ°ûÈòüÂàó PriorityBlockingQueue"></a>‰ºòÂÖàÁ∫ßÈòªÂ°ûÈòüÂàó PriorityBlockingQueue</h3><p>‚Äã        <code>PriorityBlockingQueue</code>ÊòØ‰∏Ä‰∏™<strong>ÊîØÊåÅ‰ºòÂÖàÁ∫ßÊéíÂ∫è</strong>ÁöÑ<strong>Êó†ÁïåÈòªÂ°ûÈòüÂàó</strong>Ôºà‰ºòÂÖàÁ∫ßÁöÑÂà§Êñ≠ÈÄöËøáÊûÑÈÄ†ÂáΩÊï∞‰º†ÂÖ•ÁöÑ<code>Compator</code>ÂØπË±°Êù•ÂÜ≥ÂÆö),‰ΩÜÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØ<code>PriorityBlockingQueue</code>Âπ∂‰∏ç‰ºöÈòªÂ°ûÊï∞ÊçÆÁîü‰∫ßËÄÖÔºåËÄåÂè™‰ºöÂú®Ê≤°ÊúâÂèØÊ∂àË¥πÁöÑÊï∞ÊçÆÊó∂ÔºåÈòªÂ°ûÊï∞ÊçÆÁöÑÊ∂àË¥πËÄÖ„ÄÇÂõ†Ê≠§‰ΩøÁî®ÁöÑÊó∂ÂÄôË¶ÅÁâπÂà´Ê≥®ÊÑèÔºåÁîü‰∫ßËÄÖÁîü‰∫ßÊï∞ÊçÆÁöÑÈÄüÂ∫¶ÁªùÂØπ‰∏çËÉΩÂø´‰∫éÊ∂àË¥πËÄÖÊ∂àË¥πÊï∞ÊçÆÁöÑÈÄüÂ∫¶ÔºåÂê¶ÂàôÊó∂Èó¥‰∏ÄÈïøÔºå‰ºöÊúÄÁªàËÄóÂ∞ΩÊâÄÊúâÁöÑÂèØÁî®Â†ÜÂÜÖÂ≠òÁ©∫Èó¥„ÄÇÂú®ÂÆûÁé∞<code>PriorityBlockingQueue</code>Êó∂ÔºåÂÜÖÈÉ®ÊéßÂà∂Á∫øÁ®ãÂêåÊ≠•ÁöÑÈîÅÈááÁî®ÁöÑÊòØÂÖ¨Âπ≥ÈîÅ„ÄÇ<br>‚Äã        ÂÖàÁúã‰∏Ä‰∏ã<code>PriorityBlockingQueue</code>ÁöÑÈÉ®ÂàÜÊ∫êÁ†Å,ÁêÜËß£‰∏Ä‰∏ã <code>PriorityBlockingQueue</code>ÁöÑÂÆûÁé∞ÂéüÁêÜÂíåÊú∫Âà∂Ôºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">/**
     *  ÈªòËÆ§ÁöÑÊï∞ÁªÑÂÆπÈáè
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_INITIAL_CAPACITY <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
 
    <span class="token comment">/**
     *  ÊúÄÂ§ßÁöÑÊï∞ÁªÑÂÆπÈáè
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX_ARRAY_SIZE <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">;</span>
 
    <span class="token comment">/**
     * ‰ºòÂÖàÈòüÂàóÊï∞ÁªÑ
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> queue<span class="token punctuation">;</span>
 
    <span class="token comment">/**
     *  ‰ºòÂÖàÁ∫ßÈòüÂàó‰∏≠ÁöÑÂÖÉÁ¥†ÊÄªÊï∞
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>
 
    <span class="token comment">/**
     *  ÂÖÉÁ¥†ÊØîËæÉÂô®ÔºåÂ¶ÇÊûúÊåâÁÖßËá™ÁÑ∂È°∫Â∫èËøõË°åÊéíÂ∫èÔºåÂàô‰∏∫ null
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">E</span><span class="token punctuation">></span></span> comparator<span class="token punctuation">;</span>
 
    <span class="token comment">/**
     *  ÊéßÂà∂ËÆøÈóÆÁöÑÂèØÈáçÂÖ•‰∫íÊñ•ÈîÅ
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock<span class="token punctuation">;</span>
 
    <span class="token comment">/**
     *  ÈòüÂàó‰∏∫Á©∫Êó∂ÔºåÁõÆÊ†áÁ∫øÁ®ãÂ∞ÜÂú®ÈùûÁ©∫Êù°‰ª∂ÈòªÂ°ûÁ≠âÂæÖ
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> notEmpty<span class="token punctuation">;</span>
 
    <span class="token comment">/**
     *  ÂàùÂßã0‰∏∫ÂèØËé∑ÂèñÁä∂ÊÄÅÔºåÁî®‰∫éÊéßÂà∂Êâ©ÂÆπÊìç‰Ωú
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> allocationSpinLock<span class="token punctuation">;</span>
    
        <span class="token comment">/**
     *  ÂàõÂª∫‰∏Ä‰∏™ÂàùÂßãÂÆπÈáè‰∏∫ 11ÔºåÊåâÁÖßËá™ÁÑ∂È°∫Â∫èÊéíÂ∫èÁöÑ PriorityBlockingQueue ÂÆû‰æã
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">.</span>DEFAULT_INITIAL_CAPACITY<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token comment">/**
     *  ÂàõÂª∫‰∏Ä‰∏™ÂàùÂßãÂÆπÈáè‰∏∫ initialCapacityÔºåÊåâÁÖßËá™ÁÑ∂È°∫Â∫èÊéíÂ∫èÁöÑ PriorityBlockingQueue ÂÆû‰æã
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token comment">/**
     *  ÂàõÂª∫‰∏Ä‰∏™ÂàùÂßãÂÆπÈáè‰∏∫ initialCapacityÔºåÊåâÁÖßËá™ÁÑ∂È°∫Â∫èÊéíÂ∫èÁöÑ comparator ÂÆû‰æã
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span>
            <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">E</span><span class="token punctuation">></span></span> comparator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>notEmpty <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>comparator <span class="token operator">=</span> comparator<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>initialCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">offer</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">/**
     *  Â∞ÜÁõÆÊ†áÂÖÉÁ¥†ÊèíÂÖ•Âà∞ÈòüÂàó‰∏≠ÔºåÁî±‰∫éÊòØÊó†ÁïåÁöÑÔºå‰∏ç‰ºöË¢´ÈòªÂ°û
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">offer</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// never need to block</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">offer</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/**
         * nÔºölength
         * capÔºöcapacity
         */</span>
        <span class="token keyword">int</span> n<span class="token punctuation">,</span> cap<span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">;</span>
        <span class="token comment">// ÂÖÉÁ¥†‰∏™Êï∞Ë∂ÖÂá∫ÈòüÂàóÈïøÂ∫¶ÔºåÂàôËøõË°åÊâ©ÂÆπ</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">=</span> size<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token punctuation">(</span>cap <span class="token operator">=</span> <span class="token punctuation">(</span>array <span class="token operator">=</span> queue<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">tryGrow</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">E</span><span class="token punctuation">></span></span> cmp <span class="token operator">=</span> comparator<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// Ëá™ÁÑ∂È°∫Â∫èÁöÑÊèíÂÖ•</span>
                <span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">.</span><span class="token function">siftUpComparable</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> array<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// ‰ΩøÁî®ÊåáÂÆöÊØîËæÉÂô®ÁöÑÊèíÂÖ•</span>
                <span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">.</span><span class="token function">siftUpUsingComparator</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> array<span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            size <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token comment">// Âî§ÈÜíÂú®ÈùûÁ©∫Êù°‰ª∂‰∏äÈòªÂ°ûÁ≠âÂæÖÁöÑÁ∫øÁ®ã</span>
            notEmpty<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">tryGrow</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span> <span class="token keyword">int</span> oldCap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// must release and then re-acquire main lock</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newArray <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// ÂΩìÂâçÊ≤°ÊúâÁ∫øÁ®ãÂú®ÊâßË°åÊâ©ÂÆπ &amp;&amp; ÂéüÂ≠êÊõ¥Êñ∞Êâ©ÂÆπÊ†áËØÜ‰∏∫ 1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>allocationSpinLock <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
                <span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">.</span>ALLOCATIONSPINLOCK<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">/**
                 * 1ÔºâÊóßÂÆπÈáèÂ∞è‰∫é 64ÔºåÊâßË°å„ÄêÂèåÂÄç+2„ÄëÊâ©ÂÆπ
                 * 2ÔºâÊóßÂÆπÈáèÂ§ß‰∫éÁ≠â‰∫é 64ÔºåÊâßË°å1.5ÂÄçÂêë‰∏ãÂèñÊï¥Êâ©ÂÆπ
                 */</span>
                <span class="token keyword">int</span> newCap <span class="token operator">=</span> oldCap <span class="token operator">+</span> <span class="token punctuation">(</span>oldCap <span class="token operator">&lt;</span> <span class="token number">64</span> <span class="token operator">?</span>
                        oldCap <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token comment">// grow faster if small</span>
                            oldCap <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Êñ∞ÂÆπÈáèË∂ÖÂá∫ÊúÄÂ§ßÂÆπÈáè</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>newCap <span class="token operator">-</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">.</span>MAX_ARRAY_SIZE <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// possible overflow</span>
                    <span class="token keyword">final</span> <span class="token keyword">int</span> minCap <span class="token operator">=</span> oldCap <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token comment">// Â¶ÇÊûúÂ∑≤ÁªèÊ∫¢Âá∫ÔºåÂàôÊäõÂá∫ OutOfMemoryError ÂºÇÂ∏∏</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>minCap <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> minCap <span class="token operator">></span> <span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">.</span>MAX_ARRAY_SIZE<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">OutOfMemoryError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token comment">// ÂÜôÂÖ•ÊúÄÂ§ßÂÆπÈáè</span>
                    newCap <span class="token operator">=</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">.</span>MAX_ARRAY_SIZE<span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token comment">// ÂàõÂª∫Êñ∞ÁöÑÂØπË±°Êï∞ÁªÑ</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>newCap <span class="token operator">></span> oldCap <span class="token operator">&amp;&amp;</span> queue <span class="token operator">==</span> array<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    newArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// ÈáçÁΩÆÊâ©ÂÆπÊ†áËÆ∞</span>
                allocationSpinLock <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// ËØ¥ÊòéÂ∑≤ÁªèÊúâÁ∫øÁ®ãÂú®ÊâßË°åÊâ©ÂÆπÔºåÂàôÁ≠âÂæÖÂÖ∂Êâ©ÂÆπÂÆåÊàê</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newArray <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newArray <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> queue <span class="token operator">==</span> array<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// Êâ©ÂÆπÊàêÂäüÁöÑÁ∫øÁ®ã‰ºöÂ∞ÜÂÖÉÁ¥†‰ªéÊóßÊï∞ÁªÑÊã∑Ë¥ùÂà∞Êñ∞Êï∞ÁªÑ‰∏≠</span>
            queue <span class="token operator">=</span> newArray<span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> newArray<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * ËøôÈáå‰∏ªË¶ÅÂ∞±ÊòØÂêëÂ†Ü‰∏≠ÊèíÂÖ•ÂÖÉÁ¥†ÔºåÂπ∂‰∏îÊèíÂÖ•ÁöÑÂêåÊó∂Ë¶ÅË∞ÉÊï¥Â†ÜÔºå‰øùÊåÅÊúÄÂ∞èÂ†ÜÁä∂ÊÄÅ
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">siftUpComparable</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token class-name">T</span> x<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> x<span class="token punctuation">;</span>
        <span class="token comment">// ÊèíÂÖ•ÂÖÉÁ¥†ÁöÑÁõÆÊ†áÁ¥¢Âºï</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>k <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// ËÆ°ÁÆóÁà∂ËäÇÁÇπÁ¥¢Âºï</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> parent <span class="token operator">=</span> k <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token comment">// ËØªÂèñÁà∂ËäÇÁÇπÂÄº</span>
            <span class="token keyword">final</span> <span class="token class-name">Object</span> e <span class="token operator">=</span> array<span class="token punctuation">[</span>parent<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">// Êñ∞Â¢ûÂÖÉÁ¥†Â∑≤Áªè >= ÂΩìÂâçËäÇÁÇπÔºåÂàôÊó†ÈúÄ‰∏äÁßª</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> e<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token comment">// Áà∂ËäÇÁÇπÂÖÉÁ¥†‰∏ãÁßª</span>
            array<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token comment">// ÈÄíÂΩíÊØîËæÉÁ•ñÁà∂ËäÇÁÇπ</span>
            k <span class="token operator">=</span> parent<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// ÊèíÂÖ•ÁõÆÊ†áÂÖÉÁ¥†</span>
        array<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token comment">/**
     *  ÂÆûÁé∞ÈÄªËæëÂíå siftUpComparable ‰∏ÄËá¥
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">siftUpUsingComparator</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token class-name">T</span> x<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span>
            <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> cmp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>k <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> parent <span class="token operator">=</span> k <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token class-name">Object</span> e <span class="token operator">=</span> array<span class="token punctuation">[</span>parent<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> e<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            array<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
            k <span class="token operator">=</span> parent<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        array<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
        <span class="token comment">/**
     *  Â¶ÇÊûúÈòüÂàó‰∏∫Á©∫ÔºåÂàôÈòªÂ°ûÁ≠âÂæÖÊúâÂèØÁî®ÂÖÉÁ¥†ÂêéÈáçËØïÔºåÂê¶ÂàôÁßªÈô§Âπ∂ËøîÂõû‰ºòÂÖàÁ∫ßÊúÄÈ´òÁöÑÂÖÉÁ¥†
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">E</span> result<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// Â∞ùËØïÁßªÈô§Âπ∂ËøîÂõû‰ºòÂÖàÁ∫ßÊúÄÈ´òÁöÑÂÖÉÁ¥†</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>result <span class="token operator">=</span> <span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// ÂΩìÂâçÁ∫øÁ®ãÂú®ÈùûÁ©∫Êù°‰ª∂‰∏äÈòªÂ°ûÁ≠âÂæÖÔºåË¢´Âî§ÈÜíÂêéÈáçËØï</span>
                notEmpty<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">private</span> <span class="token class-name">E</span> <span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ËÆ°ÁÆóÂ∞æÈÉ®ÂÖÉÁ¥†Á¥¢Âºï</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> n <span class="token operator">=</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment">// ÈòüÂàó‰∏∫Á©∫ÔºåÂàôËøîÂõû null</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> queue<span class="token punctuation">;</span>
            <span class="token comment">// ËØªÂèñ‰ºòÂÖàÁ∫ßÊúÄÈ´òÁöÑÂÖÉÁ¥†</span>
            <span class="token keyword">final</span> <span class="token class-name">E</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">// ËØªÂèñÂ∞æÈÉ®ÂÖÉÁ¥†</span>
            <span class="token keyword">final</span> <span class="token class-name">E</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> array<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">// Ê∏ÖÁ©∫Â∞æÈÉ®ÂÖÉÁ¥†</span>
            array<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">E</span><span class="token punctuation">></span></span> cmp <span class="token operator">=</span> comparator<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">.</span><span class="token function">siftDownComparable</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> array<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">.</span><span class="token function">siftDownUsingComparator</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> array<span class="token punctuation">,</span> n<span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            size <span class="token operator">=</span> n<span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token comment">/**
     * Inserts item x at position k, maintaining heap invariant by
     * demoting x down the tree repeatedly until it is less than or
     * equal to its children or is a leaf.
     *
     * @param k ÈúÄË¶ÅÂ°´ÂÖÖÁöÑÁõÆÊ†áÁ¥¢Âºï
     * @param x ÈúÄË¶ÅÊèíÂÖ•ÁöÑÁõÆÊ†áÂÖÉÁ¥†
     * @param array ÊåÅÊúâÂØπË±°ÁöÑÊï∞ÁªÑ
     * @param n Â†ÜÂ§ßÂ∞è
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">siftDownComparable</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token class-name">T</span> x<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span>
            <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>x<span class="token punctuation">;</span>
            <span class="token comment">// ËÆ°ÁÆó‰∫åÂàÜÁ¥¢Âºï</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> half <span class="token operator">=</span> n <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">;</span>           <span class="token comment">// loop while a non-leaf</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;</span> half<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// ËÆ°ÁÆóÂ∑¶Â≠êËäÇÁÇπÁ¥¢Âºï</span>
                <span class="token keyword">int</span> child <span class="token operator">=</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// assume left child is least</span>
                <span class="token comment">// ËØªÂèñËäÇÁÇπÂÄº</span>
                <span class="token class-name">Object</span> c <span class="token operator">=</span> array<span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">// ËÆ°ÁÆóÂè≥Â≠êËäÇÁÇπÁ¥¢Âºï</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> right <span class="token operator">=</span> child <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token comment">/**
                 *  Âè≥Â≠êËäÇÁÇπÁ¥¢ÂºïÂ∞è‰∫éÁõÆÊ†áÂ†ÜÂ§ßÂ∞è &amp;&amp;
                 *  Â∑¶Â≠êËäÇÁÇπÂÄº > Âè≥Â≠êËäÇÁÇπÂÄº
                 */</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span>
                        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> array<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// ËØªÂèñÂè≥Â≠êËäÇÁÇπÂÄºÔºåÊõ¥Êñ∞Êü•ÊâæËäÇÁÇπÁ¥¢Âºï</span>
                    c <span class="token operator">=</span> array<span class="token punctuation">[</span>child <span class="token operator">=</span> right<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token comment">// ÁõÆÊ†áÈîÆÂ∑≤ÁªèÂ∞è‰∫éÊü•ÊâæËäÇÁÇπÔºåÂàôÂèØ‰ª•Áõ¥Êé•ÊèíÂÖ•</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> c<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token comment">// Âê¶ÂàôÔºåÊèêÂçáÂ≠êËäÇÁÇπ‰∏∫Áà∂ËäÇÁÇπ</span>
                array<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>
                <span class="token comment">// Ëø≠‰ª£Â§ÑÁêÜÂ≠êËäÇÁÇπ</span>
                k <span class="token operator">=</span> child<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token comment">// ÊèíÂÖ•ÁõÆÊ†áÂÄº</span>
            array<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">siftDownUsingComparator</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token class-name">T</span> x<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">,</span>
            <span class="token keyword">int</span> n<span class="token punctuation">,</span>
            <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> cmp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> half <span class="token operator">=</span> n <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;</span> half<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">int</span> child <span class="token operator">=</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token class-name">Object</span> c <span class="token operator">=</span> array<span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">final</span> <span class="token keyword">int</span> right <span class="token operator">=</span> child <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>right <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> cmp<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> c<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> array<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        c <span class="token operator">=</span> array<span class="token punctuation">[</span>child <span class="token operator">=</span> right<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> c<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    array<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>
                    k <span class="token operator">=</span> child<span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                array<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="No3-PriorityBlockingQueueDemo-java"><a href="#No3-PriorityBlockingQueueDemo-java" class="headerlink" title="No3_PriorityBlockingQueueDemo.java"></a>No3_PriorityBlockingQueueDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>blockingqueue</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No3_PriorityBlockingQueueDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">PriorityBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> pbq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pbq<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"person3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÂÆπÂô®‰∏∫Ôºö"</span> <span class="token operator">+</span> pbq<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pbq<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"person2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÂÆπÂô®‰∏∫Ôºö"</span> <span class="token operator">+</span> pbq<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pbq<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"person1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÂÆπÂô®‰∏∫Ôºö"</span> <span class="token operator">+</span> pbq<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pbq<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"person4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÂÆπÂô®‰∏∫Ôºö"</span> <span class="token operator">+</span> pbq<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÂàÜÂâ≤Á∫ø----------------------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Ëé∑ÂèñÂÖÉÁ¥† "</span> <span class="token operator">+</span> pbq<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÂÆπÂô®‰∏∫Ôºö"</span> <span class="token operator">+</span> pbq<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÂàÜÂâ≤Á∫ø----------------------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËæìÂá∫‰∏∫Ôºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ÂÆπÂô®‰∏∫Ôºö<span class="token punctuation">[</span>person3<span class="token punctuation">]</span>
ÂÆπÂô®‰∏∫Ôºö<span class="token punctuation">[</span>person2<span class="token punctuation">,</span> person3<span class="token punctuation">]</span>
ÂÆπÂô®‰∏∫Ôºö<span class="token punctuation">[</span>person1<span class="token punctuation">,</span> person3<span class="token punctuation">,</span> person2<span class="token punctuation">]</span>
ÂÆπÂô®‰∏∫Ôºö<span class="token punctuation">[</span>person1<span class="token punctuation">,</span> person3<span class="token punctuation">,</span> person2<span class="token punctuation">,</span> person4<span class="token punctuation">]</span>
ÂàÜÂâ≤Á∫ø<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
Ëé∑ÂèñÂÖÉÁ¥† person1
ÂÆπÂô®‰∏∫Ôºö<span class="token punctuation">[</span>person2<span class="token punctuation">,</span> person3<span class="token punctuation">,</span> person4<span class="token punctuation">]</span>
ÂàÜÂâ≤Á∫ø<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
Ëé∑ÂèñÂÖÉÁ¥† person2
ÂÆπÂô®‰∏∫Ôºö<span class="token punctuation">[</span>person3<span class="token punctuation">,</span> person4<span class="token punctuation">]</span>
ÂàÜÂâ≤Á∫ø<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
Ëé∑ÂèñÂÖÉÁ¥† person3
ÂÆπÂô®‰∏∫Ôºö<span class="token punctuation">[</span>person4<span class="token punctuation">]</span>
ÂàÜÂâ≤Á∫ø<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
Ëé∑ÂèñÂÖÉÁ¥† person4
ÂÆπÂô®‰∏∫Ôºö<span class="token punctuation">[</span><span class="token punctuation">]</span>
ÂàÜÂâ≤Á∫ø<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="Âª∂Êó∂ÈòüÂàóDelayQueue"><a href="#Âª∂Êó∂ÈòüÂàóDelayQueue" class="headerlink" title="Âª∂Êó∂ÈòüÂàóDelayQueue"></a>Âª∂Êó∂ÈòüÂàóDelayQueue</h3><p>‚Äã        <code>DelayQueue</code>ÊòØ‰∏Ä‰∏™ÊîØÊåÅÂª∂Êó∂Ëé∑ÂèñÂÖÉÁ¥†ÁöÑ‰ΩøÁî®‰ºòÂÖàÁ∫ßÈòüÂàóÁöÑÂÆûÁé∞ÁöÑÊó†ÁïåÈòªÂ°ûÈòüÂàó„ÄÇÈòüÂàó‰∏≠ÁöÑÂÖÉÁ¥†ÂøÖÈ°ªÂÆûÁé∞ <code>Delayed</code>Êé•Âè£Âíå <code>Comparable</code>Êé•Âè£,‰πüÂ∞±ÊòØËØ¥<code>DelayQueue</code>ÈáåÈù¢ÁöÑÂÖÉÁ¥†ÂøÖÈ°ªÊúâ<code>public int compareTo(To)</code>Âíå <code>long getDelay(TimeUnit unit)</code>ÊñπÊ≥ïÂ≠òÂú®Âú®ÂàõÂª∫ÂÖÉÁ¥†Êó∂ÂèØ‰ª•ÊåáÂÆöÂ§ö‰πÖÊâçËÉΩ‰ªéÈòüÂàó‰∏≠Ëé∑ÂèñÂΩìÂâçÂÖÉÁ¥†„ÄÇÂè™ÊúâÂú®Âª∂ËøüÊúüÊª°Êó∂ÊâçËÉΩ‰ªéÈòüÂàó‰∏≠ÊèêÂèñÂÖÉÁ¥†„ÄÇÊàë‰ª¨ÂèØ‰ª•Â∞Ü<code>DelayQueue</code>ËøêÁî®Âú®‰ª•‰∏ãÂú∫ÊôØ‰∏≠:</p>
<ul>
<li>ÁºìÂ≠òÁ≥ªÁªüÁöÑËÆæËÆ°„ÄÇÂèØ‰ª•Áî® <code>DelayQueue</code>‰øùÂ≠òÁºìÂ≠òÂÖÉÁ¥†ÁöÑÊúâÊïàÊúü,‰ΩøÁî®‰∏Ä‰∏™Á∫øÁ®ãÂæ™ÁéØÊü•ËØ¢<br><code>DelayQueue</code>Ôºå‰∏ÄÊó¶ËÉΩ‰ªé <code>DelayQueue</code>‰∏≠Ëé∑ÂèñÂÖÉÁ¥†Êó∂,Ë°®Á§∫ÁºìÂ≠òÊúâÊïàÊúüÂà∞‰∫Ü„ÄÇ</li>
<li>ÂÆöÊó∂‰ªªÂä°Ë∞ÉÂ∫¶‰ΩøÁî®<code>DelayQueue</code>‰øùÂ≠òÂΩìÂ§©Â∞Ü‰ºöÊâßË°åÁöÑ‰ªªÂä°ÂíåÊâßË°åÊó∂Èó¥‰∏ÄÊó¶‰ªé <code>DelayQueue</code>‰∏≠Ëé∑ÂèñÂà∞‰ªªÂä°Â∞±ÂºÄÂßãÊâßË°å,ÊØîÂ¶Ç<code>TimerQueue</code> Â∞±ÊòØ‰ΩøÁî® <code>DelayQueue</code>ÂÆûÁé∞ÁöÑ„ÄÇ</li>
</ul>
<p>‚Äã        Êàë‰ª¨Êù•Áúã‰∏Ä‰∏ã <code>DelayQueue</code>ÁöÑÊ∫êÁ†ÅÔºåÊù•ÁêÜËß£‰∏Ä‰∏ã <code>DelayQueue</code>ÁöÑÂÆûÁé∞ÂéüÁêÜÂíåÊú∫Âà∂Ôºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DelayQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span> <span class="token keyword">extends</span> <span class="token class-name">Delayed</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    
    <span class="token comment">// ‰øùËØÅÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÈîÅ</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">transient</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ‰ºòÂÖàÈòüÂàó</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PriorityQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> q <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PriorityQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Ê†áËÆ∞ÂèñÂÖÉÁ¥†Êó∂ÊòØÂê¶ÊúâÁ∫øÁ®ãÂú®ÊéíÈòü</span>
    <span class="token keyword">private</span> <span class="token class-name">Thread</span> leader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// ÊòØÂê¶ÂèØÂèñÁöÑÊù°‰ª∂ÂèòÈáè</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> available <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">offer</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">//Â∞ÜÊåáÂÆöÁöÑÂÖÉÁ¥†ÊèíÂÖ•Ê≠§Âª∂ËøüÈòüÂàó</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">offer</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            q<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                leader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                available<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
   		<span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
    	lock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          		<span class="token comment">// Â†ÜÈ°∂ÂÖÉÁ¥†</span>
            	<span class="token class-name">E</span> first <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          		<span class="token comment">// ‰∏∫Á©∫ÔºåÁ≠âÂæÖË¢´Âî§ÈÜí</span>
            	<span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                	available<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          		<span class="token comment">// Â†ÜÈ°∂‰∏ç‰∏∫Á©∫</span>
            	<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
              		<span class="token comment">// Ëé∑ÂèñÂÖÉÁ¥†ÁöÑË∂ÖÊó∂Êó∂Èó¥</span>
                	<span class="token keyword">long</span> delay <span class="token operator">=</span> first<span class="token punctuation">.</span><span class="token function">getDelay</span><span class="token punctuation">(</span>NANOSECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
              		<span class="token comment">// Â∑≤ËøáÊúüÂ∞±ÂèñËµ∞</span>
                	<span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> q<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// Ê≤°ËøáÊúüÂæÄ‰∏ãËµ∞</span>
                    <span class="token comment">// ËøôÈáåËÆæÁΩÆ‰∏∫ null ÊòØÊîæÂú®ËøòÊúâÂà´ÁöÑÁ∫øÁ®ãÊåÅÊúâÊ≤°ÊúâÈáäÊîæÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÊºè</span>
                    first <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// don't retain ref while waiting</span>
                    <span class="token comment">// Ê†°È™åÊòØÂê¶ÊúâÁ≠âÂæÖÁ∫øÁ®ãÔºåÊúâÂ∞±Á≠âÂæÖleaderÁ∫øÁ®ãÂèñÂÆåÊàñÊúâÊñ∞Âä†ÂÖ•ÁöÑÂÖÉÁ¥†Âî§ÈÜíÂÆÉ</span>
                	<span class="token keyword">if</span> <span class="token punctuation">(</span>leader <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    	available<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              		<span class="token comment">// Ê≤°ÊúâÁ≠âÂæÖÁ∫øÁ®ãÔºåÂ∞±ÊääËá™Â∑±ËÆæÁΩÆ‰∏∫Á≠âÂæÖÁ∫øÁ®ãÔºåÁÑ∂ÂêéÁ≠âÂæÖË∂ÖÊó∂Êó∂Èó¥Âî§ÈÜíÈáçËØï</span>
                	<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    	<span class="token class-name">Thread</span> thisThread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    	leader <span class="token operator">=</span> thisThread<span class="token punctuation">;</span>
                    	<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        	available<span class="token punctuation">.</span><span class="token function">awaitNanos</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    	<span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                      		<span class="token comment">// Âî§ÈÜíÂêéÂ∞±Êää leader ÁΩÆÁ©∫</span>
                        	<span class="token keyword">if</span> <span class="token punctuation">(</span>leader <span class="token operator">==</span> thisThread<span class="token punctuation">)</span>
                            leader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    	<span class="token punctuation">&#125;</span>
                	<span class="token punctuation">&#125;</span>
            	<span class="token punctuation">&#125;</span>
        	<span class="token punctuation">&#125;</span>
    	<span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
      		<span class="token comment">// Ê≤°ÊúâÁ≠âÂæÖÁ∫øÁ®ãÂπ∂‰∏îÈòüÂàóËøòÊúâÊï∞ÊçÆÔºåÂ∞±Âî§ÈÜí‰∏ã‰∏Ä‰∏™Á∫øÁ®ãÊù•Âèñ</span>
        	<span class="token keyword">if</span> <span class="token punctuation">(</span>leader <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> q<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            	available<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        		lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">E</span> first <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//Ê£ÄÊü•Â†ÜÈ°∂ÂÖÉÁ¥†ÔºåÂ¶ÇÊûú‰∏∫Á©∫ÊàñËÄÖËøòÊ≤°Âà∞ÊúüÂë¢ÔºåËøîÂõû null</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> first<span class="token punctuation">.</span><span class="token function">getDelay</span><span class="token punctuation">(</span>NANOSECONDS<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token comment">//Âê¶ÂàôËøîÂõûÂèñÂá∫Â†ÜÈ°∂ÂÖÉÁ¥†</span>
                <span class="token keyword">return</span> q<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>‚Äã        Êàë‰ª¨Êù•Áúã‰∏Ä‰∏ã DelayQueueÁöÑ‰ΩøÁî®ÂÆû‰æãÔºö<br>‚Äã        (1ÔºâÂÆûÁé∞‰∏Ä‰∏™ StudentÂØπË±°‰Ωú‰∏∫DelayQueueÁöÑÂÖÉÁ¥†ÂøÖÈ°ªÂÆûÁé∞ DelayedÊé•Âè£ÁöÑ‰∏§‰∏™ÊñπÊ≥ï„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">implements</span> <span class="token class-name">Delayed</span> <span class="token punctuation">&#123;</span><span class="token comment">//ÂøÖÈ°ªÂÆûÁé∞DelayedÊé•Âè£</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">long</span> submitTime<span class="token punctuation">;</span><span class="token comment">// ‰∫§Âç∑Êó∂Èó¥</span>
        <span class="token keyword">private</span> <span class="token keyword">long</span> workTime<span class="token punctuation">;</span><span class="token comment">// ËÄÉËØïÊó∂Èó¥</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" ‰∫§Âç∑,Áî®Êó∂"</span> <span class="token operator">+</span> workTime<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">long</span> submitTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>workTime <span class="token operator">=</span> submitTime<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>submitTime <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>submitTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" ‰∫§Âç∑,Áî®Êó∂"</span> <span class="token operator">+</span> workTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">//ÂøÖÈ°ªÂÆûÁé∞getDelayÊñπÊ≥ï</span>
        <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getDelay</span><span class="token punctuation">(</span><span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">//		ËøîÂõû‰∏Ä‰∏™Âª∂ËøüÊó∂Èó¥</span>
            <span class="token keyword">return</span> unit<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>submitTime <span class="token operator">-</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unit<span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">//ÂøÖÈ°ªÂÆûÁé∞compareToÊñπÊ≥ï</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">Delayed</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//ÊØîËæÉÁöÑÊñπÊ≥ï</span>
            <span class="token class-name">Student</span> that <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Student</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
            <span class="token keyword">return</span> submitTime <span class="token operator">></span> that<span class="token punctuation">.</span>submitTime <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token punctuation">(</span>submitTime <span class="token operator">&lt;</span> that<span class="token punctuation">.</span>submitTime <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÊâßË°åËøêË°åÁ±ª</p>
<pre class="line-numbers language-none"><code class="language-none">public static void main(String[] args) &#123;

        &#x2F;&#x2F;‰∏çÂêàÊ≥ïÁöÑÊûÑÈÄ†ÂáΩÊï∞
        &#x2F;&#x2F;ÁºñËØëÊó∂ÈîôËØØÔºöÊûÑÈÄ†ÂáΩÊï∞ SingleObject() ÊòØ‰∏çÂèØËßÅÁöÑ
        &#x2F;&#x2F;SingleObject object &#x3D; new SingleObject();

        &#x2F;&#x2F;Ëé∑ÂèñÂîØ‰∏ÄÂèØÁî®ÁöÑÂØπË±°
        Singleton object0 &#x3D; Singleton.getInstance();

        &#x2F;&#x2F;Ëé∑ÂèñÂîØ‰∏ÄÂèØÁî®ÁöÑÂØπË±°
        Singleton object1 &#x3D; Singleton.getInstance();

    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="No4-DelayQueueDemo-java"><a href="#No4-DelayQueueDemo-java" class="headerlink" title="No4_DelayQueueDemo.java"></a>No4_DelayQueueDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>blockingqueue</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">DelayQueue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Delayed</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No4_DelayQueueDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">implements</span> <span class="token class-name">Delayed</span> <span class="token punctuation">&#123;</span><span class="token comment">//ÂøÖÈ°ªÂÆûÁé∞DelayedÊé•Âè£</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">long</span> submitTime<span class="token punctuation">;</span><span class="token comment">// ‰∫§Âç∑Êó∂Èó¥</span>
        <span class="token keyword">private</span> <span class="token keyword">long</span> workTime<span class="token punctuation">;</span><span class="token comment">// ËÄÉËØïÊó∂Èó¥</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" ‰∫§Âç∑,Áî®Êó∂"</span> <span class="token operator">+</span> workTime<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">long</span> submitTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>workTime <span class="token operator">=</span> submitTime<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>submitTime <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>submitTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" ‰∫§Âç∑,Áî®Êó∂"</span> <span class="token operator">+</span> workTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">//ÂøÖÈ°ªÂÆûÁé∞getDelayÊñπÊ≥ï</span>
        <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getDelay</span><span class="token punctuation">(</span><span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">//		ËøîÂõû‰∏Ä‰∏™Âª∂ËøüÊó∂Èó¥</span>
            <span class="token keyword">return</span> unit<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>submitTime <span class="token operator">-</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unit<span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">//ÂøÖÈ°ªÂÆûÁé∞compareToÊñπÊ≥ï</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">Delayed</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//ÊØîËæÉÁöÑÊñπÊ≥ï</span>
            <span class="token class-name">Student</span> that <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Student</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
            <span class="token keyword">return</span> submitTime <span class="token operator">></span> that<span class="token punctuation">.</span>submitTime <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token punctuation">(</span>submitTime <span class="token operator">&lt;</span> that<span class="token punctuation">.</span>submitTime <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Êñ∞Âª∫‰∏Ä‰∏™Á≠âÂæÖÈòüÂàó</span>
        <span class="token keyword">final</span> <span class="token class-name">DelayQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> bq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DelayQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"Â≠¶Áîü"</span><span class="token operator">+</span>i<span class="token punctuation">,</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bq<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Â∞ÜÊï∞ÊçÆÂ≠òÂà∞ÈòüÂàóÈáåÔºÅ</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">//Ëé∑Âèñ‰ΩÜ‰∏çÁßªÈô§Ê≠§ÈòüÂàóÁöÑÂ§¥ÈÉ®ÔºõÂ¶ÇÊûúÊ≠§ÈòüÂàó‰∏∫Á©∫ÔºåÂàôËøîÂõû null„ÄÇ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"bq.peek()"</span><span class="token operator">+</span>bq<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Ëé∑ÂèñÂπ∂ÁßªÈô§Ê≠§ÈòüÂàóÁöÑÂ§¥ÈÉ®ÔºåÂú®ÂèØ‰ªéÊ≠§ÈòüÂàóËé∑ÂæóÂà∞ÊúüÂª∂ËøüÁöÑÂÖÉÁ¥†ÔºåÊàñËÄÖÂà∞ËææÊåáÂÆöÁöÑÁ≠âÂæÖÊó∂Èó¥‰πãÂâç‰∏ÄÁõ¥Á≠âÂæÖÔºàÂ¶ÇÊúâÂøÖË¶ÅÔºâ„ÄÇ</span>
        <span class="token comment">//poll(long timeout, TimeUnit unit) Â§ßÂÆ∂ÂèØ‰ª•ËØï‰∏ÄËØïËøô‰∏™ÊñπÊ≥ï</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËøêË°åÁªìÊûúÂ¶Ç‰∏ã:ÊØèÊ¨°ËøêË°åÁªìÊûúÈÉΩ‰∏ç‰∏ÄÊ†∑ÔºåÊàë‰ª¨Ëé∑ÂæóÊ∞∏ËøúÊòØÈòüÂàóÈáåÈù¢ÁöÑÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">Â≠¶Áîü<span class="token number">0</span> ‰∫§Âç∑<span class="token punctuation">,</span>Áî®Êó∂<span class="token number">5</span>
Â≠¶Áîü<span class="token number">1</span> ‰∫§Âç∑<span class="token punctuation">,</span>Áî®Êó∂<span class="token number">3</span>
Â≠¶Áîü<span class="token number">2</span> ‰∫§Âç∑<span class="token punctuation">,</span>Áî®Êó∂<span class="token number">5</span>
Â≠¶Áîü<span class="token number">3</span> ‰∫§Âç∑<span class="token punctuation">,</span>Áî®Êó∂<span class="token number">9</span>
Â≠¶Áîü<span class="token number">4</span> ‰∫§Âç∑<span class="token punctuation">,</span>Áî®Êó∂<span class="token number">10</span>
bq<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Â≠¶Áîü<span class="token number">1</span> ‰∫§Âç∑<span class="token punctuation">,</span>Áî®Êó∂<span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËØªËÄÖÂèØ‰ª•ÊÖ¢ÊÖ¢Âú∞Âú®‰ª•ÂêéÁöÑÂ∑•‰ΩúÂΩì‰∏≠‰Ωì‰ºö DelayQueueÁöÑÁî®Ê≥ï„ÄÇ</p>
<h3 id="ÂêåÊ≠•ÈòüÂàóSynchronousQueue"><a href="#ÂêåÊ≠•ÈòüÂàóSynchronousQueue" class="headerlink" title="ÂêåÊ≠•ÈòüÂàóSynchronousQueue"></a>ÂêåÊ≠•ÈòüÂàóSynchronousQueue</h3><p>‚Äã        <code>SynchronousQueue</code>ÊòØ‰∏Ä‰∏™‰∏çÂ≠òÂÇ®ÂÖÉÁ¥†ÁöÑÈòªÂ°ûÈòüÂàó„ÄÇÊØè‰∏Ä‰∏™<code>put</code>Êìç‰ΩúÂøÖÈ°ªÁ≠âÂæÖ‰∏Ä‰∏™<code>take</code>Êìç‰ΩúÔºåÂê¶Âàô‰∏çËÉΩÁªßÁª≠Ê∑ªÂä†ÂÖÉÁ¥†„ÄÇ<code>SynchronousQueue</code>ÂèØ‰ª•ÁúãÊàêÊòØ‰∏Ä‰∏™‰º†ÁêÉÊâãÔºåË¥üË¥£ÊääÁîü‰∫ßËÄÖÁ∫øÁ®ãÂ§ÑÁêÜÁöÑÊï∞ÊçÆÁõ¥Êé•‰º†ÈÄíÁªôÊ∂àË¥πËÄÖÁ∫øÁ®ã„ÄÇÈòüÂàóÊú¨Ë∫´Âπ∂‰∏çÂ≠òÂÇ®‰ªª‰ΩïÂÖÉÁ¥†ÔºåÈùûÂ∏∏ÈÄÇÂêà‰∫é‰º†ÈÄíÊÄßÂú∫ÊôØÔºåÊØîÂ¶ÇÂú®‰∏Ä‰∏™Á∫øÁ®ã‰∏≠‰ΩøÁî®ÁöÑÊï∞ÊçÆÔºå‰º†ÈÄíÁªôÂè¶Â§ñ‰∏Ä‰∏™Á∫øÁ®ã‰ΩøÁî®Ôºå<code>SynchronousQueue</code>ÁöÑÂêûÂêêÈáèÈ´ò‰∫é<code>LinkedBlockingQueue</code>Âíå <code>ArrayBlockingQueue</code>„ÄÇ<br>‚Äã        Â£∞Êòé‰∏Ä‰∏™<code>SynchronousQueue</code>Êúâ‰∏§Áßç‰∏çÂêåÁöÑÊñπÂºèÔºåÂÆÉ‰ª¨‰πãÈó¥ÊúâÁùÄ‰∏çÂ§™‰∏ÄÊ†∑ÁöÑË°å‰∏∫„ÄÇÂÖ¨Âπ≥Ê®°ÂºèÂíåÈùûÂÖ¨Âπ≥Ê®°ÂºèÁöÑÂå∫Âà´ÔºöÂ¶ÇÊûúÈááÁî®ÂÖ¨Âπ≥Ê®°ÂºèÔºå<code>SynchronousQueue</code>‰ºöÈááÁî®ÂÖ¨Âπ≥ÈîÅÔºåÂπ∂ÈÖçÂêà‰∏Ä‰∏™ <code>FIFO</code> ÈòüÂàóÊù•ÈòªÂ°ûÂ§ö‰ΩôÁöÑÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖÔºå‰ªéËÄå‰ΩìÁ≥ªÊï¥‰ΩìÁöÑÂÖ¨Âπ≥Á≠ñÁï•Ôºõ‰ΩÜÂ¶ÇÊûúÊòØÈùûÂÖ¨Âπ≥Ê®°Âºè(<code>SynchronousQueue</code>ÈªòËÆ§) ,<code>SynchronousQueue</code>ÈááÁî®ÈùûÂÖ¨Âπ≥ÈîÅÔºåÂêåÊó∂ÈÖçÂêà‰∏Ä‰∏™ <code>LIFO</code>ÈòüÂàóÊù•ÁÆ°ÁêÜÂ§ö‰ΩôÁöÑÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖ,ËÄåÂêé‰∏ÄÁßçÊ®°ÂºèÔºåÂ¶ÇÊûúÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖÁöÑÂ§ÑÁêÜÈÄüÂ∫¶ÊúâÂ∑ÆË∑ù,ÂàôÂæàÂÆπÊòìÂá∫Áé∞È••Ê∏¥ÁöÑÊÉÖÂÜµÔºåÂç≥ÂèØËÉΩÊúâÊüê‰∫õÁîü‰∫ßËÄÖÊàñËÄÖÊòØÊ∂àË¥πËÄÖÁöÑÊï∞ÊçÆÊ∞∏ËøúÈÉΩÂæó‰∏çÂà∞Â§ÑÁêÜ„ÄÇ<br>‚Äã        Êù•ÁúãÈÉ®ÂàÜ<code>SynchronousQueue</code>ÁöÑÊ∫êÁ†ÅÔºåÁêÜËß£‰∏Ä‰∏ã<code>SynchronousQueue</code>ÁöÑÂÆûÁé∞ÂéüÁêÜÂíåÊú∫Âà∂Ôºö</p>
<p>‚Äã        Âõ†‰∏∫<code>SynchronousQueue</code>Ê≤°ÊúâÂÜÖÈÉ®ÂÆπÈáèÔºåÊâÄ‰ª•Âè™Êèê‰æõ‰ª•‰∏ãÊñπÊ≥ïÔºö</p>
<ul>
<li><code>isEmpty()</code>ÔºöÂßãÁªàËøîÂõû true„ÄÇ</li>
<li><code>size()</code>ÔºöÂßãÁªàËøîÂõû0„ÄÇ</li>
<li><code>remainingCapacity()</code>ÔºöÂßãÁªàËøîÂõû0„ÄÇ</li>
<li><code>clear()</code>Ôºö‰∏çÊâßË°å‰ªª‰ΩïÊìç‰Ωú„ÄÇ</li>
<li><code>remove(Object o)</code>ÔºöÂßãÁªàËøîÂõûfalse„ÄÇ</li>
<li><code>containsAll(Collection&lt;?&gt;c)</code>ÔºöÈô§ÈùûÁªôÂÆö<code>collection</code>‰∏∫Á©∫ÔºåÂê¶ÂàôËøîÂõûfalse„ÄÇ</li>
<li><code>removeAll(Collection&lt;?&gt;c)</code>ÔºöÂßãÁªàËøîÂõûfalse„ÄÇ</li>
<li><code>retainAll(Collection&lt;?&gt;C)</code>ÔºöÂßãÁªàËøîÂõûfalse„ÄÇ</li>
<li><code>peek(O)</code>ÔºöÂßãÁªàËøîÂõûnull„ÄÇ</li>
<li><code>iterator()</code>ÔºöËøîÂõû‰∏Ä‰∏™Á©∫Ëø≠‰ª£Âô®,ÂÖ∂‰∏≠hasNextÂßãÁªàËøîÂõûfalse„ÄÇ</li>
<li><code>toArray()</code>ÔºöËøîÂõû‰∏Ä‰∏™0ÈïøÂ∫¶ÁöÑÊï∞ÁªÑ„ÄÇ</li>
</ul>
<p>SynchronousQueueÁÆÄÂçïÁöÑ‰ΩøÁî®ÂÆû‰æãÂ¶Ç‰∏ã:</p>
<h4 id="No5-SynchronousQueueDemo-java"><a href="#No5-SynchronousQueueDemo-java" class="headerlink" title="No5_SynchronousQueueDemo.java"></a>No5_SynchronousQueueDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>blockingqueue</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">SynchronousQueue</span><span class="token punctuation">;</span>

<span class="token comment">/*
 * Áé∞ÊàêÁ®ãÂ∫è‰∏≠ÁöÑTest1Á±ª‰∏≠ÁöÑ‰ª£Á†ÅÂú®‰∏çÊñ≠Âú∞‰∫ßÁîüÊï∞ÊçÆÔºå
 * ÁÑ∂Âêé‰∫§ÁªôTestDo.doSome()ÊñπÊ≥ïÂéªÂ§ÑÁêÜÔºå
 * Â∞±Â•ΩÂÉèÁîü‰∫ßËÄÖÂú®‰∏çÊñ≠Âú∞‰∫ßÁîüÊï∞ÊçÆÔºåÊ∂àË¥πËÄÖÂú®‰∏çÊñ≠Ê∂àË¥πÊï∞ÊçÆ„ÄÇ
 *
 * ËØ∑Â∞ÜÁ®ãÂ∫èÊîπÈÄ†ÊàêÊúâ10‰∏™Á∫øÁ®ãÊù•Ê∂àË¥πÁîüÊàêËÄÖ‰∫ßÁîüÁöÑÊï∞ÊçÆÔºåËøô‰∫õÊ∂àË¥πËÄÖÈÉΩË∞ÉÁî®TestDo.doSome()ÊñπÊ≥ïÂéªËøõË°åÂ§ÑÁêÜÔºå
 * ÊïÖÊØè‰∏™Ê∂àË¥πËÄÖÈÉΩÈúÄË¶Å‰∏ÄÁßíÊâçËÉΩÂ§ÑÁêÜÂÆåÔºåÁ®ãÂ∫èÂ∫î‰øùËØÅËøô‰∫õÊ∂àË¥πËÄÖÁ∫øÁ®ã‰æùÊ¨°ÊúâÂ∫èÂú∞Ê∂àË¥πÊï∞ÊçÆÔºåÂè™Êúâ‰∏ä‰∏Ä‰∏™Ê∂àË¥πËÄÖÊ∂àË¥πÂÆåÂêéÔºå
 * ‰∏ã‰∏Ä‰∏™Ê∂àË¥πËÄÖÊâçËÉΩÊ∂àË¥πÊï∞ÊçÆÔºå‰∏ã‰∏Ä‰∏™Ê∂àË¥πËÄÖÊòØË∞ÅÈÉΩÂèØ‰ª•Ôºå‰ΩÜË¶Å‰øùËØÅËøô‰∫õÊ∂àË¥πËÄÖÁ∫øÁ®ãÊãøÂà∞ÁöÑÊï∞ÊçÆÊòØÊúâÈ°∫Â∫èÁöÑ„ÄÇ
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No5_SynchronousQueueDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// ‰∏çËÉΩÊîπÂä®Ê≠§TestDoÁ±ª</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">TestDo</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">doSome</span><span class="token punctuation">(</span><span class="token class-name">String</span> input<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">String</span> output <span class="token operator">=</span> input <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> output<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"begin:"</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ÂÆö‰πâ‰∏Ä‰∏™Synchronous</span>
        <span class="token keyword">final</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> sq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ÂÆö‰πâ‰∏Ä‰∏™Êï∞Èáè‰∏∫1ÁöÑ‰ø°Âè∑ÈáèÔºåÂÖ∂‰ΩúÁî®Áõ∏ÂΩì‰∫é‰∏Ä‰∏™‰∫íÊñ•ÈîÅ</span>
        <span class="token keyword">final</span> <span class="token class-name">Semaphore</span> sem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        sem<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> input <span class="token operator">=</span> sq<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> output <span class="token operator">=</span> <span class="token class-name">TestDo</span><span class="token punctuation">.</span><span class="token function">doSome</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        sem<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ËøôË°å‰∏çËÉΩÊîπÂä®</span>
            <span class="token class-name">String</span> input <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token comment">// ËøôË°å‰∏çËÉΩÊîπÂä®</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                sq<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="ÈìæË°®ÂèåÂêëÈòªÂ°ûÈòüÂàóLinkedBlockingDeque"><a href="#ÈìæË°®ÂèåÂêëÈòªÂ°ûÈòüÂàóLinkedBlockingDeque" class="headerlink" title="ÈìæË°®ÂèåÂêëÈòªÂ°ûÈòüÂàóLinkedBlockingDeque"></a>ÈìæË°®ÂèåÂêëÈòªÂ°ûÈòüÂàó<code>LinkedBlockingDeque</code></h3><p>‚Äã        <code>LinkedBlockingDeque</code>ÊòØ‰∏Ä‰∏™Áî±ÈìæË°®ÁªìÊûÑÁªÑÊàêÁöÑÂèåÂêëÈòªÂ°ûÈòüÂàó„ÄÇÊâÄË∞ìÂèåÂêëÈòüÂàóÊåáÁöÑ‰Ω†ÂèØ‰ª•‰ªéÈòüÂàóÁöÑ‰∏§Á´ØÊèíÂÖ•ÂíåÁßªÂá∫ÂÖÉÁ¥†„ÄÇÂèåÁ´ØÈòüÂàóÂõ†‰∏∫Â§ö‰∫Ü‰∏Ä‰∏™Êìç‰ΩúÈòüÂàóÁöÑÂÖ•Âè£ÔºåÂú®Â§öÁ∫øÁ®ãÂêåÊó∂ÂÖ•ÈòüÊó∂Ôºå‰πüÂ∞±ÂáèÂ∞ë‰∫Ü‰∏ÄÂçäÁöÑÁ´û‰∫â„ÄÇ Áõ∏ÊØîÂÖ∂‰ªñÁöÑÈòªÂ°ûÈòüÂàóÔºå<code>LinkedBlockingDeque</code>Â§ö‰∫Ü<code>addFirst</code>„ÄÅ<code>addLast</code>„ÄÅ<code>offerFirst</code>„ÄÅ<code>offerLast</code>„ÄÅ<code>peekFirst</code>„ÄÅ<code>peekLast</code> Á≠âÊñπÊ≥ïÔºå‰ª•<code>First</code>ÂçïËØçÁªìÂ∞æÁöÑÊñπÊ≥ïÔºåË°®Á§∫ÊèíÂÖ•„ÄÅËé∑Âèñ(<code>peek</code>) ÊàñÁßªÈô§ÂèåÁ´ØÈòüÂàóÁöÑÁ¨¨-‰∏Ä‰∏™ÂÖÉÁ¥†„ÄÇ‰ª•<code>Last</code>ÂçïËØçÁªìÂ∞æÁöÑÊñπÊ≥ïÔºåË°®Á§∫ÊèíÂÖ•ÔºåËé∑ÂèñÊàñÁßªÈô§ÂèåÁ´ØÈòüÂàóÁöÑÊúÄÂêé‰∏Ä‰∏™ÂÖÉÁ¥†„ÄÇÂè¶Â§ñÊèíÂÖ•ÊñπÊ≥ï<code>add</code>Á≠âÂêå‰∫é<code>addLast</code>ÔºåÁßªÈô§ÊñπÊ≥ï<code>remove</code>Á≠âÊïà‰∫é<code>removeFirst</code>.<br>‚Äã        Âú®ÂàùÂßãÂåñLinkedBlockingDequeÊó∂ÂèØ‰ª•ËÆæÁΩÆÂÆπÈáèÈò≤Ê≠¢ÂÖ∂ËøáÊ∏°ËÜ®ËÉÄ„ÄÇÂè¶Â§ñÔºåÂèåÂêëÈòªÂ°ûÈòüÂàóÂèØ‰ª•ËøêÁî®Âú®‚ÄúÂ∑•‰ΩúÁ™ÉÂèñ‚ÄùÊ®°Âºè‰∏≠ÔºåÊúâÁÇπÂíåLinkedBlockingQueueÁ±ª‰ººÔºåËøôÈáåÂ∞±‰∏çÂ§öËØ¥‰∫Ü„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">BlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>
    
    <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
	<span class="token keyword">public</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    	<span class="token keyword">this</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
 
	<span class="token keyword">public</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span>capacity <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>capacity <span class="token operator">=</span> capacity<span class="token punctuation">;</span> <span class="token comment">// ÊåáÂÆöÈòüÂàóÂàùÂßãÂÆπÈáè</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">addLast</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ë∞ÉÁî®‰∫ÜaddLastÊñπÊ≥ï</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">addFirst</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ë∞ÉÁî®‰∫ÜaddFirstÊñπÊ≥ï</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addFirst</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">offerFirst</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"Deque full"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 			<span class="token comment">// ÈòüÂàóÂ∑≤Êª°ÔºåÊäõÂºÇÂ∏∏</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">offerLast</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"Deque full"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 			<span class="token comment">// ÈòüÂàóÂ∑≤Êª°ÔºåÊäõÂºÇÂ∏∏</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">offer</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">offerLast</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">offerFirst</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Êñ∞ÂÖÉÁ¥†ËäÇÁÇπ</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token function">linkFirst</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ë∞ÉÁî®ÊèíÂÖ•ÂèåÁ´ØÈòüÂàóÂ§¥ÈÉ®ÊñπÊ≥ï</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">linkFirst</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> node<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// assert lock.isHeldByCurrentThread();</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">>=</span> capacity<span class="token punctuation">)</span> <span class="token comment">// Â¶ÇÊûúÈòüÂàóÂÆπÈáèÂ∑≤Êª°,ËøîÂõûfalse</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> f <span class="token operator">=</span> first<span class="token punctuation">;</span> <span class="token comment">// ‰∏¥Êó∂Â≠òÂÇ®ÈòüÂàóÂ§¥ÈÉ®ÂÖÉÁ¥†</span>
        node<span class="token punctuation">.</span>next <span class="token operator">=</span> f<span class="token punctuation">;</span> <span class="token comment">// ÊääÊóßÂ§¥ÈÉ®ÂÖÉÁ¥†‰Ωú‰∏∫Êñ∞ÂÖÉÁ¥†ÁöÑnextËäÇÁÇπ</span>
        first <span class="token operator">=</span> node<span class="token punctuation">;</span> <span class="token comment">// ÊääÊñ∞ÂÖÉÁ¥†‰Ωú‰∏∫Â§¥ÈÉ®ËäÇÁÇπ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>last <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// Âà§Êñ≠ÈòüÂàóÂ∞æÈÉ®ÂÖÉÁ¥†ÊòØÂê¶‰∏∫Á©∫</span>
            last <span class="token operator">=</span> node<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            f<span class="token punctuation">.</span>prev <span class="token operator">=</span> node<span class="token punctuation">;</span> <span class="token comment">// ÊääÊóßÂ§¥ÈÉ®ÂÖÉÁ¥†ÁöÑprevÊåáÂêëÊñ∞ËäÇÁÇπ</span>
        <span class="token operator">++</span>count<span class="token punctuation">;</span> <span class="token comment">// Á¥ØËÆ°ÈòüÂàóÊï∞Èáè</span>
        notEmpty<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Âî§ÈÜíÊ∂àË¥πËÄÖÁ∫øÁ®ã</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// ËøîÂõûtrue</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">offerLast</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Êñ∞ÂÖÉÁ¥†ËäÇÁÇπ</span>
    <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">linkLast</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ë∞ÉÁî®ÊèíÂÖ•ÈòüÂàóÂ∞æÈÉ®ÊñπÊ≥ï</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
 
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">linkLast</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> node<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// assert lock.isHeldByCurrentThread();</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">>=</span> capacity<span class="token punctuation">)</span> <span class="token comment">// Âà§Êñ≠ÂÆπÈáèÊòØÂê¶Â∑≤Êª°, Â∑≤Êª°ËøîÂõûfalse</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> l <span class="token operator">=</span> last<span class="token punctuation">;</span> <span class="token comment">// ‰∏¥Êó∂Â≠òÂÇ®ÈòüÂàóÂ∞æÈÉ®ËäÇÁÇπ</span>
        node<span class="token punctuation">.</span>prev <span class="token operator">=</span> l<span class="token punctuation">;</span> <span class="token comment">// ÊääÊñ∞ÂÖÉÁ¥†ËäÇÁÇπÁöÑprevÊåáÂêëÈòüÂàóÊóßÂ∞æÈÉ®ËäÇÁÇπ</span>
        last <span class="token operator">=</span> node<span class="token punctuation">;</span> <span class="token comment">// ÊääÊñ∞ÂÖÉÁ¥†ËäÇÁÇπ‰Ωú‰∏∫ÈòüÂàóÂ∞æÈÉ®ËäÇÁÇπ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// Âà§Êñ≠ÈòüÂàóÂ§¥ÈÉ®ÂÖÉÁ¥†ÊòØÂê¶‰∏∫Á©∫</span>
            first <span class="token operator">=</span> node<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            l<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span> <span class="token comment">// ÊääÊóßÂ∞æÈÉ®ËäÇÁÇπÁöÑnextÊåáÂêëÊñ∞ÂÖÉÁ¥†ËäÇÁÇπ</span>
        <span class="token operator">++</span>count<span class="token punctuation">;</span> <span class="token comment">// Á¥ØËÆ°ÈòüÂàóÊï∞Èáè</span>
        notEmpty<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Âî§ÈÜíÊ∂àË¥πËÄÖÁ∫øÁ®ã</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// ËøîÂõûfalse</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token function">putLast</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">putFirst</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Êñ∞ÂÖÉÁ¥†ËäÇÁÇπ</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">linkFirst</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Âà§Êñ≠ÂÖÉÁ¥†ÊòØÂê¶Â∑≤ÊèíÂÖ•ÊàêÂäüÔºåÂ¶ÇÊú™ÊàêÂäüÔºåÂàô‰∏ÄÁõ¥ÈòªÂ°û</span>
                notFull<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">putLast</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Êñ∞ÂÖÉÁ¥†ËäÇÁÇπ</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">linkLast</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Â¶ÇÊú™ÊèíÂÖ•ÊàêÂäüÔºåÂàô‰∏ÄÁõ¥ÈòªÂ°ûÔºåÁ≠âÂæÖÊèíÂÖ•</span>
                notFull<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">takeFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">takeFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">E</span> x<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token function">unlinkFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                notEmpty<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> x<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="ÈìæË°®‰º†ËæìÈòüÂàó-LinkedTransferQueue"><a href="#ÈìæË°®‰º†ËæìÈòüÂàó-LinkedTransferQueue" class="headerlink" title="ÈìæË°®‰º†ËæìÈòüÂàó LinkedTransferQueue"></a>ÈìæË°®‰º†ËæìÈòüÂàó LinkedTransferQueue</h3><p>‚Äã        <code>LinkedTransferQueue</code>ÊòØ‰∏Ä‰∏Ä‰∏™Áî±ÈìæË°®ÁªìÊûÑÁªÑÊàêÁöÑÊó†Áïå‰º†ËæìÈòªÂ°ûÈòüÂàó„ÄÇ<code>TransferQueue</code>ÊòØ‰∏Ä‰∏™ÁªßÊâø‰∫Ü<code>BlockingQueue</code> ÁöÑÊé•Âè£ÔºåÂπ∂‰∏îÂ¢ûÂä†Ëã•Âπ≤Êñ∞ÁöÑÊñπÊ≥ï„ÄÇ<code>LinkedTransferQueue</code>ÊòØÂÆûÁé∞Á±ªÔºåÂÖ∂ÂÆö‰πâ‰∏∫‰∏Ä‰∏™Êó†ÁïåÁöÑÈòüÂàóÔºå‰∏ÄÊ†∑ÂÖ∑ÊúâÂÖàËøõÂÖàÂá∫(<strong>FIFO : first-in-first-out</strong>)ÁöÑÁâπÊÄß„ÄÇDoug LeaËøôÊ†∑ËØÑ‰ª∑ÂÆÉ: <code>TransferQueue</code> ÊòØ‰∏Ä‰∏™ËÅ™ÊòéÁöÑÈòüÂàóÔºåÂÆÉÊòØ<code>ConcurrentLinkedQueue</code>„ÄÅ<code>SynchronousQueue</code> (Âú®ÂÖ¨Âπ≥Ê®°Âºè‰∏ã)„ÄÅÊó†ÁïåÁöÑ<code>LinkedBlockingQueue</code>Á≠âÁöÑË∂ÖÈõÜÔºåÊòØLinkedBlockingQueue„ÄÅSynchronousQueueÔºàÂÖ¨Âπ≥Ê®°ÂºèÔºâ„ÄÅConcurrentLinkedQueue‰∏âËÄÖÁöÑÈõÜÂêà‰ΩìÔºåÂÆÉÁªºÂêà‰∫ÜËøô‰∏âËÄÖÁöÑÊñπÊ≥ïÔºåÂπ∂‰∏îÊèê‰æõ‰∫ÜÊõ¥Âä†È´òÊïàÁöÑÂÆûÁé∞ÊñπÂºè„ÄÇÊòæÁÑ∂ÊòìËßÅÔºåÊ∑∑Âêà‰∫ÜËã•Âπ≤È´òÁ∫ßÁâπÊÄßÔºåÂπ∂‰∏îÂÖ∑ÊúâÈ´òÊÄßËÉΩÁöÑ‰∏Ä‰∏Ä‰∏™ÁªÑÂêà‰ΩìÔºå‰∏Ä‰∏™Â§öÈù¢Êâã„ÄÇÂçïÁ∫Ø‰ªéÈòüÂàóÊù•ÁúãÔºå<code>TransferQueue </code>Êé•Âè£Â¢ûÂä†‰∫Ü‰∏Ä‰∫õÂæàÂÆûÁî®ÁöÑÊñ∞ÁâπÊÄß„ÄÇ</p>
<p>‚Äã        <code>transfer ÁÆóÊ≥ïÊØîËæÉÂ§çÊùÇ</code>ÔºåÂÆûÁé∞ÂæàÈöæÁúãÊòéÁôΩ„ÄÇÂ§ßËá¥ÁöÑÁêÜËß£ÊòØÈááÁî®ÊâÄË∞ì<strong>ÂèåÈáçÊï∞ÊçÆÁªìÊûÑ</strong>(dual data structures) „ÄÇ‰πãÊâÄ‰ª•Âè´ÂèåÈáçÔºåÂÖ∂ÂéüÂõ†ÊòØÊñπÊ≥ïÈÉΩÊòØÈÄöËøá‰∏§‰∏™Ê≠•È™§ÂÆåÊàêÔºö‰øùÁïô‰∏éÂÆåÊàê„ÄÇÊØîÂ¶ÇÔºåÊ∂àË¥πËÄÖÁ∫øÁ®ã‰ªé‰∏Ä‰∏™ÈòüÂàó‰∏≠ÂèñÂÖÉÁ¥†ÔºåÂèëÁé∞ÈòüÂàó‰∏∫Á©∫ÔºåÂÆÉÂ∞±ÁîüÊàê‰∏Ä‰∏™Á©∫ÂÖÉÁ¥†ÊîæÂÖ•ÈòüÂàóÔºåÊâÄË∞ìÁ©∫ÂÖÉÁ¥†Â∞±ÊòØÊï∞ÊçÆÈ°πÂ≠óÊÆµ‰∏∫Á©∫„ÄÇÁÑ∂ÂêéÊ∂àË¥πËÄÖÁ∫øÁ®ãÂú®Ëøô‰∏™Â≠óÊÆµ‰∏äÁªßÁª≠Á≠âÂæÖÔºåËøôÂè´‰øùÁïô„ÄÇÁõ¥Âà∞‰∏Ä‰∏™Áîü‰∫ßËÄÖÁ∫øÁ®ãÊÑèÊ¨≤ÂêëÈòüÂàó‰∏≠ÊîæÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåËøôÈáåÂÆÉÂèëÁé∞ÊúÄÂâçÈù¢ÁöÑÂÖÉÁ¥†ÁöÑÊï∞ÊçÆÈ°πÂ≠óÊÆµ‰∏∫NULLÔºåÂÆÉÂ∞±Áõ¥Êé•ÊääËá™Â∑±Êï∞ÊçÆÂ°´ÂÖÖÂà∞Ëøô‰∏™ÂÖÉÁ¥†‰∏≠ÔºåÂç≥ÂÆåÊàê‰∫ÜÂÖÉÁ¥†ÁöÑ‰º†ÈÄÅ„ÄÇÂ§ß‰ΩìÊòØËøô‰∏™ÊÑèÊÄùÔºåËøôÁßçÊñπÂºè‰ºòÁæéÂú∞ÂÆåÊàê‰∫ÜÁ∫øÁ®ã‰πãÈó¥ÁöÑÈ´òÊïàÂçè‰Ωú„ÄÇÂÖ∂<code>tansfer</code>ÊñπÊ≥ïÊèê‰æõ‰∫ÜÁ∫øÁ®ã‰πãÈó¥Áõ¥Êé•‰∫§Êç¢ÂØπË±°ÁöÑÊç∑ÂæÑÁöÑÊñπÊ≥ïÔºåÂ¶Ç‰∏ãÊâÄËø∞Ôºö</p>
<ul>
<li>(1) <code>transfer(E e)</code>ÔºåËã•ÂΩìÂâçÂ≠òÂú®‰∏Ä‰∏™Ê≠£Âú®Á≠âÂæÖ Ëé∑ÂèñÁöÑÊ∂àË¥πËÄÖÁ∫øÁ®ãÔºåÂç≥Á´ãÂàªÁßª‰∫§‰πãÔºõÂê¶ÂàôÔºå‰ºöÊèíÂÖ•ÂΩìÂâçÂÖÉÁ¥†eÂà∞ÈòüÂàóÂ∞æÈÉ®ÔºåÂπ∂‰∏îÁ≠âÂæÖËøõÂÖ•ÈòªÂ°ûÁä∂ÊÄÅÔºåÁõ¥Âà∞ÊúâÊ∂àË¥πËÄÖÁ∫øÁ®ãÂèñËµ∞ËØ•ÂÖÉÁ¥†„ÄÇ</li>
<li>(2) <code>tryTransfer(E e)</code>ÔºåËã•ÂΩìÂâçÂ≠òÂú®‰∏Ä‰∏™Ê≠£Âú®Á≠âÂæÖËé∑ÂèñÁöÑÊ∂àË¥πËÄÖÁ∫øÁ®ã(‰ΩøÁî®<code>take()</code>ÊàñËÄÖ<code>poll()</code>ÂáΩÊï∞)Ôºå‰ΩøÁî®ËØ•ÊñπÊ≥ï‰ºöÂç≥ÂàªËΩ¨Áßª&#x2F;‰º†ËæìÂØπË±°ÂÖÉÁ¥†ÔºõËã•‰∏çÂ≠òÂú®ÔºåÂàôËøîÂõû<strong>false</strong>ÔºåÂπ∂‰∏î‰∏çËøõÂÖ•ÈòüÂàó„ÄÇËøôÊòØ‰∏™<strong>‰∏çÈòªÂ°û</strong>ÁöÑÊìç‰Ωú„ÄÇ</li>
<li>(3) <code>tryTransfer(E e, long timeout, TimeUnit unit)</code>ÔºåËã•ÂΩìÂâçÂ≠òÂú®‰∏Ä‰∏™Ê≠£Âú®Á≠âÂæÖËé∑ÂèñÁöÑÊ∂àË¥πËÄÖÁ∫øÁ®ãÔºå‰ºöÁ´ãÂç≥‰º†ËæìÁªôÂÆÉÔºõÂê¶ÂàôÂ∞ÜÊèíÂÖ•ÂÖÉÁ¥†eÂà∞ÈòüÂàóÂ∞æÈÉ®ÔºåÂπ∂‰∏îÁ≠âÂæÖË¢´Ê∂àË¥πËÄÖÁ∫øÁ®ãËé∑ÂèñÊ∂àË¥πÊéâ„ÄÇËã•Âú®ÊåáÂÆöÁöÑÊó∂Èó¥ÂÜÖÂÖÉÁ¥†eÊó†Ê≥ïË¢´Ê∂àË¥πËÄÖÁ∫øÁ®ãËé∑ÂèñÔºåÂàôËøîÂõû<strong>false</strong>ÔºåÂêåÊó∂ËØ•ÂÖÉÁ¥†<strong>Ë¢´ÁßªÈô§</strong>„ÄÇ</li>
<li>(4) <code>hasWaitingConsumer()</code>ÔºåÂæàÊòéÊòæÔºåÂà§Êñ≠ÊòØÂê¶‰∏∫ÁªàÁ´ØÊ∂àË¥πËÄÖÁ∫øÁ®ã„ÄÇ</li>
<li>(5) <code>getWaitingConsumerCount()</code>ÔºåÂ≠óÈù¢ÊÑèÊÄùÂæàÊòéÁôΩÔºåËé∑ÂèñÁªàÁ´ØÊâÄÊúâÁ≠âÂæÖËé∑ÂèñÂÖÉÁ¥†ÁöÑÊ∂àË¥πÁ∫øÁ®ãÊï∞Èáè„ÄÇ</li>
<li>(6) <code>size()</code>Ôºå Âõ†‰∏∫ÈòüÂàóÁöÑÂºÇÊ≠•ÁâπÊÄßÔºåÊ£ÄÊµãÂΩìÂâçÈòüÂàóÁöÑÂÖÉÁ¥†‰∏™Êï∞ÈúÄË¶ÅÈÄê‰∏ÄËø≠‰ª£Ôºå ÂèØËÉΩ‰ºöÂæóÂà∞‰∏Ä‰∏™‰∏çÂ§™ÂáÜÁ°ÆÁöÑÁªìÊûúÔºåÂ∞§ÂÖ∂ÊòØÂú®ÈÅçÂéÜÊó∂ÊúâÂèØËÉΩÈòüÂàóÂèëÁîüÊõ¥Êîπ„ÄÇ</li>
</ul>
<p>ÊâπÈáèÊìç‰ΩúÁ±ª‰ºº‰∫é<code>addAll</code>„ÄÅ <code>removeAll</code>„ÄÅ<code>retainAll</code>„ÄÅ<code>containsAll </code>„ÄÅ<code>equals</code>„ÄÅ <code>toArray</code> Á≠âÊñπÊ≥ïÔºå<strong>API</strong>‰∏çËÉΩ‰øùËØÅ‰∏ÄÂÆö‰ºöÁ´ãÂàªÊâßË°å„ÄÇÂõ†Ê≠§ÔºåÊàë‰ª¨Âú®‰ΩøÁî®ËøáÁ®ã‰∏≠Ôºå‰∏çËÉΩÊúâÊâÄÊúüÂæÖÔºåËøôÊòØ‰∏Ä‰∏™ÂÖ∑ÊúâÂºÇÊ≠•ÁâπÊÄßÁöÑÈòüÂàó„ÄÇ</p>
<p>Ê≥®ÊÑè‰∫ãÈ°π:<br>        ‚óèÊó†ËÆ∫ÊòØ<code>transfer</code>ËøòÊòØ<code>tryTransfer</code>ÊñπÊ≥ïÔºåÂú®&gt;&#x3D;1‰∏™Ê∂àË¥πËÄÖÁ∫øÁ®ãÁ≠âÂæÖËé∑ÂèñÂÖÉÁ¥†Êó∂(<strong>Ê≠§Êó∂ÈòüÂàó‰∏∫Á©∫</strong>)ÔºåÈÉΩ‰ºöÁ´ãÂàªËΩ¨‰∫§ÔºåËøôÂ±û‰∫éÁ∫øÁ®ã‰πãÈó¥ÁöÑÂÖÉÁ¥†‰∫§Êç¢„ÄÇÊ≥®ÊÑèÔºåËøôÊó∂ÂÖÉÁ¥†Âπ∂Ê≤°ÊúâËøõÂÖ•ÈòüÂàó„ÄÇ<br>        ‚óèÂú®ÈòüÂàó‰∏≠Â∑≤ÊúâÊï∞ÊçÆÊÉÖÂÜµ‰∏ãÔºå<code>transfer</code> Â∞ÜÈúÄË¶ÅÁ≠âÂæÖÂâçÈù¢Êï∞ÊçÆË¢´Ê∂àË¥πÊéâÔºåÁõ¥Âà∞‰º†ÈÄíÁöÑÂÖÉÁ¥†<strong>e</strong>Ë¢´Ê∂àË¥πÁ∫øÁ®ãÂèñËµ∞‰∏∫Ê≠¢„ÄÇ<br>        ‚óè‰ΩøÁî®<code>transfer</code> ÊñπÊ≥ïÔºåÂ∑•‰ΩúËÄÖÁ∫øÁ®ãÂèØËÉΩ‰ºöË¢´ÈòªÂ°ûÂà∞Áîü‰∫ßÁöÑÂÖÉÁ¥†Ë¢´Ê∂àË¥πÊéâ‰∏∫Ê≠¢„ÄÇÊ∂àË¥πËÄÖÁ∫øÁ®ãÁ≠âÂæÖ‰∏∫Èõ∂ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂêÑËá™ÁöÑÂ§ÑÁêÜÂÖÉÁ¥†ÂÖ•Èòü‰∏éÂê¶ÊÉÖÂÜµÊúâÊâÄ‰∏çÂêå„ÄÇ<br>        ‚óè<code>size()</code>ÊñπÊ≥ïÔºåÈúÄË¶ÅËø≠‰ª£Ôºå<strong>ÂèØËÉΩ‰∏çÂ§™ÂáÜÁ°ÆÔºåÂ∞ΩÈáè‰∏çË¶ÅË∞ÉÁî®</strong>„ÄÇ</p>
<p>Êù•ÁúãÈÉ®ÂàÜ<code>LinkedTransferQueue</code>ÁöÑÊ∫êÁ†ÅÔºåÁêÜËß£‰∏Ä‰∏ã <code>LinkedTransferQueue</code>ÁöÑÂÆûÁé∞ÂéüÁêÜÂíåÊú∫Âà∂Ôºö</p>
<p><code>LinkedTransferQueue</code>ÁÆÄÂçïÁöÑ‰ΩøÁî®ÂÆû‰æãÂ¶Ç‰∏ã,Êù•ÊÖ¢ÊÖ¢‰Ωì‰ºö‰∏Ä‰∏ã:</p>
<h4 id="No7-LinkedTransferQueueDemo-java"><a href="#No7-LinkedTransferQueueDemo-java" class="headerlink" title="No7_LinkedTransferQueueDemo.java"></a>No7_LinkedTransferQueueDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>blockingqueue</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedTransferQueue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TransferQueue</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No7_LinkedTransferQueueDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TransferQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> queue<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span><span class="token class-name">TransferQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> queue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>queue <span class="token operator">=</span> queue<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" Consumer "</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> queue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TransferQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> queue<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token class-name">TransferQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> queue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>queue <span class="token operator">=</span> queue<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">" your lucky number "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">hasWaitingConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        queue<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Áîü‰∫ßËÄÖÁù°Áú†‰∏ÄÁßíÈíü,ËøôÊ†∑ÂèØ‰ª•ÁúãÂá∫Á®ãÂ∫èÁöÑÊâßË°åËøáÁ®ã</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">TransferQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedTransferQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ËÆæÁΩÆ‰∏∫ÂÆàÊä§ËøõÁ®ã‰ΩøÂæóÁ∫øÁ®ãÊâßË°åÁªìÊùüÂêéÁ®ãÂ∫èËá™Âä®ÁªìÊùüËøêË°å</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            consumer<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// Ê∂àË¥πËÄÖËøõÁ®ã‰ºëÁú†‰∏ÄÁßíÈíüÔºå‰ª•‰æø‰ª•‰æøÁîü‰∫ßËÄÖËé∑ÂæóCPUÔºå‰ªéËÄåÁîü‰∫ß‰∫ßÂìÅ</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Consumer</span> <span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">1</span> your lucky number <span class="token number">2</span>
<span class="token class-name">Consumer</span> <span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">2</span> your lucky number <span class="token number">55</span>
<span class="token class-name">Consumer</span> <span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">3</span> your lucky number <span class="token number">86</span>
<span class="token class-name">Consumer</span> <span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">4</span> your lucky number <span class="token number">54</span>
<span class="token class-name">Consumer</span> <span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">5</span> your lucky number <span class="token number">8</span>
<span class="token class-name">Consumer</span> <span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">6</span> your lucky number <span class="token number">30</span>
<span class="token class-name">Consumer</span> <span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">7</span> your lucky number <span class="token number">54</span>
<span class="token class-name">Consumer</span> <span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">8</span> your lucky number <span class="token number">8</span>
<span class="token class-name">Consumer</span> <span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">9</span> your lucky number <span class="token number">69</span>
<span class="token class-name">Consumer</span> <span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">10</span> your lucky number <span class="token number">14</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÊÄª‰πãÔºå<code>BlockingQueue</code>‰Ωú‰∏∫Á∫øÁ®ãÂÆπÂô®ÔºåÂèØ‰ª•‰∏∫Á∫øÁ®ãÂêåÊ≠•Êèê‰æõÊúâÂäõÁöÑ‰øùÈöú„ÄÇ<code>BlockingQueue</code>Âú®Á∫øÁ®ãÊ±†ÈáåÈù¢ÊúâÈáçË¶ÅÂ∫îÁî®,ÊâÄ‰ª•Êàë‰ª¨ËøôÈáåÂøÖÈ°ª‰∫§‰ª£Ê∏ÖÊ•ö„ÄÇ</p>
<h3 id="ÂêåÊ≠•ËÆ°Êï∞Âô®CountDownLatch"><a href="#ÂêåÊ≠•ËÆ°Êï∞Âô®CountDownLatch" class="headerlink" title="ÂêåÊ≠•ËÆ°Êï∞Âô®CountDownLatch"></a>ÂêåÊ≠•ËÆ°Êï∞Âô®CountDownLatch</h3><p>‚Äã        <code>CountDownLatch</code> ÊòØ‰∏Ä‰∏™ÂêåÊ≠•ËæÖÂä©Á±ªÔºåÁõ¥ËØëËøáÊù•Â∞±ÊòØÂÄíËÆ°Êï∞(<code>CountDown</code>)Èó®Èó©(<code>Latch</code>) „ÄÇÂÄíËÆ°Êï∞‰∏çÁî®ËØ¥ÔºåÈó®Èó®ÁöÑÊÑèÊÄùÈ°æÂêçÊÄù‰πâÂ∞±ÊòØÈòªÊ≠¢ÂâçËøõ„ÄÇÂú®ÂÆåÊàê‰∏ÄÁªÑÊ≠£Âú®ÂÖ∂‰ªñÁ∫øÁ®ã‰∏≠ÊâßË°åÁöÑÊìç‰Ωú‰πãÂâçÔºåÂÆÉÂÖÅËÆ∏‰∏Ä‰∏™ÊàñÂ§ö‰∏™Á∫øÁ®ã‰∏ÄÁõ¥Á≠âÂæÖ„ÄÇ Áî®ÁªôÂÆöÁöÑËÆ°Êï∞ÂàùÂßãÂåñ<code>CountDownLatch</code>„ÄÇ Áî±‰∫éË∞ÉÁî®‰∫Ü<code>countDown()</code>ÊñπÊ≥ïÔºåÊâÄ‰ª•Âú®ÂΩìÂâçËÆ°Êï∞Âà∞ËææÈõ∂‰πãÂâçÔºå<code>await() </code>ÊñπÊ≥ï‰ºöÁõ¥ÂèóÈòªÂ°û„ÄÇ ‰πãÂêéÔºå‰ºöÈáäÊîæÊâÄÊúâÁ≠âÂæÖÁöÑÁ∫øÁ®ãÔºå<code>await() </code> ÁöÑÊâÄÊúâÂêéÁª≠Ë∞ÉÁî®ÈÉΩÂ∞ÜÁ´ãÂç≥ËøîÂõû„ÄÇ<strong>ËøôÁßçÁé∞Ë±°Âè™Âá∫Áé∞‰∏ÄÊ¨°‚ÄìËÆ°Êï∞Êó†Ê≥ïË¢´ÈáçÁΩÆ</strong>„ÄÇ</p>
<p>‚Äã        ‰∏ªË¶ÅÁöÑÊñπÊ≥ïÊúâ:</p>
<ul>
<li><p><code>CountDownLatch(int count)</code>ÊûÑÈÄ†‰∏Ä‰∏™Áî®ÁªôÂÆöËÆ°Êï∞ÂàùÂßãÂåñÁöÑ<code>CountDownLatch</code>„ÄÇ</p>
</li>
<li><p><code>void await()</code>ÂØºËá¥ÂΩìÂâçÁ∫øÁ®ãÁ≠âÂæÖÔºåÁõ¥Âà∞Èó©ÈîÅÂÄíÊï∞‰∏∫Èõ∂ÔºåÈô§ÈùûÁ∫øÁ®ãË¢´‰∏≠Êñ≠„ÄÇ</p>
</li>
<li><p><code>boolean await(long timeout, TimeUnit unit)</code> ÂØºËá¥ÂΩìÂâçÁ∫øÁ®ãÁ≠âÂæÖÔºåÁõ¥Âà∞ÈîÅÂ≠òÂô®ÂÄíÊï∞‰∏∫Èõ∂ÔºåÈô§ÈùûÁ∫øÁ®ãË¢´‰∏≠Êñ≠ÔºåÊàñÊåáÂÆöÁöÑÁ≠âÂæÖÊó∂Èó¥Ëøá‰∫Ü„ÄÇ</p>
</li>
<li><p><code>countDown()</code>ÈÄíÂáèÈîÅÂ≠òÂô®ÁöÑËÆ°Êï∞ÔºåÂ¶ÇÊûúËÆ°Êï∞Âà∞ËææÈõ∂ÔºåÂàôÈáäÊîæÊâÄÊúâÁ≠âÂæÖÁöÑÁ∫øÁ®ã„ÄÇ</p>
</li>
<li><p><code>long getCount()</code>ËøîÂõûÂΩìÂâçËÆ°Êï∞„ÄÇ</p>
</li>
</ul>
<p> <code>CountDownLatch</code>ÁöÑÂÆûÁé∞ÂéüÁêÜÔºö<br>        Êù•Áúã‰∏Ä‰∏ã<code>CountDownLatch</code> ÁöÑÈÉ®ÂàÜÊ∫êÁ†ÅÔºåÁêÜËß£‰∏Ä‰∏ã<code>CountDownLatch</code> ÁöÑÂÆûÁé∞ÂéüÁêÜÂíåÊú∫Âà∂„ÄÇ</p>
<p><a target="_blank" rel="noopener" href="https://baijiahao.baidu.com/s?id=1663210842526248944&wfr=spider&for=pc">JavaÂπ∂ÂèëÂ∑•ÂÖ∑‰∏âÂâëÂÆ¢‰πãCountDownLatchÊ∫êÁ†ÅËß£Êûê (baidu.com)</a></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountDownLatch</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * Synchronization control For CountDownLatch.
     * Uses AQS state to represent count.
     ÂêåÊ≠•ÊéßÂà∂ÁöÑCountDownLatch„ÄÇ‰ΩøÁî®AQSÁä∂ÊÄÅË°®Á§∫ËÆ°Êï∞„ÄÇ  ÂèØ‰ª•ÁúãÂá∫ÔºåCountDownLatchÁöÑÂäüËÉΩËøòÊòØÈÄöËøáAQSÊù•ÂÆûÁé∞ÁöÑ„ÄÇ
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Sync</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueuedSynchronizer</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">4982264981922014374L</span><span class="token punctuation">;</span>

        <span class="token class-name">Sync</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">setState</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">tryAcquireShared</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">tryReleaseShared</span><span class="token punctuation">(</span><span class="token keyword">int</span> releases<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// Decrement count; signal when transition to zero ÈÄíÂáèËÆ°Êï∞;‰ø°Âè∑Êó∂ËøáÊ∏°Âà∞Èõ∂</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> nextc <span class="token operator">=</span> c<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token comment">//CAS </span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> nextc<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> nextc <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Sync</span> sync<span class="token punctuation">;</span>
    
    <span class="token comment">//ÊûÑÈÄ†‰∏Ä‰∏™Áî®ÁªôÂÆöËÆ°Êï∞ÂàùÂßãÂåñÁöÑCountDownLatch„ÄÇ count -Âú®Á∫øÁ®ãÈÄöËøáawait‰πãÂâçÂøÖÈ°ªË∞ÉÁî®countDownÁöÑÊ¨°Êï∞</span>
    <span class="token keyword">public</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"count &lt; 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ÂèØ‰ª•ÁúãÂá∫Ë¶Å‰ΩøÁî®CountDownLatchÂ∞±ÈúÄË¶ÅÊåáÂÆöcountÂÄºÔºå‰∏îÂøÖÈ°ªÂ§ß‰∫é0ÔºåËÄåËøô‰∏™countÂÄºÊúÄÁªàÊòØËµãÂÄºÁªô‰∫ÜAQSÁöÑstateÔºåÂèØ‰ª•Áúã‰∏ãÈù¢ new Sync(count)ÁöÑÊ∫êÁ†ÅÔºåÂÆÉÂÆûÈôÖ‰∏äÊòØsetÁöÑstateÂÄºÔºåËÄåËøô‰∏™stateÊòØAQS‰∏≠ÁöÑÂ±ûÊÄß</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sync <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sync</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/** 
    	ÂØºËá¥ÂΩìÂâçÁ∫øÁ®ãÁ≠âÂæÖÔºåÁõ¥Âà∞Èó©ÈîÅÂÄíÊï∞‰∏∫Èõ∂ÔºåÈô§ÈùûÁ∫øÁ®ãË¢´‰∏≠Êñ≠
    	Â¶ÇÊûúÂΩìÂâçËÆ°Êï∞‰∏∫Èõ∂ÔºåÂàôÊ≠§ÊñπÊ≥ïÁ´ãÂç≥ËøîÂõû„ÄÇ
		
		Â¶ÇÊûúÂΩìÂâçËÆ°Êï∞Â§ß‰∫é0ÔºåÂàôÂΩìÂâçÁ∫øÁ®ãÂ∞ÜË¢´Á¶ÅÁî®Ôºå‰ª•ÂÆûÁé∞Á∫øÁ®ãË∞ÉÂ∫¶ÁõÆÁöÑÔºåÂπ∂Â§Ñ‰∫é‰ºëÁú†Áä∂ÊÄÅÔºåÁõ¥Âà∞ÂèëÁîü‰ª•‰∏ã‰∏§ÁßçÊÉÖÂÜµ‰πã‰∏ÄÔºö
		1„ÄÅÁî±‰∫éË∞ÉÁî®countDownÊñπÊ≥ïÔºåËÆ°Êï∞ËææÂà∞Èõ∂;
		2„ÄÅÊàñÂÖ∂‰ªñÁ∫øÁ®ã‰∏≠Êñ≠ÂΩìÂâçÁ∫øÁ®ã„ÄÇ
		
		Â¶ÇÊûúÂΩìÂâçÁ∫øÁ®ã:
			Âú®ËøõÂÖ•ËØ•ÊñπÊ≥ïÊó∂ËÆæÁΩÆ‰∫Ü‰∏≠Êñ≠Áä∂ÊÄÅ;
			ÊàñÂú®Á≠âÂæÖÊó∂Ë¢´ÊâìÊñ≠
		
		ÁÑ∂ÂêéÊäõÂá∫InterruptedExceptionÔºåÂπ∂Ê∏ÖÈô§ÂΩìÂâçÁ∫øÁ®ãÁöÑ‰∏≠Êñ≠Áä∂ÊÄÅ„ÄÇ
		ÊäõÂá∫: InterruptedException‚Äî‚ÄîÂ¶ÇÊûúÂΩìÂâçÁ∫øÁ®ãÂú®Á≠âÂæÖÊó∂Ë¢´‰∏≠Êñ≠
	*/</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        sync<span class="token punctuation">.</span><span class="token function">acquireSharedInterruptibly</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
    	ÂØºËá¥ÂΩìÂâçÁ∫øÁ®ãÁ≠âÂæÖÔºåÁõ¥Âà∞ÈîÅÂ≠òÂô®ÂÄíÊï∞‰∏∫Èõ∂ÔºåÈô§ÈùûÁ∫øÁ®ãË¢´‰∏≠Êñ≠ÔºåÊàñÊåáÂÆöÁöÑÁ≠âÂæÖÊó∂Èó¥Ëøá‰∫Ü„ÄÇ
		Â¶ÇÊûúÂΩìÂâçËÆ°Êï∞‰∏∫Èõ∂ÔºåÂàôËØ•ÊñπÊ≥ïÁ´ãÂç≥ËøîÂõûÂÄº‰∏∫true„ÄÇ
		Â¶ÇÊûúÂΩìÂâçËÆ°Êï∞Â§ß‰∫é0ÔºåÈÇ£‰πàÂΩìÂâçÁ∫øÁ®ãÂ∞ÜË¢´Á¶ÅÁî®Ôºå‰ª•ÂÆûÁé∞Á∫øÁ®ãË∞ÉÂ∫¶ÁõÆÁöÑÔºåÂπ∂Â§Ñ‰∫é‰ºëÁú†Áä∂ÊÄÅÔºåÁõ¥Âà∞ÂèëÁîü‰ª•‰∏ã‰∏âÁßçÊÉÖÂÜµ‰πã‰∏Ä:
			1„ÄÅÁî±‰∫éË∞ÉÁî®countDownÊñπÊ≥ïÔºåËÆ°Êï∞ËææÂà∞Èõ∂;
			2„ÄÅÊàñÂÖ∂‰ªñÁ∫øÁ®ã‰∏≠Êñ≠ÂΩìÂâçÁ∫øÁ®ã;
			3„ÄÅÊàñÁ≠âÂæÖÊó∂Èó¥Ëøá‰∫Ü„ÄÇ
		Â¶ÇÊûúËÆ°Êï∞‰∏∫Èõ∂ÔºåÂàôËØ•ÊñπÊ≥ïËøîÂõûÂÄº‰∏∫true„ÄÇ
		Â¶ÇÊûúÂΩìÂâçÁ∫øÁ®ã:Âú®ËøõÂÖ•ËØ•ÊñπÊ≥ïÊó∂ËÆæÁΩÆ‰∫Ü‰∏≠Êñ≠Áä∂ÊÄÅ;ÊàñÂú®Á≠âÂæÖÊó∂Ë¢´‰∏≠Êñ≠ÔºåÂàôÊäõÂá∫InterruptedExceptionÔºåÂπ∂Ê∏ÖÈô§ÂΩìÂâçÁ∫øÁ®ãÁöÑ‰∏≠Êñ≠Áä∂ÊÄÅ„ÄÇ
		Â¶ÇÊûúÁªèËøá‰∫ÜÊåáÂÆöÁöÑÁ≠âÂæÖÊó∂Èó¥ÔºåÂàôËøîÂõûÂÄºfalse„ÄÇÂ¶ÇÊûúÊó∂Èó¥Â∞è‰∫éÊàñÁ≠â‰∫éÈõ∂ÔºåÂàôËØ•ÊñπÊ≥ïÊ†πÊú¨‰∏ç‰ºöÁ≠âÂæÖ„ÄÇ
		ÂèÇÊï∞:timeout‚ÄîÁ≠âÂæÖÁöÑÊúÄÂ§ßÊó∂Èó¥Âçï‰Ωç‚ÄîtimeoutÂèÇÊï∞ÁöÑÊó∂Èó¥Âçï‰Ωç
		ËøîÂõû:Â¶ÇÊûúËÆ°Êï∞‰∏∫0ÂàôËøîÂõûtrueÔºåÂ¶ÇÊûúÁ≠âÂæÖÊó∂Èó¥ÁªèËøábÂàôËøîÂõûfalse
		ÊäõÂá∫: InterruptedException‚Äî‚ÄîÂ¶ÇÊûúÂΩìÂâçÁ∫øÁ®ãÂú®Á≠âÂæÖÊó∂Ë¢´‰∏≠Êñ≠
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> sync<span class="token punctuation">.</span><span class="token function">tryAcquireSharedNanos</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> unit<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
    	ÈÄíÂáèÈîÅÂ≠òÁöÑËÆ°Êï∞ÔºåÂ¶ÇÊûúËÆ°Êï∞‰∏∫Èõ∂ÔºåÂàôÈáäÊîæÊâÄÊúâÁ≠âÂæÖÁöÑÁ∫øÁ®ã„ÄÇ
		Â¶ÇÊûúÂΩìÂâçËÆ°Êï∞Â§ß‰∫éÈõ∂ÔºåÂàôÈÄíÂáè„ÄÇÂ¶ÇÊûúÊñ∞ÁöÑËÆ°Êï∞‰∏∫0ÔºåÈÇ£‰πàÊâÄÊúâÁ≠âÂæÖÁöÑÁ∫øÁ®ãÈÉΩÂ∞ÜÈáçÊñ∞ÂêØÁî®Ôºå‰ª•ÂÆûÁé∞Á∫øÁ®ãË∞ÉÂ∫¶ÁõÆÁöÑ„ÄÇ
		Â¶ÇÊûúÂΩìÂâçËÆ°Êï∞Á≠â‰∫éÈõ∂ÔºåÈÇ£‰πà‰ªÄ‰πà‰πü‰∏ç‰ºöÂèëÁîü„ÄÇ
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">/**
        public final boolean releaseShared(int arg) &#123;
            if (tryReleaseShared(arg)) &#123;
                doReleaseShared();
                return true;
            &#125;
            return false;
    	&#125;
    	
    	private void doReleaseShared() &#123;
            for (;;) &#123;
                Node h = head;
                if (h != null &amp;&amp; h != tail) &#123;
                    int ws = h.waitStatus;
                    if (ws == Node.SIGNAL) &#123;
                        if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0))
                            continue;            // loop to recheck cases
                        unparkSuccessor(h);
                    &#125;
                    else if (ws == 0 &amp;&amp;
                             !compareAndSetWaitStatus(h, 0, Node.PROPAGATE))
                        continue;                // loop on failed CAS
                &#125;
                if (h == head)                   // loop if head changed
                    break;
            &#125;
   		 &#125;
        */</span>
        sync<span class="token punctuation">.</span><span class="token function">releaseShared</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
    ËøîÂõûÂΩìÂâçËÆ°Êï∞„ÄÇ
    Ê≠§ÊñπÊ≥ïÈÄöÂ∏∏Áî®‰∫éË∞ÉËØïÂíåÊµãËØïÁõÆÁöÑ„ÄÇ
    ËøîÂõû:ÂΩìÂâçËÆ°Êï∞
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> sync<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"[Count = "</span> <span class="token operator">+</span> sync<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>‚Äã        ÂÖ∂ÂÆûÊàë‰ª¨ÁúãÂà∞ <code>CountDownLatch</code> Ê∫êÁ†ÅÁõ∏ÂØπÊØîËæÉÁÆÄÂçïÔºå‰∏ªË¶ÅÊòØÂà©Áî®<code>AbstractQueuedSynchronizer</code>Êù•ÂÆûÁé∞„ÄÇËÄå <code>AbstractQueuedSynchronizer</code>ÂÖ∂ÂÆû‰∏çÈöæÂèëÁé∞ÔºåÊàë‰ª¨Â¶ÇÊûúÂéªÊü•Áúã‰∏Ä‰∏ã<code>ReentrantLock</code>„ÄÅ<code>CountDownLatch</code>„ÄÅ<code>Semaphore</code>„ÄÅ<code>FutureTask</code>„ÄÅ<code>ThreadPoolExecutor</code> ÁöÑÊ∫êÁ†ÅÁöÑËØùÔºåÈÉΩ‰ºöÂèëÁé∞Êúâ‰∏™ÂêçÂè´ <code>Sync</code> ÁöÑ<strong>ÈùôÊÄÅÂÜÖÈÉ®Á±ª</strong>ÔºåÁªßÊâøËá™<code>AbstractQueuedSynchronizer</code> „ÄÇ<code>AbstractQueuedSynchronizer</code>ÊòØ <code>java.util.concurrent</code> ÁöÑ<strong>Ê†∏ÂøÉÁªÑ‰ª∂‰πã‰∏Ä</strong>Ôºå<strong>ÂÆÉ‰∏∫Âπ∂ÂèëÂåÖ‰∏≠ÁöÑÂÖ∂‰ªñsynchronizersÊèê‰æõ‰∫Ü‰∏ÄÁªÑÂÖ¨ÂÖ±ÁöÑÂü∫Á°ÄËÆæÊñΩ</strong>„ÄÇ</p>
<p>‚Äã        <strong>‰ΩøÁî®Âú∫ÊôØÔºö</strong></p>
<p>‚Äã        Âú®‰∏Ä‰∫õÂ∫îÁî®Âú∫Âêà‰∏≠ÔºåÈúÄË¶ÅÁ≠âÂæÖÊüê‰∏™Êù°‰ª∂ËææÂà∞Ë¶ÅÊ±ÇÂêéÊâçËÉΩÂÅöÂêéÈù¢ÁöÑ‰∫ãÊÉÖÔºöÂêåÊó∂ÂΩìÁ∫øÁ®ãÈÉΩÂÆåÊàêÂêé<br>‰πü‰ºöËß¶Âèë‰∫ã‰ª∂Ôºå‰ª•‰æøËøõË°åÂêéÈù¢ÁöÑÊìç‰Ωú„ÄÇËøô‰∏™Êó∂ÂÄôÂ∞±ÂèØ‰ª•‰ΩøÁî®<code>CountDownLatch</code>„ÄÇ <code>CountDownLatch</code><br>ÊúÄÈáçË¶ÅÁöÑÊñπÊ≥ïÊòØ<code>countDown()</code>Âíå<code>await()</code>ÔºåÂâçËÄÖ‰∏ªË¶ÅÊòØÂÄíÊï∞‰∏ÄÊ¨°Ôºå ÂêéËÄÖÊòØÁ≠âÂæÖÂÄíÊï∞Âà∞0ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂà∞<br>Ëææ<strong>0</strong>ÔºåÂ∞±Âè™Êúâ<strong>ÈòªÂ°ûÁ≠âÂæÖ</strong>‰∫Ü„ÄÇÊØîÂ¶ÇÔºå‰∏ãÈù¢‰∏§ÁßçÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÔºö</p>
<ul>
<li>Â∫îÁî®Âú∫ÊôØ1ÔºöÂºÄ5‰∏™Â§öÁ∫øÁ®ãÂéª‰∏ãËΩΩÔºåÂΩì5‰∏™Á∫øÁ®ãÈÉΩÊâßË°åÂÆå‰∫ÜÊâçÁÆó‰∏ãËΩΩÊàêÂäü!</li>
<li>Â∫îÁî®Âú∫ÊôØ2ÔºöÂΩìÁî®Êà∑Â§öÊñá‰ª∂‰∏ä‰º†ÁöÑÊó∂ÂÄôÔºåÂèØ‰ª•ÈááÁî®Â§öÁ∫øÁ®ã‰∏ä‰º†ÔºåÂΩìÂ§ö‰∏™Êñá‰ª∂ÈÉΩ‰∏ä‰º†ÊàêÂäüÁöÑ<br>Êó∂ÂÄôÊâçÁÆóÁúüÊ≠£ÁöÑ‰∏ä‰º†ÊàêÂäü„ÄÇ</li>
</ul>
<p>‰∏æ‰æã:Ê®°Êãü‰∏Ä‰∏™Âú∫ÊôØÔºåÂè™Êúâ‰∏â‰∏™Á®ãÂ∫èÈÉΩÂπ≤ÂÆåÊ¥ª‰∫ÜÔºåÊâçÁÆóÈ°πÁõÆÂÆåÊàê„ÄÇÂÆû‰æãÂ¶Ç‰∏ã:</p>
<h4 id="No1-CountDownLatchDemoOne-java"><a href="#No1-CountDownLatchDemoOne-java" class="headerlink" title="No1_CountDownLatchDemoOne.java"></a>No1_CountDownLatchDemoOne.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>semaphore</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No1_CountDownLatchDemoOne</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">CountDownLatch</span> latch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Worker</span> worker1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"Á®ãÂ∫èÂëò1"</span><span class="token punctuation">,</span>latch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Worker</span> worker2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"Á®ãÂ∫èÂëò2"</span><span class="token punctuation">,</span>latch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Worker</span> worker3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"Á®ãÂ∫èÂëò3"</span><span class="token punctuation">,</span>latch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        worker1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        worker2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        worker3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        latch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ÂΩìÂâçÁ∫øÁ®ãÁ≠âÂæÖ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Main thread end!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> workerName<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">CountDownLatch</span> latch<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token class-name">String</span> workerName<span class="token punctuation">,</span><span class="token class-name">CountDownLatch</span> latch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>workerName <span class="token operator">=</span> workerName<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>latch <span class="token operator">=</span> latch<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Worker:"</span><span class="token operator">+</span>workerName <span class="token operator">+</span><span class="token string">" is begin."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ‰ºëÁú†‰∏ÄÁßíÈíüÔºå‰ª•‰æøÁ≠âÂæÖÂÖ∂‰ªñÁ∫øÁ®ãË∞ÉÁî®begin</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Worker:"</span><span class="token operator">+</span>workerName <span class="token operator">+</span><span class="token string">" is end."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// TODO Auto-generated catch block</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token comment">//Ê®°‰ªøÂπ≤Ê¥ªÔºõ</span>
            latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ÈÄíÂáèÈîÅÂ≠òÂô®ÁöÑËÆ°Êï∞</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËæìÂá∫</p>
<pre class="line-numbers language-none"><code class="language-none">Worker:Á®ãÂ∫èÂëò1 is begin.
Worker:Á®ãÂ∫èÂëò3 is begin.
Worker:Á®ãÂ∫èÂëò2 is begin.
Worker:Á®ãÂ∫èÂëò3 is end.
Worker:Á®ãÂ∫èÂëò2 is end.
Worker:Á®ãÂ∫èÂëò1 is end.
Main thread end!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>‚Äã       </p>
<p>‚Äã        ‰ªéÁªìÊûú‰∏äÂèØ‰ª•ÁúãÂæóÂá∫Êù•‰∏çÂÉèÊàë‰ª¨‰πãÂâçÁöÑÂÆû‰æãÔºåMainThread‰πãÂêéÁ≠â‰∏â‰∏™Á∫øÁ®ãÂêåÊó∂ÂÆåÊàêÁöÑÊó∂ÂÄôÊâç‰ºöÁªßÁª≠ÂæÄ‰∏ãÊâßË°å„ÄÇ</p>
<p>‰∏ãÈù¢Êù•ÁúãÁúãÁ±ª‰∏≠Ê≥®ÈáäÁöÑÊîπÂÜôÁöÑ‰æãÂ≠ê</p>
<h4 id="No1-CountDownLatchDemoTwo-java"><a href="#No1-CountDownLatchDemoTwo-java" class="headerlink" title="No1_CountDownLatchDemoTwo.java"></a>No1_CountDownLatchDemoTwo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>semaphore</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No1_CountDownLatchDemoTwo</span>  <span class="token punctuation">&#123;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Driver</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">CountDownLatch</span> startSignal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CountDownLatch</span> doneSignal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// create and start threads ÂàõÂª∫ÂíåÂêØÂä®Á∫øÁ®ã</span>
                <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>startSignal<span class="token punctuation">,</span> doneSignal<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token function">doSomethingElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// don't let run yet</span>
            startSignal<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// let all threads proceed  ËÆ©ÊâÄÊúâÁöÑÁ∫øÁ®ãÁªßÁª≠</span>
            <span class="token function">doSomethingElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            doneSignal<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// wait for all to finish  Á≠â‰∏ÄÂàáÈÉΩÁªìÊùü</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"wait for all to finish"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">void</span> <span class="token function">doSomethingElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"doSomethingElse "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss:SSS"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CountDownLatch</span> startSignal<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CountDownLatch</span> doneSignal<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>
        <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token class-name">CountDownLatch</span> startSignal<span class="token punctuation">,</span> <span class="token class-name">CountDownLatch</span> doneSignal<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>startSignal <span class="token operator">=</span> startSignal<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>doneSignal <span class="token operator">=</span> doneSignal<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>i <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                startSignal<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">doWork</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                doneSignal<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// return;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">void</span> <span class="token function">doWork</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" WorkerRunnable "</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Driver2</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">CountDownLatch</span> doneSignal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ExecutorService</span> e <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// create and start threads  ËÆ©ÊâÄÊúâÁöÑÁ∫øÁ®ãÁªßÁª≠</span>
                e<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WorkerRunnable</span><span class="token punctuation">(</span>doneSignal<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            doneSignal<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// wait for all to finish  Á≠â‰∏ÄÂàáÈÉΩÁªìÊùü</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"wait for all to finish"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WorkerRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CountDownLatch</span> doneSignal<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>
        <span class="token class-name">WorkerRunnable</span><span class="token punctuation">(</span><span class="token class-name">CountDownLatch</span> doneSignal<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>doneSignal <span class="token operator">=</span> doneSignal<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>i <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">doWork</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            doneSignal<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">void</span> <span class="token function">doWork</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" WorkerRunnable "</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"InterruptedException"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

<span class="token comment">//        try &#123;</span>
<span class="token comment">//            new Driver2().main();</span>
<span class="token comment">//        &#125;catch (InterruptedException e)&#123;</span>
<span class="token comment">//            System.out.println("InterruptedException");</span>
<span class="token comment">//            e.printStackTrace();</span>
<span class="token comment">//        &#125;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="ÊäΩË±°ÈòüÂàóÂåñÂêåÊ≠•Âô®AbstractQueuedSynchronizer"><a href="#ÊäΩË±°ÈòüÂàóÂåñÂêåÊ≠•Âô®AbstractQueuedSynchronizer" class="headerlink" title="ÊäΩË±°ÈòüÂàóÂåñÂêåÊ≠•Âô®AbstractQueuedSynchronizer"></a>ÊäΩË±°ÈòüÂàóÂåñÂêåÊ≠•Âô®AbstractQueuedSynchronizer</h3><p>‚Äã        <code>AbstractQueuedSynchronizer</code> ÊòØ<code>java.util.concurrent</code> ÁöÑ<strong>Ê†∏ÂøÉÁªÑ‰ª∂‰πã‰∏Ä</strong>,ÂÆÉÊèê‰æõ‰∫Ü‰∏Ä‰∏™Âü∫‰∫é<code>FIFO</code>ÈòüÂàóÔºåÂèØ‰ª•Áî®‰∫éÊûÑÂª∫ÈîÅÊàñËÄÖÂÖ∂‰ªñÁõ∏ÂÖ≥ÂêåÊ≠•Ë£ÖÁΩÆÁöÑÂü∫Á°ÄÊ°ÜÊû∂„ÄÇ<strong>ËØ•Á±ªÂà©Áî®‰∫Ü‰∏Ä‰∏™intÊù•Ë°®Á§∫Áä∂ÊÄÅÔºåÊúüÊúõÂÆÉËÉΩÂ§üÊàê‰∏∫ÂÆûÁé∞Â§ßÈÉ®ÂàÜÂêåÊ≠•ÈúÄÊ±ÇÁöÑÂü∫Á°Ä</strong>„ÄÇ<strong>‰ΩøÁî®ÁöÑÊñπÊ≥ïÊòØÁªßÊâøÔºåÂ≠êÁ±ªÈÄöËøáÁªßÊâøÂêåÊ≠•Âô®Âπ∂ÈúÄË¶ÅÂÆûÁé∞ÂÆÉÁöÑÊñπÊ≥ïÊù•ÁÆ°ÁêÜÂÖ∂Áä∂ÊÄÅÔºåÁÆ°ÁêÜÁöÑÊñπÂºèÂ∞±ÊòØÈÄöËøáÁ±ª‰ººacquireÂíå releaseÁöÑÊñπÂºèÊù•ÊìçÁ∫µÁä∂ÊÄÅ„ÄÇ</strong>ÁÑ∂ËÄåÔºåÂ§öÁ∫øÁ®ãÁéØÂ¢É‰∏≠ÂØπÁä∂ÊÄÅÁöÑÊìçÁ∫µÂøÖÈ°ªÁ°Æ‰øùÂéüÂ≠êÊÄßÔºåÂõ†Ê≠§Â≠êÁ±ªÂØπ‰∫éÁä∂ÊÄÅÁöÑÊääÊè°,ÈúÄË¶Å‰ΩøÁî®Ëøô‰∏™ÂêåÊ≠•Âô®Êèê‰æõÁöÑ‰ª•‰∏ã‰∏â‰∏™ÊñπÊ≥ïÂØπÁä∂ÊÄÅËøõË°åÊìç‰ΩúÔºö</p>
<ul>
<li><code>AbstractQueuedSynchronizer.getState()</code></li>
<li><code>AbstractQueuedSynchronizer.setState()</code></li>
<li><code>AbstractQueuedSynchronizer.compareAndSetState()</code></li>
</ul>
<p>‚Äã        Â≠êÁ±ªÊé®ËçêË¢´ÂÆö‰πâ‰∏∫Ëá™ÂÆö‰πâÂêåÊ≠•Ë£ÖÁΩÆÁöÑÂÜÖÈÉ®Á±ªÔºåÂ∞±ÂÉè<code>CountDownLatch</code>ÈáåÈù¢‰∏ÄÊ†∑ÔºåÂêåÊ≠•Âô®Ëá™Ë∫´Ê≤°ÊúâÂÆûÁé∞‰ªª‰ΩïÂêåÊ≠•Êé•Âè£ÔºåÂÆÉ‰ªÖ‰ªÖÊòØ‰∏∫ÂÆö‰πâ‰∫ÜËã•Âπ≤<code>acquire</code> (ËØëÊñáÔºöËé∑Âèñ)‰πãÁ±ªÁöÑÊñπÊ≥ïÊèê‰æõ‰ΩøÁî®„ÄÇ<strong>ËØ•ÂêåÊ≠•Âô®Êó¢ÂèØ‰ª•‰Ωú‰∏∫Êéí‰ªñÊ®°Âºè‰πüÂèØ‰ª•‰Ωú‰∏∫ÂÖ±‰∫´Ê®°Âºè</strong>„ÄÇÂΩìÂÆÉË¢´ÂÆö‰πâ‰∏∫‰∏Ä‰∏™Êéí‰ªñÊ®°ÂºèÊó∂ÔºåÂÖ∂‰ªñÁ∫øÁ®ãÂØπÂÆÉÁöÑËé∑ÂèñÂ∞±Ë¢´ÈòªÊ≠¢ÔºåËÄåÂÖ±‰∫´Ê®°ÂºèÂØπ‰∫éÂ§ö‰∏™Á∫øÁ®ãËé∑ÂèñÈÉΩÂèØ‰ª•ÊàêÂäü„ÄÇ<br>‚Äã        <code>AbstractQueuedSynchronizer</code> <strong>Êèê‰æõ‰∫Ü‰∏§ÁßçÊú∫Âà∂ÔºöÊéí‰ªñÊ®°ÂºèÂíåÂÖ±‰∫´Ê®°ÂºèÔºå‰πüÂèØ‰ª•‰∏§ÁßçÊ®°ÂºèÂÖ±Â≠ò</strong>„ÄÇ<strong>Â§Ñ‰∫éÊéí‰ªñÊ®°ÂºèÊó∂ÔºåÂÖ∂‰ªñÁ∫øÁ®ãËØïÂõæËé∑ÂèñËØ•ÈîÅÂ∞ÜÊó†Ê≥ïÂèñÂæóÊàêÂäü„ÄÇÂú®ÂÖ±‰∫´Ê®°Âºè‰∏ãÔºåÂ§ö‰∏™Á∫øÁ®ãËé∑ÂèñÊüê‰∏™ÈîÅÂèØËÉΩÔºà‰ΩÜ‰∏çÊòØ‰∏ÄÂÆö)‰ºöËé∑ÂæóÊàêÂäü„ÄÇ</strong>Ê≠§Á±ªÂπ∂‰∏ç‚Äú‰∫ÜËß£‚ÄùËøô‰∫õ‰∏çÂêåÔºåÈô§‰∫ÜÊú∫Ê¢∞Âú∞ÊÑèËØÜÂà∞ÂΩìÂú®ÂÖ±‰∫´Ê®°Âºè‰∏ãÊàêÂäüËé∑ÂèñÊüê‰∏ÄÈîÅÊó∂Ôºå‰∏ã‰∏Ä‰∏™Á≠âÂæÖÁ∫øÁ®ã(Â¶ÇÊûúÂ≠òÂú®Ôºâ‰πüÂøÖÈ°ªÁ°ÆÂÆöËá™Â∑±ÊòØÂê¶ÂèØ‰ª•ÊàêÂäüËé∑ÂèñËØ•ÈîÅ„ÄÇÂ§Ñ‰∫é‰∏çÂêåÊ®°Âºè‰∏ãÁöÑÁ≠âÂæÖÁ∫øÁ®ãÂèØ‰ª•ÂÖ±‰∫´Áõ∏ÂêåÁöÑ<code>FIFO</code> ÈòüÂàó„ÄÇÈÄöÂ∏∏ÔºåÂÆûÁé∞Â≠êÁ±ªÂè™ÊîØÊåÅÂÖ∂‰∏≠‰∏ÄÁßçÊ®°ÂºèÔºå‰ΩÜ‰∏§ÁßçÊ®°ÂºèÈÉΩÂèØ‰ª•Âú®(‰æãÂ¶Ç)<code>ReadWriteLock</code>‰∏≠ÂèëÊå•‰ΩúÁî®„ÄÇ<strong>Âè™ÊîØÊåÅÊéí‰ªñÊ®°ÂºèÊàñËÄÖÂè™ÊîØÊåÅÂÖ±‰∫´Ê®°ÂºèÁöÑÂ≠êÁ±ª‰∏çÂøÖÂÆö‰πâÊîØÊåÅÊú™‰ΩøÁî®Ê®°ÂºèÁöÑÊñπÊ≥ï</strong>„ÄÇ<br>‚Äã        Ê≠§Á±ªÈÄöËøáÊîØÊåÅÊéí‰ªñÊ®°ÂºèÁöÑÂ≠êÁ±ªÂÆö‰πâ‰∫Ü‰∏Ä‰∏™ÂµåÂ•óÁöÑ<code>AbstractQueuedSynchronizer.ConditionObject</code>Á±ªÔºåÂèØ‰ª•Â∞ÜËøô‰∏™Á±ªÁî®‰Ωú<code>Condition</code>ÂÆûÁé∞„ÄÇ<code>isHeldExclusively()</code>ÊñπÊ≥ïÂ∞ÜÊä•ÂëäÂêåÊ≠•ÂØπ‰∫éÂΩìÂâçÁ∫øÁ®ãÊòØÂê¶ÊòØÊéí‰ªñÁöÑÔºõ‰ΩøÁî®ÂΩìÂâç<code>getState()</code>ÂÄºË∞ÉÁî®<code>release(int)</code>ÊñπÊ≥ïÂàôÂèØ‰ª•ÂÆåÂÖ®ÈáäÊîæÊ≠§ÂØπË±°ÔºõÂ¶ÇÊûúÁªôÂÆö‰øùÂ≠òÁöÑÁä∂ÊÄÅÂÄºÔºåÈÇ£‰πà<code>acquire(int)</code>ÊñπÊ≥ïÂèØ‰ª•Â∞ÜÊ≠§ÂØπË±°ÊúÄÁªàÊÅ¢Â§ç‰∏∫ÂÆÉ‰ª•ÂâçËé∑ÂèñÁöÑÁä∂ÊÄÅ„ÄÇÊ≤°ÊúâÂà´ÁöÑ<code>AbstractQueuedSynchronizer</code>ÊñπÊ≥ïÂàõÂª∫ËøôÊ†∑ÁöÑÊù°‰ª∂ÔºåÂõ†Ê≠§ÔºåÂ¶ÇÊûúÊó†Ê≥ïÊª°Ë∂≥Ê≠§Á∫¶ÊùüÔºåÂàô‰∏çË¶Å‰ΩøÁî®ÂÆÉ„ÄÇ<code>AbstractQueuedSynchronizer.ConditionObject</code> ÁöÑË°å‰∏∫ÂΩìÁÑ∂ÂèñÂÜ≥‰∫éÂÖ∂ÂêåÊ≠•Âô®ÂÆûÁé∞ÁöÑËØ≠‰πâ„ÄÇ<br>‚Äã        Ê≠§Á±ª‰∏∫ÂÜÖÈÉ®ÈòüÂàóÊèê‰æõ‰∫ÜÊ£ÄÊü•„ÄÅÊ£ÄÊµãÂíåÁõëËßÜÊñπÊ≥ïÔºåËøò‰∏∫ <code>condition</code>ÂØπË±°Êèê‰æõ‰∫ÜÁ±ª‰ººÊñπÊ≥ï„ÄÇÂèØ‰ª•Ê†πÊçÆÈúÄË¶Å‰ΩøÁî®ÔºåÂèØ‰ª•‰ΩøÂÖ∂Âú®ÂêåÊ≠•Êú∫Âà∂ÁöÑ<code>AbstractQueuedSynchronizer</code> ÁöÑÂ≠êÁ±ª‰∏≠ÂºïÁî®Ëøô‰∫õÊñπÊ≥ï„ÄÇÊ≠§Á±ªÁöÑÂ∫èÂàóÂåñÂè™Â≠òÂÇ®Áª¥Êä§Áä∂ÊÄÅÁöÑÂü∫Á°ÄÂéüÂ≠êÊï¥Êï∞ÔºåÂõ†Ê≠§Â∑≤Â∫èÂàóÂåñÁöÑÂØπË±°Êã•ÊúâÁ©∫ÁöÑÁ∫øÁ®ãÈòüÂàó„ÄÇÈúÄË¶ÅÂèØÂ∫èÂàóÂåñÁöÑÂÖ∏ÂûãÂ≠êÁ±ªÂ∞ÜÂÆö‰πâ‰∏Ä‰∏™<code>readObject</code>ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ïÂú®ÂèçÂ∫èÂàóÂåñÊó∂Â∞ÜÊ≠§ÂØπË±°ÊÅ¢Â§çÂà∞Êüê‰∏™Â∑≤Áü•ÂàùÂßãÁä∂ÊÄÅ„ÄÇ<br>‚Äã        Êé•‰∏ãÊù•ÁúãÁúãÂ¶Ç‰Ωï‰ΩøÁî®Ôºö</p>
<p>‚Äã        ÂÆö‰πâ‰∏Ä‰∏™Â≠êÁ±ªÂèØ‰ª•ÈÄÇÂΩìÂú∞ÈáçÊñ∞ÂÆö‰πâ <code>tryAcquire(int)</code>ËØïÂõæÂú®Êéí‰ªñÊ®°Âºè‰∏ãËé∑ÂèñÂØπË±°Áä∂ÊÄÅÔºå<code>tryRelease(int)</code>ËØïÂõæËÆæÁΩÆÁä∂ÊÄÅÊù•ÂèçÊò†Êéí‰ªñÊ®°Âºè‰∏ãÁöÑ‰∏Ä‰∏™ÈáäÊîæÔºå<code>tryAcquireShared(int)</code>ËØïÂõæÂú®ÂÖ±‰∫´Ê®°Âºè‰∏ãËé∑ÂèñÂØπË±°Áä∂ÊÄÅÔºå<code>tryReleaseShared(int)</code>ËØïÂõæËÆæÁΩÆÁä∂ÊÄÅÊù•ÂèçÊò†ÂÖ±‰∫´Ê®°Âºè‰∏ãÁöÑ‰∏Ä‰∏™ÈáäÊîæÔºå<code>isHeldExclusively()</code>Ë°®Á§∫Â¶ÇÊûúÂØπ‰∫éÂΩìÂâç(Ê≠£Ë∞ÉÁî®ÁöÑ)Á∫øÁ®ãÔºåÂêåÊ≠•ÊòØ‰ª•Êéí‰ªñÊñπÂºèËøõË°åÁöÑÔºåÂàôËøîÂõû <code>true</code>,Á≠âÁ≠âËøô‰∫õÊñπÊ≥ï„ÄÇËøôÊòØÈÄöËøá‰ΩøÁî® <code>getState()</code>„ÄÅ<code>setState(int) </code> Âíå&#x2F;Êàñ <code>compareAndSetState(int, int)</code>ÊñπÊ≥ïÊù•Ê£ÄÊü• Âíå&#x2F;Êàñ ‰øÆÊîπÂêåÊ≠•Áä∂ÊÄÅÊù•ÂÆûÁé∞ÁöÑ„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÊØè‰∏™ÊñπÊ≥ïÈÉΩÊäõÂá∫ <code>UnsupportedOperationException</code>(<strong>‰∏çÊîØÊåÅÊìç‰ΩúÂºÇÂ∏∏</strong>)„ÄÇËøô‰∫õÊñπÊ≥ïÁöÑÂÆûÁé∞<strong>Âú®ÂÜÖÈÉ®ÂøÖÈ°ªÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ</strong>ÔºåÈÄöÂ∏∏Â∫îËØ•ÂæàÁü≠Âπ∂‰∏î‰∏çË¢´ÈòªÂ°û„ÄÇ<strong>ÂÆö‰πâËøô‰∫õÊñπÊ≥ïÊòØ‰ΩøÁî®Ê≠§Á±ªÁöÑÂîØ‰∏ÄÂèóÊîØÊåÅÁöÑÊñπÂºè„ÄÇ</strong>ÂÖ∂‰ªñÊâÄÊúâÊñπÊ≥ïÈÉΩË¢´Â£∞Êòé‰∏∫ <code>final</code>ÔºåÂõ†‰∏∫ÂÆÉ‰ª¨Êó†Ê≥ïÊòØÂêÑ‰∏çÁõ∏ÂêåÁöÑ„ÄÇ<code>AbstractQueuedSynchronizer</code> ÂÜÖÁΩÆ‰∏Ä‰∏™ <code>state</code> Â≠óÊÆµÔºåÁî®Êù•Ë°®Á§∫ÊüêÁßçÊÑè‰πâ‚Äî‚ÄîÂΩì<code>ReentrantLock</code>‰ΩøÁî®<code>AQS</code>ÁöÑÊó∂ÂÄôÔºå<code>state</code> Ë¢´Áî®Êù•Ë°®Á§∫ÈîÅË¢´ÈáçÂÖ•ÁöÑÊ¨°Êï∞ÔºõÂΩì<code>Semaphore</code>‰ΩøÁî®<code>AQS</code>ÁöÑÊó∂ÂÄôÔºå<code>state</code> ÂàôË¢´Áî®Êù•Ë°®Á§∫ÂΩìÂâçËøòÊúâÂ§öÂ∞ë‰ø°Âè∑ÈáèÂèØË¢´Ëé∑Âèñ„ÄÇ<code>AbstractQueuedSynchronizer</code> ÊîØÊåÅÁöÑ‰∏§ÁßçÊ®°ÂºèÔºöÊéí‰ªñÂºèÂíåÂÖ±‰∫´ÂºèÔºå‰∏§ËÄÖËøõË°åËé∑ÂèñÂíåÈáäÊîæÂä®‰ΩúÁöÑÊÄùË∑ØÈÉΩÊòØÂ∑Æ‰∏çÂ§öÁöÑ„ÄÇ<br>‚Äã        Ëé∑ÂèñÂêåÊ≠•Âô®ÁöÑÊµÅÁ®ãÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span><span class="token punctuation">(</span>Â∞ùËØïËé∑ÂèñÊàêÂäü<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span>„ÄÇ
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
	Âä†ÂÖ•Á≠âÂæÖÈòüÂàó<span class="token punctuation">;</span> parkËá™Â∑±
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÈáäÊîæÂêåÊ≠•Âô®ÁöÑÊµÅÁ®ãÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span><span class="token punctuation">(</span>Â∞ùËØïÈáäÊîæÊàêÂäü<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	unparkÁ≠âÂæÖÈòüÂàó‰∏≠Á¨¨‰∏Ä‰∏™ËäÇÁÇπ
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÂØπÊ¶ÇÂøµÊúâ‰∫ÜÂü∫Êú¨ÁöÑÁêÜËß£‰πãÂêéÊàë‰ª¨Êù•Áúã‰∏Ä‰∏™ÂÆòÊñπÁöÑ<strong>demo</strong>ÔºåÂ∞±ÂèØ‰ª•ÂÆûÁé∞‰∏Ä‰∏™ÁÆÄÂçïÁöÑËá™ÂÆö‰πâÈîÅ‰∫Ü„ÄÇÂ¶Ç‰∏ãÔºö</p>
<h4 id="No2-MutexDemo-java"><a href="#No2-MutexDemo-java" class="headerlink" title="No2_MutexDemo.java"></a>No2_MutexDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>semaphore</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectInputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">AbstractQueuedSynchronizer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Condition</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Lock</span><span class="token punctuation">;</span>

<span class="token comment">/**
 ËøôÈáåÊúâ‰∏Ä‰∏™‰∏çÂèØÈáçÂÖ•ÁöÑ‰∫íÊñ•ÈîÅÁ±ªÔºåÂÆÉ‰ΩøÁî®ÂÄº0Ë°®Á§∫Êú™Ëß£ÈîÅÁä∂ÊÄÅÔºå1Ë°®Á§∫ÈîÅÂÆöÁä∂ÊÄÅ„ÄÇ
 ËôΩÁÑ∂‰∏çÂèØÈáçÂÖ•ÈîÅÂπ∂‰∏ç‰∏•Ê†ºË¶ÅÊ±ÇËÆ∞ÂΩïÂΩìÂâçÊâÄÊúâËÄÖÁ∫øÁ®ãÔºå‰ΩÜËøô‰∏™Á±ªÊó†ËÆ∫Â¶Ç‰ΩïÈÉΩË¶ÅËøôÊ†∑ÂÅöÔºå‰ª•‰Ωø‰ΩøÁî®Êõ¥ÂÆπÊòìÁõëÊéß„ÄÇ
 ÂÆÉËøòÊîØÊåÅÊù°‰ª∂ÔºåÂπ∂ÂÖ¨ÂºÄ‰∫Ü‰∏ÄÁßçÊµãÈáèÊñπÊ≥ï:
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No2_MutexDemo</span> <span class="token keyword">implements</span> <span class="token class-name">Lock</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// Our internal helper class ÂÜÖÈÉ®Á±ªÔºåËá™ÂÆö‰πâÂêåÊ≠•Âô®</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Sync</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueuedSynchronizer</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Reports whether in locked state ÊòØÂê¶Â§Ñ‰∫éÂç†Áî®Áä∂ÊÄÅ</span>
        <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">isHeldExclusively</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// Acquires the lock if state is zero ÂΩìÁä∂ÊÄÅ‰∏∫0ÁöÑÊó∂ÂÄôËé∑ÂèñÈîÅ</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">assert</span> acquires <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Otherwise unused Âê¶ÂàôÊú™‰ΩøÁî®</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// Releases the lock by setting state to zero ÈáäÊîæÈîÅÔºåÂ∞ÜÁä∂ÊÄÅËÆæÁΩÆ‰∏∫0</span>
        <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">tryRelease</span><span class="token punctuation">(</span><span class="token keyword">int</span> releases<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">assert</span> releases <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Otherwise unused Âê¶ÂàôÊú™‰ΩøÁî®</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalMonitorStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// Provides a Condition  ËøîÂõû‰∏Ä‰∏™ConditionÔºåÊØè‰∏™conditionÈÉΩÂåÖÂê´‰∫Ü‰∏Ä‰∏™conditionÈòüÂàó</span>
        <span class="token class-name">Condition</span> <span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConditionObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

        <span class="token comment">// Deserializes properly ÂèçÂ∫èÂàóÂåñÊ≠£Á°Æ</span>
        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectInputStream</span> s<span class="token punctuation">)</span>
                <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
            s<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// reset to unlocked state ÈáçÁΩÆ‰∏∫Ëß£ÈîÅÁä∂ÊÄÅ</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// The sync object does all the hard work. We just forward to it.</span>
    <span class="token comment">//Âà©Áî®ÂÜÖÈÉ®Á±ªÔºåÂ£∞Êòé‰∏Ä‰∏™AbstractQueuedSynchronizerÂ≠êÁ±ªÔºå‰∏ÄËà¨ÈÉΩÊòØÂú®ÂÜÖÈÉ®Á±ªÈáåÈù¢‰ΩøÁî®ÁöÑ</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Sync</span> sync <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">&#123;</span> sync<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> sync<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">&#123;</span> sync<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token class-name">Condition</span> <span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> sync<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> sync<span class="token punctuation">.</span><span class="token function">isHeldExclusively</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasQueuedThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> sync<span class="token punctuation">.</span><span class="token function">hasQueuedThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        sync<span class="token punctuation">.</span><span class="token function">acquireInterruptibly</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> sync<span class="token punctuation">.</span><span class="token function">tryAcquireNanos</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> unit<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        </p>
<h4 id="No2-BooleanLatchDemo-java"><a href="#No2-BooleanLatchDemo-java" class="headerlink" title="No2_BooleanLatchDemo.java"></a>No2_BooleanLatchDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>semaphore</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">AbstractQueuedSynchronizer</span><span class="token punctuation">;</span>

<span class="token comment">/**
ËøôÈáåÊúâ‰∏Ä‰∏™ÈîÅÂ≠òÁ±ªÔºåÂÆÉÁ±ª‰ºº‰∫éCountDownLatchÔºåÂè™‰∏çËøáÂÆÉÂè™ÈúÄË¶Å‰∏Ä‰∏™‰ø°Âè∑Êù•Ëß¶Âèë„ÄÇÂõ†‰∏∫Èó®Èó©ÊòØÈùûÁã¨Âç†ÁöÑÔºåÊâÄ‰ª•ÂÆÉ‰ΩøÁî®ÂÖ±‰∫´ÁöÑËé∑ÂèñÂíåÈáäÊîæÊñπÊ≥ï„ÄÇ
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No2_BooleanLatchDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Sync</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueuedSynchronizer</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">boolean</span> <span class="token function">isSignalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

        <span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">tryAcquireShared</span><span class="token punctuation">(</span><span class="token keyword">int</span> ignore<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token function">isSignalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">tryReleaseShared</span><span class="token punctuation">(</span><span class="token keyword">int</span> ignore<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Sync</span> sync <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSignalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> sync<span class="token punctuation">.</span><span class="token function">isSignalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token punctuation">&#123;</span> sync<span class="token punctuation">.</span><span class="token function">releaseShared</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        sync<span class="token punctuation">.</span><span class="token function">acquireSharedInterruptibly</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÊúÄÂêéÔºå<code>AbstractQueuedSynchronizer</code>Â≠êÁ±ªÔºå‰∏ÄËà¨ÈÉΩÊòØÂú®ÂÜÖÈÉ®Á±ªÈáåÈù¢‰ΩøÁî®ÁöÑÔºå‰∏çÂêåÁöÑÂêåÊ≠•Êú∫Âà∂ÂíåÈòªÂ°ûÊú∫Âà∂ÔºåÈáäÊîæÈîÅÂíåÂä†ÈîÅÁöÑÈÄªËæëÂèØËÉΩÈÉΩ‰∏ç‰∏ÄÊ†∑Ôºå<code>AbstractQueuedSynchronizer</code> Âè™ÊòØÊèê‰æõ‰∫Ü‰∏ÄÁßçÂü∫‰∫é<code>FIFO</code> ÈòüÂàóÁöÑ„ÄÅÂèØ‰ª•Áî®‰∫éÊûÑÂª∫ÈîÅÊàñËÄÖÂÖ∂‰ªñÁõ∏ÂÖ≥ÂêåÊ≠•Ë£ÖÁΩÆÁöÑÂü∫Á°ÄÊ°ÜÊû∂ÔºåÊàë‰ª¨ÂèØ‰ª•ÁªìÂêà‰∏äÈù¢ÁöÑ<code>CountDownLatch</code>Âíå‰∏ã‰∏ÄËäÇÂ∞ÜË¶ÅËÆ≤Ëø∞ÁöÑ<code>Semaphore</code>ÂÜçÂÅö‰∏Ä‰∏ãÁêÜËß£„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractQueuedSynchronizer</span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractOwnableSynchronizer</span>
    <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="ÂêåÊ≠•ËÆ°Êï∞Âô®Semaphore"><a href="#ÂêåÊ≠•ËÆ°Êï∞Âô®Semaphore" class="headerlink" title="ÂêåÊ≠•ËÆ°Êï∞Âô®Semaphore"></a>ÂêåÊ≠•ËÆ°Êï∞Âô®Semaphore</h3><p>‚Äã        <code>Semaphore</code>ÊòØ‰∏Ä‰∏™ËÆ°Êï∞‰ø°Âè∑Èáè„ÄÇ‰ªéÊ¶ÇÂøµ‰∏äËÆ≤Ôºå‰ø°Âè∑ÈáèÁª¥Êä§‰∫Ü‰∏Ä‰∏™ËÆ∏ÂèØÈõÜÂêà„ÄÇÂ¶ÇÊúâÂøÖË¶ÅÔºåÂú®ËÆ∏ÂèØÂèØÁî®Ââç‰ºöÈòªÂ°ûÊØè‰∏Ä‰∏™ <code>acquire()</code>ÔºåÁÑ∂ÂêéÂÜçËé∑ÂèñËØ•ËÆ∏ÂèØ„ÄÇÊØè‰∏™ <code>release()</code>Ê∑ªÂä†‰∏Ä‰∏™ËÆ∏ÂèØÔºå‰ªéËÄåÂèØËÉΩÈáäÊîæ‰∏Ä‰∏™Ê≠£Âú®ÈòªÂ°ûÁöÑËé∑ÂèñËÄÖ„ÄÇÂ∞±ÂÉèÊéíÈòüËøõÂÖ•‰∏äÊµ∑ÂçöÁâ©È¶Ü‰∏ÄÊ†∑ÔºåÂÖàÊîæÂá†‰∏™‰∫∫ËøõÂéªÔºåÁ≠âËøôÂá†‰∏™‰∫∫Ëµ∞‰∫ÜÔºåÁÑ∂ÂêéÂÜçÊîæÂá†‰∏™‰∫∫ËøõÂÖ•,Â∞±ÂÉèÊòØ‰∏ÄÁßçÊéíÈòüÊú∫Âà∂„ÄÇ</p>
<p>‚Äã        <code>Semaphore</code> ‰∏ªË¶ÅÁöÑ„ÄÅÂ∏∏Áî®ÁöÑÊñπÊ≥ïÊúâÔºö</p>
<ol>
<li><code>Semaphore(int permits)</code>ÔºåÂàõÂª∫ÂÖ∑ÊúâÁªôÂÆöÁöÑËÆ∏ÂèØÊï∞ÂíåÁªôÂÆöÁöÑÈùûÂÖ¨Âπ≥ÁöÑÂÖ¨Âπ≥ËÆæÁΩÆÁöÑ<br>SemaphoreÊï∞Èáè„ÄÇ</li>
<li><code>Semaphore(int permits, boolean fair)</code>ÔºåÂàõÂª∫ÂÖ∑ÊúâÁªôÂÆöÁöÑËÆ∏ÂèØÊï∞ÂíåÁªôÂÆöÁöÑÂÖ¨Âπ≥ËÆæÁΩÆÁöÑSemaphoreÊï∞Èáè„ÄÇ<br>ÊâÄË∞ìÂÖ¨Âπ≥ÊÄßÂ∞±ÊòØÊòØÂê¶ÂÖàËøõÊù•ÁöÑÂÖàÈáäÊîæÔºåÈªòËÆ§ÊòØÂê¶ÁöÑ„ÄÇ</li>
<li><code>void acquire()</code>Ôºå‰ªéÊ≠§‰ø°Âè∑ÈáèËé∑Âèñ‰∏Ä‰∏™ËÆ∏ÂèØÔºåÂú®Êèê‰æõ‰∏Ä‰∏™ËÆ∏ÂèØÂâç‰∏Ä Áõ¥Â∞ÜÁ∫øÁ®ãÈò≥Â°ûÔºåÂê¶ÂàôÁ∫øÁ®ãË¢´‰∏≠Êñ≠„ÄÇ</li>
<li><code>int availablePermits()</code>ÔºåËøîÂõûÊ≠§‰ø°Âè∑Èáè‰∏≠ÂΩìÂâçÂèØÁî®ÁöÑËÆ∏ÂèØÊï∞„ÄÇ</li>
<li><code>int drainPermits()</code>ÔºåËé∑ÂèñÂπ∂ËøîÂõûÁ´ãÂç≥ÂèØÁî®ÁöÑÊâÄÊúâËÆ∏ÂèØ„ÄÇ</li>
<li><code>int getQueueLength()</code>Ôºå ËøîÂõûÊ≠£Âú®Á≠âÂæÖËé∑ÂèñÁöÑÁ∫øÁ®ãÁöÑ‰º∞ËÆ°Êï∞ÁõÆ„ÄÇ</li>
<li><code>boolean hasQueuedThreads()</code>Ôºå Êü•ËØ¢ÊòØÂê¶ÊúâÁ∫øÁ®ãÊ≠£Âú®Á≠âÂæÖËé∑Âèñ„ÄÇ</li>
<li><code>boolean isFair()</code>ÔºåÂ¶ÇÊûúÊ≠§‰ø°Âè∑ÈáèÁöÑÂÖ¨Âπ≥ËÆæÁΩÆ‰∏∫true, ÂàôËøîÂõûtrue„ÄÇ</li>
<li><code>void reducePermits(int reductions)</code>ÔºåÊ†πÊçÆÊåáÂÆöÁöÑÁº©ÂáèÈáèÂáèÂ∞èÂèØÁî®ËÆ∏ÂèØÁöÑÊï∞ÁõÆ„ÄÇ</li>
<li><code>void release()</code>ÔºåÈáäÊîæ‰∏Ä‰∏™ËÆ∏ÂèØÔºåÂ∞ÜÂÖ∂ËøîÂõûÁªô‰ø°Âè∑Èáè„ÄÇ</li>
<li><code>void release(int permits)</code>ÔºåÈáäÊîæÁªôÂÆöÊï∞ÁõÆÁöÑËÆ∏ÂèØÔºåÂ∞ÜÂÖ∂ËøîÂõûÂà∞‰ø°Âè∑Èáè„ÄÇ</li>
<li><code>boolean tryAcquire()</code>Ôºå‰ªÖÂú®Ë∞ÉÁî®Êó∂Ê≠§‰ø°Âè∑ÈáèÂ≠òÂú®‰∏Ä‰∏™ÂèØÁî®ËÆ∏ÂèØÔºåÊâç‰ªé‰ø°Âè∑ÈáèËé∑ÂèñËÆ∏ÂèØ„ÄÇ</li>
</ol>
<p>‚Äã        ‰ΩøÁî®Âú∫ÊôØÔºö<br>‚Äã        ÊéíÈòüÂú∫ÊôØÔºåËµÑÊ∫êÊúâÈôêÁöÑÊàøÈó¥ÔºåËµÑÊ∫êÊúâÈôêÁöÑÁæ§Á≠âÁ≠â„ÄÇÂ∏∏ËßÅÁöÑÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÂåÖÊã¨Á∫øÁ®ãÊ±†„ÄÅËøûÊé•Ê±†Á≠â„ÄÇ<br>‚Äã        ÂÆû‰æã:<br>‚Äã        ÂÅáËÆæ‰∏Ä‰∏™ÊúçÂä°Âô®ËµÑÊ∫êÊúâÈôêÔºåÂè™ÂÖÅËÆ∏ÂêåÊó∂3‰∏™‰∫∫ËøõË°åËÆøÈóÆÔºå‰∏ÄÂÖ±Êù•‰∫Ü10‰∏™‰∫∫ÁöÑÂú∫ÊôØ„ÄÇ</p>
<h4 id="No3-SemaphoreDemo-java"><a href="#No3-SemaphoreDemo-java" class="headerlink" title="No3_SemaphoreDemo.java"></a>No3_SemaphoreDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>semaphore</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No3_SemaphoreDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//‰∏ÄÊ¨°Âè™ËøêË°å3‰∏™‰∫∫ËøõË°åËÆøÈóÆ</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> no <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token class-name">Runnable</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Áî®Êà∑"</span> <span class="token operator">+</span> no <span class="token operator">+</span> <span class="token string">"ËøûÊé•‰∏ä‰∫Ü:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">300L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Ëé∑ÂèñÊé•‰∏ãÂéªÊâßË°åÁöÑËÆ∏ÂèØ</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Áî®Êà∑"</span> <span class="token operator">+</span> no <span class="token operator">+</span> <span class="token string">"ÂºÄÂßãËÆøÈóÆÂêéÂè∞Á®ãÂ∫è..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Ê®°‰ªøÁî®Êà∑ËÆøÈóÆÊúçÂä°ËøáÁ®ã</span>
                        semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ÈáäÊîæÂÖÅËÆ∏‰∏ã‰∏Ä‰∏™Á∫øÁ®ãËÆøÈóÆËøõÂÖ•ÂêéÂè∞</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Áî®Êà∑"</span> <span class="token operator">+</span> no <span class="token operator">+</span> <span class="token string">"ËÆøÈóÆÁªìÊùü„ÄÇ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Main thread end!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="ÂêåÊ≠•ËÆ°Êï∞Âô®CyclicBarrier"><a href="#ÂêåÊ≠•ËÆ°Êï∞Âô®CyclicBarrier" class="headerlink" title="ÂêåÊ≠•ËÆ°Êï∞Âô®CyclicBarrier"></a>ÂêåÊ≠•ËÆ°Êï∞Âô®CyclicBarrier</h3><p>‚Äã        <code>CyclicBarrier</code> ÊòØ‰∏Ä‰∏™ÂêåÊ≠•ËæÖÂä©Á±ªÔºåÁøªËØëËøáÊù•Âè´Âæ™ÁéØÊ†ÖÊ†è„ÄÅÂæ™ÁéØÂ±èÈöú„ÄÇÂÆÉÂÖÅËÆ∏‰∏ÄÁªÑÁ∫øÁ®ã‰∫íÁõ∏Á≠âÂæÖÔºåÁõ¥Âà∞Âà∞ËææÊüê‰∏™ÂÖ¨ÂÖ±Â±èÈöúÁÇπ<code>(common barrier point</code>)ÔºåÁÑ∂ÂêéÊâÄÊúâÁöÑËøôÁªÑÁ∫øÁ®ãÂÜçÂêåÊ≠•ÂæÄÂêéÈù¢ÊâßË°å„ÄÇÂú®Ê∂âÂèä‰∏ÄÁªÑÂõ∫ÂÆöÂ§ßÂ∞èÁöÑÁ∫øÁ®ãÁöÑÁ®ãÂ∫è‰∏≠ÔºåËøô‰∫õÁ∫øÁ®ãÂøÖÈ°ª‰∏çÊó∂Âú∞‰∫íÁõ∏Á≠âÂæÖÔºåÊ≠§Êó∂CyclicBarrier ÂæàÊúâÁî®„ÄÇ‰∏çË¶ÅÈîôËØØÁêÜËß£‰∫ÜÔºå‰∏çÊòØÁ∫øÁ®ãÂ±èÈöúÂèØ‰ª•ÈáçÂ§ç‰ΩøÁî®ÔºåËÄåÊòØÂ§ö‰∏™Á∫øÁ®ãÈÉΩÂÉèÂ§ö‰∏™Âæ™ÁéØ‰∏ÄÊ†∑ÔºåÈÉΩÂæ™ÁéØÂà∞Ëøô‰∏™ÁÇπ‰∫ÜÔºåÂÜç‰∏ÄËµ∑ÂºÄÂßãÂæÄÂêéÈù¢ÊâßË°å„ÄÇ<br>‚Äã        ‰∏ªË¶ÅÁöÑÊñπÊ≥ïÊúâ:</p>
<ol>
<li><code>CyclicBarrier(int parties)</code>ÔºåÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ <code>CyclicBarrier</code>ÔºåÂÆÉÂ∞ÜÂú®ÁªôÂÆöÊï∞ÈáèÁöÑÂèÇ‰∏éËÄÖ(Á∫øÁ®ã)Â§Ñ‰∫éÁ≠âÂæÖÁä∂ÊÄÅÊó∂ÂêØÂä®Ôºå‰ΩÜÂÆÉ‰∏ç‰ºöÂú®ÂêØÂä®<code>barrier</code> Êó∂ÊâßË°åÈ¢ÑÂÆö‰πâÁöÑÊìç‰Ωú„ÄÇ</li>
<li><code>CyclicBarrier(int parties, Runnable barrierAction)</code>ÔºåÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ<code>CyclicBarrier</code>ÔºåÂÆÉÂ∞ÜÂú®ÁªôÂÆöÊï∞ÈáèÁöÑÂèÇ‰∏éËÄÖ(Á∫øÁ®ã)Â§Ñ‰∫éÁ≠âÂæÖÁä∂ÊÄÅÊó∂ÂêØÂä®ÔºåÂπ∂Âú®ÂêØÂä®<code>barrier</code> Êó∂ÊâßË°åÁªôÂÆöÁöÑÂ±èÈöúÊìç‰ΩúÔºåËØ•Êìç‰ΩúÁî±ÊúÄÂêé‰∏Ä‰∏™ËøõÂÖ•<code>barrier</code> ÁöÑÁ∫øÁ®ãÊâßË°å„ÄÇ</li>
<li><code>int await()</code>ÔºåÂú®ÊâÄÊúâÂèÇ‰∏éËÄÖÈÉΩÂ∑≤ÁªèÂú®Ê≠§<code>barrier</code> ‰∏äË∞ÉÁî®<code>await</code> ÊñπÊ≥ï‰πãÂâçÔºåÂ∞Ü‰∏ÄÁõ¥Á≠âÂæÖ„ÄÇ</li>
<li><code>int await(long timeout, TimeUnit unit)</code>ÔºåÂú®ÊâÄÊúâÂèÇ‰∏éËÄÖÈÉΩÂ∑≤ÁªèÂú®Ê≠§Â±èÈöú‰∏äË∞ÉÁî®<code>await</code> ÊñπÊ≥ï‰πãÂâçÂ∞Ü‰∏ÄÁõ¥Á≠âÂæÖÔºå ÊàñËÄÖË∂ÖÂá∫‰∫ÜÊåáÂÆöÁöÑÁ≠âÂæÖÊó∂Èó¥„ÄÇ</li>
<li><code>int getNumberWaiting()</code>ÔºåËøîÂõûÂΩìÂâçÂú®Â±èÈöúÂ§ÑÁ≠âÂæÖÁöÑÂèÇ‰∏éËÄÖÊï∞ÁõÆ„ÄÇ</li>
<li><code>int getParties()</code>ÔºåËøîÂõûË¶ÅÊ±ÇÂêØÂä®Ê≠§<code>barrier</code>ÁöÑÂèÇ‰∏éËÄÖÊï∞ÁõÆ„ÄÇ</li>
<li><code>boolean isBroken()</code>ÔºåÊü•ËØ¢Ê≠§Â±èÈöúÊòØÂê¶Â§Ñ‰∫éÊçüÂùèÁä∂ÊÄÅ„ÄÇ</li>
<li><code>void reset()</code>ÔºåÂ∞ÜÂ±èÈöúÈáçÁΩÆ‰∏∫ÂÖ∂ÂàùÂßãÁä∂ÊÄÅ„ÄÇ</li>
</ol>
<p>‚Äã     ‰ΩøÁî®Âú∫ÊôØ:<br>‚Äã    Â§ßÊï∞ÊçÆËøêÁÆóÈúÄË¶ÅÊãÜÂàÜÊàêÂ§öÊ≠•È™§ÁöÑÊó∂ÂÄô„ÄÇÊØîÂ¶ÇËøô‰πà‰∏Ä‰∏™ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØÔºöÊàë‰ª¨ÈúÄË¶ÅÁªüËÆ°ÂÖ®ÂõΩÁöÑ‰∏öÂä°Êï∞ÊçÆÔºåÂÖ∂‰∏≠ÂêÑÁúÅÁöÑÊï∞ÊçÆÂ∫ìÊòØÁã¨Á´ãÁöÑÔºå‰πüÂ∞±ÊòØËØ¥ÊåâÁúÅÂàÜÂ∫ìÔºåÂπ∂‰∏îÁªüËÆ°ÁöÑÊï∞ÊçÆÈáèÂæàÂ§ßÔºåÁªüËÆ°ËøáÁ®ã‰πüÊØîËæÉÊÖ¢„ÄÇ‰∏∫‰∫ÜÊèêÈ´òÊÄßËÉΩÔºåÂø´ÈÄüËÆ°ÁÆóÔºåÊàë‰ª¨ÈááÂèñÂπ∂ÂèëÁöÑÊñπÂºèÔºåÂ§ö‰∏™Á∫øÁ®ãÂêåÊó∂ËÆ°ÁÆóÂêÑÁúÅÊï∞ÊçÆÔºåÊØè‰∏™ÁúÅ‰∏ãÈù¢ÂèàÁî®Â§öÁ∫øÁ®ãÔºåÊúÄÂêéÂÜçÊ±áÊÄªÁªüËÆ°„ÄÇ</p>
<p>‚Äã    ÂÆû‰æãÔºö</p>
<h4 id="No4-CyclicBarrierDemo-java"><a href="#No4-CyclicBarrierDemo-java" class="headerlink" title="No4_CyclicBarrierDemo.java"></a>No4_CyclicBarrierDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>semaphore</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No4_CyclicBarrierDemo</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">CyclicBarrier</span> barrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">TotalTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BillTask</span> worker1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BillTask</span><span class="token punctuation">(</span><span class="token string">"111"</span><span class="token punctuation">,</span>barrier<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BillTask</span> worker2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BillTask</span><span class="token punctuation">(</span><span class="token string">"222"</span><span class="token punctuation">,</span>barrier<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BillTask</span> worker3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BillTask</span><span class="token punctuation">(</span><span class="token string">"333"</span><span class="token punctuation">,</span>barrier<span class="token punctuation">)</span><span class="token punctuation">;</span>
        worker1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        worker2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        worker3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Main thread end!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">TotalTask</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÊâÄÊúâÂ≠ê‰ªªÂä°ÈÉΩÊâßË°åÂÆå‰∫ÜÔºåÂ∞±ÂºÄÂßãÊâßË°å‰∏ª‰ªªÂä°‰∫Ü„ÄÇ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">BillTask</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> billName<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">CyclicBarrier</span> barrier<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">BillTask</span><span class="token punctuation">(</span><span class="token class-name">String</span> workerName<span class="token punctuation">,</span><span class="token class-name">CyclicBarrier</span> barrier<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>billName <span class="token operator">=</span> workerName<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>barrier <span class="token operator">=</span> barrier<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Â∏ÇÂå∫:"</span><span class="token operator">+</span>billName <span class="token operator">+</span><span class="token string">"ËøêÁÆóÂºÄÂßãÔºö"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Ê®°‰ªøÁ¨¨‰∏ÄÊ¨°ËøêÁÆóÔºõ</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Â∏ÇÂå∫:"</span><span class="token operator">+</span>billName <span class="token operator">+</span><span class="token string">"ËøêÁÆóÂÆåÊàêÔºåÁ≠âÂæÖ‰∏≠..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                barrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ÂÅáËÆæ‰∏ÄÊ¨°ËøêÁÆó‰∏çÂÆåÔºåÁ¨¨‰∫åÊ¨°Ë¶Å‰æùËµñÁ¨¨‰∏ÄÊ¨°ÁöÑËøêÁÆóÁªìÊûú„ÄÇÈÉΩÂà∞ËææËøô‰∏™ËäÇÁÇπ‰πãÂêéÂêéÈù¢Êâç‰ºöÁªßÁª≠ÊâßË°åÔºõ</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÂÖ®ÈÉ®ÈÉΩÁªìÊùüÔºåÂ∏ÇÂå∫"</span><span class="token operator">+</span>billName <span class="token operator">+</span><span class="token string">"ÊâçÂºÄÂßãÂêéÈù¢ÁöÑÂ∑•‰Ωú„ÄÇ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>‚Äã        ‰ªéËøêË°åÁªìÊûú‰∏äÈù¢‰ªîÁªÜ‰Ωì‰ºö‰∏éCountDownLatchÁöÑÂå∫Âà´„ÄÇ</p>
<p>‚Äã        ‚óèCountDownLatchÔºö‰∏Ä‰∏™Á∫øÁ®ã(ÊàñËÄÖÂ§ö‰∏™)ÔºåÁ≠âÂæÖÂè¶Â§ñN ‰∏™Á∫øÁ®ãÂÆåÊàêÊüê‰∏™‰∫ãÊÉÖ‰πãÂêéÊâçËÉΩÊâßË°å„ÄÇ</p>
<p>‚Äã		‚óèCyclicBarrierÔºöN‰∏™Á∫øÁ®ãÁõ∏‰∫íÁ≠âÂæÖÔºå‰ªª‰Ωï‰∏Ä‰∏™Á∫øÁ®ãÂÆåÊàê‰πãÂâçÔºåÊâÄÊúâÁöÑÁ∫øÁ®ãÈÉΩÂøÖÈ°ªÁ≠âÂæÖ„ÄÇ<br>‚Äã        ËøôÊ†∑ÊØîÂØπ‰∏Ä‰∏ãÂ∫îËØ•Â∞±Ê∏ÖÊ•ö‰∫ÜÔºå ÂØπ‰∫éCountDownlachÊù•ËØ¥ÔºåÈáçÁÇπÊòØÈÇ£‰∏™‚Äú‰∏Ä‰∏™Á∫øÁ®ã‚ÄùÔºåÊòØÂÆÉÂú®Á≠âÂæÖËÄåÂè¶Â§ñÈÇ£NÁöÑÁ∫øÁ®ãÂú®Êää‚ÄúÊüê‰∏™‰∫ãÊÉÖ‚ÄùÂÅöÂÆå‰πãÂêéÂèØ‰ª•ÁªßÁª≠Á≠âÂæÖÔºåÂèØ‰ª•ÁªàÊ≠¢ÔºõËÄåÂØπ‰∫é<code>CyclicBarrier</code>Êù•ËØ¥ÔºåÈáçÁÇπÊòØÈÇ£N‰∏™Á∫øÁ®ãÔºåÂÆÉ‰ª¨‰πãÈó¥‰ªª‰Ωï‰∏Ä‰∏™Ê≤°ÊúâÂÆåÊàêÔºåÊâÄÊúâÁöÑÁ∫øÁ®ãÈÉΩÂøÖÈ°ªÁ≠âÂæÖ„ÄÇ</p>
<p>‚Äã        <code>CyclicBarrier</code>ÁöÑÂÆûÁé∞ÂéüÁêÜÊòØÔºåÂà©Áî®<code>ReentrantIock</code>ÂÅöÁ∫øÁ®ãÂÆâÂÖ®ÈîÅÔºåÂÆûÁé∞Á∫øÁ®ãÂÆâÂÖ®Á≠âÂæÖ„ÄÇ<br>Êù•Áúã‰∏Ä‰∏ã<strong>CyclicBarrier</strong>ÁöÑÊ∫êÁ†Å‰Ωì‰ºö‰∏ã„ÄÇ</p>
<p>‚Äã        ÊÄª‰πãÔºåËøô‰∏ÄÁ´†ÈáçÁÇπËÆ≤Ëß£‰∫ÜÁ∫øÁ®ãÁöÑÈòüÂàóÊú∫Âà∂ÂíåÁ∫øÁ®ã‰∫§‰∫íÁ≠âÂæÖÊú∫Âà∂Ôºå‰∏æ‰æãËØ¥Êòé‰∫ÜÊàë‰ª¨Âπ≥Êó∂Â∑•‰Ωú‰∏≠Â∏∏Áî®ÁöÑ‰∏Ä‰∫õÁ±ª„ÄÇ ‰ΩúËÄÖËÆ≤Ëß£ÁöÑÂÜÖÂÆπËµ∑Âà∞ÊäõÁ†ñÂºïÁéâÁöÑ‰ΩúÁî®ÔºåÁªôËØªËÄÖ‰∏ÄÁßçÂàÜÊûêÈóÆÈ¢òÁöÑÊÄùË∑ØÂíåÊñπÊ≥ïÔºå Â∏åÊúõÊàë‰ª¨Â∑•‰Ωú‰∏≠Ê≥®ÊÑèËßÇÂØüÂíåÂàÜÊûêÔºåÂèØ‰ª•‰Ωì‰ºöÂà∞Â§öÁ∫øÁ®ãÁºñÁ®ã‰∏≠ÁöÑËßÑÂæãÔºå‰∏áÂèò‰∏çÁ¶ªÂÖ∂ÂÆóÔºåÊéåÊè°Â•ΩÂü∫Á°ÄÔºåÈÅìÁêÜÈÉΩÊòØÁõ∏ÈÄöÁöÑ„ÄÇ</p>
<h2 id="Á∫øÁ®ãÊ±†"><a href="#Á∫øÁ®ãÊ±†" class="headerlink" title="Á∫øÁ®ãÊ±†"></a>Á∫øÁ®ãÊ±†</h2><blockquote>
<p> <strong>È™êÈ™•‰∏ÄË∑ÉÔºå‰∏çËÉΩÂçÅÊ≠•ÔºõÈ©ΩÈ©¨ÂçÅÈ©æÔºåÂäüÂú®‰∏çËàç„ÄÇ</strong></p>
</blockquote>
<p><img src="/image/Concurrent/Concurrent18.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent18.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        Á∫øÁ®ãÊ±†ÔºåÁâπÂà´ÊòØÈ´òÂπ∂ÂèëÈ°πÁõÆÔºå‰∫íËÅîÁΩëÈ°πÁõÆÂøÖÈ°ª‰ºöÁî®ÁöÑ„ÄÇ</p>
<h3 id="‰ªÄ‰πàÊòØÁ∫øÁ®ãÊ±†"><a href="#‰ªÄ‰πàÊòØÁ∫øÁ®ãÊ±†" class="headerlink" title="‰ªÄ‰πàÊòØÁ∫øÁ®ãÊ±†"></a>‰ªÄ‰πàÊòØÁ∫øÁ®ãÊ±†</h3><p>‚Äã        Âú®Èù¢ÂêëÂØπË±°ÁºñÁ®ã‰∏≠ÔºåÂàõÂª∫ÂíåÈîÄÊØÅÂØπË±°ÊòØÂæàË¥πÊó∂Èó¥ÁöÑÔºåÂõ†‰∏∫ÂàõÂª∫‰∏Ä‰∏™ÂØπË±°Ë¶ÅËé∑ÂèñÂÜÖÂ≠òËµÑÊ∫êÊàñËÄÖÂÖ∂‰ªñÊõ¥Â§öËµÑÊ∫ê„ÄÇÂú®Java‰∏≠Êõ¥ÊòØÂ¶ÇÊ≠§ÔºåËôöÊãüÊú∫Â∞ÜËØïÂõæË∑üË∏™ÊØè‰∏Ä‰∏™ÂØπË±°Ôºå‰ª•‰æøËÉΩÂ§üÂú®ÂØπË±°ÈîÄÊØÅÂêéËøõË°åÂûÉÂúæÂõûÊî∂„ÄÇÊâÄ‰ª•<strong>ÊèêÈ´òÊúçÂä°Á®ãÂ∫èÊïàÁéáÁöÑ‰∏Ä‰∏™ÊâãÊÆµÂ∞±ÊòØÂ∞ΩÂèØËÉΩÂáèÂ∞ëÂàõÂª∫ÂíåÈîÄÊØÅÂØπË±°ÁöÑÊ¨°Êï∞ÔºåÁâπÂà´ÊòØ-‰∫õÂæàËÄóË¥πËµÑÊ∫êÁöÑÂØπË±°ÂàõÂª∫ÂíåÈîÄÊØÅ</strong>„ÄÇÂ¶Ç‰ΩïÂà©Áî®Â∑≤ÊúâÂØπË±°Êù•ÊúçÂä°Â∞±ÊòØ‰∏Ä‰∏™ÈúÄË¶ÅËß£ÂÜ≥ÁöÑÂÖ≥ÈîÆÈóÆÈ¢òÔºåÂÖ∂ÂÆûËøôÂ∞±ÊòØ‰∏Ä‰∫õ‚ÄúÊ±†ÂåñËµÑÊ∫ê‚ÄùÊäÄÊúØ‰∫ßÁîüÁöÑÂéüÂõ†„ÄÇÊØîÂ¶ÇÂ§ßÂÆ∂ÊâÄÁÜüÊÇâÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†ÔºåÊ≠£ÊòØÈÅµÂæ™Ëøô‰∏ÄÊÄùÊÉ≥ËÄå‰∫ßÁîüÁöÑ„ÄÇ<br>‚Äã        <strong>JavaÁ∫øÁ®ãÊ±†ÂÆûÁé∞‰∫Ü‰∏Ä‰∏™JavaÈ´òÂπ∂ÂèëÁöÑ„ÄÅJavaÂ§öÁ∫øÁ®ãÁöÑ„ÄÅÂèØÁÆ°ÁêÜÁöÑÁªü‰∏ÄË∞ÉÂ∫¶Âô®</strong>„ÄÇÂéüÁêÜÂíåÂ∑•‰ΩúÊú∫Âà∂ÂÖà‰∏çËØ¥‰∫ÜÔºåÊàë‰ª¨ÂØπÂÆÉÊúâ‰∏™Â§ß‰ΩìÁöÑËÆ§ËØÜÔºåÁ®çÂêéÂÜçÊÖ¢ÊÖ¢Â≠¶‰π†„ÄÇÂÖàÊù•ËÆ§ËØÜ‰∏Ä‰∏ã<code>java.util.concurrent.Executors</code>Â∑•‰Ωú‰∏≠ÊúÄÂ∏∏Áî®ÁöÑÂíåÁÜüÁü•ÁöÑ„ÄÇ<br>‚Äã        <code>Executors</code>ÊòØ‰∏™Á∫øÁ®ãÁöÑÂ∑•ÂéÇÁ±ªÔºåÊñπ‰æøÂø´ÈÄüÂú∞ÂàõÂª∫ÂæàÂ§öÁ∫øÁ®ãÊ±†Ôºå‰πüÂèØ‰ª•ËØ¥ÊòØ‰∏Ä‰∏™Á∫øÁ®ãÊ±†ÁöÑÂ∑•ÂÖ∑Á±ª„ÄÇÈÖçÁΩÆ‰∏Ä‰∏™Á∫øÁ®ãÊ±†ÊòØÊØîËæÉÂ§çÊùÇÁöÑÔºåÂ∞§ÂÖ∂ÊòØÂØπ‰∫éÁ∫øÁ®ãÊ±†ÁöÑÂéüÁêÜ‰∏çÊòØÂæàÊ∏ÖÊ•öÁöÑÊÉÖÂÜµ‰∏ãÔºåÂæàÊúâÂèØËÉΩÈÖçÁΩÆÁöÑÁ∫øÁ®ãÊ±†‰∏çÊòØÊúÄ‰ºòÁöÑ„ÄÇÂõ†Ê≠§ÔºåÂú®<code>Executors</code>Á±ªÈáåÈù¢Êèê‰æõ‰∫Ü‰∏Ä‰∫õÈùôÊÄÅÂ∑•ÂéÇÔºåÁîüÊàê‰∏Ä‰∫õÂ∏∏Áî®ÁöÑÁ∫øÁ®ãÊ±†„ÄÇ</p>
<p>‚Äã        Â∏∏Áî®ÁöÑÊñπÊ≥ïÊúâ‰ª•‰∏ã‰∏âÁßçÔºö</p>
<ul>
<li><strong><code>newSingleThreadExecutor</code><strong>Ôºö</strong>ÂàõÂª∫‰∏Ä‰∏™ÂçïÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÊ±†</strong>„ÄÇ</li>
<li><strong><code>newFixedThreadPool</code><strong>Ôºö</strong>ÂàõÂª∫Âõ∫ÂÆöÂ§ßÂ∞èÁöÑÁ∫øÁ®ãÊ±†</strong>„ÄÇ</li>
<li><strong><code>newCachedThreadPool</code><strong>Ôºö</strong>ÂàõÂª∫‰∏Ä‰∏™ÂèØÁºìÂ≠òÁöÑÁ∫øÁ®ãÊ±†</strong>„ÄÇ</li>
</ul>
<p>‚Äã        Êé•‰∏ãÊù•Êàë‰ª¨Êù•‰∏Ä‰∏ÄËß£Êûê„ÄÇ</p>
<h3 id="newSingleThreadExecutorÁöÑ‰ΩøÁî®"><a href="#newSingleThreadExecutorÁöÑ‰ΩøÁî®" class="headerlink" title="newSingleThreadExecutorÁöÑ‰ΩøÁî®"></a>newSingleThreadExecutorÁöÑ‰ΩøÁî®</h3><p>‚Äã        ÂàõÂª∫‰∏Ä‰∏™ÂçïÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÊ±†„ÄÇËøô‰∏™Á∫øÁ®ãÊ±†Âè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãÂú®Â∑•‰ΩúÔºå‰πüÂ∞±ÊòØÁõ∏ÂΩì‰∫éÂçïÁ∫øÁ®ã‰∏≤Ë°åÊâßË°åÊâÄÊúâ‰ªªÂä°„ÄÇÂ¶ÇÊûúËøô‰∏™ÂîØ‰∏ÄÁöÑÁ∫øÁ®ãÂõ†‰∏∫ÂºÇÂ∏∏ÁªìÊùüÔºåÈÇ£‰πà‰ºöÊúâ‰∏Ä‰∏™Êñ∞ÁöÑÁ∫øÁ®ãÊù•Êõø‰ª£ÂÆÉ„ÄÇÊ≠§Á∫øÁ®ãÊ±†‰øùËØÅÊâÄÊúâ‰ªªÂä°ÁöÑÊâßË°åÈ°∫Â∫èÊåâÁÖß‰ªªÂä°ÁöÑÊèê‰∫§È°∫Â∫èÊâßË°å„ÄÇ<br>‚Äã        ÂÖàÊù•Áúã‰∏Ä‰∏™‰æãÂ≠ê:</p>
<h4 id="No1-NewSingleThreadExecutorDemo-java"><a href="#No1-NewSingleThreadExecutorDemo-java" class="headerlink" title="No1_NewSingleThreadExecutorDemo.java"></a>No1_NewSingleThreadExecutorDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadpool</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No1_NewSingleThreadExecutorDemo</span> <span class="token punctuation">&#123;</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Êñπ‰æøÁõëÊéßÂ∑•ÂÖ∑ËÉΩÊçïËé∑Âà∞</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> no <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token class-name">Runnable</span> runnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"into"</span> <span class="token operator">+</span> no<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"end"</span> <span class="token operator">+</span> no<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>runnable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Thread Main End!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Thread</span> <span class="token class-name">Main</span> <span class="token class-name">End</span><span class="token operator">!</span>
into0
end0
into1
end1
into2
end2
into3
end3
into4
end4
into5
end5
into6
end6
into7
end7
into8
end8
into9
end9<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‰ªéÁªìÊûú‰∏äÈù¢ÁúãÊòØ‰∏ÄÊù°‰∏ÄÊù°Âú∞Âú®ÊâßË°å„ÄÇ‰ªéÁõëÊéßÂ∑•ÂÖ∑‰∏äÈù¢Áúã:</p>
<p>(1) <strong>main</strong>Á∫øÁ®ãÊó©Â∞±ÁªìÊùü‰∫ÜÔºåËÄåÁ∫øÁ®ãÊ±†ÈáåÈù¢Ê∞∏ËøúÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ã„ÄÇ‰πüÂèØ‰ª•ÁúãÂá∫Êù•<strong>10</strong>‰∏™Á∫øÁ®ãÊâßË°åÊó∂Èó¥‰πüÊúÄÈïø,Â¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent19.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent19.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>(2ÔºâÁ∫øÁ®ãÊï∞ÈáèÊ∞∏Ëøú‰∏çÂèò,Â¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent20.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent20.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>(3Ôºâ‰ΩøÁî®ÁöÑ <strong>dump</strong>ÂÜÖÂ≠òÂü∫Êú¨‰∏äÂ§Ñ‰∫éÁ®≥ÂÆöÈò∂ÊÆµ,Â¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent21.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent21.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Áúã‰∏Ä‰∏ã**<code>Executors.newSingleThreadExecutor()</code>**ÁöÑÂÆûÁé∞ÊñπÊ≥ï:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ÂàõÂª∫‰∏Ä‰∏™ExecutorÔºåËØ•Executor‰ΩøÁî®‰∏Ä‰∏™Â∑•‰ΩúÁ∫øÁ®ãÊìç‰Ωú‰∏Ä‰∏™Êó†ÁïåÈòüÂàó„ÄÇ</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FinalizableDelegatedExecutorService</span>
            <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                                    <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
                                    <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‰∏äÈù¢‰ª£Á†ÅÊ†πÊçÆ<code>ThreadPoolExecutor</code>ÂàõÂª∫‰∏Ä‰∏™ <code>LinkedBlockingQueue</code>ÁöÑ‰∏Ä‰∏™Â§ßÂ∞èÁöÑÁ∫øÁ®ãÊ±†ÔºåÈááÁî®ÈªòËÆ§ÁöÑÂºÇÂ∏∏Á≠ñÁï•„ÄÇ</p>
<h3 id="newCachedThreadPoolÁöÑ‰ΩøÁî®"><a href="#newCachedThreadPoolÁöÑ‰ΩøÁî®" class="headerlink" title="newCachedThreadPoolÁöÑ‰ΩøÁî®"></a>newCachedThreadPoolÁöÑ‰ΩøÁî®</h3><p>‚Äã        ÂàõÂª∫‰∏Ä‰∏™ÁºìÂ≠òÊ±†Â§ßÂ∞èÂèØÊ†πÊçÆÈúÄË¶Å‰º∏Áº©ÁöÑÁ∫øÁ®ãÊ±†Ôºå‰ΩÜÊòØÂú®‰ª•ÂâçÊûÑÈÄ†ÁöÑÁ∫øÁ®ãÂèØÁî®Êó∂Â∞ÜÈáçÁî®ÂÆÉ‰ª¨„ÄÇÂØπ‰∫éÊâßË°åÂæàÂ§öÁü≠ÊúüÂºÇÊ≠•‰ªªÂä°ÁöÑÁ®ãÂ∫èËÄåË®ÄÔºåËøô‰∫õÁ∫øÁ®ãÊ±†ÈÄöÂ∏∏ÂèØÊèêÈ´òÁ®ãÂ∫èÊÄßËÉΩ„ÄÇË∞ÉÁî®**<code>execute</code>** Â∞ÜÈáçÁî®‰ª•ÂâçÊûÑÈÄ†ÁöÑÁ∫øÁ®ã(Â¶ÇÊûúÁ∫øÁ®ãÂèØÁî®)„ÄÇÂ¶ÇÊûúÁé∞ÊúâÁ∫øÁ®ãÊ≤°ÊúâÂèØÁî®ÁöÑÔºåÂàôÂàõÂª∫‰∏Ä‰∏Ä‰∏™Êñ∞Á∫øÁ®ãÂπ∂Ê∑ªÂä†Âà∞Ê±†‰∏≠„ÄÇÁªàÊ≠¢Âπ∂‰ªéÁºìÂ≠ò‰∏≠ÁßªÈô§ÈÇ£‰∫õÂ∑≤Êúâ60sÊú™Ë¢´‰ΩøÁî®ÁöÑÁ∫øÁ®ã„ÄÇÂõ†Ê≠§ÔºåÈïøÊó∂Èó¥‰øùÊåÅÁ©∫Èó≤ÁöÑÁ∫øÁ®ãÊ±†‰∏ç‰ºö‰ΩøÁî®‰ªª‰ΩïËµÑÊ∫ê„ÄÇ<br>‚Äã        ÂÖàÊù•Áúã‰∏Ä‰∏™‰æãÂ≠ê:</p>
<h4 id="No2-NewCachedThreadPoolDemo-java"><a href="#No2-NewCachedThreadPoolDemo-java" class="headerlink" title="No2_NewCachedThreadPoolDemo.java"></a>No2_NewCachedThreadPoolDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadpool</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No2_NewCachedThreadPoolDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Êñπ‰æøÁõëÊéßÂ∑•ÂÖ∑ËÉΩÊçïËé∑Âà∞</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> no <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token class-name">Runnable</span> runnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"into"</span> <span class="token operator">+</span> no<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"end"</span> <span class="token operator">+</span> no<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>runnable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Thread Main End!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ËæìÂá∫Ôºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">into0
into2
into3
into4
into1
<span class="token class-name">Thread</span> <span class="token class-name">Main</span> <span class="token class-name">End</span><span class="token operator">!</span>
into5
into6
into7
into8
into9
into10
into11
into12
into13
into14
into15
into16
into17
into18
into19
end16
end13
end12
end11
end19
end17
end1
end18
end2
end4
end3
end0
end7
end15
end8
end9
end10
end5
end6
end14<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰ªéÁªìÊûú‰∏äÈù¢ÁúãÔºå‰∏Ä‰∏ãÂ≠êÊâÄÊúâÁöÑÁ∫øÁ®ãÈÉΩÂºÄÂßãÊâßË°åÔºåÈÉΩÂú®‰∫íÁõ∏ÁöÑ‰∫âÊä¢ CPUËµÑÊ∫ê„ÄÇ<br>‚Äã        ‰ªéÁõëÊéßÂ∑•ÂÖ∑ÁßçÂèØ‰ª•ÁúãÂá∫Êù•:<br>‚Äã        (1) <strong><code>main</code><strong>Á∫øÁ®ã‰∏ÄËÆ©Âá∫ËµÑÊ∫êÔºå Á∫øÁ®ãÊ±†ÈáåÈù¢Êúâ</strong>20</strong>‰∏™Á∫øÁ®ãÂêåÊó∂ÊâßË°å„ÄÇËøôÊó∂ÂÄôÊâßË°åÊó∂Èó¥‰πüÊúÄÁü≠ÔºåÂ¶ÇÊûúCPUÂÖÅËÆ∏ÊâßË°åÔºå‰πüÊòØÊúÄÂø´ÁöÑÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent22.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent22.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        (2)Á∫øÁ®ãÊï∞ÈáèÊÄ•Ââß‰∏äÂçá„ÄÇÁ∫øÁ®ãÊ±†Á∫øÁ®ãÊï∞ÈáèÊ≤°Êúâ‰∏ãÈôçÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent23.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent23.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        (3)‰ΩøÁî®ÁöÑ**<code>dump</code>**ÂÜÖÂ≠òÂü∫Êú¨‰∏äÂ§Ñ‰∫éÊÄ•Ââß‰∏äÂçáÈò∂ÊÆµÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent24.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent24.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        Áúã‰∏Ä‰∏ã**<code>Executors.newCachedThreadPool()</code>**ÁöÑÂÆûÁé∞:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ãÊ±†ÔºåËØ•Á∫øÁ®ãÊ±†Ê†πÊçÆÈúÄË¶ÅÂàõÂª∫Êñ∞Á∫øÁ®ãÔºå‰ΩÜÂ∞ÜÂú®‰ª•ÂâçÊûÑÈÄ†ÁöÑÁ∫øÁ®ãÂèØÁî®Êó∂ÈáçÁî®ÂÆÉ‰ª¨„ÄÇ   </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span>
                                      <span class="token number">60L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
                                      <span class="token keyword">new</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰ª£Á†ÅÂàõÂª∫‰∫Ü‰∏Ä‰∏™ÂÜÖÊ†∏Á∫øÁ®ãÊ±†„ÄÇÁ∫øÁ®ã‰∏∫Èõ∂ÔºåÊù•‰∏Ä‰∏™Á∫øÁ®ãÂ∞±Âú®Á∫øÁ®ãÊ±†ÈáåÈù¢ÂàõÂª∫‰∏Ä‰∏™ÁöÑ<br><strong><code>SynchronousQueue</code></strong>.</p>
<p><strong>Áº∫ÁÇπÔºö‰∏ÄËà¨‰∏çÁî®ÔºåÊòØÂõ†‰∏∫newCachedThreadPool ÂèØ‰ª•Êó†ÈôêÁöÑÊñ∞Âª∫Á∫øÁ®ãÔºåÂÆπÊòìÈÄ†ÊàêÂ†ÜÂ§ñÂÜÖÂ≠òÊ∫¢Âá∫ÔºåÂõ†‰∏∫ÂÆÉÁöÑÊúÄÂ§ßÂÄºÊòØÂú®ÂàùÂßãÂåñÁöÑÊó∂ÂÄôËÆæÁΩÆ‰∏∫ Integer.MAX_VALUEÔºå‰∏ÄËà¨Êù•ËØ¥Êú∫Âô®ÈÉΩÊ≤°ÈÇ£‰πàÂ§ßÂÜÖÂ≠òÁªôÂÆÉ‰∏çÊñ≠‰ΩøÁî®„ÄÇÂΩìÁÑ∂Áü•ÈÅìÂèØËÉΩÂá∫ÈóÆÈ¢òÁöÑÁÇπÔºåÂ∞±ÂèØ‰ª•ÂéªÈáçÂÜô‰∏Ä‰∏™ÊñπÊ≥ïÈôêÂà∂‰∏Ä‰∏ãËøô‰∏™ÊúÄÂ§ßÂÄº</strong>„ÄÇ</p>
<h3 id="newFixedThreadPoolÁöÑ‰ΩøÁî®"><a href="#newFixedThreadPoolÁöÑ‰ΩøÁî®" class="headerlink" title="newFixedThreadPoolÁöÑ‰ΩøÁî®"></a>newFixedThreadPoolÁöÑ‰ΩøÁî®</h3><p>‚Äã        ÂàõÂª∫‰∏Ä‰∏™ÂèØÈáçÁî®Âõ∫ÂÆöÁ∫øÁ®ãÊï∞ÁöÑÁ∫øÁ®ãÊ±†Ôºå‰ª•ÂÖ±‰∫´ÁöÑÊó†ÁïåÈòüÂàóÊñπÂºèÊù•ËøêË°åËøô‰∫õÁ∫øÁ®ã„ÄÇÂú®‰ªªÊÑèÁÇπÔºåÂú®Â§ßÂ§öÊï∞ <strong>nThreads</strong> Á∫øÁ®ã‰ºöÂ§Ñ‰∫éÂ§ÑÁêÜ‰ªªÂä°ÁöÑÊ¥ªÂä®Áä∂ÊÄÅ„ÄÇÂ¶ÇÊûúÂú®ÊâÄÊúâÁ∫øÁ®ãÂ§Ñ‰∫éÊ¥ªÂä®Áä∂ÊÄÅÊó∂Êèê‰∫§ÈôÑÂä†‰ªªÂä°ÔºåÂàôÂú®ÊúâÂèØÁî®Á∫øÁ®ã‰πãÂâçÔºåÈôÑÂä†‰ªªÂä°Â∞ÜÂú®ÈòüÂàó‰∏≠Á≠âÂæÖ„ÄÇÂ¶ÇÊûúÂú®ÂÖ≥Èó≠ÂâçÁöÑÊâßË°åÊúüÈó¥Áî±‰∫éÂ§±Ë¥•ËÄåÂØºËá¥‰ªª‰ΩïÁ∫øÁ®ãÁªàÊ≠¢ÔºåÈÇ£‰πà‰∏Ä‰∏™Êñ∞Á∫øÁ®ãÂ∞Ü‰ª£ÊõøÂÆÉÊâßË°åÂêéÁª≠ÁöÑ‰ªªÂä°(Â¶ÇÊûúÈúÄË¶Å)„ÄÇÂú®Êüê‰∏™Á∫øÁ®ãË¢´ÊòæÂºèÂú∞ÂÖ≥Èó≠‰πãÂâçÔºåÊ±†‰∏≠ÁöÑÁ∫øÁ®ãÂ∞Ü‰∏ÄÁõ¥Â≠òÂú®„ÄÇ<br>‚Äã        ÂÖàÊù•Áúã‰∏Ä‰∏™‰æãÂ≠êÔºö</p>
<h4 id="No3-NewFixedThreadPoolDemo-java"><a href="#No3-NewFixedThreadPoolDemo-java" class="headerlink" title="No3_NewFixedThreadPoolDemo.java"></a>No3_NewFixedThreadPoolDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadpool</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No3_NewFixedThreadPoolDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Êñπ‰æøÁõëÊéßÂ∑•ÂÖ∑ËÉΩÊçïËé∑Âà∞</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> no <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token class-name">Runnable</span> runnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"into"</span> <span class="token operator">+</span> no<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"end"</span> <span class="token operator">+</span> no<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>runnable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Thread Main End!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>


<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËæìÂá∫Ôºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">into2
end3
end1
end2
end0
into7
end4
into8
into9
into5
into6
end5
end7
into10
end8
end9
end6
into12
into14
into11
into13
end11
end13
end14
into16
end10
into17
into18
end12
into19
into15
end15
end18
end17
end19
end16<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰ªéÁªìÊûú‰∏äÈù¢ÁúãÔºå‰∏Ä‰∏ãÂ≠êÂè™Êúâ5‰∏™Á∫øÁ®ãÂºÄÂßãÊâßË°åÔºåÁÑ∂ÂêéÁªìÊùü-‰∏™ÂÜçÊâßË°å‰∏Ä‰∏™„ÄÇ<br>Áúã‰∏Ä‰∏ãÁõëÊéßÂ∑•ÂÖ∑Â¶Ç‰∏ã:<br>‚Äã        (1) mainÁ∫øÁ®ãËÆ©Âá∫ËµÑÊ∫êÔºåÁ∫øÁ®ãÊ±†ÈáåÈù¢Ê∞∏ËøúÊúâ5‰∏™Á∫øÁ®ãÂêåÊó∂ÊâßË°åÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇËøôÊó∂ÂÄôÊâß<br>Ë°åÊó∂Èó¥‰∏∫‰∏≠Á≠â„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent25.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent25.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        (2)Á∫øÁ®ãÊï∞Èáè‰∏äÂçáÂà∞‰∏ÄÂÆöÊï∞Èáè‰πãÂêéÂ∞±‰∏çÂèò‰∫ÜÔºåÁÑ∂ÂêéÊâßË°åÂÆå‰πãÂêéÈÄêÊ∏êÈáäÊîæÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent26.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent26.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        (3)‰ΩøÁî®ÁöÑ**<code>dump</code>**ÂÜÖÂ≠ò‰∏äÂçáÂà∞Á∫øÁ®ãÊ±†ÁöÑÊåáÂÆöÂ§ßÂ∞èÔºåÂü∫Êú¨‰∏äÂ§Ñ‰∫éÁ®≥ÂÆöÈò∂ÊÆµÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent27.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent27.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        Áúã‰∏Ä‰∏ãExecutors.newFixedThreadPool()ÁöÑÂÆûÁé∞Ôºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ãÊ±†ÔºåËØ•Á∫øÁ®ãÊ±†ÈáçÁî®Âõ∫ÂÆöÊï∞ÈáèÁöÑÁ∫øÁ®ãÔºåËøô‰∫õÁ∫øÁ®ãÂú®‰∏Ä‰∏™ÂÖ±‰∫´ÁöÑÊó†ËæπÁïåÈòüÂàó‰∏äÊìç‰Ωú„ÄÇÂú®‰ªª‰ΩïÊó∂ÂÄôÔºåÂ§ßÂ§öÊï∞nThreadsÁ∫øÁ®ãÈÉΩÊòØÊ¥ªÂä®ÁöÑÂ§ÑÁêÜ‰ªªÂä°„ÄÇ</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> nThreads<span class="token punctuation">,</span>
                                      <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
                                      <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="newScheduledThreadPoolÁöÑ‰ΩøÁî®"><a href="#newScheduledThreadPoolÁöÑ‰ΩøÁî®" class="headerlink" title="newScheduledThreadPoolÁöÑ‰ΩøÁî®"></a>newScheduledThreadPoolÁöÑ‰ΩøÁî®</h3><p>‚Äã        ÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ãÊ±†,ÂèØ‰ª•Ë∞ÉÂ∫¶ÂëΩ‰ª§Êù•ËøêË°å‰∏Ä‰∏™ÁªôÂÆöÁöÑÂª∂ËøüÂêé,ÊàñÂÆöÊúüÊâßË°å„ÄÇ</p>
<h4 id="No4-NewScheduledThreadPoolDemo-java"><a href="#No4-NewScheduledThreadPoolDemo-java" class="headerlink" title="No4_NewScheduledThreadPoolDemo.java"></a>No4_NewScheduledThreadPoolDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadpool</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ScheduledExecutorService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No4_NewScheduledThreadPoolDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ScheduledExecutorService</span> scheduledExecutorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Êñπ‰æøÁõëÊéßÂ∑•ÂÖ∑ËÉΩÊçïËé∑Âà∞</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Ê∑ªÂä†‰ªªÂä°ÔºåÊó∂Èó¥Ôºö"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> no <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"into"</span> <span class="token operator">+</span> no<span class="token operator">+</span><span class="token string">" =========> "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">Runnable</span> runnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"into"</span> <span class="token operator">+</span> no<span class="token operator">+</span><span class="token string">" =========> "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
            scheduledExecutorService<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>runnable<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Thread Main End!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">Ê∑ªÂä†‰ªªÂä°ÔºåÊó∂Èó¥Ôºö<span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">46</span> CST <span class="token number">2021</span>
into0 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">47</span> CST <span class="token number">2021</span>
into1 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">48</span> CST <span class="token number">2021</span>
into2 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">49</span> CST <span class="token number">2021</span>
into0 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">49</span> CST <span class="token number">2021</span>
into1 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">50</span> CST <span class="token number">2021</span>
into3 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">50</span> CST <span class="token number">2021</span>
into2 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">51</span> CST <span class="token number">2021</span>
into4 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">51</span> CST <span class="token number">2021</span>
into3 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">52</span> CST <span class="token number">2021</span>
into5 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">52</span> CST <span class="token number">2021</span>
into4 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">53</span> CST <span class="token number">2021</span>
into6 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">53</span> CST <span class="token number">2021</span>
into7 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">54</span> CST <span class="token number">2021</span>
into5 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">54</span> CST <span class="token number">2021</span>
into8 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">55</span> CST <span class="token number">2021</span>
into6 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">55</span> CST <span class="token number">2021</span>
into7 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">56</span> CST <span class="token number">2021</span>
into9 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">56</span> CST <span class="token number">2021</span>
<span class="token class-name">Thread</span> <span class="token class-name">Main</span> <span class="token class-name">End</span><span class="token operator">!</span>
into8 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">57</span> CST <span class="token number">2021</span>
into9 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Wed</span> <span class="token class-name">Nov</span> <span class="token number">10</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">03</span><span class="token operator">:</span><span class="token number">58</span> CST <span class="token number">2021</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p> Áúã‰∏Ä‰∏ã**<code>Executors.newScheduledThreadPool(int corePoolSize)</code>**ÁöÑÂÆûÁé∞:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ãÊ±†,ÂèØ‰ª•Ë∞ÉÂ∫¶ÂëΩ‰ª§Êù•ËøêË°å‰∏Ä‰∏™ÁªôÂÆöÁöÑÂª∂ËøüÂêé,ÊàñÂÆöÊúüÊâßË°å„ÄÇ</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ScheduledExecutorService</span> <span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ScheduledThreadPoolExecutor</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token operator">==</span><span class="token operator">></span>
    <span class="token keyword">public</span> <span class="token class-name">ScheduledThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> NANOSECONDS<span class="token punctuation">,</span>
              <span class="token keyword">new</span> <span class="token class-name">DelayedWorkQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‰ª£Á†ÅÂàõÂª∫‰∫Ü‰∏Ä‰∏™ÂÜÖÊ†∏Á∫øÁ®ãÊ±†„ÄÇÁ∫øÁ®ãÊï∞‰∏∫corePoolSizeÔºåÊù•‰∏Ä‰∏™Á∫øÁ®ãÂ∞±Âú®Á∫øÁ®ãÊ±†ÈáåÈù¢ÂàõÂª∫‰∏Ä‰∏™ÁöÑ‰∏ìÈó®ÁöÑÂª∂ËøüÈòüÂàó„ÄÇÂÖÅËÆ∏ÁöÑËØ∑Ê±ÇÈòüÂàóÈïøÂ∫¶‰∏∫ Integer.MAX_VALUEÔºåÂèØËÉΩ‰ºöÂ†ÜÁßØÂ§ßÈáèÁöÑËØ∑Ê±ÇÔºå‰ªéËÄåÂØºËá¥ OOM„ÄÇ</p>
<h3 id="Á∫øÁ®ãÊ±†ÁöÑÂ•ΩÂ§Ñ"><a href="#Á∫øÁ®ãÊ±†ÁöÑÂ•ΩÂ§Ñ" class="headerlink" title="Á∫øÁ®ãÊ±†ÁöÑÂ•ΩÂ§Ñ"></a>Á∫øÁ®ãÊ±†ÁöÑÂ•ΩÂ§Ñ</h3><h4 id="1-ÂêàÁêÜÂà©Áî®Á∫øÁ®ãÊ±†ËÉΩÂ§üÂ∏¶Êù•4‰∏™Â•ΩÂ§Ñ"><a href="#1-ÂêàÁêÜÂà©Áî®Á∫øÁ®ãÊ±†ËÉΩÂ§üÂ∏¶Êù•4‰∏™Â•ΩÂ§Ñ" class="headerlink" title="1.ÂêàÁêÜÂà©Áî®Á∫øÁ®ãÊ±†ËÉΩÂ§üÂ∏¶Êù•4‰∏™Â•ΩÂ§Ñ"></a>1.ÂêàÁêÜÂà©Áî®Á∫øÁ®ãÊ±†ËÉΩÂ§üÂ∏¶Êù•4‰∏™Â•ΩÂ§Ñ</h4><ol>
<li><strong>Èôç‰ΩéËµÑÊ∫êÊ∂àËÄó„ÄÇÈÄöËøáÈáçÂ§çÂà©Áî®Â∑≤ÂàõÂª∫ÁöÑÁ∫øÁ®ãÔºåÈôç‰ΩéÁ∫øÁ®ãÂàõÂª∫ÂíåÈîÄÊØÅÈÄ†ÊàêÁöÑÊ∂àËÄó„ÄÇ</strong></li>
<li><strong>ÊèêÈ´òÂìçÂ∫îÈÄüÂ∫¶„ÄÇÂΩì‰ªªÂä°Âà∞ËææÊó∂Ôºå‰ªªÂä°ÂèØ‰ª•‰∏çÈúÄË¶ÅÁ≠âÂà∞Á∫øÁ®ãÂàõÂª∫Â∞±ËÉΩÁ´ãÂç≥ÊâßË°å„ÄÇ</strong></li>
<li><strong>ÊèêÈ´òÁ∫øÁ®ãÁöÑÂèØÁÆ°ÁêÜÊÄß„ÄÇÁ∫øÁ®ãÊòØÁ®ÄÁº∫ËµÑÊ∫êÔºåÂ¶ÇÊûúÊó†ÈôêÂà∂Âú∞ÂàõÂª∫Ôºå‰∏ç‰ªÖ‰ºöÊ∂àËÄóÁ≥ªÁªüËµÑÊ∫êÔºåËøò‰ºöÈôç‰ΩéÁ≥ªÁªüÁöÑÁ®≥ÂÆöÊÄßÔºå‰ΩøÁî®Á∫øÁ®ãÊ±†ÂèØ‰ª•ËøõË°åÁªü‰∏ÄÁöÑÂàÜÈÖç„ÄÅ Ë∞É‰ºòÂíåÁõëÊéß„ÄÇ‰ΩÜÊòØË¶ÅÂÅöÂà∞ÂêàÁêÜÂú∞Âà©Áî®Á∫øÁ®ãÊ±†ÔºåÂøÖÈ°ªÂØπÂÖ∂ÂéüÁêÜ‰∫ÜÂ¶ÇÊåáÊéå„ÄÇ</strong></li>
<li><strong>Èò≤Ê≠¢ÊúçÂä°Âô®ËøáËΩΩÔºåÂΩ¢ÊàêÂÜÖÂ≠òÊ∫¢Âá∫ÔºåÊàñËÄÖCPUËÄóÂ∞Ω„ÄÇ</strong></li>
</ol>
<h4 id="2-Á∫øÁ®ãÊ±†ÊäÄÊúØÂ¶Ç‰ΩïÊèêÈ´òÊúçÂä°Âô®Á®ãÂ∫èÁöÑÊÄßËÉΩ"><a href="#2-Á∫øÁ®ãÊ±†ÊäÄÊúØÂ¶Ç‰ΩïÊèêÈ´òÊúçÂä°Âô®Á®ãÂ∫èÁöÑÊÄßËÉΩ" class="headerlink" title="2.Á∫øÁ®ãÊ±†ÊäÄÊúØÂ¶Ç‰ΩïÊèêÈ´òÊúçÂä°Âô®Á®ãÂ∫èÁöÑÊÄßËÉΩ"></a>2.Á∫øÁ®ãÊ±†ÊäÄÊúØÂ¶Ç‰ΩïÊèêÈ´òÊúçÂä°Âô®Á®ãÂ∫èÁöÑÊÄßËÉΩ</h4><p>‚Äã        ËøôÈáåÊâÄÊèêÂà∞ÊúçÂä°Âô®Á®ãÂ∫èÊòØÊåáËÉΩÂ§üÊé•ÂèóÂÆ¢Êà∑ËØ∑Ê±ÇÂπ∂ËÉΩÂ§ÑÁêÜËØ∑Ê±ÇÁöÑÁ®ãÂ∫èÔºåËÄå‰∏çÂè™ÊòØÊåáÈÇ£‰∫õÊé•ÂèóÁΩëÁªúÂÆ¢Êà∑ËØ∑Ê±ÇÁöÑÁΩëÁªúÊúçÂä°Âô®Á®ãÂ∫è„ÄÇÂ§öÁ∫øÁ®ãÊäÄÊúØ‰∏ªË¶ÅËß£ÂÜ≥Â§ÑÁêÜÂô®ÂçïÂÖÉÂÜÖÂ§ö‰∏™Á∫øÁ®ãÊâßË°åÁöÑÈóÆÈ¢òÔºåÂÆÉÂèØ‰ª•ÊòæËëóÂáèÂ∞ëÂ§ÑÁêÜÂô®ÂçïÂÖÉÁöÑÈó≤ÁΩÆÊó∂Èó¥ÔºåÂ¢ûÂä†Â§ÑÁêÜÂô®ÂçïÂÖÉÁöÑÂêûÂêêËÉΩÂäõ„ÄÇ‰ΩÜÂ¶ÇÊûúÂØπÂ§öÁ∫øÁ®ãÂ∫îÁî®‰∏çÂΩìÔºå‰ºöÂ¢ûÂä†ÂØπÂçï‰∏™‰ªªÂä°ÁöÑÂ§ÑÁêÜÊó∂Èó¥„ÄÇ</p>
<h4 id="3-ÂèØ‰ª•‰∏æ‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠ê"><a href="#3-ÂèØ‰ª•‰∏æ‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠ê" class="headerlink" title="3.ÂèØ‰ª•‰∏æ‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠ê"></a>3.ÂèØ‰ª•‰∏æ‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠ê</h4><p>‚Äã        ÂÅáËÆæÂú®‰∏ÄÂè∞ÊúçÂä°Âô®ÂÆåÊàê‰∏ÄÈ°π‰ªªÂä°ÁöÑÊó∂Èó¥‰∏∫ T,Âπ∂ÂÅáËÆæÔºö<br>‚óèT1ÔºåÂàõÂª∫Á∫øÁ®ãÁöÑÊó∂Èó¥„ÄÇ<br>‚óèT2ÔºåÂú®Á∫øÁ®ã‰∏≠ÊâßË°å‰ªªÂä°ÁöÑÊó∂Èó¥ÔºåÂåÖÊã¨Á∫øÁ®ãÈó¥ÂêåÊ≠•ÊâÄÈúÄÊó∂Èó¥„ÄÇ<br>‚óèT3ÔºåÁ∫øÁ®ãÈîÄÊØÅÁöÑÊó∂Èó¥„ÄÇ</p>
<p>‚Äã        ÊòæÁÑ∂T &#x3D; T1+T2+T3„ÄÇÊ≥®ÊÑèËøôÊòØ‰∏Ä-‰∏Ä‰∏™ÊûÅÂ∫¶ÁÆÄÂåñÁöÑÂÅáËÆæ„ÄÇ<br>‚Äã        ÂèØ‰ª•ÁúãÂá∫T1„ÄÅT3ÊòØÂ§öÁ∫øÁ®ãÊú¨Ë∫´ÁöÑÂ∏¶Êù•ÁöÑÂºÄÈîÄÔºåÊàë‰ª¨Ê∏¥ÊúõÂáèÂ∞ëTI„ÄÅT3 ÊâÄÁî®ÁöÑÊó∂Èó¥Ôºå‰ªéËÄåÂáèÂ∞ë T ÁöÑÊó∂Èó¥„ÄÇ‰ΩÜ‰∏Ä‰∫õÁ∫øÁ®ãÁöÑ‰ΩøÁî®ËÄÖÂπ∂Ê≤°ÊúâÊ≥®ÊÑèÂà∞Ëøô‰∏ÄÁÇπÔºåÊâÄ‰ª•Âú®Á®ãÂ∫è‰∏≠È¢ëÁπÅÂú∞ÂàõÂª∫ÊàñÈîÄÊØÅÁ∫øÁ®ãÔºåËøôÂØºËá¥TIÂíåT3Âú®T‰∏≠Âç†ÊúâÁõ∏ÂΩìÊØî‰æã„ÄÇÊòæÁÑ∂ËøôÊòØÁ™ÅÂá∫‰∫ÜÁ∫øÁ®ãÁöÑÂº±ÁÇπ(TI, T3)ÔºåËÄå‰∏çÊòØ‰ºòÁÇπ(Âπ∂ÂèëÊÄß)„ÄÇ<br>‚Äã        Á∫øÁ®ãÊ±†ÊäÄÊúØÊ≠£ÊòØÂÖ≥Ê≥®Â¶Ç‰ΩïÁº©Áü≠ÊàñË∞ÉÊï¥TI„ÄÅT3Êó∂Èó¥ÁöÑÊäÄÊúØÔºå‰ªéËÄåÊèêÈ´òÊúçÂä°Âô®Á®ãÂ∫èÊÄßËÉΩÁöÑ„ÄÇÂÆÉÊääT1„ÄÅT3ÂàÜÂà´ÂÆâÊéíÂú®ÊúçÂä°Âô®Á®ãÂ∫èÁöÑÂêØÂä®ÂíåÁªìÊùüÁöÑÊó∂Èó¥ÊÆµÊàñËÄÖ‰∏Ä‰∫õÁ©∫Èó≤ÁöÑÊó∂Èó¥ÊÆµÔºå ËøôÊ†∑Âú®ÊúçÂä°Âô®Á®ãÂ∫èÂ§ÑÁêÜÂÆ¢Êà∑ËØ∑Ê±ÇÊó∂Ôºå‰∏ç‰ºöÊúâTI„ÄÅT3ÁöÑÂºÄÈîÄ‰∫Ü„ÄÇ</p>
<p>‚Äã        Á∫øÁ®ãÊ±†‰∏ç‰ªÖË∞ÉÊï¥T1„ÄÅT3‰∫ßÁîüÁöÑÊó∂Èó¥ÊÆµÔºåËÄå‰∏îÂÆÉËøòÊòæËëóÂáèÂ∞ë‰∫ÜÂàõÂª∫Á∫øÁ®ãÁöÑÊï∞ÁõÆ„ÄÇÂÜçÁúã‰∏Ä‰∏™‰æãÂ≠êÔºö<br>‚Äã        ÂÅáËÆæ‰∏Ä‰∏™ÊúçÂä°Âô®‰∏ÄÂ§©Ë¶ÅÂ§ÑÁêÜ50000‰∏™ËØ∑Ê±ÇÔºåÂπ∂‰∏îÊØè‰∏™ËØ∑Ê±ÇÈúÄË¶Å‰∏Ä‰∏™ÂçïÁã¨ÁöÑÁ∫øÁ®ãÂÆåÊàê„ÄÇÊàë‰ª¨ÊØîËæÉ‰∏Ä‰∏ãÂà©Áî®Á∫øÁ®ãÊ±†ÊäÄÊúØÂíå‰∏çÂà©Áî®Á∫øÁ®ãÊ±†ÊäÄÊúØÁöÑÊúçÂä°Âô®Â§ÑÁêÜËøô‰∫õËØ∑Ê±ÇÊó∂ÊâÄ‰∫ßÁîüÁöÑÁ∫øÁ®ãÊÄªÊï∞„ÄÇÂú®Á∫øÁ®ãÊ±†‰∏≠ÔºåÁ∫øÁ®ãÊï∞‰∏ÄËà¨ÊòØÂõ∫ÂÆöÁöÑÔºåÊâÄ‰ª•‰∫ßÁîüÁ∫øÁ®ãÊÄªÊï∞‰∏ç‰ºöË∂ÖËøáÁ∫øÁ®ãÊ±†‰∏≠Á∫øÁ®ãÁöÑÊï∞ÁõÆÊàñËÄÖ‰∏äÈôê(‰ª•‰∏ãÁÆÄÁß∞Á∫øÁ®ãÊ±†Â∞∫ÂØ∏)ÔºåËÄåÂ¶ÇÊûúÊúçÂä°Âô®‰∏çÂà©Áî®Á∫øÁ®ãÊ±†Êù•Â§ÑÁêÜËøô‰∫õËØ∑Ê±ÇÂàôÁ∫øÁ®ãÊÄªÊï∞‰∏∫<strong>50000</strong>Ôºå‰∏ÄËà¨Á∫øÁ®ãÊ±†Â∞∫ÂØ∏ÊòØËøúÂ∞è‰∫é<strong>50000</strong>„ÄÇÊâÄ‰ª•Âà©Áî®Á∫øÁ®ãÊ±†ÁöÑÊúçÂä°Âô®Á®ãÂ∫è‰∏ç‰ºö‰∏∫‰∫ÜÂàõÂª∫<strong>50000</strong>ËÄåÂú®Â§ÑÁêÜËØ∑Ê±ÇÊó∂Êµ™Ë¥πÊó∂Èó¥Ôºå‰ªéËÄåÊèêÈ´òÊïàÁéá„ÄÇ</p>
<h4 id="4-Á∫øÁ®ãÊ±†ÁöÑÂ∫îÁî®ËåÉÂõ¥"><a href="#4-Á∫øÁ®ãÊ±†ÁöÑÂ∫îÁî®ËåÉÂõ¥" class="headerlink" title="4.Á∫øÁ®ãÊ±†ÁöÑÂ∫îÁî®ËåÉÂõ¥"></a>4.Á∫øÁ®ãÊ±†ÁöÑÂ∫îÁî®ËåÉÂõ¥</h4><ol>
<li>ÈúÄË¶ÅÂ§ßÈáèÁöÑÁ∫øÁ®ãÊù•ÂÆåÊàê‰ªªÂä°Ôºå‰∏îÂÆåÊàê‰ªªÂä°ÁöÑÊó∂Èó¥ÊØîËæÉÁü≠„ÄÇ**<code>Web</code><strong>ÊúçÂä°Âô®ÂÆåÊàêÁΩëÈ°µËØ∑Ê±ÇËøôÊ†∑ÁöÑ‰ªªÂä°Ôºå‰ΩøÁî®Á∫øÁ®ãÊ±†ÊäÄÊúØÊòØÈùûÂ∏∏ÂêàÈÄÇÁöÑ„ÄÇÂõ†‰∏∫Âçï‰∏™‰ªªÂä°Â∞èÔºåËÄå‰ªªÂä°Êï∞ÈáèÂ∑®Â§ßÔºå‰Ω†ÂèØ‰ª•ÊÉ≥Ë±°‰∏Ä‰∏™ÁÉ≠Èó®ÁΩëÁ´ôÁöÑÁÇπÂáªÊ¨°Êï∞„ÄÇ‰ΩÜÂØπ‰∫éÈïøÊó∂Èó¥ÁöÑ‰ªªÂä°ÔºåÊØîÂ¶Ç‰∏Ä‰∏™</strong>Telnet<strong>ËøûÊé•ËØ∑Ê±ÇÔºåÁ∫øÁ®ãÊ±†ÁöÑ‰ºòÁÇπÂ∞±‰∏çÊòéÊòæ‰∫Ü„ÄÇÂõ†‰∏∫</strong>Telnet**‰ºöËØùÊó∂Èó¥ÊØîÁ∫øÁ®ãÁöÑÂàõÂª∫Êó∂Èó¥Â§ßÂ§ö‰∫Ü„ÄÇ</li>
<li>ÂØπÊÄßËÉΩË¶ÅÊ±ÇËãõÂàªÁöÑÂ∫îÁî®ÔºåÊØîÂ¶ÇË¶ÅÊ±ÇÊúçÂä°Âô®ËøÖÈÄüÂìçÂ∫îÂÆ¢Êà∑ËØ∑Ê±Ç„ÄÇ</li>
<li>Êé•ÂèóÁ™ÅÂèëÊÄßÁöÑÂ§ßÈáèËØ∑Ê±ÇÔºå‰ΩÜ‰∏çËá≥‰∫é‰ΩøÊúçÂä°Âô®Âõ†Ê≠§‰∫ßÁîüÂ§ßÈáèÁ∫øÁ®ãÁöÑÂ∫îÁî®„ÄÇÁ™ÅÂèëÊÄßÂ§ßÈáèÂÆ¢Êà∑ËØ∑Ê±ÇÔºåÂú®Ê≤°ÊúâÁ∫øÁ®ãÊ±†ÊÉÖÂÜµ‰∏ãÔºåÂ∞Ü‰∫ßÁîüÂ§ßÈáèÁ∫øÁ®ãÔºåËôΩÁÑ∂ÁêÜËÆ∫‰∏äÂ§ßÈÉ®ÂàÜÊìç‰ΩúÁ≥ªÁªüÁ∫øÁ®ãÊï∞ÁõÆÊúÄÂ§ßÂÄº‰∏çÊòØÈóÆÈ¢òÔºåÁü≠Êó∂Èó¥ÂÜÖ‰∫ßÁîüÂ§ßÈáèÁ∫øÁ®ãÂèØËÉΩ‰ΩøÂÜÖÂ≠òÂà∞ËææÊûÅÈôêÔºåÂπ∂Âá∫Áé∞**<code>OutOfMemory</code>**ÁöÑÈîôËØØ„ÄÇ</li>
</ol>
<h3 id="Á∫øÁ®ãÊ±†ÁöÑÂ∑•‰ΩúÊú∫Âà∂ÂèäÂÖ∂ÂéüÁêÜ"><a href="#Á∫øÁ®ãÊ±†ÁöÑÂ∑•‰ΩúÊú∫Âà∂ÂèäÂÖ∂ÂéüÁêÜ" class="headerlink" title="Á∫øÁ®ãÊ±†ÁöÑÂ∑•‰ΩúÊú∫Âà∂ÂèäÂÖ∂ÂéüÁêÜ"></a>Á∫øÁ®ãÊ±†ÁöÑÂ∑•‰ΩúÊú∫Âà∂ÂèäÂÖ∂ÂéüÁêÜ</h3><h4 id="Á∫øÁ®ãÊ±†ÁöÑÊ†∏ÂøÉÁöÑ‰∏§‰∏™ÈòüÂàó"><a href="#Á∫øÁ®ãÊ±†ÁöÑÊ†∏ÂøÉÁöÑ‰∏§‰∏™ÈòüÂàó" class="headerlink" title="Á∫øÁ®ãÊ±†ÁöÑÊ†∏ÂøÉÁöÑ‰∏§‰∏™ÈòüÂàó:"></a>Á∫øÁ®ãÊ±†ÁöÑÊ†∏ÂøÉÁöÑ‰∏§‰∏™ÈòüÂàó:</h4><ul>
<li>Á∫øÁ®ãÁ≠âÂæÖÊ±†ÔºåÂç≥Á∫øÁ®ãÈòüÂàó**<code>BlockingQueue</code>.**</li>
<li>‰ªªÂä°Â§ÑÁêÜÊ±†(<strong><code>PoolWorker</code></strong>)ÔºåÂç≥Ê≠£Âú®Â∑•‰ΩúÁöÑ**<code>Thread</code>**ÂàóË°®( <strong><code>HashSet&lt;Worker&gt; </code></strong>)„ÄÇ</li>
</ul>
<h4 id="Á∫øÁ®ãÊ±†ÁöÑÊ†∏ÂøÉÁöÑÂèÇÊï∞"><a href="#Á∫øÁ®ãÊ±†ÁöÑÊ†∏ÂøÉÁöÑÂèÇÊï∞" class="headerlink" title="Á∫øÁ®ãÊ±†ÁöÑÊ†∏ÂøÉÁöÑÂèÇÊï∞:"></a>Á∫øÁ®ãÊ±†ÁöÑÊ†∏ÂøÉÁöÑÂèÇÊï∞:</h4><ul>
<li><p>Ê†∏ÂøÉÊ±†Â§ßÂ∞è(<strong><code>corePolSize</code></strong>)ÔºåÂç≥Âõ∫ÂÆöÂ§ßÂ∞èÔºåËÆæÂÆöÂ•Ω‰πãÂêéÔºåÁ∫øÁ®ãÊ±†ÁöÑÁ®≥ÂÆöÂ≥∞ÂÄºÔºåËææÂà∞Ëøô‰∏™ÂÄº‰πãÂêéÊ±†ÁöÑÁ∫øÁ®ãÊï∞Â§ßÂ∞è‰∏ç‰ºöÈáäÊîæÁöÑ„ÄÇ</p>
</li>
<li><p>ÊúÄÂ§ßÂ§ÑÁêÜÁ∫øÁ®ãÊ±†Êï∞(<strong><code>maximumPoolSize</code></strong>)ÔºåÂΩìÁ∫øÁ®ãÊ±†ÈáåÈù¢ÁöÑÁ∫øÁ®ãÊï∞Ë∂ÖËøá**<code>corePoolSize</code><strong>ÔºåÂ∞è‰∫é</strong><code>maximumPoolSize</code>**Êó∂‰ºöÂä®ÊÄÅÂàõÂª∫‰∏éÂõûÊî∂Á∫øÁ®ãÊ±†ÈáåÈù¢ÁöÑÁ∫øÁ®ãÁöÑËµÑÊ∫ê„ÄÇ</p>
</li>
</ul>
<h4 id="Á∫øÁ®ãÊ±†ÁöÑËøêË°åÊú∫Âà∂"><a href="#Á∫øÁ®ãÊ±†ÁöÑËøêË°åÊú∫Âà∂" class="headerlink" title="Á∫øÁ®ãÊ±†ÁöÑËøêË°åÊú∫Âà∂:"></a>Á∫øÁ®ãÊ±†ÁöÑËøêË°åÊú∫Âà∂:</h4><p>‚Äã        Êàë‰ª¨‰∏æ‰∏Ä‰∏™‰æãÂ≠êÊù•ËØ¥Êòé„ÄÇÂÅáÂ¶ÇÊúâ‰∏Ä‰∏™Â∑•ÂéÇÔºåÂ∑•ÂéÇÈáåÈù¢Êúâ<strong>10</strong>‰∏™Â∑•‰∫∫ÔºåÊØè‰∏™Â∑•‰∫∫ÂêåÊó∂Âè™ËÉΩÂÅö‰ª∂‰ªªÂä°„ÄÇÂõ†Ê≠§Âè™Ë¶ÅÂΩì<strong>10</strong>‰∏™Â∑•‰∫∫‰∏≠ÊúâÂ∑•‰∫∫ÊòØÁ©∫Èó≤ÁöÑÔºåÊù•‰∫Ü‰ªªÂä°Â∞±ÂàÜÈÖçÁªôÁ©∫Èó≤ÁöÑÂ∑•‰∫∫ÂÅöÔºõÂΩì<strong>10</strong>‰∏™Â∑•‰∫∫ÈÉΩÊúâ‰ªªÂä°Âú®ÂÅöÊó∂ÔºåÂ¶ÇÊûúËøòÊù•‰∫Ü‰ªªÂä°ÔºåÂ∞±Êää‰ªªÂä°ËøõË°åÊéíÈòüÁ≠âÂæÖ„ÄÇ</p>
<p>‚Äã        Â¶ÇÊûúËØ¥Êñ∞‰ªªÂä°Êï∞ÁõÆÂ¢ûÈïøÁöÑÈÄüÂ∫¶ËøúËøúÂ§ß‰∫éÂ∑•‰∫∫ÂÅö‰ªªÂä°ÁöÑÈÄüÂ∫¶ÔºåÈÇ£‰πàÊ≠§Êó∂Â∑•ÂéÇ‰∏ªÁÆ°ÂèØËÉΩ‰ºöÊÉ≥Ë°•ÊïëÊé™ÊñΩÔºåÊØîÂ¶ÇÈáçÊñ∞Êãõ<strong>4</strong>‰∏™‰∏¥Êó∂Â∑•‰∫∫ËøõÊù•ÔºöÁÑ∂ÂêéÂ∞±Â∞Ü‰ªªÂä°‰πüÂàÜÈÖçÁªôËøô<strong>4</strong>‰∏™‰∏¥Êó∂Â∑•‰∫∫ÂÅö„ÄÇ<br>Â¶ÇÊûúËØ¥Ëøô<strong>14</strong>‰∏™Â∑•‰∫∫ÂÅö‰ªªÂä°ÁöÑÈÄüÂ∫¶ËøòÊòØ‰∏çÂ§üÔºåÊ≠§Êó∂Â∑•ÂéÇ‰∏ªÁÆ°ÂèØËÉΩÂ∞±Ë¶ÅËÄÉËôë‰∏çÂÜçÊé•Êî∂Êñ∞ÁöÑ‰ªªÂä°ÊàñËÄÖÊäõÂºÉÂâçÈù¢ÁöÑ‰∏Ä‰∫õ‰ªªÂä°‰∫Ü„ÄÇ ÂΩìËøô<strong>14</strong>‰∏™Â∑•‰∫∫ÂΩì‰∏≠Êúâ‰∫∫Á©∫Èó≤Êó∂ÔºåËÄåÊñ∞‰ªªÂä°Â¢ûÈïøÁöÑÈÄüÂ∫¶ÂèàÊØîËæÉÁºìÊÖ¢ÔºåÂ∑•ÂéÇ‰∏ªÁÆ°ÂèØËÉΩÂ∞±ËÄÉËôëËæûÊéâ4‰∏™‰∏¥Êó∂Â∑•‰∫ÜÔºåÂè™‰øùÊåÅÂéüÊù•ÁöÑ<strong>10</strong>‰∏™Â∑•‰∫∫ÔºåÊØïÁ´ûËØ∑È¢ùÂ§ñÁöÑÂ∑•‰∫∫ÊòØË¶ÅËä±Èí±ÁöÑ„ÄÇ<br>‚Äã        <strong>Ëøô‰∏™‰æãÂ≠ê‰∏≠Ê∞∏ËøúÁ≠âÂæÖÂπ≤Ê¥ªÁöÑ</strong> <strong>10</strong>‰∏™Â∑•‰∫∫Êú∫Âà∂Â∞±ÊòØ**<code>workerQueue</code><strong>.Ëøô‰∏™‰æãÂ≠ê‰∏≠ÁöÑ</strong><code>corePoolSize</code><strong>Â∞±ÊòØ</strong>10<strong>ÔºåËÄå</strong><code>maximumPoolSize</code><strong>Â∞±ÊòØ14 (10+4) „ÄÇ‰πüÂ∞±ÊòØËØ¥</strong><code>corePoolSize </code><strong>Â∞±ÊòØÁ∫øÁ®ãÊ±†Â§ßÂ∞èÔºå</strong><code>maximumPoolSize</code><strong>Âú®ÊàëÁúãÊù•ÊòØÁ∫øÁ®ãÊ±†ÁöÑ‰∏ÄÁßçË°•ÊïëÊé™ÊñΩÔºå</strong>Âç≥‰ªªÂä°ÈáèÁ™ÅÁÑ∂ËøáÂ§ßÊó∂ÁöÑ‰∏ÄÁßçË°•ÊïëÊé™ÊñΩ<strong>„ÄÇÂÜçÁúãÁúã‰∏ãÂõæÂ•ΩÂ•ΩÁêÜËß£‰∏Ä‰∏ã„ÄÇ Â∑•‰∫∫Ê∞∏ËøúÂú®Á≠âÂæÖÂπ≤Ê¥ªÔºåÂ∞±ÂÉè</strong><code>workerQueue</code>**Ê∞∏ËøúÂú®Âæ™ÁéØÂπ≤Ê¥ª‰∏ÄÊ†∑ÔºåÈô§ÈùûÔºåÊï¥‰∏™Á∫øÁ®ãÊ±†ÂÅúÊ≠¢‰∫Ü„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent28.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent28.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        Á∫øÁ®ãÊ±†ÈáåÈù¢ÁöÑÁ∫øÁ®ãÁöÑÊó∂Â∫èÂõæÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö<img src="/image/Concurrent/Concurrent29.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent29.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<h3 id="Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†‰∏éExecutorService"><a href="#Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†‰∏éExecutorService" class="headerlink" title="Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†‰∏éExecutorService"></a>Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†‰∏éExecutorService</h3><p>‚Äã        Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†ÈúÄË¶ÅÁî®Âà∞**<code>ThreadFactory</code><strong>ÔºåÊú¨ËäÇÂ∞ÜÈÄöËøáÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ãÁöÑ‰æãÂ≠êÂØπ</strong><code>ExecutorService</code>**ÂèäÂÖ∂ÂèÇÊï∞ËøõË°åËØ¶ÁªÜËÆ≤Ëß£„ÄÇ</p>
<h4 id="1-ËÆ§ËØÜ‰∏Ä‰∏ãExecutorServiceÁöÑÂÆ∂Êóè"><a href="#1-ËÆ§ËØÜ‰∏Ä‰∏ãExecutorServiceÁöÑÂÆ∂Êóè" class="headerlink" title="1.ËÆ§ËØÜ‰∏Ä‰∏ãExecutorServiceÁöÑÂÆ∂Êóè"></a>1.ËÆ§ËØÜ‰∏Ä‰∏ãExecutorServiceÁöÑÂÆ∂Êóè</h4><p>**<code>ExecutorService</code>**Á±ªÁöÑÂÆ∂ÊóèÊàêÂëòÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent30.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent30.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‰∏äÂõæ‰∏≠‰∏ªË¶ÅÂÖÉÁ¥†ËØ¥ÊòéÂ¶Ç‰∏ã:</p>
<ul>
<li>**<code>Executor</code><strong>ÔºöÁ∫øÁ®ãÊ±†ÁöÑÈ°∂Á∫ßÊé•Âè£Ôºå‰ΩÜÊòØ‰∏•Ê†ºÊÑè‰πâ‰∏äËÆ≤</strong><code>Executor</code>**Âπ∂‰∏çÊòØ‰∏Ä‰∏Ä‰∏™Á∫øÁ®ãÊ±†ÔºåËÄåÂè™ÊòØ‰∏Ä ‰∏™ÊâßË°åÁ∫øÁ®ãÁöÑÂ∑•ÂÖ∑„ÄÇ</li>
<li>**<code>ExecutorService</code><strong>ÔºöÁúüÊ≠£ÁöÑÁ∫øÁ®ãÊ±†Êé•Âè£„ÄÇËøô‰∏™Êé•Âè£ÁªßÊâø‰∫Ü</strong><code>Executor</code><strong>Êé•Âè£ÔºåÂπ∂Â£∞Êòé‰∫Ü‰∏Ä‰∫õÊñπÊ≥ïÔºö<br><strong><code>submit \ invokeAll \ invokeAny</code></strong> ‰ª•Âèä</strong><code>shutDown</code>**Á≠â„ÄÇ</li>
<li>**<code>AbstractExecutorService</code><strong>ÂÆûÁé∞‰∫Ü</strong><code>ExecutorService</code><strong>Êé•Âè£,Âü∫Êú¨ÂÆûÁé∞‰∫Ü</strong><code>ExecutorService</code>**‰∏≠Â£∞ÊòéÁöÑÊâÄÊúâÊñπÊ≥ï„ÄÇ</li>
<li><strong><code>ThreadPoolExecutor</code></strong>: <strong><code>ExecutorService</code></strong> ÁöÑÈªòËÆ§ÂÆûÁé∞ÔºåÁªßÊâø‰∫ÜÁ±ª**<code>AbstractExecutorService</code>**„ÄÇ</li>
<li>**<code>ScheduledExecutorService</code>**Ôºö‰∏éTimer&#x2F;TimerTaskÁ±ª‰ººÔºåËß£ÂÜ≥ÈÇ£‰∫õÈúÄË¶Å‰ªªÂä°ÈáçÂ§çÊâßË°åÁöÑÈóÆÈ¢ò„ÄÇ</li>
<li>**<code>ScheduledThreadPoolExecutor</code><strong>ÔºöÁªßÊâøThreadPoolExcutorÁöÑ</strong><code>ScheduledExecutorService</code>**Êé•Âè£ÂÆûÁé∞ÔºåÂë®ÊúüÊÄß‰ªªÂä°Ë∞ÉÂ∫¶ÁöÑÁ±ªÂÆûÁé∞„ÄÇ</li>
<li>**<code>Executors</code>**ÊòØ‰∏™Á∫øÁ®ãÁöÑÂ∑•ÂéÇÁ±ªÔºåÊñπ‰æøÂø´ÈÄüÂàõÂª∫ÂæàÂ§öÁ∫øÁ®ãÊ±†„ÄÇ</li>
</ul>
<h4 id="2-Âà©Áî®ThreadFactoryÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ã"><a href="#2-Âà©Áî®ThreadFactoryÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ã" class="headerlink" title="2.Âà©Áî®ThreadFactoryÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ã"></a>2.Âà©Áî®ThreadFactoryÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ã</h4><p>‚Äã        <strong><code>java.concurrent.ThreadFactory</code><strong>Êèê‰æõ‰∫Ü‰∏Ä‰∏™ÂàõÂª∫Á∫øÁ®ãÂ∑•ÂéÇÁöÑÊé•Âè£„ÄÇÂ∑•ÂéÇÊ®°ÂºèÊòØÊàë‰ª¨Â≠¶‰π†ÁºñÁ®ãÊó∂ÔºåÊé•Ëß¶Âà∞ÁöÑÁ¨¨-‰∏Ä‰∏™ËÆæËÆ°Ê®°ÂºèÔºå‰πüÊòØÊúÄÁÆÄÂçï„ÄÅÊúÄÂ∏∏Áî®ÁöÑ‰∏Ä‰∏™ËÆæËÆ°Ê®°Âºè„ÄÇ Âú®JDKÁöÑÊ∫êÁ†Å‰∏≠ÔºåÂ§ßÈáè‰ΩøÁî®Â∑•ÂéÇÊ®°ÂºèÔºå</strong><code>ThreadFactory</code></strong> Â∞±ÊòØÂÖ∂‰∏≠‰∏ÄÁßç„ÄÇ<br>‚Äã        ÂâçÈù¢Êàë‰ª¨‰ªãÁªç‰∫Ü‰∏âÁßçÂàõÂª∫Á∫øÁ®ãÁöÑÊñπÊ≥ïÔºåËøôÈáåÊàë‰ª¨ÂÜç‰ªãÁªç‰∏ÄÁßçÔºåÈÄöËøáÁ∫øÁ®ãÂ∑•ÂéÇÁõ¥Êé•ÂàõÂª∫Á∫øÁ®ã„ÄÇËÆæÊÉ≥ËøôÊ†∑‰∏ÄÁßçÂú∫ÊôØÔºå Êàë‰ª¨ÈúÄË¶Å‰∏Ä‰∏™Á∫øÁ®ãÊ±†Ôºå Âπ∂‰∏îÂØπ‰∫éÁ∫øÁ®ãÊ±†‰∏≠ÁöÑÁ∫øÁ®ãÂØπË±°ÔºåËµã‰∫àÁªü‰∏ÄÁöÑÁ∫øÁ®ã‰ºòÂÖàÁ∫ß„ÄÅÁªü‰∏ÄÁöÑÂêçÁß∞„ÄÅÁîöËá≥ËøõË°åÁªü‰∏ÄÁöÑ‰∏öÂä°Â§ÑÁêÜÊàñÂíå‰∏öÂä°ÊñπÈù¢ÁöÑÂàùÂßãÂåñÂ∑•‰ΩúÔºåËøôÊó∂Â∑•ÂéÇÊñπÊ≥ïÂ∞±ÊòØÊúÄÂ•ΩÁî®ÁöÑÊñπÊ≥ï‰∫Ü„ÄÇ<br>‚Äã        <strong><code>ThreadFactory</code></strong> ÁöÑÊé•Âè£ÂÜÖÂÆπÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Âú®   <strong><code>ThreadFactory</code></strong> ‰∏≠ÔºåÂè™Êúâ‰∏Ä‰∏™**<code>newThread</code>**ÊñπÊ≥ïÔºåÂÆÉË¥üË¥£Êé•Êî∂‰∏Ä‰∏™ **<code>Runnable</code><strong>ÂØπË±°ÔºåÂπ∂Â∞ÜÂÖ∂Â∞ÅË£ÖÂà∞</strong><code>Thread</code>**ÂØπË±°‰∏≠ÔºåËøõË°åÊâßË°å„ÄÇ<br>‚Äã        Êàë‰ª¨ÂèØ‰ª•ÂÆûÁé∞‰∏äËø∞Êé•Âè£ÔºåÂÅö-‰∏Ä‰∏™ÊúÄÁÆÄÂçïÁöÑÁ∫øÁ®ãÂ∑•ÂéÇÂá∫Êù•ÔºåÊ∫êÁ†ÅÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">SimpleThreadFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">public</span> <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰∏äËø∞Á∫øÁ®ãÂ∑•ÂéÇÔºåÂè™ÊòØÂàõÂª∫‰∫Ü‰∏Ä‰∏™Êñ∞Á∫øÁ®ãÔºåÂÖ∂‰ªñ‰ªÄ‰πàÈÉΩÊ≤°Âπ≤„ÄÇÂÆûÈôÖ‰ΩøÁî®Êó∂Ôºå‰∏ÄËà¨‰∏ç‰ºöÂàõÂª∫Ëøô‰πàÁÆÄÂçïÁöÑÁ∫øÁ®ãÂ∑•ÂéÇ„ÄÇ<br>‚Äã        Êàë‰ª¨Êù•Áúã‰∏Ä‰∏ãJDKÊèê‰æõÁöÑÈªòËÆ§Á∫øÁ®ãÂ∑•ÂéÇÁ±ªÁ∫øÁ®ãÊ±†ÈáåÈù¢Áî®Âà∞ÁöÑÂæàÂ§ö„ÄÇÂú®**<code>Executors</code>**Â∑•ÂÖ∑Á±ª‰∏≠Ôºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ThreadFactory</span> <span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DefaultThreadFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> poolNumber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ThreadGroup</span> group<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> threadNumber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> namePrefix<span class="token punctuation">;</span>

        <span class="token class-name">DefaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">SecurityManager</span> s <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            group <span class="token operator">=</span> <span class="token punctuation">(</span>s <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> s<span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span>
                                  <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            namePrefix <span class="token operator">=</span> <span class="token string">"pool-"</span> <span class="token operator">+</span>
                          poolNumber<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                         <span class="token string">"-thread-"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>group<span class="token punctuation">,</span> r<span class="token punctuation">,</span>
                                  namePrefix <span class="token operator">+</span> threadNumber<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                t<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span>NORM_PRIORITY<span class="token punctuation">)</span>
                t<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>NORM_PRIORITY<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> t<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÊâÄ‰ª•Êàë‰ª¨ÁúãÂà∞Á∫øÁ®ãÊ±†ÈáåÈù¢ÁöÑÁ∫øÁ®ãÁöÑÂêçÁß∞ÔºåÈÉΩÊòØËøôÈáåÊù•ÁöÑÂì¶ÔºåÂ¶ÇÊûúÊÉ≥Ëá™ÂÆö‰πâÔºåÊâ©Â±ïÂç≥ÂèØ„ÄÇ</p>
<h4 id="3-ÁêÜËß£RejectedExecutionHandler"><a href="#3-ÁêÜËß£RejectedExecutionHandler" class="headerlink" title="3.ÁêÜËß£RejectedExecutionHandler"></a>3.ÁêÜËß£RejectedExecutionHandler</h4><p>‚Äã        Â¶ÇÊûúÁ∫øÁ®ãÊ±†ÁöÑÁ∫øÁ®ãÂ∑≤ÁªèÈ•±ÂíåÔºåÂπ∂‰∏î‰ªªÂä°ÈòüÂàó‰πüÂ∑≤Êª°ÔºåÈÇ£‰πàÂ∞±ÈúÄË¶ÅÂÅö‰∏¢ÂºÉÂ§ÑÁêÜÔºå<br>**<code>RejectedExecutionHandler</code>**Ëøô‰∏™Á±ªÂ∞±ÊòØÁî®Êù•Â§ÑÁêÜË¢´‰∏¢ÂºÉÁöÑÁ∫øÁ®ãÁöÑÂºÇÂ∏∏Â§ÑÁêÜÊé•Âè£„ÄÇ<br>‚Äã        Êé•Âè£ÂÜÖÂÆπÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RejectedExecutionHandler</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//ÊñπÊ≥ïÂú®ÊâßË°åÊó∂ÂèØËÉΩË¢´ThreadPoolExecutorË∞ÉÁî®Ôºå‰ΩÜ‰∏çËÉΩÊé•Âèó‰ªªÂä°„ÄÇËøôÁßçÊÉÖÂÜµÂèØËÉΩÂèëÁîüÂú®Áî±‰∫éË∂ÖÂá∫‰∫ÜÁ∫øÁ®ãÊàñÈòüÂàóÊßΩÁöÑËæπÁïåËÄåÊ≤°ÊúâÊõ¥Â§öÁ∫øÁ®ãÊàñÈòüÂàóÊßΩÂèØÁî®Êó∂ÔºåÊàñËÄÖÂú®ExecutorÂÖ≥Èó≠Êó∂„ÄÇ</span>
	<span class="token keyword">void</span> <span class="token function">rejectedExecution</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">,</span> <span class="token class-name">ThreadPoolExecutor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÂèØ‰ª•Ëá™Â∑±ÂÆûÁé∞Ëøô‰∏™Êé•Âè£ÂÆûÁé∞Ëá™ Â∑±ÁöÑÁ∫øÁ®ã‰∏¢ÂºÉÂ§ÑÁêÜÁ±ªÔºåÁÆÄÂçïÁöÑÁ§∫‰æã‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No5_RejectedExecutionHandlerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">RejectedExecutionHandler</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rejectedExecution</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">,</span> <span class="token class-name">ThreadPoolExecutor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" Á∫øÁ®ã‰ø°ÊÅØ:‚Äù+ r.toString() +‚Äù Ë¢´ÈÅóÂºÉÁöÑÁ∫øÁ®ãÊ±†: "</span><span class="token operator">+</span>executor<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        JDKÈáåÈù¢**<code>RejectedExecutionHandler</code><strong>Êèê‰æõ‰∫Ü</strong>4<strong>ÁßçÊñπÂºèÊù•Â§ÑÁêÜ‰ªªÂä°</strong>ÊãíÁªùÁ≠ñÁï•**ÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent31.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent31.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚óè**<code>AbortPolicy</code><strong>: Áõ¥Êé•ÊäõÂá∫ÂºÇÂ∏∏„ÄÇ<br>‚óè</strong><code>CallerRunsPolicy</code><strong>: Âè™Áî®Ë∞ÉÁî®ËÄÖÊâÄÂú®Á∫øÁ®ãÊù•ËøêË°å‰ªªÂä°„ÄÇ<br>‚óè</strong><code>DiscardOldestPolicy</code><strong>: ‰∏¢ÂºÉÈòüÂàóÈáåÊúÄËøëÁöÑ‰∏Ä‰∏™‰ªªÂä°ÔºåÂπ∂ÊâßË°åÂΩìÂâç‰ªªÂä°„ÄÇ<br>‚óè</strong><code>DiscardPolicy</code>**: ‰∏çÂ§ÑÁêÜÔºå‰∏¢ÂºÉÊéâ„ÄÇ</p>
<p>Â§ßÂÆ∂ÂéªÁúãÂá†‰∏™Á±ªÁöÑÊ∫êÁ†Å‰πüÈùûÂ∏∏ÁÆÄÂçïÔºåÁé∞Âú®‰∏æÊù•ÁÆÄÂçïËØ¥Êòé‰∏Ä‰∏ã„ÄÇ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/* Predefined RejectedExecutionHandlers */</span>

    <span class="token comment">/**Ë¢´ÊãíÁªù‰ªªÂä°ÁöÑÂ§ÑÁêÜÁ®ãÂ∫èÔºåÂÆÉÁõ¥Êé•Âú®executeÊñπÊ≥ïÁöÑË∞ÉÁî®Á∫øÁ®ã‰∏≠ËøêË°åË¢´ÊãíÁªùÁöÑ‰ªªÂä°ÔºåÈô§ÈùûÊâßË°åÁ®ãÂ∫èÂ∑≤ÂÖ≥Èó≠ÔºåÂú®ËøôÁßçÊÉÖÂÜµ‰∏ã‰ªªÂä°Â∞ÜË¢´‰∏¢ÂºÉ„ÄÇ
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CallerRunsPolicy</span> <span class="token keyword">implements</span> <span class="token class-name">RejectedExecutionHandler</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">/**
         * ÂàõÂª∫‰∏Ä‰∏™CallerRunsPolicy„ÄÇ
         */</span>
        <span class="token keyword">public</span> <span class="token class-name">CallerRunsPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>

        <span class="token comment">/**
         * Âú®Ë∞ÉÁî®ËÄÖÁöÑÁ∫øÁ®ã‰∏≠ÊâßË°å‰ªªÂä°rÔºåÈô§ÈùûÊâßË°åÂô®Ë¢´ÂÖ≥Èó≠ÔºåÂê¶Âàô‰ªªÂä°Â∞ÜË¢´‰∏¢ÂºÉ„ÄÇ
         *
         * @param r the runnable task requested to be executed
         * @param e the executor attempting to execute this task
         */</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rejectedExecution</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">,</span> <span class="token class-name">ThreadPoolExecutor</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span><span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                r<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * ÊäõÂá∫RejectedExecutionExceptionÁöÑË¢´ÊãíÁªù‰ªªÂä°ÁöÑÂ§ÑÁêÜÁ®ãÂ∫è„ÄÇ
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">AbortPolicy</span> <span class="token keyword">implements</span> <span class="token class-name">RejectedExecutionHandler</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">/**
         * ÂàõÂª∫‰∏Ä‰∏™AbortPolicy„ÄÇ
         */</span>
        <span class="token keyword">public</span> <span class="token class-name">AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>

        <span class="token comment">/**
         * Áõ¥Êé•ÊäõÂá∫ RejectedExecutionException.
         *
         * @param r the runnable task requested to be executed
         * @param e the executor attempting to execute this task
         * @throws RejectedExecutionException always
         */</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rejectedExecution</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">,</span> <span class="token class-name">ThreadPoolExecutor</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RejectedExecutionException</span><span class="token punctuation">(</span><span class="token string">"Task "</span> <span class="token operator">+</span> r<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                                                 <span class="token string">" rejected from "</span> <span class="token operator">+</span>
                                                 e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * ‰∏Ä‰∏™Ë¢´ÊãíÁªù‰ªªÂä°ÁöÑÂ§ÑÁêÜÁ®ãÂ∫èÔºåÂÆÉÈùôÈªòÂú∞‰∏¢ÂºÉË¢´ÊãíÁªùÁöÑ‰ªªÂä°„ÄÇ
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DiscardPolicy</span> <span class="token keyword">implements</span> <span class="token class-name">RejectedExecutionHandler</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">/**
         * ÂàõÂª∫‰∏Ä‰∏™DiscardPolicy„ÄÇ
         */</span>
        <span class="token keyword">public</span> <span class="token class-name">DiscardPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>

        <span class="token comment">/**
         * ‰ªÄ‰πàÈÉΩ‰∏çÂÅöÔºåÊúâ‰∏¢ÂºÉ‰ªªÂä°rÁöÑÊïàÊûú„ÄÇ
         *
         * @param r the runnable task requested to be executed
         * @param e the executor attempting to execute this task
         */</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rejectedExecution</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">,</span> <span class="token class-name">ThreadPoolExecutor</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * Ë¢´ÊãíÁªù‰ªªÂä°ÁöÑÂ§ÑÁêÜÁ®ãÂ∫èÔºåÂÆÉ‰∏¢ÂºÉÊúÄËÄÅÁöÑÊú™Â§ÑÁêÜËØ∑Ê±ÇÔºåÁÑ∂ÂêéÈáçËØïÊâßË°åÔºåÈô§ÈùûÊâßË°åÁ®ãÂ∫èÂÖ≥Èó≠ÔºåÂú®ËøôÁßçÊÉÖÂÜµ‰∏ã‰ªªÂä°Â∞ÜË¢´‰∏¢ÂºÉ
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DiscardOldestPolicy</span> <span class="token keyword">implements</span> <span class="token class-name">RejectedExecutionHandler</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">/**
         * ‰∏∫ÁªôÂÆöÁöÑÊâßË°åÂô®ÂàõÂª∫‰∏Ä‰∏™DiscardOldestPolicy„ÄÇ
         */</span>
        <span class="token keyword">public</span> <span class="token class-name">DiscardOldestPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>

        <span class="token comment">/**
         * Ëé∑ÂèñÂπ∂ÂøΩÁï•ÊâßË°åÂô®Â∞ÜÊâßË°åÁöÑ‰∏ã‰∏Ä‰∏™‰ªªÂä°(Â¶ÇÊûúÊúâ‰∏Ä‰∏™‰ªªÂä°Á´ãÂç≥ÂèØÁî®)ÔºåÁÑ∂ÂêéÈáçËØï‰ªªÂä°rÁöÑÊâßË°åÔºåÈô§ÈùûÊâßË°åÂô®Ë¢´ÂÖ≥Èó≠ÔºåÂú®ËøôÁßçÊÉÖÂÜµ‰∏ã‰ªªÂä°rÂ∞ÜË¢´‰∏¢ÂºÉ„ÄÇ
         *
         * @param r the runnable task requested to be executed
         * @param e the executor attempting to execute this task
         */</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rejectedExecution</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">,</span> <span class="token class-name">ThreadPoolExecutor</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span><span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                e<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        <strong>‰∏∫‰ªÄ‰πàÊúâ‰ªªÂä°ÊãíÁªùÁöÑÊÉÖÂÜµÂèëÁîüÔºö</strong><br>‚Äã        ËøôÈáåÂÖàÂÅáËÆæ‰∏Ä‰∏™ÂâçÊèê: Á∫øÁ®ãÊ±†Êúâ‰∏Ä‰∏™‰ªªÂä°ÈòüÂàóÔºåÁî®‰∫éÁºìÂ≠òÊâÄÊúâÂæÖÂ§ÑÁêÜÁöÑ‰ªªÂä°ÔºåÊ≠£Âú®Â§ÑÁêÜÁöÑ‰ªªÂä°Â∞Ü‰ªé‰ªªÂä°ÈòüÂàó‰∏≠ÁßªÈô§„ÄÇÂõ†Ê≠§ÔºåÂú®‰ªªÂä°ÈòüÂàóÈïøÂ∫¶ÊúâÈôêÁöÑÊÉÖÂÜµ‰∏ãÔºåÂ∞±‰ºöÂá∫Áé∞Êñ∞‰ªªÂä°ÁöÑÊãíÁªùÂ§ÑÁêÜÈóÆÈ¢òÔºåÈúÄË¶ÅÊúâ‰∏ÄÁßçÁ≠ñÁï•Êù•Â§ÑÁêÜËøôÁßçÂ∫îËØ•Âä†ÂÖ•‰ªªÂä°ÈòüÂàóÂç¥Âõ†‰∏∫ÈòüÂàóÂ∑≤Êª°Êó†Ê≥ïÂä†ÂÖ•ÁöÑÊÉÖÂÜµ„ÄÇ Âè¶Â§ñÔºåÂú®Á∫øÁ®ãÊ±†ÂÖ≥Èó≠ÁöÑÊó∂ÂÄôÔºå‰πüÈúÄË¶ÅÂØπ‰ªªÂä°Âä†ÂÖ•ÈòüÂàóÊìç‰ΩúËøõË°åÈ¢ùÂ§ñÁöÑÂçèË∞ÉÂ§ÑÁêÜ„ÄÇ</p>
<h4 id="4-ThreadPoolExecutorËØ¶Ëß£"><a href="#4-ThreadPoolExecutorËØ¶Ëß£" class="headerlink" title="4.ThreadPoolExecutorËØ¶Ëß£"></a>4.ThreadPoolExecutorËØ¶Ëß£</h4><p>‚Äã        **<code>ThreadPoolExecutor</code><strong>Á±ªÊòØÁ∫øÁ®ãÊ±†‰∏≠ÊúÄÊ†∏ÂøÉÁöÑ‰∏Ä‰∏™Á±ªÔºåÂõ†Ê≠§Â¶ÇÊûúË¶ÅÈÄèÂΩªÂú∞‰∫ÜËß£Java‰∏≠ÁöÑÁ∫øÁ®ãÊ±†ÔºåÈ°ªÂÖà‰∫ÜËß£Ëøô‰∏™Á±ª„ÄÇ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏Ä ‰∏ã</strong><code>ThreadPoolExecutor</code>**Á±ªÁöÑÂÖ∑‰ΩìÂÆûÁé∞Ê∫êÁ†Å„ÄÇ<br>‚Äã        4ÁßçÊûÑÈÄ†ÊñπÊ≥ïÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**‰ΩøÁî®ÁªôÂÆöÁöÑÂàùÂßãÂèÇÊï∞ÂíåÈªòËÆ§Á∫øÁ®ãÂ∑•ÂéÇÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑThreadPoolExecutorÔºåÂπ∂ÊãíÁªùÊâßË°åÂ§ÑÁêÜÁ®ãÂ∫è„ÄÇ‰ΩøÁî®Êüê‰∏™executorÂ∑•ÂéÇÊñπÊ≥ïÂèØËÉΩÊØî‰ΩøÁî®Ëøô‰∏™ÈÄöÁî®ÊûÑÈÄ†ÂáΩÊï∞Êõ¥Êñπ‰æø„ÄÇ

ÂèÇÊï∞:corePoolSize‚ÄîÊ±†‰∏≠‰øùÁïôÁöÑÁ∫øÁ®ãÊï∞ÔºåÂç≥‰ΩøÂÆÉ‰ª¨ÊòØÁ©∫Èó≤ÁöÑÔºåÈô§ÈùûËÆæÁΩÆ‰∫ÜallowCoreThreadTimeOut
	maximumPoolSize‚ÄîÊ±†‰∏≠ÂÖÅËÆ∏ÁöÑÊúÄÂ§ßÁ∫øÁ®ãÊï∞
	keepAliveTime‚ÄîÂΩìÁ∫øÁ®ãÊï∞Â§ß‰∫éÊ†∏ÂøÉÊï∞Êó∂ÔºåËøôÊòØÂ§ö‰ΩôÁöÑÁ©∫Èó≤Á∫øÁ®ãÂú®ÁªàÊ≠¢‰πãÂâçÁ≠âÂæÖÊñ∞‰ªªÂä°ÁöÑÊúÄÂ§ßÊó∂Èó¥„ÄÇ
	unit‚ÄîkeepAliveTimeÂèÇÊï∞ÁöÑÊó∂Èó¥Âçï‰Ωç
	workQueue‚ÄîÁî®‰∫éÂú®‰ªªÂä°ÊâßË°åÂâç‰øùÂ≠ò‰ªªÂä°ÁöÑÈòüÂàó„ÄÇËøô‰∏™ÈòüÂàóÂ∞ÜÂè™‰øùÂ≠òÁî±executeÊñπÊ≥ïÊèê‰∫§ÁöÑRunnable‰ªªÂä°„ÄÇ*/</span>
<span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                              <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                              <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                              <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span> workQueue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">,</span> maximumPoolSize<span class="token punctuation">,</span> keepAliveTime<span class="token punctuation">,</span> unit<span class="token punctuation">,</span> workQueue<span class="token punctuation">,</span>
             <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> defaultHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


<span class="token comment">/**‰ΩøÁî®ÁªôÂÆöÁöÑÂàùÂßãÂèÇÊï∞ÂíåÈªòËÆ§ÊãíÁªùÁöÑÊâßË°åÂ§ÑÁêÜÁ®ãÂ∫èÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑThreadPoolExecutor„ÄÇ

ÂèÇÊï∞:corePoolSize‚ÄîÊ±†‰∏≠‰øùÁïôÁöÑÁ∫øÁ®ãÊï∞ÔºåÂç≥‰ΩøÂÆÉ‰ª¨ÊòØÁ©∫Èó≤ÁöÑÔºåÈô§ÈùûËÆæÁΩÆ‰∫ÜallowCoreThreadTimeOut
	maximumPoolSize‚ÄîÊ±†‰∏≠ÂÖÅËÆ∏ÁöÑÊúÄÂ§ßÁ∫øÁ®ãÊï∞
	keepAliveTime‚ÄîÂΩìÁ∫øÁ®ãÊï∞Â§ß‰∫éÊ†∏ÂøÉÊï∞Êó∂ÔºåËøôÊòØÂ§ö‰ΩôÁöÑÁ©∫Èó≤Á∫øÁ®ãÂú®ÁªàÊ≠¢‰πãÂâçÁ≠âÂæÖÊñ∞‰ªªÂä°ÁöÑÊúÄÂ§ßÊó∂Èó¥„ÄÇ
	unit‚ÄîkeepAliveTimeÂèÇÊï∞ÁöÑÊó∂Èó¥Âçï‰Ωç
	workQueue‚ÄîÁî®‰∫éÂú®‰ªªÂä°ÊâßË°åÂâç‰øùÂ≠ò‰ªªÂä°ÁöÑÈòüÂàó„ÄÇËøô‰∏™ÈòüÂàóÂ∞ÜÂè™‰øùÂ≠òÁî±executeÊñπÊ≥ïÊèê‰∫§ÁöÑRunnable‰ªªÂä°„ÄÇ
	threadFactory‚ÄîÊâßË°åÁ®ãÂ∫èÂàõÂª∫Êñ∞Á∫øÁ®ãÊó∂‰ΩøÁî®ÁöÑÂ∑•ÂéÇ„ÄÇ*/</span>
<span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                              <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                              <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                              <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span> workQueue<span class="token punctuation">,</span>
                              <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">,</span> maximumPoolSize<span class="token punctuation">,</span> keepAliveTime<span class="token punctuation">,</span> unit<span class="token punctuation">,</span> workQueue<span class="token punctuation">,</span>
             threadFactory<span class="token punctuation">,</span> defaultHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token comment">/**‰ΩøÁî®ÁªôÂÆöÁöÑÂàùÂßãÂèÇÊï∞ÂíåÈªòËÆ§Á∫øÁ®ãÂ∑•ÂéÇÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑThreadPoolExecutor„ÄÇ

ÂèÇÊï∞:corePoolSize‚ÄîÊ±†‰∏≠‰øùÁïôÁöÑÁ∫øÁ®ãÊï∞ÔºåÂç≥‰ΩøÂÆÉ‰ª¨ÊòØÁ©∫Èó≤ÁöÑÔºåÈô§ÈùûËÆæÁΩÆ‰∫ÜallowCoreThreadTimeOut
	maximumPoolSize‚ÄîÊ±†‰∏≠ÂÖÅËÆ∏ÁöÑÊúÄÂ§ßÁ∫øÁ®ãÊï∞
	keepAliveTime‚ÄîÂΩìÁ∫øÁ®ãÊï∞Â§ß‰∫éÊ†∏ÂøÉÊï∞Êó∂ÔºåËøôÊòØÂ§ö‰ΩôÁöÑÁ©∫Èó≤Á∫øÁ®ãÂú®ÁªàÊ≠¢‰πãÂâçÁ≠âÂæÖÊñ∞‰ªªÂä°ÁöÑÊúÄÂ§ßÊó∂Èó¥„ÄÇ
	unit‚ÄîkeepAliveTimeÂèÇÊï∞ÁöÑÊó∂Èó¥Âçï‰Ωç
	workQueue‚ÄîÁî®‰∫éÂú®‰ªªÂä°ÊâßË°åÂâç‰øùÂ≠ò‰ªªÂä°ÁöÑÈòüÂàó„ÄÇËøô‰∏™ÈòüÂàóÂ∞ÜÂè™‰øùÂ≠òÁî±executeÊñπÊ≥ïÊèê‰∫§ÁöÑRunnable‰ªªÂä°„ÄÇ
	handler‚ÄîÂΩìÊâßË°åË¢´ÈòªÂ°ûÊó∂‰ΩøÁî®ÁöÑÂ§ÑÁêÜÁ®ãÂ∫èÔºåÂõ†‰∏∫Á∫øÁ®ãËæπÁïåÂíåÈòüÂàóÂÆπÈáèÂ∑≤ÁªèËææÂà∞
*/</span>
<span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                              <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                              <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                              <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span> workQueue<span class="token punctuation">,</span>
                              <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">,</span> maximumPoolSize<span class="token punctuation">,</span> keepAliveTime<span class="token punctuation">,</span> unit<span class="token punctuation">,</span> workQueue<span class="token punctuation">,</span>
             <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


<span class="token comment">/**‰ΩøÁî®ÁªôÂÆöÁöÑÂàùÂßãÂèÇÊï∞ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑThreadPoolExecutor„ÄÇ

ÂèÇÊï∞:corePoolSize‚ÄîÊ±†‰∏≠‰øùÁïôÁöÑÁ∫øÁ®ãÊï∞ÔºåÂç≥‰ΩøÂÆÉ‰ª¨ÊòØÁ©∫Èó≤ÁöÑÔºåÈô§ÈùûËÆæÁΩÆ‰∫ÜallowCoreThreadTimeOut
	maximumPoolSize‚ÄîÊ±†‰∏≠ÂÖÅËÆ∏ÁöÑÊúÄÂ§ßÁ∫øÁ®ãÊï∞
	keepAliveTime‚ÄîÂΩìÁ∫øÁ®ãÊï∞Â§ß‰∫éÊ†∏ÂøÉÊï∞Êó∂ÔºåËøôÊòØÂ§ö‰ΩôÁöÑÁ©∫Èó≤Á∫øÁ®ãÂú®ÁªàÊ≠¢‰πãÂâçÁ≠âÂæÖÊñ∞‰ªªÂä°ÁöÑÊúÄÂ§ßÊó∂Èó¥„ÄÇ
	unit‚ÄîkeepAliveTimeÂèÇÊï∞ÁöÑÊó∂Èó¥Âçï‰Ωç
	workQueue‚ÄîÁî®‰∫éÂú®‰ªªÂä°ÊâßË°åÂâç‰øùÂ≠ò‰ªªÂä°ÁöÑÈòüÂàó„ÄÇËøô‰∏™ÈòüÂàóÂ∞ÜÂè™‰øùÂ≠òÁî±executeÊñπÊ≥ïÊèê‰∫§ÁöÑRunnable‰ªªÂä°„ÄÇ
	threadFactory‚ÄîÊâßË°åÁ®ãÂ∫èÂàõÂª∫Êñ∞Á∫øÁ®ãÊó∂‰ΩøÁî®ÁöÑÂ∑•ÂéÇ„ÄÇ
	handler‚ÄîÂΩìÊâßË°åË¢´ÈòªÂ°ûÊó∂‰ΩøÁî®ÁöÑÂ§ÑÁêÜÁ®ãÂ∫èÔºåÂõ†‰∏∫Á∫øÁ®ãËæπÁïåÂíåÈòüÂàóÂÆπÈáèÂ∑≤ÁªèËææÂà∞*/</span>
<span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                              <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                              <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                              <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span> workQueue<span class="token punctuation">,</span>
                              <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span>
                              <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>corePoolSize <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span>
            maximumPoolSize <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span>
            maximumPoolSize <span class="token operator">&lt;</span> corePoolSize <span class="token operator">||</span>
            keepAliveTime <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>workQueue <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> threadFactory <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>acc <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span>
                <span class="token keyword">null</span> <span class="token operator">:</span>
                <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>corePoolSize <span class="token operator">=</span> corePoolSize<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maximumPoolSize <span class="token operator">=</span> maximumPoolSize<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>workQueue <span class="token operator">=</span> workQueue<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>keepAliveTime <span class="token operator">=</span> unit<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span>keepAliveTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>threadFactory <span class="token operator">=</span> threadFactory<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handler <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÈÄöËøáËßÇÂØüÊØè‰∏™ÊûÑÈÄ†Âô®ÁöÑÊ∫êÁ†ÅÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÔºåÂèëÁé∞ÂâçÈù¢‰∏â‰∏™ÊûÑÈÄ†Âô®ÈÉΩÊòØË∞ÉÁî®Á¨¨4‰∏™ÊûÑÈÄ†Âô®ËøõË°åÁöÑÂàùÂßãÂåñÂ∑•‰Ωú„ÄÇ‰πüÂèØ‰ª•ËØ¥ËøôÊòØ‰∏Ä‰∏™ÁúüÊ≠£ÁöÑÊûÑÈÄ†ÊñπÊ≥ïÔºåÊàë‰ª¨ËØ¶ÁªÜËØ¥Êòé‰∏Ä‰∏ãÈáåÈù¢ÁöÑÂèÇÊï∞:</p>
<ol>
<li>**<code>int corePoolSize</code><strong>ÔºöÊ†∏ÂøÉÊ±†ÁöÑÂ§ßÂ∞èÔºåËøô‰∏™ÂèÇÊï∞Ë∑üÂêéÈù¢ËÆ≤Ëø∞ÁöÑÁ∫øÁ®ãÊ±†ÁöÑÂÆûÁé∞ÂéüÁêÜÊúâÈùûÂ∏∏Â§ßÁöÑÂÖ≥Á≥ª„ÄÇÂú®ÂàõÂª∫‰∫ÜÁ∫øÁ®ãÊ±†ÂêéÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÁ∫øÁ®ãÊ±†‰∏≠Âπ∂Ê≤°Êúâ‰ªª‰ΩïÁ∫øÁ®ãÔºåËÄåÊòØÁ≠âÂæÖÊúâ‰ªªÂä°Âà∞Êù•ÊâçÂàõÂª∫Á∫øÁ®ãÂéªÊâßË°å‰ªªÂä°ÔºåÈô§ÈùûË∞ÉÁî®‰∫Ü<code>pestartAllCoreThreads()</code>ÊàñËÄÖ<code>pestartCoreThread()</code>ÊñπÊ≥ïÔºå‰ªéËøô2‰∏™ÊñπÊ≥ïÁöÑÂêçÂ≠óÂ∞±ÂèØ‰ª•ÁúãÂá∫ÔºåÊòØÈ¢ÑÂàõÂª∫Á∫øÁ®ãÁöÑÊÑèÊÄùÔºåÂç≥Âú®Ê≤°Êúâ‰ªªÂä°Âà∞Êù•‰πãÂâçÂ∞±ÂàõÂª∫</strong><code>corePoolSize</code><strong>‰∏™Á∫øÁ®ãÊàñËÄÖ‰∏Ä‰∏™Á∫øÁ®ã„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂú®ÂàõÂª∫‰∫ÜÁ∫øÁ®ãÊ±†ÂêéÔºåÁ∫øÁ®ãÊ±†‰∏≠ÁöÑÁ∫øÁ®ãÊï∞‰∏∫0ÔºåÂΩìÊúâ‰ªªÂä°Êù•‰πãÂêéÔºåÂ∞±‰ºöÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ãÂéªÊâßË°å‰ªªÂä°Ôºå ÂΩìÁ∫øÁ®ãÊ±†‰∏≠ÁöÑÁ∫øÁ®ãÊï∞ÁõÆËææÂà∞</strong><code>corePolsise</code>**ÂêéÔºåÂ∞±‰ºöÊääÂà∞ËææÁöÑ‰ªªÂä°ÊîæÂà∞ÁºìÂ≠òÈòüÂàóÂΩì‰∏≠„ÄÇ</li>
<li><strong><code>int maximumolsize</code><strong>ÔºöÁ∫øÁ®ãÊ±†ÊúÄÂ§ßÁ∫øÁ®ãÊï∞ÔºåËøô‰∏™ÂèÇÊï∞‰πüÊòØ‰∏Ä‰∏™ÈùûÂ∏∏ÈáçË¶ÅÁöÑÂèÇÊï∞ÔºåÂÆÉË°®Á§∫Âú®Á∫øÁ®ãÊ±†‰∏≠ÊúÄÂ§öËÉΩÂàõÂª∫Â§öÂ∞ë‰∏™Á∫øÁ®ãÔºõÂú®</strong><code>corePoolSize</code><strong>Âíå</strong><code>maximumPoolSize</code><strong>ÁöÑÁ∫øÁ®ãÊï∞</strong>‰ºöË¢´Ëá™Âä®ÈáäÊîæ</strong>„ÄÇËÄåÂ∞è‰∫é**<code>corePoolSize</code>**ÁöÑ‰∏ç‰ºö„ÄÇ</li>
<li><strong><code>long kepAliveTime</code><strong>Ë°®Á§∫Á∫øÁ®ãÊ≤°Êúâ‰ªªÂä°ÊâßË°åÊó∂ÊúÄÂ§ö‰øùÊåÅÂ§ö‰πÖÊó∂Èó¥‰ºöÁªàÊ≠¢„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂè™ÊúâÂΩìÁ∫øÁ®ãÊ±†‰∏≠ÁöÑÁ∫øÁ®ãÊï∞Â§ß‰∫é</strong><code>corePoolSize</code><strong>Êó∂Ôºå</strong><code>keepaliveTime </code><strong>Êâç‰ºöËµ∑‰ΩúÁî®ÔºåÁõ¥Âà∞Á∫øÁ®ãÊ±†‰∏≠ÁöÑÁ∫øÁ®ãÊï∞‰∏çÂ§ß‰∫é</strong><code>corePoolSize</code><strong>Âç≥ÂΩìÁ∫øÁ®ãÊ±†‰∏≠ÁöÑÁ∫øÁ®ãÊï∞Â§ß‰∫é</strong><code>corePoolSize</code><strong>Êó∂ÔºåÂ¶ÇÊûú‰∏Ä‰∏™Á∫øÁ®ãÁ©∫Èó≤ÁöÑÊó∂Èó¥ËææÂà∞</strong><code>keepAliveTime</code><strong>ÔºåÂàô‰ºöÁªàÊ≠¢ÔºåÁõ¥Âà∞Á∫øÁ®ãÊ±†‰∏≠ÁöÑÁ∫øÁ®ãÊï∞‰∏çË∂ÖËøá</strong><code>corePoolSize</code></strong> Ôºå‰ΩÜÊòØÂ¶ÇÊûúË∞ÉÁî®‰∫Ü<br><strong><code>allowCoreThreadTimeOut(boolean)</code><strong>ÊñπÊ≥ïÔºåÂú®Á∫øÁ®ãÊ±†‰∏≠ÁöÑÁ∫øÁ®ãÊï∞‰∏çÂ§ß‰∫é</strong><code>corePoolSize</code></strong> Êó∂Ôºå<br><strong><code>keepaliveTime </code><strong>ÂèÇÊï∞‰πü‰ºöËµ∑‰ΩúÁî®Ôºå</strong>Áõ¥Âà∞Á∫øÁ®ãÊ±†‰∏≠ÁöÑÁ∫øÁ®ãÊï∞‰∏∫0</strong>„ÄÇ</li>
<li>**<code>TimeUnit unit</code><strong>ÔºöÂèÇÊï∞</strong><code>keepAliveTime</code>**ÁöÑÊó∂Èó¥Âçï‰ΩçÔºå‰∏Ä‰∏™JDKÈáåÈù¢ÁöÑÊó∂Èó¥Âçï‰ΩçÊûö‰∏æÁ±ª„ÄÇ</li>
<li>**<code>BlockingQueue workQueue</code><strong>Ôºö‰∏Ä‰∏™ÈòªÂ°ûÈòüÂàóÔºåÁî®Êù•Â≠òÂÇ®Á≠âÂæÖÊâßË°åÁöÑ‰ªªÂä°ÔºåËøô‰∏™ÂèÇÊï∞ÁöÑÈÄâÊã©‰πüÂæàÈáçË¶ÅÔºå‰ºöÂØπÁ∫øÁ®ãÊ±†ÁöÑËøêË°åËøáÁ®ã‰∫ßÁîüÈáçÂ§ßÂΩ±ÂìçÔºå‰∏ÄËà¨Êù•ËØ¥Ôºå ËøôÈáåÁöÑÈòªÂ°ûÈòüÂàóÂ∞±ÊòØÊàë‰ª¨ÂâçÈù¢ËÆ≤ËøáÁöÑÂá†ÁßçÈÄâÊã©</strong>(ArrayBlockingQueue;LinkedBlockingQueue;SynchronousQueue;)**„ÄÇ</li>
<li>**<code>ThreadFactory threadFactory</code><strong>ÔºöÁ∫øÁ®ãÂ∑•ÂéÇÔºå‰∏ªË¶ÅÁî®Êù•ÂàõÂª∫Á∫øÁ®ãÔºöÂèØ‰ª•ÊòØ‰∏Ä‰∏™Ëá™ÂÆö‰πâÁöÑÁ∫øÁ®ãÂ∑•ÂéÇÔºåÈªòËÆ§Â∞±ÊòØÊàë‰ª¨ÂâçÈù¢ËÆ≤ÁöÑ</strong><code>Executors. defaultThreadFactory()</code>**„ÄÇÁî®Êù•Âú®Á∫øÁ®ãÊ±†ÈáåÈù¢ÂàõÂª∫Á∫øÁ®ã„ÄÇ</li>
<li><strong><code>RejectedExecutionHandler handler</code><strong>ÔºöË°®Á§∫ÂΩìÊãíÁªùÂ§ÑÁêÜ‰ªªÂä°Êó∂ÁöÑÁ≠ñÁï•Ôºå‰πüÊòØÂèØ‰ª•Ëá™ÂÆö‰πâÁöÑÔºåÈªòËÆ§‰πüÊòØÊàë‰ª¨ÂâçÈù¢ËØ¥ËøáÁöÑ</strong>4</strong>ÁßçÂèñÂÄºÔºö</li>
</ol>
<ul>
<li><strong><code>ThreadPoolExecutor.AbortPolicy (ÈªòËÆ§ÁöÑ)</code></strong></li>
<li><strong><code>ThreadPoolExecutor DiscardPolicy</code></strong></li>
<li><strong><code>ThreadPoolExecutor.DiscardOldestPolicy</code></strong></li>
<li><strong><code>ThreadPoolExecutor.CallerRunsPolicy</code></strong><br>    ÊâÄ‰ª•ÊÉ≥Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†Â∞±‰ªé‰ª•‰∏äÂá†‰∏™ÂèÇÊï∞ÂÖ•Êâã„ÄÇÊé•‰∏ãÊù•Êàë‰ª¨Áúã**<code>ThreadPoolExecutor</code>**ÈáåÈù¢ÁöÑ‰∏Ä‰∫õÂÖ∑‰ΩìÊ∫êÁ†ÅÔºåÁ®çÂæÆÁêÜËß£‰∏Ä‰∏ãÈáåÈù¢ÁöÑÂÆûÁé∞ÂéüÁêÜÔºö</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * The default rejected execution handler
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">RejectedExecutionHandler</span> defaultHandler <span class="token operator">=</span>
    <span class="token keyword">new</span> <span class="token class-name">AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span> workQueue<span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> mainLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Set containing all worker threads in pool. Accessed only when
 * holding mainLock.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Worker</span><span class="token punctuation">></span></span> workers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Worker</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">;</span>

<span class="token comment">/**
 * If false (default), core threads stay alive even when idle.
 * If true, core threads use keepAliveTime to time out waiting
 * for work.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> allowCoreThreadTimeOut<span class="token punctuation">;</span>


<span class="token comment">/**
 * Core pool size is the minimum number of workers to keep alive
 * (and not allow to time out etc) unless allowCoreThreadTimeOut
 * is set, in which case the minimum is zero.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> corePoolSize<span class="token punctuation">;</span>

<span class="token comment">/**
 * Maximum pool size. Note that the actual maximum is internally
 * bounded by CAPACITY.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">;</span>

<span class="token comment">/**
 * Handler called when saturated or shutdown in execute.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÁªìÂêàÊàë‰ª¨‰ª•ÂâçËÆ≤ÁöÑÂéüÁêÜÊàëÁõ∏‰ø°ÈÄöËøá‰ª•‰∏äÁöÑÂá†‰∏™ÂèÇÊï∞Â§ßÊ¶ÇÂ∞±ËÉΩÁåúÁöÑÂá∫Êù•ÈáåÈù¢ÊòØÊÄé‰πàÂÆûÁé∞ÁöÑ‰∫Ü„ÄÇ</p>
<h4 id="5-Ëá™ÂÆö‰πâÂÆûÁé∞‰∏Ä‰∏™ÁÆÄÂçïÁöÑWebËØ∑Ê±ÇÁ∫øÁ®ãÊ±†"><a href="#5-Ëá™ÂÆö‰πâÂÆûÁé∞‰∏Ä‰∏™ÁÆÄÂçïÁöÑWebËØ∑Ê±ÇÁ∫øÁ®ãÊ±†" class="headerlink" title="5.Ëá™ÂÆö‰πâÂÆûÁé∞‰∏Ä‰∏™ÁÆÄÂçïÁöÑWebËØ∑Ê±ÇÁ∫øÁ®ãÊ±†"></a>5.Ëá™ÂÆö‰πâÂÆûÁé∞‰∏Ä‰∏™ÁÆÄÂçïÁöÑWebËØ∑Ê±ÇÁ∫øÁ®ãÊ±†</h4><p>Êàë‰ª¨Êù•Ëá™ÂÆö‰πâÂÆûÁé∞‰∏Ä‰∏™ÁÆÄÂçïÁöÑWebËØ∑Ê±ÇÁ∫øÁ®ãÊ±†„ÄÇÊ®°‰ªøWebÊúçÂä°ÁöÑÈúÄÊ±ÇÂú∫ÊôØËØ¥ÊòéÂ¶Ç‰∏ã:</p>
<ul>
<li><strong>ÊúçÂä°Âô®ÂèØÂÆπÁ∫≥ÁöÑÊúÄÂ∞èËØ∑Ê±ÇÊï∞ÊòØÂ§öÂ∞ë„ÄÇ</strong></li>
<li><strong>ÂèØ‰ª•Âä®ÊÄÅÊâ©ÂÖÖÁöÑËØ∑Ê±ÇÊï∞Â§ßÂ∞èÊòØÂ§öÂ∞ë„ÄÇ</strong></li>
<li><strong>Â§ö‰πÖÂõûÊî∂Â§ö‰ΩôÁ∫øÁ®ãÊï∞Âç≥ËØ∑Ê±ÇÊï∞„ÄÇ</strong></li>
<li><strong>Áî®Êà∑ËÆøÈóÆÈáèÂ§ß‰∫ÜÊÄé‰πàÂ§ÑÁêÜ„ÄÇ</strong></li>
<li><strong>Á∫øÁ®ãÈòüÂàóÊú∫Âà∂ÈááÂèñÊúâ‰ºòÂÖàÁ∫ßÁöÑÊéíÈòüÁöÑÊâßË°åÊú∫Âà∂„ÄÇ</strong></li>
</ul>
<p>Ê†πÊçÆ‰∏äÈù¢ÂÆö‰πâÁöÑÂú∫ÊôØÔºåÊàë‰ª¨Êù•ÁúãÁúãËøô‰∏™Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†ËØ•Â¶Ç‰ΩïÂÜôÔºü‰ª£Á†ÅÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//Âà©Áî®ÈªòËÆ§Á∫øÁ®ãÂ∑•ÂéÇÂíåPriorityBlockingQueueÈòüÂàóÊú∫Âà∂„ÄÅÂΩìÁÑ∂‰∫ÜÔºåÊàë‰ª¨‰πüÂèØ‰ª•ÂàÜÂà´ÂÆûÁé∞Â∑•ÂéÇÁ±ªÂíåÁªßÊâøqueueËøõË°åËá™ÂÆöÂíåÊâ©Â±ï</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newMyWebThreadPool</span><span class="token punctuation">(</span><span class="token keyword">int</span> minSpareThreads<span class="token punctuation">,</span> <span class="token keyword">int</span> maxThreads<span class="token punctuation">,</span> <span class="token keyword">int</span> maxIdleTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>minSpareThreads<span class="token punctuation">,</span> maxThreads<span class="token punctuation">,</span> maxIdleTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÂΩìÁÑ∂‰∫ÜÊàë‰ª¨ÂèØËÉΩÂè™ÊòØÁÆÄÂçïÂú∞ÂÅö‰∫Ü‰∏Ä‰∫õËá™ÂÆö ‰πâÁöÑÂÆûÁé∞ÔºåÂ§ßÂÆ∂ÂèØ‰ª•‰ªîÁªÜ‰Ωì‰ºö‰∏Ä‰∏ãÔºå ÂêéÈù¢Êàë‰ª¨‰ºöËØ¶ÁªÜËØ¥Êòé‰∏Ä‰∏ãÁúüÊ≠£ÁöÑTomcatÈáåÈù¢ÁöÑÁ∫øÁ®ãÊ±†ÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑ„ÄÇ</p>
<h3 id="Á∫øÁ®ãÊ±†Âú®Â∑•‰Ωú‰∏≠ÁöÑÈîôËØØ‰ΩøÁî®"><a href="#Á∫øÁ®ãÊ±†Âú®Â∑•‰Ωú‰∏≠ÁöÑÈîôËØØ‰ΩøÁî®" class="headerlink" title="Á∫øÁ®ãÊ±†Âú®Â∑•‰Ωú‰∏≠ÁöÑÈîôËØØ‰ΩøÁî®"></a>Á∫øÁ®ãÊ±†Âú®Â∑•‰Ωú‰∏≠ÁöÑÈîôËØØ‰ΩøÁî®</h3><p>(1) <strong>ÂàÜ‰∏çÊ∏ÖÊ•öÁ∫øÁ®ãÊ±†ÊòØÂçï‰æãËøòÊòØÂ§öÂØπË±°</strong>„ÄÇÂÖàÈóÆÂêÑ‰ΩçÂêåÂ≠¶‰∏Ä‰∏™ÈóÆÈ¢òÔºå Á∫øÁ®ãÊ±†Âú®‰ΩøÁî®ÁöÑËøáÁ®ã‰∏≠ÊòØÂçï‰æãÁöÑËøòÊòØÂ§ö‰æãÁöÑ?Á∫øÁ®ãÊ±†‰∏ÄÂÆöË¶ÅÂú®ÂêàÁêÜÁöÑÂçï‰æãÊ®°Âºè‰∏ãÊâçÊúâÊïàÔºåÂ∑•‰Ωú‰∏≠ÊàëÂèëÁé∞Êúâ‰∫õÂêåÂ≠¶Â∞ÜÁ∫øÁ®ãÊ±†ÁöÑÂàõÂª∫ÊñπÊ≥ïÊîæÂú®services ÊñπÊ≥ïÈáåÈù¢ÂéªÂàõÂª∫Á∫øÁ®ãÊ±†ÔºåËøôÊòØ‰∏çÂèØ‰ª•ÁöÑÔºåÂõ†‰∏∫ÊØèÂΩìËøô‰∏™ÊñπÊ≥ïË¢´Ë∞ÉÁî®ÁöÑÊó∂ÂÄô‰∏çÊòØÂàõÂª∫Â§öÂ∞ë‰∏™Á∫øÁ®ãÁöÑÈóÆÈ¢ò‰∫ÜÔºåËÄåÊòØÂàõÂª∫Âá∫Êù•‰∫Ü‰∏ÄÂ§ßÂ†ÜÁ∫øÁ®ãÊ±†!<br>(2) <strong>Á∫øÁ®ãÊ±†Êï∞ÈáèËÆæÁΩÆÂæàÂ§ßÔºåËØ∑Ê±ÇËøáËΩΩ</strong>„ÄÇËøôÊ†∑Â∞±ÂèëÊå•‰∏ç‰∫ÜÁ∫øÁ®ãÊ±†ÁöÑÂè¶Â§ñ‰∏Ä‰∏™‰ºòÁÇπ‰∫Ü„ÄÇ‰ªÖ‰ªÖÊòØËØ∑Ê±ÇÂ∞±ÂéãÂûÆ‰∫ÜÊúçÂä°Âô®ÔºåËøôÁßçÊÉÖÂÜµÊòØÂèØËÉΩÁöÑ„ÄÇÂú®ËøôÁßçÊÉÖÂΩ¢‰∏ãÔºåÊàë‰ª¨ÂèØËÉΩ‰∏çÊÉ≥Â∞ÜÊØè‰∏™Âà∞Êù•ÁöÑËØ∑Ê±ÇÈÉΩÂà∞Êàë‰ª¨ÁöÑÂ∑•‰ΩúÈòüÂàó‰∏≠ÊéíÈòüÔºåÂõ†‰∏∫ÊéíÂú®ÈòüÂàó‰∏≠Á≠âÂæÖÊâßË°åÁöÑ‰ªªÂä°ÂèØËÉΩ‰ºöÊ∂àËÄóÂ§™Â§öÁöÑÁ≥ªÁªüËµÑÊ∫êÂπ∂ÂºïËµ∑ËµÑÊ∫êÁº∫‰πè„ÄÇÂú®ËøôÁßçÊÉÖÂΩ¢‰∏ãÂÜ≥ÂÆöÂ¶Ç‰ΩïÂÅöÂèñÂÜ≥‰∫é‰Ω†Ëá™Â∑±ÔºöÂú®Êüê‰∫õÊÉÖÂÜµ‰∏ãÔºå‰Ω†ÂèØ‰ª•ÁÆÄÂçïÂú∞ÊäõÂºÉËØ∑Ê±ÇÔºå‰æùÈù†Êõ¥È´òÁ∫ßÂà´ÁöÑÂçèËÆÆÁ®çÂêéÈáçËØïËØ∑Ê±ÇÔºå‰Ω†‰πüÂèØ‰ª•Áî®‰∏Ä‰∏™ÊåáÂá∫ÊúçÂä°Âô®ÊöÇÊó∂ÂæàÂøôÁöÑÂìçÂ∫îÊù•ÊãíÁªùËØ∑Ê±Ç„ÄÇ<br>(3) <strong>Ê≥®ÊÑèÊ≠ªÈïúÈóÆÈ¢ò„ÄÇ‰ªª‰ΩïÂ§öÁ∫øÁ®ãÂ∫îÁî®Á®ãÂ∫èÈÉΩÊúâÊ≠ªÈîÅÈ£éÈô©</strong>„ÄÇÂΩìÁªÑËøõÁ®ãÊàñÁ∫øÁ®ã‰∏≠ÁöÑÊØè‰∏Ä‰∏™ÈÉΩÂú®Á≠âÂæÖ‰∏Ä‰∏™Âè™ÊúâËØ•ÁªÑ‰∏≠Âè¶‰∏Ä‰∏™ËøõÁ®ãÊâçËÉΩÂºïËµ∑ÁöÑ‰∫ã‰ª∂Êó∂ÔºåÊàë‰ª¨Â∞±ËØ¥ËøôÁªÑËøõÁ®ãÊàñÁ∫øÁ®ãÊ≠ªÈîÅ‰∫Ü„ÄÇÊ≠ªÈîÅÁöÑÊúÄÁÆÄÂçïÊÉÖÂΩ¢ÊòØÔºöÁ∫øÁ®ãAÊåÅÊúâÂØπË±°XÁöÑÁã¨Âç†ÈîÅÔºåÂπ∂‰∏îÂú®Á≠âÂæÖÂØπË±°YÁöÑÈîÅÔºåËÄåÁ∫øÁ®ãBÊåÅÊúâÂØπË±°YÁöÑÁã¨Âç†ÈîÅÔºåÂç¥Âú®Á≠âÂæÖÂØπË±°XÁöÑÈîÅ„ÄÇÈô§ÈùûÊúâÊüêÁßçÊñπÊ≥ïÊù•ÊâìÁ†¥ÂØπÈîÅÁöÑÁ≠âÂæÖ(Java ÈîÅÂÆö‰∏çÊîØÊåÅËøôÁßçÊñπÊ≥ï)ÔºåÂê¶ÂàôÊ≠ªÈîÅÁöÑÁ∫øÁ®ãÂ∞ÜÊ∞∏ËøúÁ≠â‰∏ãÂéª„ÄÇ</p>
<h3 id="Executors-Á∫øÁ®ãÊ±†ÂàõÂª∫ÊÄªÁªì"><a href="#Executors-Á∫øÁ®ãÊ±†ÂàõÂª∫ÊÄªÁªì" class="headerlink" title="Executors Á∫øÁ®ãÊ±†ÂàõÂª∫ÊÄªÁªì"></a><strong>Executors Á∫øÁ®ãÊ±†ÂàõÂª∫ÊÄªÁªì</strong></h3><p><strong>1„ÄÅExecutors.newCachedThreadPool();</strong><br><strong>ËØ¥Êòé:</strong></p>
<p>„ÄÄ„ÄÄ ÂàõÂª∫ÁöÑÁ∫øÁ®ãÊ±†Ê†∏ÂøÉÁ∫øÁ®ã0 Ôºå ÊúÄÂ§ßÁ∫øÁ®ãÊòØInteger.MaxValue„ÄÇ Á∫øÁ®ãÁ©∫Èó≤Â≠òÊ¥ªÊó∂Èó¥1ÂàÜÈíü„ÄÇ ÈªòËÆ§ÂºÇÂ∏∏ÊãíÁªùÁ≠ñÁï•Ôºå‰ΩøÁî®SynchronousQueueÈòü</p>
<p><strong>ÁâπÁÇπ:</strong></p>
<p>„ÄÄ„ÄÄÊØèÊ¨°Ê∑ªÂä†‰ªªÂä°Â¶ÇÊûúÊ≤°ÊúâÁ©∫Èó≤Á∫øÁ®ãÂ∞±‰ºöÊñ∞Âª∫‰∏Ä‰∏™Á∫øÁ®ãÂéªÊâßË°å„ÄÇ<br>„ÄÄ„ÄÄSynchronousQueueÊòØÈòªÂ°ûÈòüÂàóÔºåÂä†ÂÖ•‰ªªÂä°ÁöÑÁ∫øÁ®ã‰ºöÈòªÂ°û‰ΩèÔºåÁõ¥Âà∞ÂÖ∂ÂÆÉÁ∫øÁ®ã‰ªé‰∏≠ÂèñËµ∞‰ªªÂä°Êâç‰ºöÁªìÊùüÈòªÂ°û<br>„ÄÄ„ÄÄÁ∫øÁ®ãÂàõÂª∫‰∏äÈôêËøë‰πéÊó†Èôê</p>
<p><strong>ÈÄÇÁî®Âú∫ÊôØÔºö</strong></p>
<p>„ÄÄ„ÄÄÊâÄ‰ª•ÂÆÉÈÄÇÁî®‰∫é‰ªªÂä°Âä†ÂÖ•ÊØîËæÉÁ®≥ÂΩì‰∏îÂä†ÂÖ•Èó¥ÈöîÁü≠ÁöÑÂú∫ÊôØ</p>
<p><strong>ÂÆûÁé∞Ôºö</strong></p>
<p>„ÄÄ„ÄÄnew ThreadPoolExecutor(0,Integer.MAX_VALUE,60L,TimeUnit.SECONDS,new SynchronousQueue());</p>
<p><strong>Áº∫ÁÇπÔºö</strong></p>
<p>„ÄÄ„ÄÄ‰ªªÂä°ÈòüÂàóÊòØSynchronousQueueÔºåÁ∫øÁ®ãÊ±†ÂØπ‰ªªÂä°Êù•ÁùÄ‰∏çÊãíÔºåÁ∫øÁ®ã‰∏çÂ§üÁî®Â∞±ÂàõÂª∫‰∏Ä‰∏™Á∫øÁ®ã„ÄÇ</p>
<p>„ÄÄ„ÄÄÂ¶ÇÊûúÂêå‰∏ÄÊó∂ÂàªÂ∫îÁî®ÁöÑÊù•‰∫ÜÂ§ßÈáèÁöÑ‰ªªÂä°Ôºå Ëøô‰∏™Á∫øÁ®ãÊ±†ÂæàÂÆπÊòìÂ∞±ÂàõÂª∫ËøáÂ§öÁöÑÁ∫øÁ®ã, ÂÆπÊòìÂØºËá¥Â∫îÁî®Âç°È°øÊàñËÄÖÁõ¥Êé•OOM</p>
<p><strong>2„ÄÅExecutors.newFixedThreadPool(int);</strong><br><strong>ËØ¥Êòé:</strong> </p>
<p>„ÄÄ„ÄÄÊ†∏ÂøÉÁ∫øÁ®ãÂíåÊúÄÂ§ßÁ∫øÁ®ãÊï∞ÊòØ‰Ω†‰º†ÂÖ•ÁöÑÂèÇÊï∞„ÄÇ ÂÖ∂‰ªñÂèÇÊï∞Âíå Executors.newSingleThreadExecutor‰∏ÄÊ†∑</p>
<p><strong>ÂÆûÁé∞Ôºö</strong></p>
<p>„ÄÄ„ÄÄnew ThreadPoolExecutor(nThreads, nThreads,0L,TimeUnit.MILLISECONDS,new LinkedBlockingQueue());</p>
<p><strong>Áº∫ÁÇπÔºö</strong></p>
<p>„ÄÄ„ÄÄËøô‰∏™ÂÆöÊ≠ª‰∫ÜÁ∫øÁ®ãÊï∞ÈáèÔºå ÊâÄ‰ª•Á∫øÁ®ãÊï∞ÈáèÊòØ‰∏ç‰ºöË∂ÖÂá∫ÁöÑÔºå‰ΩÜÊòØÂÆÉÁöÑ‰ªªÂä°ÈòüÂàóÊòØÊó†ÁïåÁöÑLinkedBlockingQueue</p>
<p>„ÄÄ„ÄÄÂä†ËøõÊù•ÁöÑ‰ªªÂä°Â§ÑÁêÜ‰∏çËøáÊù•Â∞±‰ºöÂ≠òÂÖ•‰ªªÂä°ÈòüÂàó‰∏≠Ôºå Âπ∂‰∏îÊó†ÈôêÂà∂ÁöÑÂ≠òÂÖ•ÈòüÂàóÔºåÂæàÂÆπÊòìÂØºËá¥OOM„ÄÇ</p>
<p><strong>3„ÄÅExecutors.newSingleThreadExecutor();</strong><br><strong>ËØ¥Êòé:</strong></p>
<p>„ÄÄ„ÄÄÂàõÂª∫‰∏Ä‰∏™ÂçïÁ∫øÁ®ãÂåñÁöÑÁ∫øÁ®ãÊ±†ÔºåÂÆÉÂè™‰ºöÁî®ÂîØ‰∏ÄÁöÑÂ∑•‰ΩúÁ∫øÁ®ãÊù•ÊâßË°å‰ªªÂä°Ôºå‰øùËØÅÊâÄÊúâ‰ªªÂä°ÊåâÁÖßÈ°∫Â∫èÊâßË°å„ÄÇ</p>
<p><strong>ÁâπÁÇπ:</strong></p>
<p>„ÄÄ„ÄÄÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ã</p>
<p>„ÄÄ„ÄÄËøë‰πéÂèØ‰ª•Êé•Êî∂Êó†Èôê‰ªªÂä°ÁöÑÈòüÂàóÔºå ÂèØ‰ª•Â†ÜÁßØÂ§ßÈáè‰ªªÂä°</p>
<p>„ÄÄ„ÄÄÈÄÇÁî®‰∫é‰ªªÂä°ÊåÅÁª≠Âä†ÂÖ•‰ΩÜÊòØ‰ªªÂä°Êï∞Âπ∂‰∏çÂ§öÁöÑÂú∫ÊôØ</p>
<p><strong>ÂÆûÁé∞Ôºö</strong></p>
<p>„ÄÄ„ÄÄnew ThreadPoolExecutor(1,1,0L,TimeUnit.MILLISECONDS,new LinkedBlockingQueue())</p>
<p><strong>Áº∫ÁÇπÔºö</strong></p>
<p>„ÄÄ„ÄÄ‰ªªÂä°ÈòüÂàóÂíå‰∏äÈù¢‰∏ÄÊ†∑Ôºå Ê≤°ÊúâÈôêÂà∂Ôºå ÂæàÂÆπÊòìÂ∞±‰ΩøÁî®‰∏çÂΩìÂØºËá¥OOM</p>
<p><strong>4„ÄÅExecutors.newScheduledThreadPool(int);</strong><br><strong>ËØ¥Êòé:</strong></p>
<p>„ÄÄ„ÄÄÂàõÂª∫‰∏Ä‰∏™ÂÆöÈïøÁ∫øÁ®ãÊ±†ÔºåÊîØÊåÅÂÆöÊó∂ÂèäÂë®ÊúüÊÄß‰ªªÂä°ÊâßË°å„ÄÇ</p>
<p><strong>ÁâπÁÇπÔºö</strong></p>
<p>„ÄÄ„ÄÄÊ†∏ÂøÉÁ∫øÁ®ãÊòØ‰º†ÂÖ•ÁöÑÂèÇÊï∞ÔºåÊúÄÂ§ßÁ∫øÁ®ãÊòØint‰∏äÁ∫øÔºå ÈªòËÆ§Â≠òÊ¥ªÊó∂Èó¥ÊòØ10ÊØ´ÁßíÔºå ‰ªªÂä°ÈòüÂàó‰ΩøÁî®Ëá™Â∑±ÂÆûÁé∞ÁöÑDelayedWorkQueueÔºå ÊãíÁªùÁ≠ñÁï•ÂºÇÂ∏∏Á≠ñÁï•</p>
<p>„ÄÄ„ÄÄÂä†ÂÖ•‰ªªÂä°ÁöÑÊó∂ÂÄôÔºå‰ºöÊää‰ªªÂä°ÂíåÂÆöÊó∂Êó∂Èó¥ÊûÑÂª∫‰∏Ä‰∏™RunnableScheduledFutureÂØπË±°ÔºåÂÜçÊääËøô‰∏™ÂØπË±°ÊîæÂÖ•DelayedWorkQueueÈòüÂàó‰∏≠Ôºå</p>
<p>„ÄÄ„ÄÄDelayedWorkQueueÊòØ‰∏Ä‰∏™ÊúâÂ∫èÈòüÂàóÔºå ‰ªñ‰ºöÊ†πÊçÆÂÜÖÈÉ®ÁöÑRunnableScheduledFutureÁöÑËøêË°åÊó∂Èó¥ÊéíÂ∫èÂÜÖÈÉ®ÂØπË±°„ÄÇ</p>
<p>„ÄÄ„ÄÄ‰ªªÂä°Âä†ÂÖ•ÂêéÂ∞±‰ºöÂêØÂä®‰∏Ä‰∏™Á∫øÁ®ã„ÄÇ Ëøô‰∏™Á∫øÁ®ã‰ºö‰ªéDelayedWorkQueue‰∏≠Ëé∑Âèñ‰∏Ä‰∏™‰ªªÂä°„ÄÇ</p>
<p>„ÄÄ„ÄÄDelayedWorkQueueÂÜÖÈÉ®ÊòØÊåâÁÖßÊó∂Èó¥‰ªéÂâçÂÆåÂêéËé∑Âèñ‰ªªÂä°ÁöÑ„ÄÇÂ¶ÇÊûú‰ªªÂä°ÁöÑ‰∏≠ÁöÑÊó∂Èó¥ËøòÊ≤°ÊúâÂà∞„ÄÇ Ëé∑ÂèñÁöÑÂ∞±ÊòØnull„ÄÇ Ëé∑Âèñ‰ªªÂä°ÁªìÊùüÔºåÁ∫øÁ®ã‰ºö‰ºëÁú†10ÊØ´Áßí„ÄÇÊâÄ‰ª•Ëøô‰∏™ÂÆöÊó∂‰ªªÂä°ÁöÑÊâßË°åÊúÄÂ∞èÈó¥ÈöîÊòØ10ÊØ´ÁßíÁöÑ„ÄÇ</p>
<p><strong>ÂÜÖÈÉ®ÂÆûÁé∞</strong>Ôºö</p>
<p>„ÄÄ„ÄÄnew ScheduledThreadPoolExecutor(corePoolSize)</p>
<p><strong>Áº∫ÁÇπÔºö</strong></p>
<p>„ÄÄ„ÄÄËøô‰∏™ÊòØÂÆöÊó∂‰ªªÂä°ÁöÑÁ∫øÁ®ãÊ±†Ôºå Ê≤°ÊúâÂÆö‰πâÁ∫øÁ®ãÂàõÂª∫Êï∞ÈáèÁöÑ‰∏äÁ∫øÔºå ÂêåÊó∂‰ªªÂä°ÈòüÂàó‰πüÊ≤°ÊúâÂÆö‰πâ‰∏äÈôêÔºå Â¶ÇÊûúÂâç‰∏ÄÊ¨°ÂÆöÊó∂‰ªªÂä°ËøòÊ≤°ÊúâÂÆåÊàêÔºå Âêé‰∏Ä‰∏™ÂÆöÊó∂‰ªªÂä°ÁöÑËøêË°åÊó∂Èó¥Âà∞‰∫ÜÔºå ÂÆÉ‰πü‰ºöËøêË°åÔºå Á∫øÁ®ã‰∏çÂ§üÂ∞±ÂàõÂª∫„ÄÇ</p>
<p>„ÄÄ„ÄÄËøôÊ†∑Â¶ÇÊûúÂÆöÊó∂‰ªªÂä°ËøêË°åÁöÑÊó∂Èó¥ËøáÈïøÔºå Â∞±‰ºöÂØºËá¥ÂâçÂêé‰∏§‰∏™ÂÆöÊó∂‰ªªÂä°ÂêåÊó∂ÊâßË°åÔºåÂ¶ÇÊûú‰ªñ‰ª¨‰πãÈó¥ÊúâÈîÅÔºåËøòÊúâÂèØËÉΩÂá∫Áé∞Ê≠ªÈîÅ„ÄÇ</p>
<blockquote>
<p><strong>Ê≠£Âõ†‰∏∫‰ª•‰∏äÈóÆÈ¢ò</strong></p>
<p><strong><code>ÈòøÈáåÂ∑¥Â∑¥JavaÂºÄÂèëÊâãÂÜå</code>‰∏≠ÊòéÁ°ÆÊåáÂá∫ÔºåËÄå‰∏îÁî®ÁöÑËØçÊòØ„Äé‰∏çÂÖÅËÆ∏„Äè‰ΩøÁî®ExecutorsÂàõÂª∫Á∫øÁ®ãÊ±†</strong> </p>
<p>ËØ¶ËßÅÂπ∂ÂèëÂ§ÑÁêÜ</p>
<ol start="4">
<li>„ÄêÂº∫Âà∂„ÄëÁ∫øÁ®ãÊ±†‰∏çÂÖÅËÆ∏‰ΩøÁî® <code>Executors</code> ÂéªÂàõÂª∫ÔºåËÄåÊòØÈÄöËøá <code>ThreadPoolExecutor</code> ÁöÑÊñπÂºèÔºåËøôÊ†∑</li>
</ol>
<p>ÁöÑÂ§ÑÁêÜÊñπÂºèËÆ©ÂÜôÁöÑÂêåÂ≠¶Êõ¥Âä†ÊòéÁ°ÆÁ∫øÁ®ãÊ±†ÁöÑËøêË°åËßÑÂàôÔºåËßÑÈÅøËµÑÊ∫êËÄóÂ∞ΩÁöÑÈ£éÈô©„ÄÇ</p>
<p>ËØ¥ÊòéÔºö<code>Executors</code> ËøîÂõûÁöÑÁ∫øÁ®ãÊ±†ÂØπË±°ÁöÑÂºäÁ´ØÂ¶Ç‰∏ãÔºö </p>
<p>1Ôºâ<code>FixedThreadPool</code> Âíå <code>SingleThreadPool</code>:</p>
<p>ÂÖÅËÆ∏ÁöÑËØ∑Ê±ÇÈòüÂàóÈïøÂ∫¶‰∏∫ <strong>Integer.MAX_VALUE</strong>ÔºåÂèØËÉΩ‰ºöÂ†ÜÁßØÂ§ßÈáèÁöÑËØ∑Ê±ÇÔºå‰ªéËÄåÂØºËá¥ <strong>OOM</strong>„ÄÇ </p>
<p>2Ôºâ<code>CachedThreadPool</code> Âíå <code>ScheduledThreadPool</code>:</p>
<p>ÂÖÅËÆ∏ÁöÑÂàõÂª∫Á∫øÁ®ãÊï∞Èáè‰∏∫ <strong>Integer.MAX_VALUE</strong>ÔºåÂèØËÉΩ‰ºöÂàõÂª∫Â§ßÈáèÁöÑÁ∫øÁ®ãÔºå‰ªéËÄåÂØºËá¥ <strong>OOM</strong>„ÄÇ</p>
</blockquote>
<p>Ëá™ÂÆö‰πâ</p>
<h2 id="JDK7Êñ∞Â¢ûÁöÑFork-x2F-Join"><a href="#JDK7Êñ∞Â¢ûÁöÑFork-x2F-Join" class="headerlink" title="JDK7Êñ∞Â¢ûÁöÑFork&#x2F;Join"></a>JDK7Êñ∞Â¢ûÁöÑFork&#x2F;Join</h2><blockquote>
<p> <strong>ÂçìË∂äÊòØÊñπÂêë,ÊàêÂ∞±Âú®Ë∑Ø‰∏ä„ÄÇ</strong></p>
</blockquote>
<p><img src="/image/Concurrent/Concurrent32.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent32.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        <strong>ÂåñÁπÅ‰∏∫ÁÆÄÔºåÂàÜËÄåÊ≤ª‰πã„ÄÇÈÄíÂΩíÁöÑÂàÜËß£ÂíåÂêàÂπ∂ÔºåÁõ¥Âà∞‰ªªÂä°Â∞èÂà∞ÂèØ‰ª•Êé•ÂèóÁöÑÁ®ãÂ∫¶„ÄÇ</strong></p>
<h3 id="ËÆ§ËØÜ-Future‰ªªÂä°Êú∫Âà∂ÂíåFutureTask"><a href="#ËÆ§ËØÜ-Future‰ªªÂä°Êú∫Âà∂ÂíåFutureTask" class="headerlink" title="ËÆ§ËØÜ Future‰ªªÂä°Êú∫Âà∂ÂíåFutureTask"></a>ËÆ§ËØÜ Future‰ªªÂä°Êú∫Âà∂ÂíåFutureTask</h3><p>‚Äã        Êú¨ËäÇÊàë‰ª¨‰ªãÁªç<code>Future</code>Á±ª„ÄÇÂâçÈù¢Êàë‰ª¨ÊèêÂà∞‰∫Ü<code>thread</code> ÁöÑ‰∏âÁßçÂàõÂª∫ÊñπÂºèÔºå‰∏ÄÁßçÊòØËøîÂõûÁªìÊûúÁöÑÂ∞±ÊòØË¶ÅÁé∞ <code>Callable</code>Êé•Âè£„ÄÇ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏Ä‰∏ãËøô‰∏™Êé•Âè£Ê∫êÁ†Å:</p>
<pre class="line-numbers language-none"><code class="language-none">public interface Callable&lt;V&gt; &#123;
    &#x2F;**
     * Computes a result, or throws an exception if unable to do so.
     * Âè™Êúâ‰∏Ä‰∏™Ëé∑ÂæóËøîÂõûÁªìÊûúÁöÑÊñπÊ≥ï,ÂÆûÁé∞Ëøô‰∏™ÊñπÊ≥ïÂç≥ËÆ¢„ÄÇ
     * @return computed result
     * @throws Exception if unable to compute a result
     *&#x2F;
    V call() throws Exception;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>‚Äã        <code>Future</code>Á±ªÂ∞±ÊòØÂØπ‰∫éÂÖ∑‰ΩìÁöÑ <code>Runnable</code>ÊàñËÄÖ<code>Callable</code>‰ªªÂä°ÁöÑÊâßË°åÁªìÊûúËøõË°åÂèñÊ∂à„ÄÅÊü•ËØ¢ÊòØÂê¶ÂÆåÊàê„ÄÅËé∑ÂèñÁªìÊûú„ÄÇÂøÖË¶ÅÊó∂ÂèØ‰ª•ÈÄöËøá<code>get</code>ÊñπÊ≥ïËé∑ÂèñÊâßË°åÁªìÊûúÔºåËØ•ÊñπÊ≥ï‰ºöÈòªÂ°ûÁõ¥Âà∞‰ªªÂä°ËøîÂõûÁªìÊûú„ÄÇ<code>Future</code>Á±ª‰Ωç‰∫é<code>java.util.concurrent</code>ÂåÖ‰∏ãÔºåÂÆÉ‰πüÊòØ‰∏Ä‰∏™Êé•Âè£ÔºåÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * A &#123;@code Future&#125; represents the result of an asynchronous
 * computation.  Methods are provided to check if the computation is
 * complete, to wait for its completion, and to retrieve the result of
 * the computation.  The result can only be retrieved using method
 * &#123;@code get&#125; when the computation has completed, blocking if
 * necessary until it is ready.  Cancellation is performed by the
 * &#123;@code cancel&#125; method.  Additional methods are provided to
 * determine if the task completed normally or was cancelled. Once a
 * computation has completed, the computation cannot be cancelled.
 * If you would like to use a &#123;@code Future&#125; for the sake
 * of cancellability but not provide a usable result, you can
 * declare types of the form &#123;@code Future&lt;?>&#125; and
 * return &#123;@code null&#125; as a result of the underlying task.
 
 Á§∫‰æãÁî®Ê≥ï(Ê≥®ÊÑèÔºå‰∏ãÈù¢ÁöÑÁ±ªÈÉΩÊòØÁªÑÊàêÁöÑ„ÄÇ)
 Sample Usage (Note that the following classes are all made-up.)
 interface ArchiveSearcher &#123; String search(String target); &#125;
 class App &#123;
   ExecutorService executor = ...
   ArchiveSearcher searcher = ...
   void showSearch(final String target)
       throws InterruptedException &#123;
     Future&lt;String> future
       = executor.submit(new Callable&lt;String>() &#123;
         public String call() &#123;
             return searcher.search(target);
         &#125;&#125;);
     displayOtherThings(); // do other things while searching
     try &#123;
       displayText(future.get()); // use future
     &#125; catch (ExecutionException ex) &#123; cleanup(); return; &#125;
   &#125;
 &#125;
 
 FutureTaskÁ±ªÊòØÂÆûÁé∞‰∫ÜRunnableÁöÑFutureÁöÑÂÆûÁé∞ÔºåÂõ†Ê≠§ÂèØ‰ª•Áî±ExecutorÊâßË°å„ÄÇ
 ‰æãÂ¶ÇÔºå‰∏äËø∞Â∏¶ÊúâsubmitÁöÑÁªìÊûÑÂèØ‰ª•Áî®‰ª•‰∏ãÊñπÂºè‰ª£Êõø:
 
 The FutureTask class is an implementation of Future that implements Runnable, and so may be executed by an Executor. For example, the above construction with submit could be replaced by:
 
  FutureTask&lt;String> future =
   new FutureTask&lt;String>(new Callable&lt;String>() &#123;
     public String call() &#123;
       return searcher.search(target);
   &#125;&#125;);
 executor.execute(future);
 
 
 * &lt;p>Memory consistency effects: Actions taken by the asynchronous computation
 * &lt;a href="package-summary.html#MemoryVisibility"> &lt;i>happen-before&lt;/i>&lt;/a>
 * actions following the corresponding &#123;@code Future.get()&#125; in another thread.
 * ÂÜÖÂ≠ò‰∏ÄËá¥ÊÄßÊïàÊûú:ÂºÇÊ≠•ËÆ°ÁÆóÊâÄÈááÂèñÁöÑÂä®‰ΩúÂèëÁîüÂú®Âè¶‰∏Ä‰∏™Á∫øÁ®ã‰∏≠Áõ∏Â∫îFuture.get()‰πãÂêéÁöÑÂä®‰Ωú‰πãÂâç„ÄÇ
 * @see FutureTask
 * @see Executor
 * @since 1.5
 * @author Doug Lea
 * @param &lt;V> The result type returned by this Future's &#123;@code get&#125; method
 */</span>
 <span class="token comment">/**
 FutureË°®Á§∫ÂºÇÊ≠•ËÆ°ÁÆóÁöÑÁªìÊûú„ÄÇÊèê‰æõÁöÑÊñπÊ≥ïÁî®‰∫éÊ£ÄÊü•ËÆ°ÁÆóÊòØÂê¶ÂÆåÊàê„ÄÅÁ≠âÂæÖËÆ°ÁÆóÂÆåÊàêÂíåÊ£ÄÁ¥¢ËÆ°ÁÆóÁªìÊûú„ÄÇÂè™ÊúâÂΩìËÆ°ÁÆóÂÆåÊàêÊó∂ÔºåÊâçËÉΩ‰ΩøÁî®getÊñπÊ≥ïÊ£ÄÁ¥¢ÁªìÊûúÔºåÂøÖË¶ÅÊó∂Â∞ÜÈòªÂ°ûÔºåÁõ¥Âà∞ÂÆÉÂáÜÂ§áÂ∞±Áª™„ÄÇÂèñÊ∂àÁî±cancelÊñπÊ≥ïÊâßË°å„ÄÇÊèê‰æõ‰∫ÜÂÖ∂‰ªñÊñπÊ≥ïÊù•Á°ÆÂÆö‰ªªÂä°ÊòØÊ≠£Â∏∏ÂÆåÊàêËøòÊòØË¢´ÂèñÊ∂à„ÄÇ‰∏ÄÊó¶ËÆ°ÁÆóÂÆåÊàêÔºåËÆ°ÁÆóÂ∞±‰∏çËÉΩË¢´ÂèñÊ∂à„ÄÇÂ¶ÇÊûú‰∏∫‰∫ÜÂèØÂèñÊ∂àÊÄßËÄå‰ΩøÁî®FutureÔºå‰ΩÜ‰∏çÊèê‰æõÂèØÁî®ÁöÑÁªìÊûúÔºåÂàôÂèØ‰ª•Â£∞ÊòéFuture&lt;?>Âπ∂ËøîÂõûnull‰Ωú‰∏∫Â∫ïÂ±Ç‰ªªÂä°ÁöÑÁªìÊûú„ÄÇ
 
 
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token comment">/**
     * ËØïÂõæÂèñÊ∂àÊ≠§‰ªªÂä°ÁöÑÊâßË°å„ÄÇÂ¶ÇÊûú‰ªªÂä°Â∑≤ÂÆåÊàê„ÄÅÂ∑≤Ë¢´ÂèñÊ∂àÊàñÁî±‰∫éÂÖ∂‰ªñÂéüÂõ†Êó†Ê≥ïÂèñÊ∂àÔºåÂàôÊ≠§Â∞ùËØïÂ∞ÜÂ§±Ë¥•„ÄÇÂ¶ÇÊûúÊàêÂäüÔºå‰∏îÂú®Ë∞ÉÁî®cancelÊó∂ËØ•‰ªªÂä°Â∞öÊú™ÂêØÂä®ÔºåÂàôËØ•‰ªªÂä°Ê∞∏Ëøú‰∏çÂ∫îËøêË°å„ÄÇÂ¶ÇÊûú‰ªªÂä°Â∑≤ÁªèÂêØÂä®ÔºåÈÇ£‰πàmayInterruptIfRunningÂèÇÊï∞Â∞ÜÁ°ÆÂÆöÂú®ËØïÂõæÂÅúÊ≠¢‰ªªÂä°Êó∂ÊòØÂê¶Â∫îËØ•‰∏≠Êñ≠ÊâßË°åËØ•‰ªªÂä°ÁöÑÁ∫øÁ®ã„ÄÇ
    ËØ•ÊñπÊ≥ïËøîÂõûÂêéÔºåÂØπisDoneÁöÑÂêéÁª≠Ë∞ÉÁî®ÊÄªÊòØËøîÂõûtrue„ÄÇÂ¶ÇÊûúËØ•ÊñπÊ≥ïËøîÂõûtrueÔºåÂØπisCancelledÁöÑÂêéÁª≠Ë∞ÉÁî®Â∞ÜÂßãÁªàËøîÂõûtrue„ÄÇ
    Â¶ÇÊûúÊâßË°åÊ≠§‰ªªÂä°ÁöÑÁ∫øÁ®ãÂ∫îËØ•Ë¢´‰∏≠Êñ≠ÔºåÂàô‰∏∫true;Âê¶ÂàôÔºåÂÖÅËÆ∏Ê≠£Âú®ÊâßË°åÁöÑ‰ªªÂä°ÂÆåÊàê
	Â¶ÇÊûú‰ªªÂä°‰∏çËÉΩË¢´ÂèñÊ∂àÔºåËøîÂõûfalseÔºåÈÄöÂ∏∏ÊòØÂõ†‰∏∫ÂÆÉÂ∑≤ÁªèÊ≠£Â∏∏ÂÆåÊàê;true Âèç‰πã
     */</span>
    <span class="token keyword">boolean</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> mayInterruptIfRunning<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     *  Â¶ÇÊûúËØ•‰ªªÂä°Âú®Ê≠£Â∏∏ÂÆåÊàê‰πãÂâçË¢´ÂèñÊ∂àÔºåÂàôËøîÂõûtrue„ÄÇ
		Â¶ÇÊûú‰ªªÂä°Âú®ÂÆåÊàê‰πãÂâçË¢´ÂèñÊ∂àÔºåÂàôËøîÂõûtrue
     */</span>
    <span class="token keyword">boolean</span> <span class="token function">isCancelled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     *	Â¶ÇÊûú‰ªªÂä°ÂÆåÊàêÔºåËøîÂõûtrue„ÄÇÂÆåÊàêÂèØËÉΩÊòØÁî±‰∫éÊ≠£Â∏∏ÁªàÊ≠¢„ÄÅÂºÇÂ∏∏ÊàñÂèñÊ∂à‚Äî‚ÄîÂú®ÊâÄÊúâËøô‰∫õÊÉÖÂÜµ‰∏ãÔºåËØ•ÊñπÊ≥ïÂ∞ÜËøîÂõûtrue„ÄÇ
		Â¶ÇÊûú‰ªªÂä°ÂÆåÊàêÔºåËøîÂõûtrue
     */</span>
    <span class="token keyword">boolean</span> <span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Âú®ÂøÖË¶ÅÊó∂Á≠âÂæÖËÆ°ÁÆóÂÆåÊàêÔºåÁÑ∂ÂêéÊ£ÄÁ¥¢ÂÖ∂ÁªìÊûú„ÄÇ
		ËøîÂõû:ËÆ°ÁÆóÁªìÊûú
     *
     Throws:
        CancellationException‚Äî‚ÄîÂ¶ÇÊûúËÆ°ÁÆóË¢´ÂèñÊ∂à
        ExecutionException‚Äî‚ÄîÂ¶ÇÊûúËÆ°ÁÆóÊäõÂá∫ÂºÇÂ∏∏
        InterruptedException‚Äî‚ÄîÂ¶ÇÊûúÂΩìÂâçÁ∫øÁ®ãÂú®Á≠âÂæÖÊó∂Ë¢´‰∏≠Êñ≠
     */</span>
    <span class="token comment">//Áî®Êù•Ëé∑ÂèñÊâßË°åÁªìÊûúÔºåËøô‰∏™ÊñπÊ≥ï‰ºö‰∫ßÁîüÈòªÂ°û,‰ºö‰∏ÄÁõ¥Á≠âÂà∞‰ªªÂä°ÊâßË°åÂÆåÊØïÊâçËøîÂõû„ÄÇ</span>
    <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Â¶ÇÊûúÊúâÂøÖË¶ÅÔºåÊúÄÂ§öÁ≠âÂæÖÁªôÂÆöÁöÑÊó∂Èó¥Êù•ÂÆåÊàêËÆ°ÁÆóÔºåÁÑ∂ÂêéÊ£ÄÁ¥¢ÂÖ∂ÁªìÊûú(Â¶ÇÊûúÂèØÁî®)„ÄÇ
     *
     * ÂèÇÊï∞:timeout‚ÄîÁ≠âÂæÖÁöÑÊúÄÂ§ßÊó∂Èó¥Âçï‰Ωç‚ÄîtimeoutÂèÇÊï∞ÁöÑÊó∂Èó¥Âçï‰Ωç
		ËøîÂõû:ËÆ°ÁÆóÁªìÊûú
     * throws:
             CancellationException‚Äî‚ÄîÂ¶ÇÊûúËÆ°ÁÆóË¢´ÂèñÊ∂à
             ExecutionException‚Äî‚ÄîÂ¶ÇÊûúËÆ°ÁÆóÊäõÂá∫ÂºÇÂ∏∏
             InterruptedException‚Äî‚ÄîÂ¶ÇÊûúÂΩìÂâçÁ∫øÁ®ãÂú®Á≠âÂæÖÊó∂Ë¢´‰∏≠Êñ≠
             TimeoutException -Â¶ÇÊûúÁ≠âÂæÖË∂ÖÊó∂
     */</span>
    <span class="token comment">//Áî®Êù•Ëé∑ÂèñÊâßË°åÁªìÊûú,Â¶ÇÊûúÂú®ÊåáÂÆöÊó∂Èó¥ÂÜÖ,ËøòÊ≤°Ëé∑ÂèñÂà∞ÁªìÊûú,Â∞±Áõ¥Êé•ËøîÂõûnull</span>
    <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰πüÂ∞±ÊòØËØ¥<code>Future</code>Êèê‰æõ‰∫Ü‰∏âÁßçÂäüËÉΩÔºö</p>
<ul>
<li>Âà§Êñ≠‰ªªÂä°ÊòØÂê¶ÂÆåÊàê„ÄÇ</li>
<li>ËÉΩÂ§ü‰∏≠Êñ≠‰ªªÂä°„ÄÇ</li>
<li>ËÉΩÂ§üËé∑Âèñ‰ªªÂä°ÊâßË°åÁªìÊûú„ÄÇ</li>
</ul>
<p>‚Äã        Âõ†‰∏∫ <code>Future</code>Âè™ÊòØ‰∏Ä‰∏™Êé•Âè£ÔºåÊâÄ‰ª•ÊòØÊó†Ê≥ïÁõ¥Êé•Áî®Êù•ÂàõÂª∫ÂØπË±°‰ΩøÁî®ÁöÑÔºåÂõ†Ê≠§Â∞±Êúâ‰∫Ü‰∏ãÈù¢ÁöÑ<code>FutureTask</code>„ÄÇ<code>FutureTask</code>ÁõÆÂâçÊòØ<code>Future</code>Êé•Âè£ÁöÑ‰∏Ä‰∏™ÂîØ‰∏ÄÂÆûÁé∞Á±ª„ÄÇ<br>‚Äã        Êàë‰ª¨ÂÖàÁÆÄÂçïÂú∞Êù•Áúã‰∏Ä‰∏ã<code>FutureTask</code>Á±ª:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>‚Äã        <code>FutureTask</code>Á±ªÂÆûÁé∞‰∫Ü<code>RunnableFuture</code>Êé•Âè£ÔºåÊàë‰ª¨Áúã‰∏Ä‰∏ã<code>RunnableFuture</code>Êé•Âè£ÁöÑÂÆûÁé∞Ôºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">Runnable</span><span class="token punctuation">,</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * Sets this Future to the result of its computation
     * unless it has been cancelled.
     Â∞ÜËøô‰∏™FutureËÆæÁΩÆ‰∏∫ÂÖ∂ËÆ°ÁÆóÁöÑÁªìÊûúÔºåÈô§ÈùûÂÆÉÂ∑≤Ë¢´ÂèñÊ∂à
     */</span>
    <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÂèØ‰ª•ÁúãÂá∫ <code>RunnableFuture</code>ÁªßÊâø‰∫Ü<code>Runnable</code>Êé•Âè£Âíå <code>Future</code>Êé•Âè£ÔºåËÄå <code>FutureTask</code>ÂÆûÁé∞‰∫Ü<code>RunnableFuture</code>Êé•Âè£„ÄÇÊâÄ‰ª•ÂÆÉÊó¢ÂèØ‰ª•‰Ωú‰∏∫<code>Runnable</code>Ë¢´Á∫øÁ®ãÊâßË°åÔºåÂèàÂèØ‰ª•‰Ωú‰∏∫<code>Future</code>ÂæóÂà∞<code>Callable</code>ÁöÑËøîÂõûÂÄº„ÄÇ<br>‚Äã        <code>FutureTask</code>Êèê‰æõ‰∫Ü2‰∏™ÊûÑÈÄ†Âô®:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**ÂàõÂª∫FutureTaskÔºåÂú®ËøêË°åÊó∂ÊâßË°åÁªôÂÆöÁöÑCallable„ÄÇ
Params: callable‚ÄîÂèØË∞ÉÁî®‰ªªÂä°
ÊäõÂá∫:
NullPointerException‚Äî‚ÄîÂ¶ÇÊûúÂèØË∞ÉÁî®ÂØπË±°‰∏∫Á©∫*/</span>
<span class="token keyword">public</span> <span class="token class-name">FutureTask</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> callable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>callable <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callable <span class="token operator">=</span> callable<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> NEW<span class="token punctuation">;</span>       <span class="token comment">// ensure visibility of callable Á°Æ‰øùÂèØË∞ÉÁî®ÂØπË±°ÁöÑÂèØËßÅÊÄß</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/**
ÂàõÂª∫‰∏Ä‰∏™FutureTaskÔºåÂú®ËøêË°åÊó∂ÊâßË°åÁªôÂÆöÁöÑRunnableÔºåÂπ∂Âú®ÊàêÂäüÂÆåÊàêÊó∂ÂÆâÊéígetËøîÂõûÁªôÂÆöÁöÑÁªìÊûú„ÄÇ
Params: runnable -ÂèØËøêË°åÁöÑ‰ªªÂä°ÁªìÊûú-ÊàêÂäüÂÆåÊàêÂêéËøîÂõûÁöÑÁªìÊûú„ÄÇÂ¶ÇÊûú‰∏çÈúÄË¶ÅÁâπÂÆöÁöÑÁªìÊûúÔºåÂèØ‰ª•ËÄÉËôë‰ΩøÁî®‰ª•‰∏ãÂΩ¢ÂºèÁöÑÁªìÊûÑ:Future&lt;?> f = new FutureTask&lt;Void>(runnable, null)
ÊäõÂá∫:
NullPointerException‚Äî‚ÄîÂ¶ÇÊûúÂèØËøêË°åÂØπË±°‰∏∫Á©∫*/</span>
<span class="token keyword">public</span> <span class="token class-name">FutureTask</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">,</span> <span class="token class-name">V</span> result<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callable <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">callable</span><span class="token punctuation">(</span>runnable<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> NEW<span class="token punctuation">;</span>       <span class="token comment">// ensure visibility of callable Á°Æ‰øùÂèØË∞ÉÁî®ÂØπË±°ÁöÑÂèØËßÅÊÄß</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰ΩøÁî®Âú∫ÊôØÔºö<br>‚Äã        ÂÆûÈôÖÂ∑•‰Ωú‰∏≠ÔºåÂèØËÉΩÈúÄË¶ÅÁªüËÆ°ÂêÑÁßçÁ±ªÂûãÁöÑÊä•Ë°®ÂëàÁé∞ÁªìÊûúÔºåÂèØËÉΩ‰∏Ä‰∏™Â§ßÁöÑÊä•Ë°®Ë¶Å‰æùËµñiÂùóÁöÑËøêÁÆóÁªìÊûúÔºå‰∏Ä‰∏™Á∫øÁ®ãÂÅöÂèØËÉΩÂèàÊØîËæÉÊÖ¢,Â∞±ÂèØ‰ª•ÊãÜÂàÜÊàêNÂ§ö‰∏™Â∞èÁ∫øÁ®ã,ÁÑ∂ÂêéÂ∞ÜÂÖ∂Áªì‰Ωú‰∏∫Â§ßÁöÑÊä•Ë°®ÂëàÁé∞ÁªìÊûú„ÄÇËÄåÊé•‰∏ãÊù•ÁöÑFork&#x2F;JoinÂ∞±ÊòØÂü∫‰∫éFutureÂÆûÁé∞ÁöÑ„ÄÇ<br>‚Äã        Áúã‰∏ãÈù¢ÁöÑÂÆû‰æãÂÖàÊù•‰ΩìÈ™å‰∏Ä‰∏ãÔºö</p>
<h4 id="No1-FutureTaskDemo-java"><a href="#No1-FutureTaskDemo-java" class="headerlink" title="No1_FutureTaskDemo.java"></a>No1_FutureTaskDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>future</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Callable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">FutureTask</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No1_FutureTaskDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SonTask</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SonTask</span><span class="token punctuation">(</span><span class="token string">"Thread Son1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> futureTask1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>futureTask1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Âè™ÊúâÂæóÂà∞ËøîÂõûÁªìÊûúÂêéÊâç‰ºöÂæÄ‰∏ãÊâßË°å</span>

        <span class="token comment">//ÊâßË°åÂÆåÊåáÂÆöÁ∫øÁ®ãËøîÂõûÊåáÂÆöÁªìÊûú</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> futureTask2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token operator">+</span>futureTask2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Âè™ÊúâÂæóÂà∞ËøîÂõûÁªìÊûúÂêéÊâç‰ºöÂæÄ‰∏ãÊâßË°å</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">SonTask</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

    <span class="token class-name">SonTask</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token operator">+</span><span class="token string">"‰ªªÂä°ËÆ°ÁÆóÂÆåÊàê"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"name"</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">MyRun</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Ê®°ÊãüÂπ≤Ê¥ª</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ÁâπÂÆöÁ∫øÁ®ã2ÂÆåÊàê"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Thread</span> <span class="token class-name">Son1</span>‰ªªÂä°ËÆ°ÁÆóÂÆåÊàê
nameThread<span class="token operator">-</span><span class="token number">0</span>
ÁâπÂÆöÁ∫øÁ®ã<span class="token number">2</span>ÂÆåÊàê
result22<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰ªéÁªìÊûú‰∏äÂèØ‰ª•ÁúãÂà∞ÊòØÊåâÁÖßÈ¢ÑÊÉ≥ÁªìÊûú,ÊåâÈ°∫Â∫è,ÊåâÊ≠•È™§Âú∞ÊâßË°å„ÄÇ</p>
<h3 id="‰ªÄ‰πàÊòØFork-x2F-JoinÊ°ÜÊû∂"><a href="#‰ªÄ‰πàÊòØFork-x2F-JoinÊ°ÜÊû∂" class="headerlink" title="‰ªÄ‰πàÊòØFork&#x2F;JoinÊ°ÜÊû∂"></a>‰ªÄ‰πàÊòØFork&#x2F;JoinÊ°ÜÊû∂</h3><p>‚Äã        <code>Fork/Join</code>Ê°ÜÊû∂ÊòØJava 7Êèê‰æõÁöÑ‰∏Ä‰∏™Áî®‰∫éÂπ∂Ë°åÊâßË°å‰ªªÂä°ÁöÑÊ°ÜÊû∂ÔºåÊòØ‰∏Ä‰∏™ÊääÂ§ß‰ªªÂä°ÂàÜÂâ≤ÊàêËã•Âπ≤‰∏™Â∞è‰ªªÂä°ÔºåÊúÄÁªàÊ±áÊÄªÊØè‰∏™Â∞è‰ªªÂä°ÁªìÊûúÂêéÂæóÂà∞Â§ß‰ªªÂä°ÁªìÊûúÁöÑÊ°ÜÊû∂„ÄÇ<br>‚Äã        Êàë‰ª¨ÂÜçÈÄöËøá<code>Fork</code>Âíå<code>Join</code>Ëøô‰∏§‰∏™ÂçïËØçÊù•ÁêÜËß£‰∏ã<code>Fork/Join</code>Ê°ÜÊû∂Ôºå<code>Fork</code>Â∞±ÊòØÊää‰∏Ä‰∏™Â§ß‰ªªÂä°ÂàáÂàÜ‰∏∫Ëã•Âπ≤Â≠ê‰ªªÂä°Âπ∂Ë°åÂú∞ÊâßË°åÔºå<code>Join</code> Â∞±ÊòØÂêàÂπ∂Ëøô‰∫õÂ≠ê‰ªªÂä°ÁöÑÊâßË°åÁªìÊûúÔºåÊúÄÂêéÂæóÂà∞Ëøô‰∏™Â§ß‰ªªÂä°ÁöÑÁªìÊûú„ÄÇÊØîÂ¶ÇËÆ°ÁÆó1+2+‚Ä¶+10000ÔºåÂèØ‰ª•ÂàÜÂâ≤Êàê10‰∏™Â≠ê‰ªªÂä°ÔºåÊØè‰∏™Â≠ê‰ªªÂä°ÂàÜÂà´ÂØπ1000‰∏™Êï∞ËøõË°åÊ±ÇÂíåÔºåÊúÄÁªàÊ±áÊÄªËøô10‰∏™Â≠ê‰ªªÂä°ÁöÑÁªìÊûú„ÄÇ<code>Fork/Join</code>ÁöÑËøêË°åÊµÅÁ®ãÂõæÂ¶Ç‰∏ã:<img src="/image/Concurrent/Concurrent33.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent33.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        ËÆ©Êàë‰ª¨ÈÄöËøá‰∏Ä‰∏™ÁÆÄÂçïÁöÑÈúÄÊ±ÇÊù•‰ΩìÈ™å‰∏Ä‰∏ã‰ªÄ‰πàÊòØ<code>Fork /Join</code>Ê°ÜÊû∂ÔºåÈúÄÊ±ÇÊòØÔºöËÆ°ÁÆó1+2+3+4ÁöÑÁªìÊûú„ÄÇ<br>‚Äã        ‰ΩøÁî®<code>Fork /Join</code>Ê°ÜÊû∂È¶ñÂÖàË¶ÅËÄÉËôëÂà∞ÁöÑÊòØÂ¶Ç‰ΩïÂàÜÂâ≤‰ªªÂä°„ÄÇÂ¶ÇÊûúÊàë‰ª¨Â∏åÊúõÊØè‰∏™Â≠ê‰ªªÂä°ÊúÄÂ§öÊâßË°å‰∏§‰∏™Êï∞ÁöÑÁõ∏Âä†ÔºåÈÇ£‰πàÊàë‰ª¨ËÆæÁΩÆÂàÜÂâ≤ÁöÑÈòàÂÄºÊòØ2ÔºåÁî±‰∫éÊòØ4‰∏™Êï∞Â≠óÁõ∏Âä†ÔºåÊâÄ‰ª•<code>Fork / Join</code>Ê°ÜÊû∂‰ºöÊääËøô‰∏™‰ªªÂä°<code>fork</code>Êàê‰∏§‰∏™Â≠ê‰ªªÂä°ÔºåÂ≠ê‰ªªÂä°‰∏ÄË¥üË¥£ËÆ°ÁÆó1+2ÔºåÂ≠ê‰ªªÂä°‰∫åË¥üË¥£ËÆ°ÁÆó3+4ÔºåÁÑ∂ÂêéÂÜç<code>join</code>‰∏§‰∏™Â≠ê‰ªªÂä°ÁöÑÁªìÊûú„ÄÇ<br>‚Äã        ÂÖàÊù•Áúã‰∏Ä‰∏™‰æãÂ≠ê‰Ωì‰ºö‰∏Ä‰∏ãÂ¶Ç‰∏ãÔºö</p>
<h4 id="No2-ForkJoinTaskDemo-java"><a href="#No2-ForkJoinTaskDemo-java" class="headerlink" title="No2_ForkJoinTaskDemo.java"></a>No2_ForkJoinTaskDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>future</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ForkJoinPool</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Future</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">RecursiveTask</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No2_ForkJoinTaskDemo</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ForkJoinPool</span> forkJoinPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountTask</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountTask</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> result <span class="token operator">=</span> forkJoinPool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1-5ÊúÄÁªàÁõ∏Âä†ÁöÑÁªìÊûúÔºö"</span> <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CountTask</span> task2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountTask</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> result2 <span class="token operator">=</span> forkJoinPool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>task2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1-100ÊúÄÁªàÁõ∏Âä†ÁöÑÁªìÊûúÔºö"</span> <span class="token operator">+</span> result2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Thread Main End!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name">CountTask</span> <span class="token keyword">extends</span> <span class="token class-name">RecursiveTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">3336021432713606929L</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> splitSize <span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> start<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> end<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">CountTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> start<span class="token punctuation">,</span><span class="token keyword">int</span> end<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> end<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Integer</span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> sum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment">//Â¶ÇÊûú‰ªªÂä°Â∑≤Áªè‰∏çÈúÄË¶ÅÂÜçÊãÜÂàÜ‰∫ÜÂ∞±ÂºÄÂßãËÆ°ÁÆó</span>
        <span class="token keyword">boolean</span> canCompute<span class="token operator">=</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token operator">&lt;=</span>splitSize<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>canCompute<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>end<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                sum<span class="token operator">=</span>sum<span class="token operator">+</span>i<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//ÊãÜÂàÜÊàê‰∏§‰∏™Â≠ê‰ªªÂä°</span>
            <span class="token keyword">int</span> middle <span class="token operator">=</span> <span class="token punctuation">(</span>start<span class="token operator">+</span>end<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token class-name">CountTask</span> fistTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountTask</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span>middle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">CountTask</span> secondTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountTask</span><span class="token punctuation">(</span>middle<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fistTask<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ÂºÄÂßãÊâßË°å</span>
            secondTask<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>
            <span class="token comment">//Ëé∑ÂæóÁ¨¨‰∏Ä‰∏™Â≠ê‰ªªÂä°ÁöÑÁªìÊûúÔºåÂæó‰∏çÂà∞ÁªìÊûúÔºåÊ≠§Á∫øÁ®ã‰∏ç‰ºöÂæÄ‰∏ãÈù¢ÊâßË°å„ÄÇ</span>
            <span class="token keyword">int</span> firstResult <span class="token operator">=</span> fistTask<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> secondResult <span class="token operator">=</span> secondTask<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//ÂêàÂπ∂‰∏§‰∏™ÂÑøÂ≠êÁöÑÊâßË°åÁªìÊûú„ÄÇ</span>
            sum <span class="token operator">=</span> firstResult<span class="token operator">+</span> secondResult<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">1</span><span class="token operator">-</span><span class="token number">5</span>ÊúÄÁªàÁõ∏Âä†ÁöÑÁªìÊûúÔºö<span class="token number">15</span>
<span class="token number">1</span><span class="token operator">-</span><span class="token number">100</span>ÊúÄÁªàÁõ∏Âä†ÁöÑÁªìÊûúÔºö<span class="token number">5050</span>
<span class="token class-name">Thread</span> <span class="token class-name">Main</span> <span class="token class-name">End</span><span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÈÄöËøáËøô‰∏™‰æãÂ≠êËÆ©Êàë‰ª¨ÂÜçÊù•Ëøõ‰∏ÄÊ≠•‰∫ÜËß£‰∏Ä‰∏ã<code>ForkJoinTask</code>, <code>ForkJoinTask</code> ‰∏é‰∏ÄËà¨ÁöÑ‰ªïÂä°ÁöÑÁéãË¶ÅÂå∫Âú®‰∫éÂÆÉÈúÄË¶ÅÂÆûÁé∞<code>compute</code>ÊñπÊ≥ïÔºåÂú®Ëøô‰∏™ÊñπÊ≥ïÈáå,È¶ñÂÖàÈúÄË¶ÅÂà§Êñ≠‰ªªÂä°ÊòØÂê¶Ë∂≥Â§üÂ∞èÔºåÂ¶ÇÊûúË∂≥Â§üÂ∞èÂ∞±Ê∞îÊé•ÊâßË°å‰ªªÂä°„ÄÇÂ¶ÇÊûú‰∏çË∂≥Â§üÂ∞èÔºåÂ∞±ÂøÖÈ°ªÂàÜÂâ≤Êàê‰∏§‰∏™Â≠ê‰ªªÂä°,ÊØè‰∏™Â≠ê‰ªªÂä°Âú®Ë∞ÉÁî®<code>fork</code>ÊñπÊ≥ïÊó∂ÔºåÂèà‰ºöËøõÂÖ• <code>compute</code>ÊñπÊ≥ïÔºåÁúãÁúãÂΩìÂâçÂ≠ê‰ªªÂä°ÊòØÂê¶ÈúÄË¶ÅÁªßÁª≠ÂàÜÂâ≤ÊàêÂ≠ô‰ªªÂä°ÔºåÂ¶ÇÊûú‰∏çÈúÄË¶ÅÁªßÁª≠ÂàÜÂâ≤ÔºåÂàôÊâßË°åÂΩìÂâçÂ≠ê‰ªªÂä°Âπ∂ËøîÂõûÁªìÊûú„ÄÇ‰ΩøÁî®<code>join</code>ÊñπÊ≥ï‰ºöÁ≠âÂæÖÂ≠ê‰ªªÂä°ÊâßË°åÂÆåÊàêÂπ∂ÂæóÂà∞ÂÖ∂ÁªìÊûú„ÄÇ</p>
<h3 id="ËÆ§ËØÜFork-x2F-JoinÁöÑJDKÈáåÈù¢ÁöÑÂÆ∂Êóè"><a href="#ËÆ§ËØÜFork-x2F-JoinÁöÑJDKÈáåÈù¢ÁöÑÂÆ∂Êóè" class="headerlink" title="ËÆ§ËØÜFork&#x2F;JoinÁöÑJDKÈáåÈù¢ÁöÑÂÆ∂Êóè"></a>ËÆ§ËØÜFork&#x2F;JoinÁöÑJDKÈáåÈù¢ÁöÑÂÆ∂Êóè</h3><p>Êú¨ËäÇÊàë‰ª¨Â≠¶‰π†‰∏Ä‰∏ãFork&#x2F;JoinÂÆ∂ÊóèÊàêÂëò,Â¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent34.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent34.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        ÂÖàÊù•Áúã‰∏Ä‰∏ã<code>ForkJoinTask</code>ÔºåÂÆÉÊòØÂÆûÁé∞<code>Future</code>ÁöÑÂè¶‰∏ÄÁßçÊúâËøîÂõûÁªìÊûúÁöÑÂÆûÁé∞ÊñπÊ≥ïÔºåÊØî<code>Future</code>Â§ö‰∫Ü‰∏§‰∏™ÈáçË¶ÅÁöÑÊñπÊ≥ï:</p>
<ul>
<li><code>fork ()</code>ÔºåËøô‰∏™ÊñπÊ≥ïÂÜ≥ÂÆö‰∫Ü<code>ForkJoinTask</code>ÁöÑÂºÇÊ≠•ÊâßË°åÔºåÂá≠ÂÄüËøô‰∏™ÊñπÊ≥ïÂèØ‰ª•ÂàõÂª∫Êñ∞ÁöÑ‰ªªÂä°„ÄÇ</li>
<li><code>join()</code>ÔºåËØ•ÊñπÊ≥ïË¥üË¥£Âú®ËÆ°ÁÆóÂÆåÊàêÂêéËøîÂõûÁªìÊûúÔºåÂõ†Ê≠§ÂÖÅËÆ∏‰∏Ä‰∏™‰ªªÂä°Á≠âÂæÖÂè¶‰∏Ä‰ªªÂä°ÊâßË°åÂÆåÊàê„ÄÇ</li>
</ul>
<p><code>Fork /join</code>ÁöÑÂÆåÊï¥ËøáÁ®ãÂ¶Ç‰∏ãÂõæÊâÄÁ§∫:</p>
<p><img src="/image/Concurrent/Concurrent35.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent35.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<ul>
<li><code>RecursiveAction</code>ÔºöÁªßÊâøForkJoinTask,Áî®‰∫éÊ≤°ÊúâËøîÂõûÁªìÊûúÁöÑ‰ªªÂä°„ÄÇ</li>
<li><code>RecursiveTask</code>ÔºöÁªßÊâø<code>ForkJoinTask</code>ÔºåÁî®‰∫éÊúâËøîÂõûÁªìÊûúÁöÑ‰ªªÂä°„ÄÇ</li>
<li><code>ForkJoinPool</code>ÔºöÂíåÁ∫øÁ®ãÊ±†ThreadPoolExecutor‰∏ÄÊ†∑ÈÉΩÊòØÂÆûÁé∞ÁöÑExecutorÊé•Âè£„ÄÇ</li>
</ul>
<p>‚Äã       <code>ForkJoinPool</code>Êèê‰æõ‰∫Ü‰∏â‰∏™ÊñπÊ≥ïÊù•Ë∞ÉÂ∫¶Â≠ê‰ªªÂä°:</p>
<ul>
<li><code>execute</code>ÂºÇÊ≠•ÊâßË°åÊåáÂÆöÁöÑ‰ªªÂä°„ÄÇ</li>
<li><code>invoke</code>Âíå<code>invokeAll</code>ÊâßË°åÊåáÂÆöÁöÑ‰ªªÂä°ÔºåÁ≠âÂæÖÂÆåÊàê,ËøîÂõûÁªìÊûú„ÄÇ</li>
<li><code>submit</code>ÂºÇÊ≠•ÊâßË°åÊåáÂÆöÁöÑ‰ªªÂä°,Âπ∂Á´ãÂç≥ËøîÂõû‰∏Ä‰∏™ <code>Future</code>ÂØπË±°„ÄÇ</li>
</ul>
<p>‚Äã       Êàë‰ª¨Â∑≤ÁªèÂæàÊ∏ÖÊ•ö <code>Fork/Join</code>Ê°ÜÊû∂ÁöÑÈúÄÊ±Ç‰∫ÜÔºåÈÇ£‰πàÊàë‰ª¨ÂèØ‰ª•ÊÄùËÄÉ‰∏Ä‰∏ãÔºåÂ¶ÇÊûúËÆ©Êàë‰ª¨Êù•ËÆæËÆ°‰∏Ä‰∏™<code>Fork/Join</code>Ê°ÜÊû∂,ËØ•Â¶Ç‰ΩïËÆæËÆ°?Ëøô‰∏™ÊÄùËÄÉÊúâÂä©‰∫é‰Ω†ÁêÜËß£<code>Fork/Join</code>Ê°ÜÊû∂ÁöÑËÆæËÆ°„ÄÇ</p>
<p>‚Äã       Á¨¨‰∏ÄÊ≠•ÂàÜÂâ≤‰ªªÂä°„ÄÇÈ¶ñÂÖàÊàë‰ª¨ÈúÄË¶ÅÊúâ‰∏Ä‰∏™<code>fork</code>Á±ªÊù•ÊääÂ§ß‰ªªÂä°ÂàÜÂâ≤ÊàêÂ≠ê‰ªªÂä°ÔºåÊúâÂèØËÉΩÂ≠ê‰ªªÂä°ËøòÊòØÂæàÂ§ßÔºåÊâÄ‰ª•ËøòÈúÄË¶Å‰∏çÂÅúÂú∞ÂàÜÂâ≤ÔºåÁõ¥Âà∞ÂàÜÂâ≤Âá∫ÁöÑÂ≠ê‰ªªÂä°Ë∂≥Â§üÂ∞è„ÄÇ<br>‚Äã       Á¨¨‰∫åÊ≠•ÊâßË°å‰ªªÂä°Âπ∂ÂêàÂπ∂ÁªìÊûú„ÄÇÂàÜÂâ≤ÁöÑÂ≠ê‰ªªÂä°ÂàÜÂà´ÊîæÂú®ÂèåÁ´ØÈòüÂàóÈáåÔºåÁÑ∂ÂêéÂá†‰∏™ÂêØÂä®Á∫øÁ®ãÂàÜÂà´‰ªéÂèåÁ´ØÈòüÂàóÈáåËé∑Âèñ‰ªªÂä°ÊâßË°å„ÄÇÂ≠ê‰ªªÂä°ÊâßË°åÂÆåÁöÑÁªìÊûúÈÉΩÁªü‰∏ÄÊîæÂú®‰∏Ä‰∏™ÈòüÂàóÈáåÔºåÂêØÂä®‰∏Ä‰∏™Á∫øÁ®ã‰ªéÈòüÂàóÈáåÊãøÊï∞ÊçÆ,ÁÑ∂ÂêéÂêàÂπ∂Ëøô‰∫õÊï∞ÊçÆ„ÄÇ</p>
<p>‚Äã       <code>Fork/Join</code>‰ΩøÁî®‰∏§‰∏™Á±ªÊù•ÂÆåÊàê‰ª•‰∏ä‰∏§‰ª∂‰∫ãÊÉÖ:</p>
<ul>
<li><code>ForkJoinTask</code>ÔºöÊàë‰ª¨Â¶ÇÊûúË¶Å‰ΩøÁî®<code>ForkJoin</code>Ê°ÜÊû∂ÔºåÂøÖÈ°ªÈ¶ñÂÖàÂàõÂª∫‰∏Ä‰∏™ <code>ForkJoin</code>‰ªªÂä°„ÄÇÂÆÉÊèê‰æõÂú®‰ªªÂä°‰∏≠ÊâßË°å<code>fork()</code>Âíå <code>join()</code>Êìç‰ΩúÁöÑÊú∫Âà∂,ÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÊàë‰ª¨‰∏çÈúÄË¶ÅÁõ¥Êé•ÁªßÊâø<code>ForkJoinTas</code>kÁ±ªÔºåËÄåÂè™ÈúÄË¶ÅÁªßÊâøÂÆÉÁöÑÂ≠êÁ±ªÔºåÈáçËΩΩ<code>protected void compute()</code>ÊñπÊ≥ï„ÄÇ <code>Fork/Join</code>Ê°ÜÊû∂Êèê‰æõ‰∫Ü‰ª•‰∏ã‰∏§‰∏™Â≠êÁ±ªÔºö<br>    <code>RecursiveAction</code>ÔºöÁî®‰∫éÊ≤°ÊúâËøîÂõûÁªìÊûúÁöÑ‰ªªÂä°„ÄÇ<br>      <code>RecursiveTask</code>ÔºöÁî®‰∫éÊúâËøîÂõûÁªìÊûúÁöÑ‰ªªÂä°„ÄÇ</li>
<li><code>ForkJoinPool</code>Ôºö <code>ForkJoinTask</code>ÈúÄË¶ÅÈÄöËøá<code>ForkJoinPool</code>Êù•ÊâßË°åÔºå‰ªªÂä°ÂàÜÂâ≤Âá∫ÁöÑÂ≠ê‰ªªÂä°‰ºöÊ∑ªÂä†Âà∞ÂΩìÂâçÂ∑•‰ΩúÁ∫øÁ®ãÊâÄÁª¥Êä§ÁöÑÂèåÁ´ØÈòüÂàó‰∏≠ÔºåËøõÂÖ•ÈòüÂàóÁöÑÂ§¥ÈÉ®„ÄÇÂΩì‰∏Ä‰∏™Â∑•‰ΩúÁ∫øÁ®ãÁöÑÈòüÂàóÈáåÊöÇÊó∂Ê≤°Êúâ‰ªªÂä°Êó∂ÔºåÂÆÉ‰ºöÈöèÊú∫‰ªéÂÖ∂‰ªñÂ∑•‰ΩúÁ∫øÁ®ãÁöÑÈòüÂàóÁöÑÂ∞æÈÉ®Ëé∑Âèñ‰∏Ä‰∏™‰ªªÂä°„ÄÇ</li>
</ul>
<h3 id="Fork-x2F-JoinÊ°ÜÊû∂ÁöÑÂÆûÁé∞ÂéüÁêÜ"><a href="#Fork-x2F-JoinÊ°ÜÊû∂ÁöÑÂÆûÁé∞ÂéüÁêÜ" class="headerlink" title="Fork&#x2F;JoinÊ°ÜÊû∂ÁöÑÂÆûÁé∞ÂéüÁêÜ"></a>Fork&#x2F;JoinÊ°ÜÊû∂ÁöÑÂÆûÁé∞ÂéüÁêÜ</h3><p>‚Äã       <code>Fork/Join</code> (ÂàÜÂèâ&#x2F;ÁªìÂêà)Ê°ÜÊû∂ÊòØ‰∏Ä‰∏™ÊØîËæÉÁâπÊÆäÁöÑÁ∫øÁ®ãÊ±†Ê°ÜÊû∂Ôºå‰∏ìÁî®‰∫éÈúÄË¶ÅÂ∞Ü‰∏Ä‰∏™‰ªªÂä°‰∏çÊñ≠ÂàÜËß£ÊàêÂ≠ê‰ªªÂä°(ÂàÜÂèâ)ÔºåÂÜç‰∏çÊñ≠ËøõË°åÊ±áÊÄªÂæóÂà∞ÊúÄÁªàÁªìÊûú(ÁªìÂêà)ÁöÑËÆ°ÁÆóËøáÁ®ã„ÄÇÊØîËµ∑‰º†ÁªüÁöÑÁ∫øÁ®ãÊ±†Á±ª<code>ThreadPoolExecutor</code>,<code>ForkJoinPool</code>ÂÆûÁé∞‰∫ÜÂ∑•‰ΩúÁ™ÉÂèñÁÆóÊ≥ïÔºå‰ΩøÂæóÁ©∫Èó≤Á∫øÁ®ãËÉΩÂ§ü‰∏ªÂä®ÂàÜÊãÖ‰ªéÂà´ÁöÑÁ∫øÁ®ãÂàÜËß£Âá∫Êù•ÁöÑÂ≠ê‰ªªÂä°Ôºå‰ªéËÄåËÆ©ÊâÄÊúâÁöÑÁ∫øÁ®ãÈÉΩÂ∞ΩÂèØËÉΩÂ§Ñ‰∫éÈ•±Êª°ÁöÑÂ∑•‰ΩúÁä∂ÊÄÅÔºåÂπ∂Âõ†Ê≠§ÊèêÈ´ò‰∫ÜÊâßË°åÊïàÁéá„ÄÇ<br>‚Äã       Â∑•‰ΩúÁ™ÉÂèñ(<code>work-stealing</code>) ÁÆóÊ≥ïÊòØÊåáÊüê‰∏™Á∫øÁ®ã‰ªéÂÖ∂‰ªñÈòüÂàóÈáåÁ™ÉÂèñ‰ªªÂä°Êù•ÊâßË°å„ÄÇÂ∑•‰ΩúÁ™ÉÂèñÁöÑËøêË°å<br>ÊµÅÁ®ãÂõæÂ¶Ç‰∏ã:</p>
<p><img src="/image/Concurrent/Concurrent36.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent36.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã       ÈÇ£‰πà‰∏∫‰ªÄ‰πàÈúÄË¶Å‰ΩøÁî®Â∑•‰ΩúÁ™ÉÂèñÁÆóÊ≥ïÂë¢?ÂÅáÂ¶ÇÊàë‰ª¨ÈúÄË¶ÅÂÅö‰∏Ä‰∏Ä‰∏™ÊØîËæÉÂ§ßÁöÑ‰ªªÂä°ÔºåÊàë‰ª¨ÂèØ‰ª•ÊääËøô‰∏™<br>‰ªªÂä°ÂàÜÂâ≤‰∏∫Ëã•ÂçÉ‰∫í‰∏ç‰æùËµñÁöÑÂ≠ê‰ªªÂä°Ôºå‰∏∫‰∫ÜÂáèÂ∞ëÁ∫øÁ®ãÈó¥ÁöÑÁ´û‰∫âÔºå‰∫éÊòØÊääËøô‰∫õÂ≠ê‰ªªÂä°ÂàÜÂà´ÊîæÂà∞‰∏çÂêåÁöÑ<br>ÈòüÂàóÈáåÔºåÂπ∂‰∏∫ÊØè‰∏™ÈòüÂàóÂàõÂª∫‰∏Ä‰∏Ä‰∏™ ÂçïÁã¨ÁöÑÁ∫øÁ®ãÊù•ÊâßË°åÈòüÂàóÈáåÁöÑ‰ªªÂä°ÔºåÁ∫øÁ®ãÂíåÈòüÂàó‰∏Ä- -ÂØπÂ∫îÔºåÊØîÂ¶ÇA<br>Á∫øÁ®ãË¥üË¥£Â§ÑÁêÜAÈòüÂàóÈáåÁöÑ‰ªªÂä°„ÄÇ‰ΩÜÊòØÊúâÁöÑÁ∫øÁ®ã‰ºöÂÖàÊääËá™Â∑±ÈòüÂàóÈáåÁöÑ‰ªªÂä°Âπ≤ÂÆåÔºåËÄåÂÖ∂‰ªñÁ∫øÁ®ãÂØπÂ∫îÁöÑ<br>ÈòüÂàóÈáåËøòÊúâ‰ªªÂä°Á≠âÂæÖÂ§ÑÁêÜ„ÄÇÂπ≤ÂÆåÊ¥ªÁöÑÁ∫øÁ®ã‰∏éÂÖ∂Á≠âÁùÄÔºå‰∏çÂ¶ÇÂéªÂ∏ÆÂÖ∂‰ªñÁ∫øÁ®ãÂπ≤Ê¥ªÔºå‰∫éÊòØÂÆÉÂ∞±ÂéªÂÖ∂‰ªñÁ∫ø<br>Á®ãÁöÑÈòüÂàóÈáåÁ™ÉÂèñ‰∏Ä‰∏™‰ªªÂä°Êù•ÊâßË°å„ÄÇËÄåÂú®ËøôÊó∂ÔºåÂÆÉ‰ª¨‰ºöËÆøÈóÆÂêå‰∏Ä‰∏Ä‰∏™ÈòüÂàóÔºåÊâÄ‰ª•‰∏∫‰∫ÜÂáèÂ∞ëÁ™ÉÂèñ‰ªªÂä°Á∫ø<br>Á®ãÂíåË¢´Á™ÉÂèñ‰ªªÂä°Á∫øÁ®ã‰πãÈó¥ÁöÑÁ´û‰∫âÔºåÈÄöÂ∏∏‰ºö‰ΩøÁî®ÂèåÁ´ØÈòüÂàóÔºåË¢´Á™ÉÂèñ‰ªªÂä°Á∫øÁ®ãÊ∞∏Ëøú‰ªéÂèåÁ´ØÈòüÂàóÁöÑÂ§¥ÈÉ®<br>Êãø‰ªªÂä°ÊâßË°åÔºåËÄåÁ™ÉÂèñ‰ªªÂä°ÁöÑÁ∫øÁ®ãÊ∞∏Ëøú‰ªéÂèåÁ´ØÈòüÂàóÁöÑÂ∞æÈÉ®Êãø‰ªªÂä°ÊâßË°å„ÄÇ<br>‚Äã       Â∑•‰ΩúÁ™ÉÂèñÁÆóÊ≥ïÁöÑ‰ºòÁÇπÊòØÂÖÖÂàÜÂà©Áî®Á∫øÁ®ãËøõË°åÂπ∂Ë°åËÆ°ÁÆóÔºåÂπ∂ÂáèÂ∞ë‰∫ÜÁ∫øÁ®ãÈó¥ÁöÑÁ´û‰∫âÔºåÂÖ∂Áº∫ÁÇπÊòØÂú®Êüê<br>‰∫õÊÉÖÂÜµ‰∏ãËøòÊòØÂ≠òÂú®Á´û‰∫âÔºåÊØîÂ¶ÇÂèåÁ´ØÈòüÂàóÈáåÂè™Êúâ‰∏Ä‰∏Ä‰∏™‰ªªÂä°Êó∂„ÄÇÂπ∂‰∏îÊ∂àËÄó‰∫ÜÊõ¥Â§öÁöÑÁ≥ªÁªüËµÑÊ∫êÔºåÊØîÂ¶ÇÂàõ<br>Âª∫Â§ö‰∏™Á∫øÁ®ãÂíåÂ§ö‰∏™ÂèåÁ´ØÈòüÂàó„ÄÇ</p>
<p>‚Äã       <code>ForkJoinPool</code>Áî±<code>ForkJoinTask</code>Êï∞ÁªÑÂíå<code>ForkJoinWorkerThread</code>Êï∞ÁªÑÁªÑÊàêÔºå<code>ForkJoinTask</code> Êï∞ÁªÑË¥üË¥£<br>Â≠òÊîæÁ®ãÂ∫èÊèê‰∫§Áªô<code>ForkJoinPool</code>ÁöÑ‰ªªÂä°ÔºåËÄå<code>ForkJoinWorkerThread</code>Êï∞ÁªÑË¥üË¥£ÊâßË°åËøô‰∫õ‰ªªÂä°„ÄÇ<code>ForkJoinTask</code>ÁöÑ<code>fork</code>ÊñπÊ≥ïÂÆûÁé∞ÂéüÁêÜ„ÄÇÂΩìÊàë‰ª¨Ë∞ÉÁî®<code>ForkJoinTask</code>ÁöÑ<code>fork</code>ÊñπÊ≥ïÊó∂Á®ãÂ∫è‰ºöË∞ÉÁî®<code>push</code>ÊñπÊ≥ïÂºÇÊ≠•Âú∞ÊâßË°åËøô‰∏™‰ªªÂä°ÔºåÁÑ∂ÂêéÁ´ãÂç≥ËøîÂõûÁªìÊûú„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">ForkJoinTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Thread</span> t<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">ForkJoinWorkerThread</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ForkJoinWorkerThread</span><span class="token punctuation">)</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span>workQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token class-name">ForkJoinPool</span><span class="token punctuation">.</span>common<span class="token punctuation">.</span><span class="token function">externalPush</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã       <code>push</code>ÊñπÊ≥ïÊääÂΩìÂâç‰ªªÂä°Â≠òÊîæÂú®<code>ForkJoinPool</code>Êï∞ÁªÑ<code>WorkQueue</code>Èáå„ÄÇ<br>‚Äã       <code>ForkJoinPool</code>ÈáåÈù¢ÁöÑ‰∏Ä‰∫õÂèòÈáèÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">WorkQueue</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> workQueues<span class="token punctuation">;</span>		<span class="token comment">//Â∑•‰ΩúÈòüÂàó</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>‚Äã       ËÄå<code>WorkQueue</code>ÂèàÂÅö‰∫Ü‰∏äÈù¢Êàë‰ª¨ËØ¥ÁöÑÈòüÂàóÁÆóÊ≥ïÔºå‰∏Ä‰∫õÂèòÈáèÂ¶Ç‰∏ãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@sun.misc.Contended</span>
 <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">WorkQueue</span> <span class="token punctuation">&#123;</span>
     <span class="token class-name">ForkJoinTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">;</span>   <span class="token comment">// the elements (initially unallocated)</span>
     <span class="token keyword">final</span> <span class="token class-name">ForkJoinPool</span> pool<span class="token punctuation">;</span>   <span class="token comment">// the containing pool (may be null)</span>
     <span class="token keyword">final</span> <span class="token class-name">ForkJoinWorkerThread</span> owner<span class="token punctuation">;</span> <span class="token comment">// owning thread or null if shared</span>
     <span class="token keyword">volatile</span> <span class="token class-name">Thread</span> parker<span class="token punctuation">;</span>    <span class="token comment">// == owner during call to park; else null</span>
     <span class="token keyword">volatile</span> <span class="token class-name">ForkJoinTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> currentJoin<span class="token punctuation">;</span>  <span class="token comment">// task being joined in awaitJoin</span>
     <span class="token keyword">volatile</span> <span class="token class-name">ForkJoinTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> currentSteal<span class="token punctuation">;</span> <span class="token comment">// mainly used by helpStealer</span>
     <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã       <code>ForkJoinTask</code>ÁöÑ<code>join</code>ÊñπÊ≥ïÂÆûÁé∞ÂéüÁêÜ„ÄÇ<code>Join</code> ÊñπÊ≥ïÁöÑ‰∏ªË¶Å‰ΩúÁî®ÊòØÈòªÂ°ûÂΩìÂâçÁ∫øÁ®ãÂπ∂Á≠âÂæÖËé∑ÂèñÁªìÊûú„ÄÇ<br>ËÆ©Êàë‰ª¨‰∏ÄËµ∑ÁúãÁúã<code>ForkJoinTask</code>ÁöÑ<code>join</code>ÊñπÊ≥ïÁöÑÂÆûÁé∞Ôºå‰ª£Á†ÅÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">   <span class="token comment">//ÂΩìËÆ°ÁÆóÂÆåÊàêÊó∂ËøîÂõûËÆ°ÁÆóÁªìÊûú„ÄÇÊ≠§ÊñπÊ≥ï‰∏éget()ÁöÑ‰∏çÂêå‰πãÂ§ÑÂú®‰∫éÔºåÂºÇÂ∏∏ÂÆåÊàê‰ºöÂØºËá¥RuntimeExceptionÊàñErrorÔºåËÄå‰∏çÊòØExecutionExceptionÔºåÂπ∂‰∏îË∞ÉÁî®Á∫øÁ®ãÁöÑ‰∏≠Êñ≠‰∏ç‰ºöÈÄöËøáÊäõÂá∫InterruptedExceptionÂØºËá¥ÊñπÊ≥ïÁ™ÅÁÑ∂ËøîÂõû„ÄÇ</span>
<span class="token comment">//ËøîÂõû:ËÆ°ÁÆóÁªìÊûú Â¶ÇÊûúÊú™ÂÆåÊàêÂàôËøîÂõûnull</span>
   <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">int</span> s<span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">=</span> <span class="token function">doJoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> DONE_MASK<span class="token punctuation">)</span> <span class="token operator">!=</span> NORMAL<span class="token punctuation">)</span>
           <span class="token function">reportException</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token function">getRawResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã       È¶ñÂÖàÔºåÂÆÉË∞ÉÁî®‰∫Ü<code>doJoin()</code>ÊñπÊ≥ïÔºåÈÄöËøá<code>doJoin()</code>ÊñπÊ≥ïÂæóÂà∞ÂΩìÂâç‰ªªÂä°ÁöÑÁä∂ÊÄÅÊù•Âà§Êñ≠ËøîÂõû‰ªÄ‰πàÁªìÊûúÔºå<br>‰ªªÂä°Áä∂ÊÄÅÊúâ4Áßç:Â∑≤ÂÆåÊàê(<strong>NORMAL</strong>)ÔºåË¢´ÂèñÊ∂à(<strong>CANCELLED</strong>) Ôºå‰ø°Âè∑(<strong>SIGNAL</strong>) ÂíåÂá∫Áé∞ÂºÇÂ∏∏(<strong>EXCEPTIONAL</strong>)„ÄÇ</p>
<p>‚Äã       ‚óèÂ¶ÇÊûú‰ªªÂä°Áä∂ÊÄÅÊòØÂ∑≤ÂÆåÊàêÔºåÂàôÁõ¥Êé•ËøîÂõû‰ªªÂä°ÁªìÊûú„ÄÇ<br>‚Äã       ‚óèÂ¶ÇÊûú‰ªª Âä°Áä∂ÊÄÅÊòØË¢´ÂèñÊ∂àÔºåÂàôÁõ¥Êé•ÊäõÂá∫CancellationException„ÄÇ<br>‚Äã       ‚óèÂ¶ÇÊûú‰ªªÂä°Áä∂ÊÄÅÊòØÊäõÂá∫ ÂºÇÂ∏∏ÔºåÂàôÁõ¥Êé•ÊäõÂá∫ÂØπÂ∫îÁöÑÂºÇÂ∏∏„ÄÇ</p>
<p>‚Äã       ËÆ©Êàë‰ª¨ÂÜçÊù•ÂàÜÊûê‰∏ã<code>doJoin()</code>ÊñπÊ≥ïÁöÑÂÆûÁé∞‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">doJoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> s<span class="token punctuation">;</span> <span class="token class-name">Thread</span> t<span class="token punctuation">;</span> <span class="token class-name">ForkJoinWorkerThread</span> wt<span class="token punctuation">;</span> <span class="token class-name">ForkJoinPool<span class="token punctuation">.</span>WorkQueue</span> w<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>s <span class="token operator">=</span> status<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> s <span class="token operator">:</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">ForkJoinWorkerThread</span><span class="token punctuation">)</span> <span class="token operator">?</span>
        <span class="token punctuation">(</span>w <span class="token operator">=</span> <span class="token punctuation">(</span>wt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ForkJoinWorkerThread</span><span class="token punctuation">)</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span>workQueue<span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">tryUnpush</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>s <span class="token operator">=</span> <span class="token function">doExec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> s <span class="token operator">:</span>
        wt<span class="token punctuation">.</span>pool<span class="token punctuation">.</span><span class="token function">awaitJoin</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">)</span> <span class="token operator">:</span>
        <span class="token function">externalAwaitDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã       Âú®<code>doJoin()</code>ÊñπÊ≥ïÈáåÔºåÈ¶ñÂÖàÈÄöËøáÊü•Áúã‰ªªÂä°ÁöÑÁä∂ÊÄÅÔºåÁúã‰ªªÂä°ÊòØÂê¶Â∑≤ÁªèÊâßË°åÂÆå‰∫ÜÔºåÂ¶ÇÊûúÊâßË°åÂÆå‰∫ÜÔºåÂàôÁõ¥Êé•ËøîÂõû‰ªªÂä°Áä∂ÊÄÅÔºåÂ¶ÇÊûúÊ≤°ÊúâÊâßË°åÂÆåÔºåÂàô‰ªé‰ªªÂä°Êï∞ÁªÑÈáåÂèñÂá∫‰ªªÂä°Âπ∂ÊâßË°å„ÄÇÂ¶ÇÊûú‰ªªÂä°È°∫Âà©ÊâßË°åÂÆåÊàê‰∫ÜÔºåÂàôËÆæÁΩÆ‰ªªÂä°Áä∂ÊÄÅ‰∏∫<strong>NORMAL</strong>, Â¶ÇÊûúÂá∫Áé∞ÂºÇÂ∏∏ÔºåÂàôËÆ∞ÂΩïÂºÇÂ∏∏ÔºåÂπ∂Â∞Ü‰ªªÂä°Áä∂ÊÄÅËÆæÁΩÆ‰∏∫<strong>EXCEPTIONAL</strong> „ÄÇ<br>‚Äã       Â¶ÇÊûúÂÜçÂæÄ‰∏ãÈù¢ÁúãÔºå‰Ω†‰ºöÂèëÁé∞ÈáåÈù¢Áî®‰∫ÜÂêåÊ≠•‰ª£Á†ÅÂùóÈîÅÁöÑÊú∫Âà∂ÂíåÁ∫øÁ®ã<code>interrupt</code>ÈòªÂ°ûÊú∫Âà∂Ôºå‰ª£Á†ÅÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">externalAwaitDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">CountedCompleter</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token comment">// try helping</span>
                 <span class="token class-name">ForkJoinPool</span><span class="token punctuation">.</span>common<span class="token punctuation">.</span><span class="token function">externalHelpComplete</span><span class="token punctuation">(</span>
                     <span class="token punctuation">(</span><span class="token class-name">CountedCompleter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span>
                 <span class="token class-name">ForkJoinPool</span><span class="token punctuation">.</span>common<span class="token punctuation">.</span><span class="token function">tryExternalUnpush</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">doExec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>s <span class="token operator">=</span> status<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">boolean</span> interrupted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">,</span> s<span class="token punctuation">,</span> s <span class="token operator">|</span> SIGNAL<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ie<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                interrupted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token keyword">else</span>
                            <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">=</span> status<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>interrupted<span class="token punctuation">)</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="ÂºÇÂ∏∏Â§ÑÁêÜÊú∫Âà∂ÂíåÂäûÊ≥ï"><a href="#ÂºÇÂ∏∏Â§ÑÁêÜÊú∫Âà∂ÂíåÂäûÊ≥ï" class="headerlink" title="ÂºÇÂ∏∏Â§ÑÁêÜÊú∫Âà∂ÂíåÂäûÊ≥ï"></a>ÂºÇÂ∏∏Â§ÑÁêÜÊú∫Âà∂ÂíåÂäûÊ≥ï</h3><p>‚Äã       <code>ForkJoinTask</code>Âú®ÊâßË°åÁöÑÊó∂ÂÄôÂèØËÉΩ‰ºöÊäõÂá∫ÂºÇÂ∏∏Ôºå‰ΩÜÊòØÊàë‰ª¨Ê≤°ÂäûÊ≥ïÂú®‰∏ªÁ∫øÁ®ãÈáåÁõ¥Êé•ÊçïËé∑ÂºÇÂ∏∏ÔºåÊâÄ‰ª•<code>ForkJoinTask</code>Êèê‰æõ‰∫Ü<code>isCompletedAbnormally()</code>ÊñπÊ≥ïÊù•Ê£ÄÊü•‰ªªÂä°ÊòØÂê¶Â∑≤ÁªèÊäõÂá∫ÂºÇÂ∏∏ÊàñÂ∑≤ÁªèË¢´ÂèñÊ∂à<br>‰∫ÜÔºåÂπ∂‰∏îÂèØ‰ª•ÈÄöËøá<code>ForkJoinTask</code>ÁöÑ<code>getException</code>ÊñπÊ≥ïËé∑ÂèñÂºÇÂ∏∏„ÄÇ‰ª£Á†ÅÂ¶Ç‰∏ã: </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//Â¶ÇÊûúÊ≠§‰ªªÂä°ÊäõÂá∫ÂºÇÂ∏∏ÊàñË¢´ÂèñÊ∂àÔºåÂàôËøîÂõûtrue„ÄÇ</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">isCompletedAbnormally</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> status <span class="token operator">&lt;</span> NORMAL<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ËøîÂõûÂü∫ÂÄºËÆ°ÁÆóÊäõÂá∫ÁöÑÂºÇÂ∏∏ÔºåÂ¶ÇÊûúË¢´ÂèñÊ∂àÂàôËøîÂõûCancellationExceptionÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàôËøîÂõûnullÔºåÊàñËÄÖÂ¶ÇÊûúÊñπÊ≥ïÂ∞öÊú™ÂÆåÊàêÂàôËøîÂõûnull„ÄÇ</span>
<span class="token comment">//ËøîÂõû:ÂºÇÂ∏∏ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàôËøîÂõûnull</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Throwable</span> <span class="token function">getException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">int</span> s <span class="token operator">=</span> status <span class="token operator">&amp;</span> DONE_MASK<span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">>=</span> NORMAL<span class="token punctuation">)</span>    <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span>
               <span class="token punctuation">(</span>s <span class="token operator">==</span> CANCELLED<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">CancellationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span>
               <span class="token function">getThrowableException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span><span class="token punctuation">(</span>subTask<span class="token punctuation">.</span><span class="token function">isCompletedAbnormally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>subTask<span class="token punctuation">.</span><span class="token function">getException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>‚Äã       <code>getException</code>ÊñπÊ≥ïËøîÂõû<code>Throwable</code>ÂØπË±°ÔºåÂ¶ÇÊûú‰ªªÂä°Ë¢´ÂèñÊ∂à‰∫ÜÔºåÂàôËøîÂõû<code>CancellationException</code>„ÄÇÂ¶ÇÊûú‰ªªÂä°Ê≤°ÊúâÂÆåÊàêÊàñËÄÖÊ≤°ÊúâÊäõÂá∫ÂºÇÂ∏∏ÔºåÂàôËøîÂõûnull„ÄÇ</p>
<h3 id="Fork-x2F-JoinÊ®°Âºè‰ºòÁº∫ÁÇπÂèäÂÖ∂ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ"><a href="#Fork-x2F-JoinÊ®°Âºè‰ºòÁº∫ÁÇπÂèäÂÖ∂ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ" class="headerlink" title="Fork&#x2F;JoinÊ®°Âºè‰ºòÁº∫ÁÇπÂèäÂÖ∂ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ"></a>Fork&#x2F;JoinÊ®°Âºè‰ºòÁº∫ÁÇπÂèäÂÖ∂ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ</h3><p>‚Äã       ÈÄöËøá‰ΩøÁî®<code>Fork/Join</code>Ê®°ÂºèÔºåËΩØ‰ª∂ÂºÄÂèë‰∫∫ÂëòËÉΩÂ§üÊñπ‰æøÂú∞Âà©Áî®Â§öÊ†∏Âπ≥Âè∞ÁöÑËÆ°ÁÆóËÉΩÂäõÔºåËΩªÊùæÂú∞ÂÆûÁé∞Âπ∂ÂèëÁ®ãÂ∫èÁöÑ‰ªªÂä°ÊãÜÂàÜ„ÄÇÂ∞ΩÁÆ°ËøòÊ≤°ÊúâÂÅöÂà∞ÂØπËΩØ‰ª∂ÂºÄÂèë‰∫∫ÂëòÂÆåÂÖ®ÈÄèÊòéÔºå<code>Fork/Join</code> Ê®°ÂºèÂ∑≤ÁªèÊûÅÂ§ßÂú∞ÁÆÄÂåñ‰∫ÜÁºñÂÜôÂπ∂ÂèëÁ®ãÂ∫èÁöÑÁêêÁ¢éÂ∑•‰Ωú„ÄÇÂØπ‰∫éÁ¨¶Âêà<code>Fork/Join</code> Ê®°ÂºèÁöÑÂ∫îÁî®ÔºåËΩØ‰ª∂ÂºÄÂèë‰∫∫Âëò‰∏çÂÜçÈúÄË¶ÅÂ§ÑÁêÜÂêÑÁßçÂπ∂Ë°åÁõ∏ÂÖ≥‰∫ãÂä°Ôºå‰æãÂ¶ÇÂêåÊ≠•„ÄÅÈÄö‰ø°Á≠âÔºå‰ª•Èöæ‰ª•Ë∞ÉËØïËÄåÈóªÂêçÁöÑ**Ê≠ªÈîÅÂíådata race(Êï∞ÊçÆÁ´û‰∫â)**Á≠âÈîôËØØ‰πüÂ∞±‰∏ç‰ºöÂá∫Áé∞ÔºåÊèêÂçá‰∫ÜÊÄùËÄÉÈóÆÈ¢òÁöÑÂ±ÇÊ¨°„ÄÇÂπ∂Ë°åÂàÜÂèëÁ≠ñÁï•Ôºå‰ªÖ‰ªÖÂÖ≥Ê≥®Â¶Ç‰ΩïÂàíÂàÜ‰ªªÂä°ÂíåÁªÑÂêà‰∏≠Èó¥ÁªìÊûúÔºåÂ∞ÜÂâ©‰∏ãÁöÑ‰∫ãÊÉÖ‰∏¢ÁªôFork&#x2F;Join Ê°ÜÊû∂ÂÆåÊàêÂç≥ÂèØ„ÄÇ<br>‚Äã       ÂîØ‰∏ÄÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºöÂ¶ÇÊûúÊãÜÂàÜÁöÑÂØπË±°ËøáÂ§öÊó∂ÔºåÂ∞èÂøÉ‰∏Ä‰∏ãÂ≠êÊääÂÜÖÂ≠òÊíëÊª°„ÄÇÁ≠âÂæÖÁ∫øÁ®ãÁöÑCPUËµÑÊ∫êÈáäÊîæ‰∫ÜÔºå‰ΩÜÊòØÁ∫øÁ®ãÂØπË±°Á≠âÂæÖÊó∂‰∏ç‰ºöË¢´ÂûÉÂúæÊú∫Âà∂ÂõûÊî∂„ÄÇ<br>‚Äã       Êàë‰ª¨Êù•Áúã‰∏Ä‰∏ã<code>Fork/Join</code> Ê®°ÂºèÁöÑÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ„ÄÇÂØπ‰∫éÊ†ëÂΩ¢ÁªìÊûÑÁ±ªÂûãÁöÑÊï∞ÊçÆÁöÑÂ§ÑÁêÜÂíåÈÅçÂéÜÈùûÂ∏∏ÈÄÇÂêà„ÄÇÊØîÂ¶Ç:Êàë‰ª¨Ë¶ÅÂØπ‰∏Ä‰∏™ÈùôÊÄÅËµÑÊ∫êÊúçÂä°Âô®ÁöÑÂõæÁâáÊñá‰ª∂ÁõÆÂΩïÊ†ëËøõË°åÈÅçÂéÜÂíåÂàÜÊûêÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨ÈúÄË¶ÅÈÄíÂΩíÂú∞ÁªüËÆ°ÊØè‰∏™ÁõÆÂΩï‰∏ãÁöÑÊñá‰ª∂Êï∞ÈáèÔºåÊúÄÂêéÊ±áÊÄªÔºåÈùûÂ∏∏ÈÄÇÂêàÁî®ÂàÜÂèâ&#x2F;ÁªìÂêàÊ°ÜÊû∂Êù•Â§ÑÁêÜ„ÄÇÂÆû‰æã‰ª£Á†ÅÂ¶Ç‰∏ã:</p>
<h4 id="No3-RecursiveTaskDemo-java"><a href="#No3-RecursiveTaskDemo-java" class="headerlink" title="No3_RecursiveTaskDemo.java"></a>No3_RecursiveTaskDemo.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>future</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">DirectoryStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Files</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">LinkOption</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Paths</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ForkJoinPool</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">RecursiveTask</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">No3_RecursiveTaskDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Integer</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CountingTask</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"D:\\image"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"D:Áõòimage‰∏ãÈù¢ÊÄªÊñá‰ª∂Êï∞ÈáèÔºö"</span><span class="token operator">+</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Thread Main End!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Â§ÑÁêÜÂçï‰∏™ÁõÆÂΩïÁöÑ‰ªªÂä°</span>
<span class="token keyword">class</span> <span class="token class-name">CountingTask</span> <span class="token keyword">extends</span> <span class="token class-name">RecursiveTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Path</span> dir<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">CountingTask</span><span class="token punctuation">(</span><span class="token class-name">Path</span> dir<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dir <span class="token operator">=</span> dir<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Integer</span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CountingTask</span><span class="token punctuation">></span></span> subTasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CountingTask</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ËØªÂèñÁõÆÂΩï dir ÁöÑÂ≠êË∑ØÂæÑ„ÄÇ</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">DirectoryStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Path</span><span class="token punctuation">></span></span> ds <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">newDirectoryStream</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Path</span> subPath <span class="token operator">:</span> ds<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span>subPath<span class="token punctuation">,</span> <span class="token class-name">LinkOption</span><span class="token punctuation">.</span>NOFOLLOW_LINKS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// ÂØπÊØè‰∏™Â≠êÁõÆÂΩïÈÉΩÊñ∞Âª∫‰∏Ä‰∏™Â≠ê‰ªªÂä°„ÄÇ</span>
                    subTasks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CountingTask</span><span class="token punctuation">(</span>subPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// ÈÅáÂà∞Êñá‰ª∂ÔºåÂàôËÆ°Êï∞Âô®Â¢ûÂä† 1„ÄÇ</span>
                    count<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>subTasks<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// Âú®ÂΩìÂâçÁöÑ ForkJoinPool ‰∏äË∞ÉÂ∫¶ÊâÄÊúâÁöÑÂ≠ê‰ªªÂä°„ÄÇ</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CountingTask</span> subTask <span class="token operator">:</span> <span class="token function">invokeAll</span><span class="token punctuation">(</span>subTasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>subTask<span class="token punctuation">.</span><span class="token function">isCompletedAbnormally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>subTask<span class="token punctuation">.</span><span class="token function">getException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    count <span class="token operator">+=</span> subTask<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËøêÁÆóÁªìÊûúÂ¶Ç‰∏ãÔºåËøêÁÆóÁöÑÈÄüÂ∫¶ËøòÊòØÈùûÂ∏∏Âø´ÁöÑÔºå‰ΩÜÊòØ‰∏ÄÊó¶Êñá‰ª∂Â§ö‰∫ÜÔºå‰πüÊòØÈùûÂ∏∏ËÄóËµÑÊ∫êÁöÑÔºåÁîµËÑëÂ∞±‰ºöÂá∫Áé∞Âç°È°øÁöÑÊÉÖÂÜµ„ÄÇ</p>
<h1 id="ÂÆûÈôÖÁöÑ‰ΩøÁî®„ÄÅÁõëÊéß‰∏éÊãìÂ±ï"><a href="#ÂÆûÈôÖÁöÑ‰ΩøÁî®„ÄÅÁõëÊéß‰∏éÊãìÂ±ï" class="headerlink" title="ÂÆûÈôÖÁöÑ‰ΩøÁî®„ÄÅÁõëÊéß‰∏éÊãìÂ±ï"></a>ÂÆûÈôÖÁöÑ‰ΩøÁî®„ÄÅÁõëÊéß‰∏éÊãìÂ±ï</h1><h2 id="Á∫øÁ®ã„ÄÅÁ∫øÁ®ãÊ±†Âú®ÂÆûÈôÖ‰∫íËÅîÁΩëÈ°∂ÁõÆÂºÄÂèë‰∏≠ÁöÑÂ∫îÁî®"><a href="#Á∫øÁ®ã„ÄÅÁ∫øÁ®ãÊ±†Âú®ÂÆûÈôÖ‰∫íËÅîÁΩëÈ°∂ÁõÆÂºÄÂèë‰∏≠ÁöÑÂ∫îÁî®" class="headerlink" title="Á∫øÁ®ã„ÄÅÁ∫øÁ®ãÊ±†Âú®ÂÆûÈôÖ‰∫íËÅîÁΩëÈ°∂ÁõÆÂºÄÂèë‰∏≠ÁöÑÂ∫îÁî®"></a>Á∫øÁ®ã„ÄÅÁ∫øÁ®ãÊ±†Âú®ÂÆûÈôÖ‰∫íËÅîÁΩëÈ°∂ÁõÆÂºÄÂèë‰∏≠ÁöÑÂ∫îÁî®</h2><blockquote>
<p> <strong>‰∏çÁôªÈ´òÂ±±Ôºå‰∏çÁü•Â±±‰πãÈ´ò„ÄÇ‰∏ç‰∏¥Ê∑±Ê∏äÔºå‰∏çÁü•Âú∞‰πãÂéö‰πü„ÄÇ</strong></p>
</blockquote>
<p><img src="/image/Concurrent/Concurrent37.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent37.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"><br>ËÆ§ËØÜÂÆûÈôÖÂºÄÂèëËøáÁ®ã‰∏≠ÁöÑÁ∫øÁ®ãÂíåÁ∫øÁ®ãÊ±†ÁöÑÁõ∏ÂÖ≥Áü•ËØÜ‰∏éÂÆûÊàò„ÄÇ</p>
<h3 id="ServletÁ∫øÁ®ãÁöÑËÆæËÆ°"><a href="#ServletÁ∫øÁ®ãÁöÑËÆæËÆ°" class="headerlink" title="ServletÁ∫øÁ®ãÁöÑËÆæËÆ°"></a>ServletÁ∫øÁ®ãÁöÑËÆæËÆ°</h3><p>‚Äã        ‰∏Ä‰∏™ÂÆ¢Êà∑Á´ØÁöÑÊµèËßàÂô®ËØ∑Ê±Ç,Â∞±ÊòØ‰∏Ä‰∏™Êñ∞ÁöÑÁ∫øÁ®ã„ÄÇ<br>‚Äã        <code> Server</code>Á´ØÁöÑÊúçÂä°Âô®ÂºïÊìéÈÉΩ‰ºöÂª∫Á´ã‰∏Ä‰∏™ <code>socket</code> ËøûÊé•ÁõëÂê¨ÊµèËßàÂô®ÂèëÂõûÊù•ÁöÑÁî®Êà∑ËØ∑Ê±ÇÔºåÁÑ∂ÂêéÂ∞±ÊääÊØè‰∏™ËØ∑Ê±ÇÂΩìÊàê‰∏Ä‰∏™Êñ∞ÁöÑÁ∫øÁ®ãÊù•Â§ÑÁêÜ„ÄÇ<br>‚Äã        <code>Servlet</code>ÁîüÂëΩÂë®ÊúüÂàÜ‰∏∫‰∏â‰∏™Èò∂ÊÆµÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent38.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent38.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        Èò∂ÊÆµ1ÔºöÂàùÂßãÂåñÈò∂ÊÆµË∞ÉÁî®<code>init()</code>ÊñπÊ≥ï„ÄÇ<code>Servlet</code>Âú®‰∏ãÂàóÊó∂ÂàªËøõË°åÂàùÂßãÂåñÈò∂ÊÆµ„ÄÇ</p>
<blockquote>
<ul>
<li><strong><code>Servlet</code>ÂÆπÂô®ÂêØÂä®Êó∂Ëá™Âä®Ë£ÖËΩΩÊüê‰∫õ <code>Servlet</code>ÔºåÂÆûÁé∞ÂÆÉÂè™ÈúÄË¶ÅÂú®<code>web.XML</code>Êñá‰ª∂‰∏≠ÁöÑ<code>&lt;Servlet&gt;&lt;/Servlet&gt;</code>‰πãÈó¥Ê∑ªÂä†‰∏ÄË°åÔºö<code>&lt;loadon-startup&gt;1&lt;/loadon-startup&gt;</code>„ÄÇ</strong></li>
<li><strong>Âú®<code>Servlet</code>ÂÆπÂô®ÂêØÂä®ÂêéÔºåÂÆ¢Êà∑È¶ñÊ¨°Âêë<code>Servlet</code>ÂèëÈÄÅËØ∑Ê±Ç„ÄÇ</strong></li>
<li><strong><code>Servlet</code>Á±ªÊñá‰ª∂Ë¢´Êõ¥Êñ∞ÂêéÔºåÈáçÊñ∞Ë£ÖËΩΩ<code>Servlet</code>Ôºå<code>Servlet</code>Ë¢´Ë£ÖËΩΩÂêéÔºå<code>Servlet</code>ÂÆπÂô®ÂàõÂª∫‰∏Ä‰∏™ <code>Servlet</code>ÂÆû‰æãÂπ∂‰∏îË∞ÉÁî®<code>Servlet</code>ÁöÑ <code>init()</code>ÊñπÊ≥ïËøõË°åÂàùÂßãÂåñ„ÄÇÂú®<code>Servlet</code>ÁöÑÊï¥‰∏™ÁîüÂëΩÂë®ÊúüÂÜÖÔºå<code>init()</code>ÊñπÊ≥ïÂè™Ë¢´Ë∞ÉÁî®‰∏ÄÊ¨°„ÄÇ</strong></li>
</ul>
</blockquote>
<p>‚Äã        Èò∂ÊÆµ2ÔºöÂìçÂ∫îÂÆ¢Êà∑ËØ∑Ê±ÇÈò∂ÊÆµ,Ë∞ÉÁî®<code>service()</code>ÊñπÊ≥ï„ÄÇ<br>‚Äã        Èò∂ÊÆµ3ÔºöÁªàÊ≠¢Èò∂ÊÆµ„ÄÇÂΩìÊúçÂä°Âô®ÂÖ≥Èó≠ÁöÑÊó∂ÂÄôÔºåË∞ÉÁî®<code>destroy()</code>ÊñπÊ≥ï„ÄÇ<br>‚Äã        ÂèØËßÅ <code>Servlet</code>Âú®Êï¥‰∏™<strong>Tomcat</strong>ÊàñËÄÖÂ∞±<strong>Jetty</strong> ÁöÑÊúçÂä°Âô®‰∏≠ÊòØÂçï‰æãÁöÑ„ÄÇÊâÄ‰ª•ÔºåÂú®ÂÖ±‰∫´ÂèòÈáèÁöÑÊó∂ÂÄôÊòØÁ∫øÁ®ã‰∏çÂÆâÂÖ®ÁöÑ,Â§ßÂÆ∂‰ΩøÁî®ÁöÑÊó∂ÂÄôË¶ÅÂ∞èÂøÉ‰∏ÄÁÇπ„ÄÇ‰ΩÜÊòØÔºå‰∏∫‰ªÄ‰πàÁõ∏ÂØπ‰∫éÊØè‰∏™ËØ∑Ê±ÇÊù•ËØ¥ÂèàÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂë¢?<br>‚Äã        ÂÖàÁúãÂ¶Ç‰∏ã<code>Servlet</code>Ê∫êÁ†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Servlet</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">ServletConfig</span> config<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ServletConfig</span> <span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> res<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getServletInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        Êàë‰ª¨ÁúãÂà∞Âè™Êúâ<code>service</code>ÊñπÊ≥ïÂèØ‰ª•Â§ÑÁêÜÁî®Êà∑ËØ∑Ê±ÇÔºåÊØè‰∏ÄÊ¨°Áî®Êà∑ÁöÑËØ∑Ê±ÇÈÉΩ‰ºöÂàõÂª∫<code>ServletRequest</code> ÁöÑ‰∏Ä‰∏™Êñ∞ÁöÑÂØπË±°ÔºåÊâÄ‰ª•<code>ServletRequest</code>ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÔºåÂØπ‰∫éÊØè‰∏Ä‰∏™ËØ∑Ê±ÇÁî±‰∏Ä‰∏™Â∑•‰ΩúÁ∫øÁ®ãÊù•ÊâßË°åÔºåÊâÄ‰ª•<code>ServletResquest</code> Âè™ËÉΩÂú®‰∏Ä‰∏™Á∫øÁ®ã‰∏≠Ë¢´ËÆøÈóÆÔºåËÄå‰∏îÂÆÉÂè™Âú®<code>service()</code>ÊñπÊ≥ïÂÜÖÊòØÊúâÊïàÁöÑ„ÄÇ<br>‚Äã        ÊúÄÂêéÔºåÊó¢ÁÑ∂ÊØè‰∏™ËØ∑Ê±ÇÈÉΩ‰ºöÂèëËµ∑‰∏Ä‰∏™Á∫øÁ®ãÔºåÈÇ£‰πàÂ∞±‰ºöÂá∫Áé∞Êàë‰ª¨‰πãÂâçËØ¥ÁöÑÂ§öÁ∫øÁ®ãÂπ∂ÂèëÁöÑÈóÆÈ¢òÔºåËÄåÊàë‰ª¨Â∑•‰Ωú‰∏≠Âë¢ÔºåÂèàÊòØÂ¶Ç‰ΩïËß£ÂÜ≥ÁöÑÂë¢ÔºüÂÖ∂ÂÆû‰∏çËÆ∫<code>Tomcat</code>„ÄÅ<code>Jetty</code>ÔºåËøòÊòØ<code>Nginx</code>ÔºåÈÉΩÊúâÁõ∏Â∫îÁöÑËß£ÂÜ≥ÊñπÊ°àÔºåÊàë‰ª¨Êé•‰∏ãÊù•ËØ¶ÁªÜÁúãÁúã„ÄÇ</p>
<h3 id="Á∫øÁ®ãÊ±†Â¶Ç‰ΩïÂêàÁêÜËÆæËÆ°ÂíåÈÖçÁΩÆ"><a href="#Á∫øÁ®ãÊ±†Â¶Ç‰ΩïÂêàÁêÜËÆæËÆ°ÂíåÈÖçÁΩÆ" class="headerlink" title="Á∫øÁ®ãÊ±†Â¶Ç‰ΩïÂêàÁêÜËÆæËÆ°ÂíåÈÖçÁΩÆ"></a>Á∫øÁ®ãÊ±†Â¶Ç‰ΩïÂêàÁêÜËÆæËÆ°ÂíåÈÖçÁΩÆ</h3><p>‚Äã        Êó¢ÁÑ∂Êúâ‰∫ÜÁ∫øÁ®ãÊ±†ÔºåÈÇ£ÊÄé‰πàÊ†∑ÊâçÁÆóÈÖçÁΩÆËÆæÁΩÆÂêàÁêÜÂë¢ÔºüÊÄªÁªìËµ∑Êù•Â∞±ÊòØ‰∏ÄÂè•ËØùÔºå<strong>ÊúÄÂ§ßÈôêÂ∫¶Âú∞ÂèëÊå•ÂçïÂè∞Áâ©ÁêÜserverÊú∫Âô®ÁöÑÊúÄÂ§ßÂπ∂ÂèëÈáè(Âç≥ÔºöÁ∫øÁ®ãÊï∞)Ôºå‰ΩÜÂèà‰∏çËá≥‰∫éÊúçÂä°Âô®ÂÆïÊú∫ÔºåÂÅúÊ≠¢ÂìçÂ∫îÔºåËÄåÂºïËµ∑ËøûÈîÅÂèçÂ∫îÂΩ¢ÊàêÁ≥ªÁªüÂ¥©Ê∫É</strong>„ÄÇÈÇ£‰πàÂ∞±ÂøÖÈ°ªÁü•ÈÅì‰∏§‰∏™ÂèÇÊï∞‰∫ÜÔºöÊú¨Âè∞<strong>server</strong>ÁöÑÊúÄÂ§ßÂèØÂìçÂ∫îÁöÑÂπ∂ÂèëÈáèÊòØÂ§öÂ∞ëÔºüÊûÅÈôêÂπ∂ÂèëÈáèÊòØÂ§öÂ∞ëÔºüÊé•‰∏ãÊù•,Êàë‰ª¨Â∞ÜËÆ≤Ëø∞‰∏§ÁßçÊµãÂá∫ÊúÄÂ§ßÂπ∂ÂèëÁ∫øÁ®ãÁöÑÊñπÊ≥ï„ÄÇ<br>‚Äã        (1)Á¨¨1Á´†‰∏≠Êàë‰ª¨ËÆ≤Âà∞ÔºåÂ¶Ç‰ΩïËÆ°ÁÆó‰∏Ä‰∏™ËÆ°ÁÆóÊú∫(Áâ©ÁêÜÊú∫)ÁöÑÊúÄÂ§ßÂπ∂ÂèëÈáèÔºåËøô‰∏™ÊúÄÂ§ßÂπ∂ÂèëÈáèÂÖ∂ÂÆûÂ∞±ÊòØËøô‰∏™<strong>server</strong> ÁöÑÊúÄÂ∞èÂπ∂ÂèëÈáè„ÄÇËÄåÊàë‰ª¨Âú®Á¨¨1Á´†‰πüËØ¥‰∫Ü<strong>CPU</strong>ÁöÑÁ∫øÁ®ãÂ∑•‰ΩúÊú∫Âà∂ÂèäÂÖ∂ÂíåÂÜÖÂ≠òÁöÑÂÖ≥Á≥ªÔºå<strong>Áü•ÈÅìÊ†πÊçÆËØ∑Ê±ÇÁöÑÂ§ßÂ∞èÂíåCPUÁöÑËøêË°åÊú∫Âà∂ÂíåÊâßË°åÊó∂Èó¥,Â∞±ÂèØ‰ª•ÁÆóÂá∫‰∏Ä‰∏™Â§ßÊ¶ÇÁöÑÊúÄÂ§ßÂπ∂ÂèëÈáè</strong>„ÄÇÊ†πÊçÆÁöÑÂèÇÊï∞ÊúâÔºöÂÜÖÂ≠òÂ§ßÂ∞èÂíåÂìçÂ∫îÂ§ßÂ∞èÂØπÂ∫î„ÄÅÂÆΩÂ∏¶ÂíåËØ∑Ê±ÇÂ§ßÂ∞èÂØπÂ∫î„ÄÅÂçïÂè∞IOÁöÑËøêË°åÊó∂Èó¥„ÄÅCPUÂàáÊç¢Êó∂Èó¥ÂíåÁúüÊ≠£ÁöÑÁ®ãÂ∫èÊâßË°åÊó∂Èó¥ÂØπÂ∫î„ÄÅÊúâÊ≤°ÊúâÊï∞ÊçÆÂ∫ìÂ§ÑÁêÜ‰∏äÁöÑÁ≠âÂæÖ„ÄÇ<br>‚Äã        (2)ÈÄöËøáÊó•ÂøóÁõëÊéßÔºåÁúãÁúãÁî®Êà∑ÈÉΩËÆøÈóÆ‰∫ÜÂì™‰∫õËØ∑Ê±ÇÈ°µÈù¢ÔºåÂèëÈÄÅ‰∫ÜÂì™‰∫õÂèÇÊï∞ÔºåÁÑ∂ÂêéÊâæ‰∏Ä‰∏™ÂíåÊúçÂä°Âô®‰∏ÄÊ†∑ÈÖçÁΩÆÁöÑÊú∫Âô®ÂÅö‰∏Ä‰∏ãÂéãÂäõÊµãËØïÂ∞±ÂèØ‰ª•ÂæóÂá∫ÊúçÂä°Âô®ÁöÑÊúÄÂ§ßÂπ∂ÂèëÂíåÊäóÂéãËÉΩÂäõ‰∫Ü„ÄÇÊØîÂ¶ÇÔºöÊê∫Á®ãÁöÑÊêúÁ¥¢ÊúçÂä°Âô®Á∫ø‰∏ä‰∏ÄÂÖ±ÊòØÂõõÂè∞ÂÅöÁöÑË¥üËΩΩÂùáË°°ÔºåËÄåÈÄöËøáÂéãÂäõÊµãËØïÊàë‰ª¨ÂèëÁé∞ÊØè‰∏™<strong>server</strong>ÁöÑÊúÄÂ§ßÂπ∂ÂèëÈáèÊòØ300‰∏™Á∫øÁ®ã„ÄÇ<br>‚Äã        Áü•ÈÅì‰∫ÜËøô‰∫õ‰ø°ÊÅØ‰πãÂêé,Â∞±ÂèØ‰ª•ÈÄöËøáÊàë‰ª¨ÂâçÈù¢ËÆ≤ÁöÑÁ∫øÁ®ãÊ±†ÁöÑËÆæÁΩÆÂèÇÊï∞**<code>int corePoolSize„ÄÅint maximumPoolSize</code>**ÔºåËÆæÁΩÆ‰∏Ä‰∏™ÂêàÁêÜÁöÑÂ§ßÂ∞èÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇ</p>
<h3 id="Tomcat‰∏≠Á∫øÁ®ãÊ±†Â¶Ç‰ΩïÂêàÁêÜËÆæÁΩÆ"><a href="#Tomcat‰∏≠Á∫øÁ®ãÊ±†Â¶Ç‰ΩïÂêàÁêÜËÆæÁΩÆ" class="headerlink" title="Tomcat‰∏≠Á∫øÁ®ãÊ±†Â¶Ç‰ΩïÂêàÁêÜËÆæÁΩÆ"></a>Tomcat‰∏≠Á∫øÁ®ãÊ±†Â¶Ç‰ΩïÂêàÁêÜËÆæÁΩÆ</h3><p>‚Äã       (1ÔºâÂÖàÊù•ÁúãTomcatÈáåÈù¢Â¶Ç‰ΩïÈÖçÁΩÆÁ∫øÁ®ãÊ±†„ÄÇ<br>‚Äã       È¶ñÂÖàÔºåÊâìÂºÄ<code>/conf/server.xml</code>,Â¢ûÂä†Â¶Ç‰∏ã‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Executor</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tomcatThreadPool<span class="token punctuation">"</span></span> <span class="token attr-name">namePrefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>catalina-exec-<span class="token punctuation">"</span></span>
	<span class="token attr-name">maxThreads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span> <span class="token attr-name">minSpareThreads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25<span class="token punctuation">"</span></span> <span class="token attr-name">maxIdleTime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60000<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p>‚Äã       ÊúÄÂ§ßÁ∫øÁ®ã200ÔºåÊúÄÂ∞èÁ©∫Èó≤Á∫øÁ®ãÊï∞25ÔºåÁ∫øÁ®ãÊúÄÂ§ßÁ©∫Èó≤Êó∂Èó¥60s„ÄÇ</p>
<p>‚Äã       ÁÑ∂Âêé,‰øÆÊîπ<code>&lt;Connector ...&gt;</code>ËäÇÁÇπÔºåÂ¢ûÂä†<strong>executor</strong>Â±ûÊÄß,‰ª£Á†ÅÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connector</span> <span class="token attr-name">executor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tomcatThreadPool<span class="token punctuation">"</span></span>
	<span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>80<span class="token punctuation">"</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HTTP/1.1<span class="token punctuation">"</span></span>
	<span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60000<span class="token punctuation">"</span></span>
	<span class="token attr-name">keepAliveTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>15000<span class="token punctuation">"</span></span>
	<span class="token attr-name">maxKeepAliveRequests</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>
	<span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8443<span class="token punctuation">"</span></span>
	<span class="token attr-name">.....</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã       tomcatThreadPool‰∏∫‰∏äÈù¢Á∫øÁ®ãÊ±†ÁöÑÂêçÂ≠ó„ÄÇ</p>
<blockquote>
<p><strong>ÊèêÁ§∫ÔºöÂèØ‰ª•Â§ö‰∏™connector ÂÖ±Áî®1‰∏™Á∫øÁ®ãÊ±†„ÄÇ</strong></p>
</blockquote>
<p>‚Äã       (2ÔºâÊé•‰∏ãÊù•Êàë‰ª¨Áúã‰∏Ä‰∏ã <strong>Executor</strong> ÁöÑÂèÇÊï∞ÊúâÂì™‰∫õ,Â¶Ç‰∏ãË°®ÊâÄÁ§∫:. </p>
<p><img src="/image/Concurrent/Concurrent39.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent39.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã       Áî±‰∫éÊàë‰ª¨Êú¨‰π¶‰∏ªË¶ÅËÆ≤Ëß£Á∫øÁ®ãÊ±†Ôºå<strong>Connector</strong>ÁöÑÂèÇÊï∞Êàë‰ª¨Â∞±‰∏çÂú®ËøôÈáå‰∏Ä‰∏ÄËØ¥Êòé‰∫Ü(ËØ¶ÁªÜÂÜÖÂÆπËØ∑ÂèÇÁúãÈôÑÂΩï4Ôºâ„ÄÇ<br>‚Äã       (3)<strong>Tomcat</strong>ÁöÑÁ∫øÁ®ãÊ±† <strong>Executor</strong>ÂÆûÁé∞ÂéüÁêÜ„ÄÇ<br>‚Äã       Êàë‰ª¨ÂÖàÁúã‰∏Ä‰∏ã<strong>Tomcat</strong>ÂÆπÂô®ÈáåÈù¢<code>org.apache.catalina.Executor</code>ÁöÑÊ∫êÁ†Å:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Executor</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>Executor</span><span class="token punctuation">,</span> <span class="token class-name">Lifecycle</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Âú®Â∞ÜÊù•ÁöÑÊüê‰∏™Êó∂ÂÄôÊâßË°åÁªôÂÆöÁöÑÂëΩ‰ª§„ÄÇÂëΩ‰ª§ÂèØ‰ª•Âú®Êñ∞Á∫øÁ®ã„ÄÅÊ±†ÂåñÁ∫øÁ®ãÊàñË∞ÉÁî®Á∫øÁ®ã‰∏≠ÊâßË°åÔºåÁî±ExecutorÂÆûÁé∞Ëá™Ë°åÂÜ≥ÂÆö„ÄÇÂ¶ÇÊûúÊ≤°ÊúâÂèØÁî®ÁöÑÁ∫øÁ®ãÔºåÂÆÉÂ∞ÜË¢´Ê∑ªÂä†Âà∞Â∑•‰ΩúÈòüÂàó‰∏≠„ÄÇÂ¶ÇÊûúÂ∑•‰ΩúÈòüÂàóÂ∑≤Êª°ÔºåÁ≥ªÁªüÂ∞ÜÁ≠âÂæÖÊåáÂÆöÁöÑÊó∂Èó¥ÔºåÁõ¥Âà∞ÊäõÂá∫RejectedExecutionException
     *
     ÂèÇÊï∞	ÂëΩ‰ª§‚ÄîÂèØËøêË°åÁöÑ‰ªªÂä°
    	 Ë∂ÖÊó∂-Á≠âÂæÖ‰ªªÂä°ÂÆåÊàêÁöÑÊó∂Èó¥ÈïøÂ∫¶
		 Âçï‰Ωç-Ë°®Á§∫Ë∂ÖÊó∂ÁöÑÂçï‰Ωç
     *
     * @throws java.util.concurrent.RejectedExecutionException if this task
     * cannot be accepted for execution - the queue is full
     * @throws NullPointerException if command or unit is null
     */</span>
    <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÊâÄ‰ª•Âè™Ë¶ÅÂÆûÁé∞<strong>Excecutor</strong>Êé•Âè£Â∞±ÂèØ‰ª•Ëá™ÂÆö‰πâÁ∫øÁ®ãÊ±†‰∫Ü„ÄÇ</p>
<p>Êàë‰ª¨ÂÜçÁúã‰∏Ä‰∏ãÈªòËÆ§<code>org.apache.catalina.core.StandardThreadExecutor</code>ÁöÑÊ∫êÁ†Å:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">RejectedExecutionException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span></span><span class="token class-name">Executor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span></span><span class="token class-name">LifecycleException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span></span><span class="token class-name">LifecycleState</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">LifecycleMBeanBase</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>res<span class="token punctuation">.</span></span><span class="token class-name">StringManager</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads<span class="token punctuation">.</span></span><span class="token class-name">ResizableExecutor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads<span class="token punctuation">.</span></span><span class="token class-name">TaskQueue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads<span class="token punctuation">.</span></span><span class="token class-name">TaskThreadFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StandardThreadExecutor</span> <span class="token keyword">extends</span> <span class="token class-name">LifecycleMBeanBase</span>
        <span class="token keyword">implements</span> <span class="token class-name">Executor</span><span class="token punctuation">,</span> <span class="token class-name">ResizableExecutor</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">StringManager</span> sm <span class="token operator">=</span>
            <span class="token class-name">StringManager</span><span class="token punctuation">.</span><span class="token function">getManager</span><span class="token punctuation">(</span><span class="token class-name">Constants<span class="token punctuation">.</span>Package</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ---------------------------------------------- Properties</span>
    <span class="token comment">/**
     * Default thread priority
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> threadPriority <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span>NORM_PRIORITY<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Run threads in daemon or non-daemon state
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> daemon <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Default name prefix for the thread name
     */</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> namePrefix <span class="token operator">=</span> <span class="token string">"tomcat-exec-"</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * max number of threads
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> maxThreads <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * min number of threads
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> minSpareThreads <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * idle time in milliseconds
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> maxIdleTime <span class="token operator">=</span> <span class="token number">60000</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * The executor we use for this component
     */</span>
    <span class="token keyword">protected</span> <span class="token class-name">ThreadPoolExecutor</span> executor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * the name of this thread pool
     */</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">/**
     * prestart threads?
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> prestartminSpareThreads <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * The maximum number of elements that can queue up before we reject them
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> maxQueueSize <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span>

    <span class="token comment">/**
     * After a context is stopped, threads in the pool are renewed. To avoid
     * renewing all threads at the same time, this delay is observed between 2
     * threads being renewed.
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">long</span> threadRenewalDelay <span class="token operator">=</span>
        <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads<span class="token punctuation">.</span></span>Constants</span><span class="token punctuation">.</span>DEFAULT_THREAD_RENEWAL_DELAY<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">TaskQueue</span> taskqueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// ---------------------------------------------- Constructors</span>
    <span class="token keyword">public</span> <span class="token class-name">StandardThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//empty constructor for the digester</span>
    <span class="token punctuation">&#125;</span>


    <span class="token comment">// ---------------------------------------------- Public Methods</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token comment">/**
     * Start the component and implement the requirements
     * of &#123;@link org.apache.catalina.util.LifecycleBase#startInternal()&#125;.
     *
     * @exception LifecycleException if this component detects a fatal error
     *  that prevents this component from being used
     */</span>
     <span class="token comment">//Âà©Áî®LifecycleÁöÑÂæ™ÁéØÊú∫Âà∂ÂºÄÂßãÊñπÊ≥ï</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">startInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">&#123;</span>
    	<span class="token comment">//Êàë‰ª¨ÂâçÈù¢ËÆ≤ÁöÑqueueÊú∫Âà∂,ÂæÄ‰∏ãÁúãÁöÑËØùÊòØÁî®ÁöÑ LinkedBlockingQueue</span>
    	<span class="token comment">//public class TaskQueue extends LinkedBlockingQueue&lt;Runnable></span>
        taskqueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskQueue</span><span class="token punctuation">(</span>maxQueueSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ËøôÈáåÁî®‰∫ÜÊàë‰ª¨ÂâçÈù¢ËÆ≤ÁöÑËá™ÂÆö‰πâÁ∫øÁ®ãÂ∑•ÂéÇÂπøÊñπÊ≥ï„ÄÇ</span>
        <span class="token class-name">TaskThreadFactory</span> tf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskThreadFactory</span><span class="token punctuation">(</span>namePrefix<span class="token punctuation">,</span>daemon<span class="token punctuation">,</span><span class="token function">getThreadPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Âú®ËøôÈáåÁî®Âà∞‰∫ÜÊàë‰ª¨ÂâçÈù¢ËÆ≤ÁöÑËá™ÂÆö‰πâ‰∏Ä‰∏™Á∫øÁ®ãÊ±†,ËøôÈáåÂ∞±ÂèØ‰ª•ÂæàÂ•ΩÁöÑËß£Èáä‰∫ÜÊàë‰ª¨ÂâçÈù¢ÁöÑ</span>
‰∫õÂèÇÊï∞ÁöÑÊÑèÊÄùÂíåÁî®ÊÑè‰∫Ü„ÄÇ
        executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token function">getMinSpareThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getMaxThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> maxIdleTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>taskqueue<span class="token punctuation">,</span> tf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">setThreadRenewalDelay</span><span class="token punctuation">(</span>threadRenewalDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>prestartminSpareThreads<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executor<span class="token punctuation">.</span><span class="token function">prestartAllCoreThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        taskqueue<span class="token punctuation">.</span><span class="token function">setParent</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token class-name">LifecycleState</span><span class="token punctuation">.</span>STARTING<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token comment">/**
     * ÂÅúÊ≠¢ÁªÑ‰ª∂Âπ∂ÂÆûÁé∞org.apache.catalina.util.LifecycleBase.stopInternal()ÁöÑÈúÄÊ±Ç„ÄÇ
     *
     * @exception LifecycleException if this component detects a fatal error
     *  that needs to be reported
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">stopInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">&#123;</span>

        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token class-name">LifecycleState</span><span class="token punctuation">.</span>STOPPING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executor<span class="token punctuation">.</span><span class="token function">shutdownNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        taskqueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">destroyInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">destroyInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span>timeout<span class="token punctuation">,</span>unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"standardThreadExecutor.notStarted"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RejectedExecutionException</span> rx<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">//there could have been contention around the queue</span>
                <span class="token comment">//ÈòüÂàóÂë®Âõ¥ÂèØËÉΩÂèëÁîü‰∫Ü‰∫âÊâß</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TaskQueue</span><span class="token punctuation">)</span> executor<span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">force</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RejectedExecutionException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"standardThreadExecutor.queueFull"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"standardThreadExecutor.notStarted"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextStopping</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executor<span class="token punctuation">.</span><span class="token function">contextStopping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getThreadPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> threadPriority<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">return</span> daemon<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getNamePrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> namePrefix<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxIdleTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> maxIdleTime<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> maxThreads<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMinSpareThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> minSpareThreads<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isPrestartminSpareThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">return</span> prestartminSpareThreads<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setThreadPriority</span><span class="token punctuation">(</span><span class="token keyword">int</span> threadPriority<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>threadPriority <span class="token operator">=</span> threadPriority<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> daemon<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>daemon <span class="token operator">=</span> daemon<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNamePrefix</span><span class="token punctuation">(</span><span class="token class-name">String</span> namePrefix<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>namePrefix <span class="token operator">=</span> namePrefix<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxIdleTime</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxIdleTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxIdleTime <span class="token operator">=</span> maxIdleTime<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executor<span class="token punctuation">.</span><span class="token function">setKeepAliveTime</span><span class="token punctuation">(</span>maxIdleTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxThreads</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxThreads<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxThreads <span class="token operator">=</span> maxThreads<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executor<span class="token punctuation">.</span><span class="token function">setMaximumPoolSize</span><span class="token punctuation">(</span>maxThreads<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMinSpareThreads</span><span class="token punctuation">(</span><span class="token keyword">int</span> minSpareThreads<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>minSpareThreads <span class="token operator">=</span> minSpareThreads<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executor<span class="token punctuation">.</span><span class="token function">setCorePoolSize</span><span class="token punctuation">(</span>minSpareThreads<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPrestartminSpareThreads</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> prestartminSpareThreads<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>prestartminSpareThreads <span class="token operator">=</span> prestartminSpareThreads<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxQueueSize</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxQueueSize <span class="token operator">=</span> size<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxQueueSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> maxQueueSize<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getThreadRenewalDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> threadRenewalDelay<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setThreadRenewalDelay</span><span class="token punctuation">(</span><span class="token keyword">long</span> threadRenewalDelay<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>threadRenewalDelay <span class="token operator">=</span> threadRenewalDelay<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executor<span class="token punctuation">.</span><span class="token function">setThreadRenewalDelay</span><span class="token punctuation">(</span>threadRenewalDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// Statistics from the thread pool Êù•Ëá™Á∫øÁ®ãÊ±†ÁöÑÁªüËÆ°‰ø°ÊÅØ</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getActiveCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> executor<span class="token punctuation">.</span><span class="token function">getActiveCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getCompletedTaskCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> executor<span class="token punctuation">.</span><span class="token function">getCompletedTaskCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCorePoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> executor<span class="token punctuation">.</span><span class="token function">getCorePoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getLargestPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> executor<span class="token punctuation">.</span><span class="token function">getLargestPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> executor<span class="token punctuation">.</span><span class="token function">getPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getQueueSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> executor<span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">resizePool</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span> <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        executor<span class="token punctuation">.</span><span class="token function">setCorePoolSize</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">setMaximumPoolSize</span><span class="token punctuation">(</span>maximumPoolSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">resizeQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">getDomainInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// No way to navigate to Engine. Needs to have domain set.</span>
        <span class="token comment">//Ê≤°ÊúâÂäûÊ≥ïÂØºËà™Âà∞ÂºïÊìé„ÄÇÈúÄË¶ÅÊúâÂüüÈõÜ„ÄÇ</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">getObjectNameKeyProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">StringBuilder</span> name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">"type=Executor,name="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        name<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> name<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>
<span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">AccessController</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">PrivilegedAction</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">AtomicInteger</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">PrivilegedSetTccl</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Simple task thread factory to use to create threads for an executor
 * implementation.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskThreadFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ThreadGroup</span> group<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> threadNumber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> namePrefix<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> daemon<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> threadPriority<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TaskThreadFactory</span><span class="token punctuation">(</span><span class="token class-name">String</span> namePrefix<span class="token punctuation">,</span> <span class="token keyword">boolean</span> daemon<span class="token punctuation">,</span> <span class="token keyword">int</span> priority<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SecurityManager</span> s <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        group <span class="token operator">=</span> <span class="token punctuation">(</span>s <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> s<span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>namePrefix <span class="token operator">=</span> namePrefix<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>daemon <span class="token operator">=</span> daemon<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>threadPriority <span class="token operator">=</span> priority<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">TaskThread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskThread</span><span class="token punctuation">(</span>group<span class="token punctuation">,</span> r<span class="token punctuation">,</span> namePrefix <span class="token operator">+</span> threadNumber<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span>daemon<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span>threadPriority<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Set the context class loader of newly created threads to be the class</span>
        <span class="token comment">// loader that loaded this factory. This avoids retaining references to</span>
        <span class="token comment">// web application class loaders and similar.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>IS_SECURITY_ENABLED<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span> pa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrivilegedSetTccl</span><span class="token punctuation">(</span>
                    t<span class="token punctuation">,</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span>pa<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            t<span class="token punctuation">.</span><span class="token function">setContextClassLoader</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> t<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>
<span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingQueue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">RejectedExecutionException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>res<span class="token punctuation">.</span></span><span class="token class-name">StringManager</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * As task queue specifically designed to run with a thread pool executor. The
 * task queue is optimised to properly utilize threads within a thread pool
 * executor. If you use a normal queue, the executor will spawn threads when
 * there are idle threads and you wont be able to force items onto the queue
 * itself.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskQueue</span> <span class="token keyword">extends</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">StringManager</span> sm <span class="token operator">=</span> <span class="token class-name">StringManager</span>
            <span class="token punctuation">.</span><span class="token function">getManager</span><span class="token punctuation">(</span><span class="token string">"org.apache.tomcat.util.threads.res"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">ThreadPoolExecutor</span> parent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// No need to be volatile. This is written and read in a single thread</span>
    <span class="token comment">// (when stopping a context and firing the  listeners)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> forcedRemainingCapacity <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TaskQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">TaskQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>capacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">TaskQueue</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Runnable</span><span class="token punctuation">></span></span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setParent</span><span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span> tp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        parent <span class="token operator">=</span> tp<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">force</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> parent<span class="token punctuation">.</span><span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RejectedExecutionException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"taskQueue.notRunning"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//forces the item onto the queue, to be used if the task is rejected</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">force</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> parent<span class="token punctuation">.</span><span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RejectedExecutionException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"taskQueue.notRunning"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span>timeout<span class="token punctuation">,</span>unit<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//forces the item onto the queue, to be used if the task is rejected</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">offer</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">//we can't do any checks</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//we are maxed out on threads, simply queue the object</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">getPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> parent<span class="token punctuation">.</span><span class="token function">getMaximumPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//we have idle threads, just add it to the queue</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">getSubmittedCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">getPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//if we have less threads than maximum force creation of a new thread</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">getPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>parent<span class="token punctuation">.</span><span class="token function">getMaximumPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token comment">//if we reached here, we need to add it to the queue</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Runnable</span> <span class="token function">poll</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Runnable</span> runnable <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>timeout<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>runnable <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> parent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// the poll timed out, it gives an opportunity to stop the current</span>
            <span class="token comment">// thread if needed to avoid memory leaks.</span>
            parent<span class="token punctuation">.</span><span class="token function">stopCurrentThreadIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> runnable<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Runnable</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span><span class="token function">currentThreadShouldBeStopped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token function">poll</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">getKeepAliveTime</span><span class="token punctuation">(</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// yes, this may return null (in case of timeout) which normally</span>
            <span class="token comment">// does not occur with take()</span>
            <span class="token comment">// but the ThreadPoolExecutor implementation allows this</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">remainingCapacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>forcedRemainingCapacity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// ThreadPoolExecutor.setCorePoolSize checks that</span>
            <span class="token comment">// remainingCapacity==0 to allow to interrupt idle threads</span>
            <span class="token comment">// I don't see why, but this hack allows to conform to this</span>
            <span class="token comment">// "requirement"</span>
            <span class="token keyword">return</span> forcedRemainingCapacity<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">remainingCapacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setForcedRemainingCapacity</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> forcedRemainingCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>forcedRemainingCapacity <span class="token operator">=</span> forcedRemainingCapacity<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="NginxÁ∫øÁ®ãÊ±†"><a href="#NginxÁ∫øÁ®ãÊ±†" class="headerlink" title="NginxÁ∫øÁ®ãÊ±†"></a>NginxÁ∫øÁ®ãÊ±†</h3><p>‚Äã        <code>Nginx</code> ÁöÑÊúÄÂ§ß‰ΩúÁî®Â∞±ÊòØÂÅöË¥üËΩΩÂùáË°°ÔºåËøõË°åËØ∑Ê±ÇÁöÑÂàÜÂèëÔºå‰∏çË¶ÅÂÅöIOÔºå‰∏çË¶ÅÂÅöÂÖ∂‰ªñ‰ªª‰ΩïÂàÜÂç†CPUÂíåÂÜÖÂ≠òÁöÑ‰∫ãÊÉÖÔºåÂè™ÂÅöË¥üËΩΩÂàÜÂèëÔºå<code>Nginx</code>Êú¨Ë∫´ËÆæËÆ°Âæó‰πüÂæàÂ•ΩÔºåÂü∫Êú¨‰∏äÂèØ‰ª•Êé•ËøëCPUÂéüÁîüÁöÑÁ∫øÁ®ãÂπ∂ÂèëÂ≥∞ÂÄºÔºåÂ•ΩÁöÑÊúçÂä°Âô®ÈÖçÁΩÆÂ•ΩÁöÑËØùÔºåÂ∫îËØ•3ÁßíÂÜÖÂπ∂Âèë‰∏™Âá†ÂçÉÊ≤°‰ªÄ‰πàÈóÆÈ¢ò„ÄÇÊé•‰∏ãÊù•Êàë‰ª¨ËØ¥‰∏Ä‰∏ã<code>Nginx</code>ÁöÑÂ∏∏Áî®ÁöÑÈÖçÁΩÆÔºå‰ª•ÂèäÂ¶Ç‰ΩïËÆæÁΩÆÂπ∂Âèë?<br>ÂÖ∂ÂÆûNginxÈáåÈù¢Ê≤°ÊúâÁªôÂÆöÁ∫øÁ®ãÊ±†ÁöÑÁõ∏ÂÖ≥Ê¶ÇÂøµÂíåÈÖçÁΩÆ,‰ΩÜÊòØÂ¶ÇÊûú‰∏∫‰∫Ü‰ª•Èò≤‰∏á‰∏ÄÁöÑËØùÔºåÂèØ‰ª•Ê≥®ÊÑèÂ¶Ç‰∏ãÂèÇÊï∞:<br>‚Äã        (1Ôºâ<code>ngx_http_limit_req_module</code>Ê®°ÂùóÔºà0.7.21) ÂèØ‰ª•ÈÄöËøáÂÆö‰πâÁöÑÈîÆÂÄºÊù•ÈôêÂà∂ËØ∑Ê±ÇÂ§ÑÁêÜÁöÑÈ¢ëÁéá„ÄÇÁâπÂà´Âú∞ÔºåÂÆÉÂèØ‰ª•ÈôêÂà∂Êù•Ëá™Âçï‰∏™<strong>IP</strong>Âú∞ÂùÄÁöÑËØ∑Ê±ÇÂ§ÑÁêÜÈ¢ëÁéá„ÄÇÈôêÂà∂ÁöÑÊñπÊ≥ïÊòØÈÄöËøá‰∏ÄÁßç‚Äú<strong>ÊºèÊ°∂</strong>‚ÄùÁöÑÊñπÊ≥ï<strong>‚Äî‚Äî</strong>Âõ∫ÂÆöÊØèÁßíÂ§ÑÁêÜÁöÑËØ∑Ê±ÇÊï∞ÔºåÊé®ËøüËøáÂ§öÁöÑËØ∑Ê±ÇÂ§ÑÁêÜ„ÄÇ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">ËØ≠Ê≥ï<span class="token operator">:</span>limit_req zone<span class="token operator">=</span>name <span class="token punctuation">[</span>burst<span class="token operator">=</span>number<span class="token punctuation">]</span> <span class="token punctuation">[</span>nodelay<span class="token punctuation">]</span><span class="token punctuation">;</span>
ÈªòËÆ§ÂÄº<span class="token operator">:</span><span class="token operator">-</span>
‰∏ä‰∏ãÊñá<span class="token operator">:</span>http<span class="token punctuation">,</span> server<span class="token punctuation">,</span> location<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ËÆæÁΩÆÂØπÂ∫îÁöÑÂÖ±‰∫´ÂÜÖÂ≠òÈôêÂà∂ÂüüÂíåÂÖÅËÆ∏Ë¢´Â§ÑÁêÜÁöÑÊúÄÂ§ßËØ∑Ê±ÇÊï∞ÈòàÂÄº„ÄÇÂ¶ÇÊûúËØ∑Ê±ÇÁöÑÈ¢ëÁéáË∂ÖËøá‰∫ÜÈôêÂà∂ÂüüÈÖçÁΩÆÁöÑÂÄºÔºåËØ∑Ê±ÇÂ§ÑÁêÜ‰ºöË¢´Âª∂ËøüÔºåÊâÄ‰ª•ÔºåÊâÄÊúâÁöÑËØ∑Ê±ÇÈÉΩÊòØ‰ª•ÂÆö‰πâÁöÑÈ¢ëÁéáË¢´Â§ÑÁêÜÁöÑ„ÄÇË∂ÖËøáÈ¢ëÁéáÈôêÂà∂ÁöÑËØ∑Ê±Ç‰ºöË¢´Âª∂Ëøü,Áõ¥Âà∞Ë¢´Âª∂ËøüÁöÑËØ∑Ê±ÇÊï∞Ë∂ÖËøá‰∫ÜÂÆö‰πâÁöÑÈòàÂÄºÔºåËøôÊó∂ÔºåËøô‰∏™ËØ∑Ê±Ç‰ºöË¢´ÁªàÊ≠¢,Âπ∂ËøîÂõû503(Service Temporarily UnavailableÔºâÈîôËØØ„ÄÇËøô‰∏™ÈòàÂÄºÁöÑÈªòËÆ§ÂÄºÁ≠â‰∫é0„ÄÇÊØîÂ¶Ç‰∏ãÈù¢Ëøô‰∫õÊåá‰ª§:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">limit_req_zone $binary_remote_addr zone<span class="token operator">=</span>one<span class="token operator">:</span><span class="token number">10</span>m rate<span class="token operator">=</span><span class="token number">3000</span>r<span class="token operator">/</span>s<span class="token punctuation">;</span>
server <span class="token punctuation">&#123;</span>
    location <span class="token operator">/</span>search<span class="token operator">/</span> <span class="token punctuation">&#123;</span>
    	limit_req zone<span class="token operator">=</span>one burst<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÈôêÂà∂Âπ≥ÂùáÊØèÁßí‰∏çË∂ÖËøá3000‰∏Ä‰∏™ËØ∑Ê±ÇÔºåÂêåÊó∂ÂÖÅËÆ∏Ë∂ÖËøáÈ¢ëÁéáÈôêÂà∂ÁöÑËØ∑Ê±ÇÊï∞‰∏çÂ§ö‰∫é100‰∏™„ÄÇ</p>
<p>‚Äã        Â¶ÇÊûú‰∏çÂ∏åÊúõË∂ÖËøáÁöÑËØ∑Ê±ÇË¢´Âª∂ËøüÔºåÂèØ‰ª•Áî®<code>nodelay</code>ÂèÇÊï∞:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">limit_req zone<span class="token operator">=</span>one burst<span class="token operator">=</span><span class="token number">100</span> nodelay<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>‚Äã        (2) <code>ngx_http_limit_conn_module</code>Ê®°ÂùóÂèØ‰ª•ÊåâÁÖßÂÆö‰πâÁöÑÈîÆÈôêÂÆöÊØè‰∏™ÈîÆÂÄºÁöÑËøûÊé•Êï∞„ÄÇÁâπÂà´Âú∞ÔºåÂèØ‰ª•ËÆæÂÆöÂçï‰∏Ä<strong>IP</strong>Êù•Ê∫êÁöÑËøûÊé•Êï∞„ÄÇÂπ∂‰∏çÊòØÊâÄÊúâÁöÑËøûÊé•ÈÉΩ‰ºöË¢´Ê®°ÂùóËÆ°Êï∞ÔºåÂè™ÊúâÈÇ£‰∫õÊ≠£Âú®Ë¢´Â§ÑÁêÜÁöÑËØ∑Ê±Ç(Ëøô‰∫õËØ∑Ê±ÇÁöÑÂ§¥‰ø°ÊÅØÂ∑≤Ë¢´ÂÆåÂÖ®ËØªÂÖ•ÔºâÊâÄÂú®ÁöÑËøûÊé•Êâç‰ºöË¢´ËÆ°Êï∞„ÄÇ</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">ËØ≠Ê≥ï<span class="token operator">:</span>limit_conn zone number<span class="token punctuation">;</span>
ÈªòËÆ§ÂÄº<span class="token operator">:</span><span class="token operator">-</span>
‰∏ä‰∏ãÊñá<span class="token operator">:</span>http<span class="token punctuation">,</span> server<span class="token punctuation">,</span> location<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÊåáÂÆö‰∏ÄÂùóÂ∑≤ÁªèËÆæÂÆöÁöÑÂÖ±‰∫´ÂÜÖÂ≠òÁ©∫Èó¥Ôºå‰ª•ÂèäÊØè‰∏™ÁªôÂÆöÈîÆÂÄºÁöÑÊúÄÂ§ßËøûÊé•Êï∞„ÄÇÂΩìËøûÊé•Êï∞Ë∂ÖËøáÊúÄÂ§ßËøûÊé•Êï∞Êó∂ÔºåÊúçÂä°Âô®Â∞Ü‰ºöËøîÂõû<code>503(Service Temporarily Unavailable)</code>ÈîôËØØ„ÄÇÊØîÂ¶ÇÔºå‰∏ãÈù¢ÈÖçÁΩÆ‰∏ç‰ªÖ‰ºöÈôêÂà∂Âçï‰∏Ä<strong>IP</strong>Êù•Ê∫êÁöÑËøûÊé•Êï∞ÔºåÂêåÊó∂‰πü‰ºöÈôêÂà∂Âçï‰∏ÄËôöÊãüÊúçÂä°Âô®ÁöÑÊÄªËøûÊé•Êï∞:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">limit_conn_zone $binary_remote_addr zone<span class="token operator">=</span>perip<span class="token operator">:</span><span class="token number">10</span>m<span class="token punctuation">;</span>
limit_conn_zone $server_name zone<span class="token operator">=</span>perserver<span class="token operator">:</span><span class="token number">10</span>m<span class="token punctuation">;</span>
server <span class="token punctuation">&#123;</span>
	<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
    limit conn perip <span class="token number">10</span><span class="token punctuation">;</span>
    limit_conn perserver <span class="token number">200</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ‰∏äÈù¢Ëøô‰∏™ÈÖçÁΩÆË°®Á§∫,Âêå‰∏ÄPÂêå‰∏ÄÊó∂Èó¥Âè™ÂÖÅËÆ∏Êúâ<strong>10</strong>‰∏™ËøûÊé•„ÄÇÂçï‰∏ÄËôöÊãüÊúçÂä°Âô®ÁöÑÊÄªËøûÊé•Êï∞<strong>200</strong>„ÄÇÊé•‰∏ãÊù•Êàë‰ª¨Áúã‰∏Ä‰∏ãËøôÁßçÁ∫øÁ®ãÊ±†ÁöÑÂ±ÄÈôêÊÄß„ÄÇÁ∫øÁ®ãÊ±†ÈÖçÁΩÆÂ•Ω‰ª•ÂêéÔºåÁé∞Âú®ÁöÑÂπ∂ÂèëËØ∑Ê±ÇÂ±ÄÈôêÂ∞±ÊòØ<strong>Nginx</strong>ÊúçÂä°Âô®‰∫ÜÔºåÈÇ£Êé•‰∏ãÊù•Êàë‰ª¨ÊÄé‰πàÂÅöÂà∞Ê∑òÂÆù„ÄÅ‰∫¨‰∏ú„ÄÅÊê∫Á®ãÈÇ£ÁßçÂ§ßÂπ∂ÂèëÁöÑÊï∞ÈáèÁ∫ßÂà´Âë¢ÔºüÊàë‰ª¨ÁúãÁúã‰∏ãÈù¢‰∏§ÁßçÂÅöÊ≥ï:<br>‚Äã        Á¨¨‰∏ÄÁßçÔºöÈ´òÂØåÂ∏ÖÁöÑÁé©Ê≥ïÔºåÂ∞±ÊòØÊúÄÂ∏∏ËßÅÁöÑÊäïÂÖ•ÊàêÊú¨ÔºåËßÅÊïàÂø´ÔºåËøêÁª¥ÁÆÄÂçïÁöÑA10„ÄÅF5ÁöÑÁ°¨‰ª∂Ë¥üËΩΩÂùáË°°Âô®ÔºåÁõ¥Êé•ËøõË°åËØ∑Ê±ÇËΩ¨Âèë„ÄÇËøôÊó∂ÂÄôÂü∫Êú¨‰∏ä‰∏çÈúÄË¶Å<strong>Nginx</strong>ÔºåÁõ¥Êé•Âà∞ÂêéÂè∞<strong>Server</strong>‰∫Ü„ÄÇÂΩìÁÑ∂‰∫ÜÂä†<strong>Nginx</strong>Êõ¥Â•ΩÔºåÂèØ‰ª•ÂÜçÊâ©Â§ß<strong>NÂÄç</strong>„ÄÇ<br>‚Äã        Á¨¨‰∫åÁßçÔºöÂ±û‰∏ùÁ∫ßÁöÑÁé©Ê≥ïÔºåÂ∞±ÊòØÈÄöËøáÂüüÂêçËß£ÊûêÔºåÂª∫Á´ãÂæàÂ§öÂ≠êÂüüÂêçÔºå‰∏çÂêåÁöÑ‰∏öÂä°Ê®°ÂùóÁî±ÂüüÂêçÂàÜÂèëÂà∞‰∏çÂêåÁöÑ<strong>Nginx</strong>ÁöÑÊúçÂä°Âô®‰∏äÈù¢ÂéªÔºåÊØè‰∏™ <strong>Nginx</strong>ÂÜçÈÉΩÈÖçÁΩÆ‰∏äÂÜÖÂÆπÂàÜÂèëÁΩëÁªú(<strong>CDN</strong>),ÂÆûË°åÈùôÊÄÅÂàÜÁ¶ª,Â∞ΩÈáèÁªô<strong>Nginx</strong>ÊúçÂä°Âô®ÂáèÂ∞ëË¥üÊãÖ„ÄÇËøôÁßçÈÖçÁΩÆÂü∫Êú¨‰∏äÂèØ‰ª•Ëß£ÂÜ≥ÂæàÂ§ö‰∏≠Â∞èÂûãÂÖ¨Âè∏ÁöÑÈóÆÈ¢ò„ÄÇ</p>
<h3 id="Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†"><a href="#Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†" class="headerlink" title="Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†"></a>Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†</h3><p>‚Äã        ÂÖ∂ÂÆûÊàë‰ª¨ËØ¥‰∫ÜËøô‰πàÂ§öÁöÑÁ∫øÁ®ãÂíåÁ∫øÁ®ãÊ±†,Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†‰πüÊòØ‰∏ÄÊ†∑ÁöÑ„ÄÇ</p>
<p>‚Äã        <strong>(1Ôºâ‰ªÄ‰πàÊòØËøûÊé•</strong><br>‚Äã        ËøûÊé•ÔºåÊòØÊàë‰ª¨ÁöÑÁºñÁ®ãËØ≠Ë®Ä‰∏éÊï∞ÊçÆÂ∫ì‰∫§‰∫íÁöÑ‰∏ÄÁßçÊñπÂºè„ÄÇÊàë‰ª¨ÁªèÂ∏∏‰ºöÂê¨Âà∞Ëøô‰πà‰∏ÄÂè•ËØù‚Äú<strong>Êï∞ÊçÆÂ∫ìËøûÊé•ÂæàÊòÇË¥µ</strong>‚Äù„ÄÇÊúâ‰∫∫Êé•ÂèóËøôÁßçËØ¥Ê≥ïÔºåÂç¥‰∏çÁü•ÈÅìÂÆÉÁöÑÁúüÊ≠£Âê´‰πâ„ÄÇÂõ†Ê≠§Ôºå‰∏ãÈù¢ÊàëÂ∞ÜËß£ÈáäÂÆÉÁ©∂Á´üÊòØ‰ªÄ‰πà(Â¶ÇÊûú‰Ω†Â∑≤ÁªèÁü•ÈÅì‰∫ÜÔºå‰Ω†ÂèØ‰ª•Ë∑≥Âà∞ÂÆÉÁöÑÂ∑•‰ΩúÂéüÁêÜÈÉ®ÂàÜÔºâ„ÄÇ<br>‚Äã        <strong>(2ÔºâÂàõÂª∫ËøûÊé•ÁöÑ‰ª£Á†ÅÁâáÊÆµ:</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">string connUrl <span class="token operator">=</span> <span class="token string">"jdbc:mysql://your.database.domain/yourDBname"</span><span class="token punctuation">;</span>
<span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Connection</span> con <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span>getConnection <span class="token punctuation">(</span>connUrl<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÂΩìÊàë‰ª¨ÂàõÂª∫‰∫Ü‰∏Ä‰∏™ <strong>Connection</strong>ÂØπË±°,ÂÆÉÂú®ÂÜÖÈÉ®ÈÉΩÊâßË°å‰∫Ü‰ªÄ‰πàÔºö</p>
<ul>
<li><strong>DriverManager</strong>Ê£ÄÊü•Âπ∂Ê≥®ÂÜåÈ©±Âä®Á®ãÂ∫è„ÄÇ</li>
<li><code>com.mysql.jdbc.Driver</code>Â∞±ÊòØÊàë‰ª¨Ê≥®ÂÜå‰∫ÜÁöÑÈ©±Âä®Á®ãÂ∫èÔºåÂÆÉ‰ºöÂú®È©±Âä®Á®ãÂ∫èÁ±ª‰∏≠Ë∞ÉÁî®<code>connect(url..)</code>ÊñπÊ≥ï„ÄÇ</li>
<li><code>com.mysql.jdbc.Driver</code>ÁöÑ <code>connect</code>ÊñπÊ≥ïÊ†πÊçÆÊàë‰ª¨ËØ∑Ê±ÇÁöÑ<strong>connUrl</strong>ÔºåÂàõÂª∫‰∏Ä‰∏™ <strong>Socket</strong>ËøûÊé•ÔºåËøûÊé•Âà∞<strong>IP</strong>‰∏∫<code>your.database.domain</code>ÔºåÈªòËÆ§Á´ØÂè£<strong>3306</strong>ÁöÑÊï∞ÊçÆÂ∫ì„ÄÇ</li>
<li>ÂàõÂª∫ÁöÑ<strong>Socket</strong>ËøûÊé•Â∞ÜË¢´Áî®Êù•Êü•ËØ¢Êàë‰ª¨ÊåáÂÆöÁöÑÊï∞ÊçÆÂ∫ìÔºåÂπ∂ÊúÄÁªàËÆ©Á®ãÂ∫èËøîÂõûÂæóÂà∞‰∏Ä‰∏™ÁªìÊûú„ÄÇ</li>
</ul>
<p>‚Äã        <strong>(3Ôºâ‰∏∫‰ªÄ‰πàÊòÇË¥µ</strong><br>‚Äã        Áé∞Âú®ËÆ©Êàë‰ª¨Ë∞àË∞à‰∏∫‰ªÄ‰πàËØ¥ÂÆÉ‚Äú<strong>ÊòÇË¥µ</strong>‚Äù„ÄÇÂ¶ÇÊûúÂàõÂª∫<strong>Socket</strong>ËøûÊé•Ëä±Ë¥πÁöÑÊó∂Èó¥ÊØîÂÆûÈôÖÁöÑÊâßË°åÊü•ËØ¢ÁöÑÊìç‰ΩúÊâÄËä±Ë¥πÁöÑÊó∂Èó¥ËøòË¶ÅÊõ¥Èïø„ÄÇËøôÂ∞±ÊòØÊàë‰ª¨ÊâÄËØ¥ÁöÑ‚Äú<strong>Êï∞ÊçÆÂ∫ìËøûÊé•ÂæàÊòÇË¥µ</strong>‚ÄùÔºåÂõ†‰∏∫ËøûÊé•ËµÑÊ∫êÊï∞ÊòØ<strong>1</strong>ÔºåÂÆÉÈúÄË¶ÅÊØèÊ¨°ÂàõÂª∫‰∏Ä‰∏™<strong>Socket</strong>ËøûÊé•Êù•ËÆøÈóÆ<strong>DB</strong>„ÄÇÂõ†Ê≠§ÔºåÊàë‰ª¨Â∞Ü‰ΩøÁî®ËøûÊé•Ê±†„ÄÇËøûÊé•Ê±†ÂàùÂßãÂåñÊó∂ÂàõÂª∫‰∏ÄÂÆöÊï∞ÈáèÁöÑËøûÊé•ÔºåÁÑ∂Âêé‰ªéËøûÊé•Ê±†‰∏≠ÈáçÁî®ËøûÊé•ÔºåËÄå‰∏çÊòØÊØèÊ¨°ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ„ÄÇ</p>
<p>‚Äã        <strong>(4Ôºâ‰∏∫‰ªÄ‰πàÂú®ËøûÊé•Êï∞ÊçÆÂ∫ìÊó∂Ë¶Å‰ΩøÁî®ËøûÊé•Ê±†</strong><br>‚Äã        <strong>Êï∞ÊçÆÂ∫ìËøûÊé•ÊòØ‰∏ÄÁßçÂÖ≥ÈîÆÁöÑ„ÄÅÊúâÈôêÁöÑÊòÇË¥µËµÑÊ∫êÔºåËøô‰∏ÄÁÇπÂú®Â§öÁî®Êà∑ÁöÑÁΩëÈ°µÂ∫îÁî®Á®ãÂ∫è‰∏≠‰ΩìÁé∞ÂæóÂ∞§‰∏∫Á™ÅÂá∫</strong>„ÄÇ‰∏Ä‰∏™Êï∞ÊçÆÂ∫ìËøûÊé•ÂØπË±°ÂùáÂØπÂ∫î‰∏Ä‰∏™Áâ©ÁêÜÊï∞ÊçÆÂ∫ìËøûÊé•ÔºåÊØèÊ¨°Êìç‰ΩúÈÉΩÊâìÂºÄ‰∏Ä‰∏™Áâ©ÁêÜËøûÊé•Ôºå‰ΩøÁî®ÂÆåÈÉΩÂÖ≥Èó≠ËøûÊé•ÔºåËøôÊ†∑ÈÄ†ÊàêÁ≥ªÁªüÁöÑÊÄßËÉΩ‰Ωé‰∏ã„ÄÇÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†ÁöÑËß£ÂÜ≥ÊñπÊ°àÊòØÔºåÂú®Â∫îÁî®Á®ãÂ∫èÂêØÂä®Êó∂Âª∫Á´ãË∂≥Â§üÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•ÔºåÂπ∂ÊääËøô‰∫õËøûÊé•ÁªÑÊàê‰∏Ä‰∏™ËøûÊé•Ê±†(ÁÆÄÂçïËØ¥Â∞±ÊòØÂú®‰∏Ä‰∏™‚Äú<strong>Ê±†</strong>‚ÄùÈáåÊîæ‰∫ÜÂ•ΩÂ§öÂçäÊàêÂìÅÁöÑÊï∞ÊçÆÂ∫ìËÅîÊé•ÂØπË±°ÔºâÔºåÁî±Â∫îÁî®Á®ãÂ∫èÂä®ÊÄÅÂú∞ÂØπÊ±†‰∏≠ÁöÑËøûÊé•ËøõË°åÁî≥ËØ∑„ÄÅ‰ΩøÁî®ÂíåÈáäÊîæ„ÄÇÂØπ‰∫éÂ§ö‰∫éËøûÊé•Ê±†‰∏≠ËøûÊé•Êï∞ÁöÑÂπ∂ÂèëËØ∑Ê±Ç,Â∫îËØ•Âú®ËØ∑Ê±ÇÈòüÂàó‰∏≠ÊéíÈòüÁ≠âÂæÖ„ÄÇÂπ∂‰∏îÂ∫îÁî®Á®ãÂ∫èÂèØ‰ª•Ê†πÊçÆÊ±†‰∏≠ËøûÊé•ÁöÑ‰ΩøÁî®ÁéáÔºåÂä®ÊÄÅÂ¢ûÂä†ÊàñÂáèÂ∞ëÊ±†‰∏≠ÁöÑËøûÊé•Êï∞„ÄÇËøûÊé•Ê±†ÊäÄÊúØÂ∞ΩÂèØËÉΩÂ§öÂú∞ÈáçÁî®‰∫ÜÊ∂àËÄóÂÜÖÂ≠òÁöÑËµÑÊ∫êÔºåÂ§ßÂ§ßËäÇÁúÅ‰∫ÜÂÜÖÂ≠òÔºåÊèêÈ´ò‰∫ÜÊúçÂä°Âô®ÁöÑÊúçÂä°ÊïàÁéáÔºåËÉΩÂ§üÊîØÊåÅÊõ¥Â§öÁöÑÂÆ¢Êà∑ÊúçÂä°„ÄÇÈÄöËøá‰ΩøÁî®ËøûÊé•Ê±†ÔºåÂ∞ÜÂ§ßÂ§ßÊèêÈ´òÁ®ãÂ∫èËøêË°åÊïàÁéáÔºåÂêåÊó∂ÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÂÖ∂Ëá™Ë∫´ÁöÑÁÆ°ÁêÜÊú∫Âà∂Êù•ÁõëËßÜÊï∞ÊçÆÂ∫ìËøûÊé•ÁöÑÊï∞Èáè„ÄÅ‰ΩøÁî®ÊÉÖÂÜµÁ≠â„ÄÇ<br>‚Äã        <strong>(5ÔºâÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†ÁöÑÂü∫Êú¨ÂéüÁêÜ</strong><br>‚Äã        Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†ÁöÑÂü∫Êú¨ÊÄùÊÉ≥Â∞±ÊòØ‰∏∫Êï∞ÊçÆÂ∫ìËøûÊé•Âª∫Á´ã‰∏Ä‰∏™‚Äú<strong>ÁºìÂÜ≤Ê±†</strong>‚Äù„ÄÇÈ¢ÑÂÖàÂú®ÁºìÂÜ≤Ê±†‰∏≠ÊîæÂÖ•‰∏ÄÂÆöÊï∞ÈáèÁöÑËøûÊé•ÔºåÂΩìÈúÄË¶ÅÂª∫Á´ãÊï∞ÊçÆÂ∫ìËøûÊé•Êó∂ÔºåÂè™ÈúÄ‰ªé‚Äú<strong>ÁºìÂÜ≤Ê±†</strong>‚Äù‰∏≠ÂèñÂá∫‰∏Ä‰∏™Ôºå‰ΩøÁî®ÂÆåÊØï‰πãÂêéÂÜçÊîæÂõûÂéª„ÄÇÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáËÆæÂÆöËøûÊé•Ê±†ÊúÄÂ§ßËøûÊé•Êï∞ÔºåÊù•Èò≤Ê≠¢Á≥ªÁªüÊó†Â∞ΩÂú∞‰∏éÊï∞ÊçÆÂ∫ìËøûÊé•„ÄÇÊõ¥‰∏∫ÈáçË¶ÅÁöÑÊòØÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáËøûÊé•Ê±†ÁöÑÁÆ°ÁêÜÊú∫Âà∂ÁõëËßÜÊï∞ÊçÆÂ∫ìÁöÑËøûÊé•Êï∞Èáè„ÄÅ‰ΩøÁî®ÊÉÖÂÜµÔºå‰∏∫Á≥ªÁªüÂºÄÂèë„ÄÅÊµãËØïÂèäÊÄßËÉΩË∞ÉÊï¥Êèê‰æõ‰æùÊçÆ„ÄÇ<br>‚Äã        <strong>(6)ËøûÊé•Ê±†ÁöÑÂ∑•‰ΩúÂéüÁêÜ‰∏ªË¶ÅÁî±‰∏âÈÉ®ÂàÜÁªÑÊàêÂàÜÂà´‰∏∫ËøûÊé•Ê±†ÁöÑÂª∫Á´ã„ÄÅËøûÊé•Ê±†‰∏≠ËøûÊé•ÁöÑ‰ΩøÁî®ÁÆ°ÁêÜ„ÄÅËøûÊé•Ê±†ÁöÑÂÖ≥Èó≠„ÄÇ</strong></p>
<p>‚Äã         Á¨¨‰∏ÄÔºåËøûÊé•Ê±†ÁöÑÂª∫Á´ã„ÄÇ‰∏ÄËà¨Âú®Á≥ªÁªüÂàùÂßãÂåñÊó∂ÔºåËøûÊé•Ê±†‰ºöÊ†πÊçÆÁ≥ªÁªüÈÖçÁΩÆÂª∫Á´ãÔºåÂπ∂Âú®Ê±†‰∏≠ÂàõÂª∫‰∫ÜÂá†‰∏™ËøûÊé•ÂØπË±°Ôºå‰ª•‰æø‰ΩøÁî®Êó∂ËÉΩ‰ªéËøûÊé•Ê±†‰∏≠Ëé∑Âèñ„ÄÇËøûÊé•Ê±†‰∏≠ÁöÑËøûÊé•‰∏çËÉΩÈöèÊÑèÂàõÂª∫ÂíåÂÖ≥Èó≠ÔºåËøôÊ†∑ÈÅøÂÖç‰∫ÜËøûÊé•ÈöèÊÑèÂª∫Á´ãÂíåÂÖ≥Èó≠ÈÄ†ÊàêÁöÑÁ≥ªÁªüÂºÄÈîÄ„ÄÇJava‰∏≠Êèê‰æõ‰∫ÜÂæàÂ§öÂÆπÂô®Á±ªÂèØ‰ª•Êñπ‰æøÂú∞ÊûÑÂª∫ËøûÊé•Ê±†Ôºå‰æãÂ¶Ç<code>Vector</code>„ÄÅ<code>Stack</code>Á≠â„ÄÇ<br>‚Äã        Á¨¨‰∫åÔºåËøûÊé•Ê±†ÁöÑÁÆ°ÁêÜ„ÄÇËøûÊé•Ê±†ÁÆ°ÁêÜÁ≠ñÁï•ÊòØËøûÊé•Ê±†Êú∫Âà∂ÁöÑÊ†∏ÂøÉÔºåËøûÊé•Ê±†ÂÜÖËøûÊé•ÁöÑÂàÜÈÖçÂíåÈáäÊîæÂØπÁ≥ªÁªüÁöÑÊÄßËÉΩÊúâÂæàÂ§ßÁöÑÂΩ±Âìç„ÄÇÂÖ∂ÁÆ°ÁêÜÁ≠ñÁï•ÊòØÔºöÂΩìÂÆ¢Êà∑ËØ∑Ê±ÇÊï∞ÊçÆÂ∫ìËøûÊé•Êó∂ÔºåÈ¶ñÂÖàÊü•ÁúãËøûÊé•Ê±†‰∏≠ÊòØÂê¶ÊúâÁ©∫Èó≤ËøûÊé•ÔºåÂ¶ÇÊûúÂ≠òÂú®Á©∫Èó≤ËøûÊé•ÔºåÂàôÂ∞ÜËøûÊé•ÂàÜÈÖçÁªôÂÆ¢Êà∑‰ΩøÁî®ÔºõÂ¶ÇÊûúÊ≤°ÊúâÁ©∫Èó≤ËøûÊé•ÔºåÂàôÊü•ÁúãÂΩìÂâçÊâÄÂºÄÁöÑËøûÊé•Êï∞ÊòØÂê¶Â∑≤ÁªèËææÂà∞ÊúÄÂ§ßËøûÊé•Êï∞ÔºåÂ¶ÇÊûúÊ≤°ËææÂà∞Â∞±ÈáçÊñ∞ÂàõÂª∫‰∏Ä‰∏™ËøûÊé•ÁªôËØ∑Ê±ÇÁöÑÂÆ¢Êà∑ÔºõÂ¶ÇÊûúËææÂà∞Â∞±ÊåâËÆæÂÆöÁöÑÊúÄÂ§ßÁ≠âÂæÖÊó∂Èó¥ËøõË°åÁ≠âÂæÖÔºåÂ¶ÇÊûúË∂ÖÂá∫ÊúÄÂ§ßÁ≠âÂæÖÊó∂Èó¥,ÂàôÊäõÂá∫ÂºÇÂ∏∏ÁªôÂÆ¢Êà∑„ÄÇ<br>‚Äã        ÂΩìÂÆ¢Êà∑ÈáäÊîæÊï∞ÊçÆÂ∫ìËøûÊé•Êó∂ÔºåÂÖàÂà§Êñ≠ËØ•ËøûÊé•ÁöÑÂºïÁî®Ê¨°Êï∞ÊòØÂê¶Ë∂ÖËøá‰∫ÜËßÑÂÆöÂÄºÔºåÂ¶ÇÊûúË∂ÖËøáÂ∞±‰ªéËøûÊé•Ê±†‰∏≠Âà†Èô§ËØ•ËøûÊé•ÔºåÂê¶Âàô‰øùÁïô‰∏∫ÂÖ∂‰ªñÂÆ¢Êà∑ÊúçÂä°„ÄÇ<br>‚Äã        ËØ•Á≠ñÁï•‰øùËØÅ‰∫ÜÊï∞ÊçÆÂ∫ìËøûÊé•ÁöÑÊúâÊïàÂ§çÁî®ÔºåÈÅøÂÖçÈ¢ëÁπÅÂú∞Âª∫Á´ã„ÄÅÈáäÊîæËøûÊé•ÊâÄÂ∏¶Êù•ÁöÑÁ≥ªÁªüËµÑÊ∫êÂºÄÈîÄ„ÄÇ<br>‚Äã        Á¨¨‰∏âÔºåËøûÊé•Ê±†ÁöÑÂÖ≥Èó≠„ÄÇÂΩìÂ∫îÁî®Á®ãÂ∫èÈÄÄÂá∫Êó∂ÔºåÂÖ≥Èó≠ËøûÊé•Ê±†‰∏≠ÊâÄÊúâÁöÑËøûÊé•ÔºåÈáäÊîæËøûÊé•Ê±†Áõ∏ÂÖ≥ÁöÑËµÑÊ∫ê,ËØ•ËøáÁ®ãÊ≠£Â•Ω‰∏éÂàõÂª∫Áõ∏Âèç„ÄÇ</p>
<p>‚Äã         (7ÔºâÂæàÂ§öÂõΩÂÜÖJavaÂºÄÂèë‰∫∫ÂëòÈÉΩÊé®Ëçê‰ΩøÁî®<strong>Alibaba</strong>ÈõÜÂõ¢ÂºÄÂèë‰∫∫ÂëòÂºÄÂèëÁöÑÂºÄÊ∫êÈ°πÁõÆ<strong>Druid</strong>ÔºåÂÆòÊñπËØ¥ÊòØ<strong>Java</strong>ËØ≠Ë®Ä‰∏≠ÊúÄÂ•ΩÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†„ÄÇ<strong>Druid</strong> ËÉΩÂ§üÊèê‰æõÂº∫Â§ßÁöÑÁõëÊéßÂíåÊâ©Â±ïÂäüËÉΩ„ÄÇ<br>‚Äã        ‰ª•‰∏ãÊòØ‰∏Ä‰∏™ÈÖçÁΩÆ**_DruidDataSource**ÂèÇËÄÉÁöÑËøûÊé•Ê±†ÈÖçÁΩÆÔºö</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;bean id&#x3D;&quot;dataSource&quot; class&#x3D;&quot;com.alibaba.druid.pool.DruidDataSource&quot; init-method&#x3D;&quot;init&quot; destroy-method&#x3D;&quot;close&quot;&gt; 
	 &lt;!--Âü∫Êú¨Â±ûÊÄßurl,user„ÄÅ password--&gt;
    &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;$&#123;jdbc_url&#125;&quot; &#x2F;&gt;
    &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;$&#123;jdbc_user&#125;&quot; &#x2F;&gt;
    &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;$&#123;jdbc_password&#125;&quot; &#x2F;&gt;

 &lt;!--ÈÖçÁΩÆÁõëÊéßÁªüËÆ°Êã¶Êà™ÁöÑfilters --&gt;
    &lt;property name&#x3D;&quot;filters&quot; value&#x3D;&quot;stat&quot; &#x2F;&gt;

 &lt;--ÈÖçÁΩÆÂàùÂßãÂåñÂ§ßÂ∞è„ÄÅÊúÄÂ∞è„ÄÅÊúÄÂ§ß--&gt;
    &lt;property name&#x3D;&quot;initialSize&quot; value&#x3D;&quot;1&quot; &#x2F;&gt;
    &lt;property name&#x3D;&quot;minIdle&quot; value&#x3D;&quot;1&quot; &#x2F;&gt;
    &lt;property name&#x3D;&quot;maxActive&quot; value&#x3D;&quot;20&quot; &#x2F;&gt;
    &lt;!--ÈÖçÁΩÆËé∑ÂèñËøûÊé•Á≠âÂæÖË∂ÖÊó∂ÁöÑÊó∂Èó¥--&gt;
    &lt;property name&#x3D;&quot;maxWait&quot; value&#x3D;&quot;6000&quot; &#x2F;&gt;

 &lt;!--ÈÖçÁΩÆÈó¥ÈöîÂ§ö‰πÖÊâçËøõË°å‰∏ÄÊ¨°Ê£ÄÊµãÔºåÊ£ÄÊµãÈúÄË¶ÅÂÖ≥Èó≠ÁöÑÁ©∫Èó≤ËøûÊé•ÔºåÂçï‰ΩçÊòØms--&gt;
    &lt;property name&#x3D;&quot;timeBetweenEvictionRunsMillis&quot; value&#x3D;&quot;60000&quot; &#x2F;&gt;
    &lt;!-- ÈÖçÁΩÆ‰∏Ä‰∏™ËøûÊé•Âú®Ê±†‰∏≠ÊúÄÂ∞èÁîüÂ≠òÁöÑÊó∂Èó¥,Âçï‰ΩçÊòØms --&gt;
    &lt;property name&#x3D;&quot;minEvictableIdleTimeMillis&quot; value&#x3D;&quot;300000&quot; &#x2F;&gt;

    &lt;property name&#x3D;&quot;testWhileIdle&quot; value&#x3D;&quot;true&quot; &#x2F;&gt;
    &lt;property name&#x3D;&quot;testOnBorrow&quot; value&#x3D;&quot;false&quot; &#x2F;&gt;
    &lt;property name&#x3D;&quot;testOnReturn&quot; value&#x3D;&quot;false&quot; &#x2F;&gt;

 &lt;!--ÊâìÂºÄ PSCache,Âπ∂‰∏îÊåáÂÆöÊØè‰∏™ËøûÊé•‰∏äPSCacheÁöÑÂ§ßÂ∞è--&gt;
    &lt;property name&#x3D;&quot;poolPreparedStatements&quot; value&#x3D;&quot;true&quot; &#x2F;&gt;
    &lt;property name&#x3D;&quot;maxOpenPreparedStatements&quot; value&#x3D;&quot;20&quot; &#x2F;&gt;

    &lt;property name&#x3D;&quot;asyncInit&quot; value&#x3D;&quot;true&quot; &#x2F;&gt;
&lt;&#x2F;bean&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‚Äã        ÈÄöÂ∏∏Êù•ËØ¥ÔºåÂè™ÈúÄË¶Å‰øÆÊîπ<code>initialSize</code>„ÄÅ<code>minldle</code>„ÄÅ<code>maxActive</code>„ÄÇ<br>‚Äã        Â¶ÇÊûúÁî®<strong>Oracle</strong>ÔºåÂàôÊää <code>poolPreparedStatements</code> ÈÖçÁΩÆ‰∏∫<strong>true</strong>Ôºå<strong>MySQL</strong>ÂèØ‰ª•ÈÖçÁΩÆ‰∏∫ <strong>false</strong>„ÄÇÂàÜÂ∫ìÂàÜË°®ËæÉÂ§öÁöÑÊï∞ÊçÆÂ∫ì,Âª∫ËÆÆÈÖçÁΩÆ‰∏∫ <strong>false</strong>„ÄÇ<br>‚Äã        (8ÔºâÊàë‰ª¨Â¶ÇÊûúÊü•Áúã‰∏Ä‰∏ã<code>com.alibaba.druid.pool.DruidDataSource</code>ÁöÑÊ∫êÁ†ÅÁöÑËØù,Áâõ‰∫∫‰ª¨‰πü‰∏çÂ§ñ‰πé‰ΩøÁî®‰∫Ü<code>CountDownLatch</code>ÂÅöÁ∫øÁ®ãÈòÄÔºå<code>AtomicLong</code>ÁöÑÈ´òÂπ∂ÂèëÂéüÂ≠êÂèòÈáèÔºå<code>ReentrantLock</code>ÊòæÁ§∫ÂùóÁä∂ Á∫øÁ®ãÈîÅÔºå<code>volatile</code>ÂÖ≥ÈîÆÂ≠óÂÅöÈ´òÂπ∂ÂèëÁöÑÂèØËØªÂèòÈáèÔºå<code>DruidConnectionHolder[] connections</code>ÂÇ®Â≠òËøûÊé•ÈòüÂàóÔºå<code>ThreadLocal</code> ÂÅöÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂâØÊú¨„ÄÇ</p>
<h3 id="Â¶Ç‰ΩïÂú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÂÆûÁé∞È´òÂπ∂Âèë"><a href="#Â¶Ç‰ΩïÂú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÂÆûÁé∞È´òÂπ∂Âèë" class="headerlink" title="Â¶Ç‰ΩïÂú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÂÆûÁé∞È´òÂπ∂Âèë"></a>Â¶Ç‰ΩïÂú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÂÆûÁé∞È´òÂπ∂Âèë</h3><p>‚Äã        Âú®Â∑•‰Ωú‰∏≠ÔºåÂ¶Ç‰ΩïÂàÜÂ∏ÉÁ≥ªÁªüÔºåÂ¶Ç‰ΩïÂÆûÁé∞È´òÂπ∂ÂèëÁ≥ªÁªüÁöÑÂâçÊèêÊù°‰ª∂Â∞±ÊòØ:</p>
<ul>
<li><strong>‰∫ÜËß£‰Ω†ÁöÑÁâ©ÁêÜÊú∫Âô®</strong></li>
<li><strong>‰∫ÜËß£‰Ω†ÁöÑ‰∏öÂä°</strong></li>
<li><strong>‰∫ÜËß£‰Ω†ÁöÑÁ®ãÂ∫è</strong></li>
</ul>
<p>‚Äã        ËØ¥Âà∞ÊúÄÂêéÂ∞±ÊòØ‰∏ÄÂè•<strong>ÊãÜÂàÜÔºåÂÜçÊãÜÂàÜ</strong>ÔºåÊé•‰∏ãÊù•Êàë‰ª¨ËÆ≤‰∏Ä‰∫õ<strong>ÊãÜÂàÜÁöÑÂéüÂàô</strong>„ÄÇÈ¶ñÂÖàÂàÜÊûê‰ªªÂä°ÁâπÊÄßÔºåÂèØ‰ª•‰ªé‰ª•‰∏ãÂá†‰∏™ËßíÂ∫¶Êù•ËøõË°åÂàÜÊûê:</p>
<ol>
<li><strong>‰ªªÂä°ÁöÑÊÄßË¥®ÔºöCPU(ËÆ°ÁÆóÂØÜÈõÜÂûã)‰ªªÂä°ÔºåIO(ÁΩëÁªúIOÔºåDBÔºåÁ£ÅÁõòIOÁ≠âÔºâÂØÜÈõÜÂûã‰ªªÂä°,ÂÜÖÂ≠òÊ∂àËÄóÊÄß„ÄÇ</strong></li>
<li><strong>‰ªªÂä°ÁöÑÂπ∂ÂèëÊï∞ÈáèÔºöË∂ÖÁ∫ßÂ§ßÂπ∂ÂèëÔºåÂ§ßÂπ∂ÂèëÔºå‰∏≠Á≠âÈáèÔºåÂæàÂ∞ë‰∫∫ËÆøÈóÆÁ≠â„ÄÇ</strong></li>
<li><strong>‰ªªÂä°ÁöÑÊâßË°åÊó∂Èó¥ÔºöÈïøÔºå‰∏≠ÔºåÁü≠„ÄÇ</strong></li>
<li><strong>‰ªªÂä°ÁöÑ‰ºòÂÖàÁ∫ßÔºöÈ´òÔºå‰∏≠Ôºå‰Ωé„ÄÇ</strong></li>
<li><strong>‰ªªÂä°ÁöÑ‰æùËµñÊÄßÔºöÊòØÂê¶‰æùËµñÂÖ∂‰ªñÁ≥ªÁªüËµÑÊ∫êÔºåÂ¶ÇÊï∞ÊçÆÂ∫ìËøûÊé•Ôºå‰∏öÂä°ÊµÅÁ®ã‰πãÈó¥ÊòØÂê¶‰∫íÁõ∏‰æùËµñÁ≠â„ÄÇ</strong></li>
<li><strong>ÊåâÁÖßËµÑÊ∫êÊÄßË¥®ÔºöÈùôÊÄÅËµÑÊ∫êÔºåÂä®ÊÄÅËµÑÊ∫ê„ÄÇ</strong></li>
<li><strong>‰∏öÂä°‰πãÈó¥ÁöÑËÄ¶ÂêàÊÄßÔºöËÄ¶ÂêàÂ∫¶È´òÔºåÂèØËß£ËÄ¶ÔºåÊ≤°ÊúâËÄ¶Âêà„ÄÇ</strong></li>
</ol>
<p>‚Äã        ÂΩìÊàë‰ª¨ÂØπÊàë‰ª¨ÁöÑ‰∏öÂä°Âíå‰ªªÂä°Êúâ‰∫ÜÂÖ®Èù¢ÁöÑËÆ§ËØÜ‰πãÂêéÔºåÂ∞±ÂèØ‰ª•ÂêàÁêÜÂú∞ÈÖçÁΩÆÁ∫øÁ®ãÊ±†Ôºå‰ªéËÄåÂÆûÁé∞È´òÂèØÁî®„ÄÅÈ´òÂπ∂Âèë,ÂéüÂàôÂ¶Ç‰∏ãÔºö</p>
<p>‚Äã        (1)  ‰ªªÂä°ÊÄßË¥®‰∏çÂêåÁöÑ‰ªªÂä°ÂèØ‰ª•Áî®‰∏çÂêåËßÑÊ®°ÁöÑÁ∫øÁ®ãÊ±†ÂàÜÂºÄÂ§ÑÁêÜ„ÄÇCPU ÂØÜÈõÜÂûã‰ªªÂä°ÈÖçÁΩÆÂ∞ΩÂèØËÉΩÂ∞èÁöÑÁ∫øÁ®ãÔºåÂ¶ÇÈÖçÁΩÆ<code>N cpu+1</code>‰∏™Á∫øÁ®ãÁöÑÁ∫øÁ®ãÊ±†„ÄÇIOÂØÜÈõÜÂûã‰ªªÂä°ÂàôÁî±‰∫éÁ∫øÁ®ãÂπ∂‰∏çÊòØ‰∏ÄÁõ¥Âú®ÊâßË°å‰ªªÂä°,ÂàôÈÖçÁΩÆÂ∞ΩÂèØËÉΩÂ§öÁöÑÁ∫øÁ®ãÔºåÂ¶Ç<code>2*Ncpu</code>„ÄÇÊ∑∑ÂêàÂûãÁöÑ‰ªªÂä°ÔºåÂ¶ÇÊûúÂèØ‰ª•ÊãÜÂàÜÔºåÂàôÂ∞ÜÂÖ∂ÊãÜÂàÜÊàê‰∏Ä‰∏™CPUÂØÜÈõÜÂûã‰ªªÂä°Âíå‰∏Ä‰∏™IOÂØÜÈõÜÂûã‰ªªÂä°ÔºåÂè™Ë¶ÅËøô‰∏§‰∏™‰ªªÂä°ÊâßË°åÁöÑÊó∂Èó¥Áõ∏Â∑Æ‰∏çÊòØÂ§™Â§ßÔºåÈÇ£‰πàÂàÜËß£ÂêéÊâßË°åÁöÑÂêûÂêêÁéáË¶ÅÈ´ò‰∫é‰∏≤Ë°åÊâßË°åÁöÑÂêûÂêêÁéáÔºåÂ¶ÇÊûúËøô‰∏§‰∏™‰ªªÂä°ÊâßË°åÊó∂Èó¥Áõ∏Â∑ÆÂ§™Â§ßÔºåÂàôÊ≤°ÂøÖË¶ÅËøõË°åÂàÜËß£„ÄÇÊàë‰ª¨ÂèØ‰ª•ÈÄöËøá<code>Runtime.getRuntime().availableProcessors()</code>ÊñπÊ≥ïËé∑ÂæóÂΩìÂâçËÆæÂ§áÁöÑCPU‰∏™Êï∞„ÄÇ<br>‚Äã        (2Ôºâ‰ºòÂÖàÁ∫ß‰∏çÂêåÁöÑ‰ªªÂä°ÂèØ‰ª•‰ΩøÁî®‰ºòÂÖàÁ∫ßÈòüÂàó <code>PriorityBlockingQueue</code>Êù•Â§ÑÁêÜ„ÄÇÂÆÉÂèØ‰ª•ËÆ©‰ºòÂÖàÁ∫ßÈ´òÁöÑ‰ªªÂä°ÂÖàÂæóÂà∞ÊâßË°åÔºåÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂ¶ÇÊûú‰∏ÄÁõ¥Êúâ‰ºòÂÖàÁ∫ßÈ´òÁöÑ‰ªªÂä°Êèê‰∫§Âà∞ÈòüÂàóÈáåÔºåÈÇ£‰πà‰ºòÂÖàÁ∫ß‰ΩéÁöÑ‰ªªÂä°ÂèØËÉΩÊ∞∏ËøúÂæó‰∏çÂà∞ÊâßË°å„ÄÇ<br>‚Äã        (3ÔºâÊâßË°åÊó∂Èó¥‰∏çÂêåÁöÑ‰ªªÂä°ÂèØ‰ª•‰∫§Áªô‰∏çÂêåËßÑÊ®°ÁöÑÁ∫øÁ®ãÊ±†Êù•Â§ÑÁêÜÔºåÊàñËÄÖ‰πüÂèØ‰ª•‰ΩøÁî®‰ºòÂÖàÁ∫ßÈòüÂàó,ËÆ©ÊâßË°åÊó∂Èó¥Áü≠ÁöÑ‰ªªÂä°ÂÖàÊâßË°å„ÄÇ<br>‚Äã        (4Ôºâ‰æùËµñÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†ÁöÑ‰ªªÂä°ÔºåÂõ†‰∏∫Á∫øÁ®ãÊèê‰∫§SQLÂêéÈúÄË¶ÅÁ≠âÂæÖÊï∞ÊçÆÂ∫ìËøîÂõûÁªìÊûú,Â¶ÇÊûúÁ≠âÂæÖÁöÑÊó∂Èó¥Ë∂äÈïøÔºåCPUÁ©∫Èó≤Êó∂Èó¥Â∞±Ë∂äÈïøÔºåÈÇ£‰πàÁ∫øÁ®ãÊï∞Â∫îËØ•ËÆæÁΩÆË∂äÂ§ßÔºåËøôÊ†∑ÊâçËÉΩÊõ¥Â•ΩÂú∞Âà©Áî®CPU.<br>‚Äã        (5ÔºâÂª∫ËÆÆ‰ΩøÁî®ÊúâÁïåÈòüÂàó,ÊúâÁïåÈòüÂàóËÉΩÂ¢ûÂä†Á≥ªÁªüÁöÑÁ®≥ÂÆöÊÄßÂíåÈ¢ÑË≠¶ËÉΩÂäõ,ÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅËÆæÂ§ß‰∏ÄÁÇπÔºåÊØîÂ¶ÇÂá†ÂçÉ„ÄÇÊúâ‰∏ÄÊ¨°Êàë‰ª¨ÁªÑ‰ΩøÁî®ÁöÑÂêéÂè∞‰ªªÂä°Á∫øÁ®ãÊ±†ÁöÑÈòüÂàóÂíåÁ∫øÁ®ãÊ±†ÂÖ®Êª°‰∫ÜÔºå‰∏çÊñ≠Âú∞ÊäõÂá∫ÊäõÂºÉ‰ªªÂä°ÁöÑÂºÇÂ∏∏ÔºåÈÄöËøáÊéíÊü•ÂèëÁé∞ÊòØÊï∞ÊçÆÂ∫ìÂá∫Áé∞‰∫ÜÈóÆÈ¢òÔºåÂØºËá¥ÊâßË°å<strong>SQL</strong>ÂèòÂæóÈùûÂ∏∏ÁºìÊÖ¢ÔºåÂõ†‰∏∫ÂêéÂè∞‰ªªÂä°Á∫øÁ®ãÊ±†ÈáåÁöÑ‰ªªÂä°ÂÖ®ÊòØÈúÄË¶ÅÂêëÊï∞ÊçÆÂ∫ìÊü•ËØ¢ÂíåÊèíÂÖ•Êï∞ÊçÆÁöÑÔºåÊâÄ‰ª•ÂØºËá¥Á∫øÁ®ãÊ±†ÈáåÁöÑÂ∑•‰ΩúÁ∫øÁ®ãÂÖ®ÈÉ®ÈòªÂ°û‰ΩèÔºå‰ªªÂä°ÁßØÂéãÂú®Á∫øÁ®ãÊ±†Èáå„ÄÇÂ¶ÇÊûúÂΩìÊó∂Êàë‰ª¨ËÆæÁΩÆÊàêÊó†ÁïåÈòüÂàóÔºåÁ∫øÁ®ãÊ±†ÁöÑÈòüÂàóÂ∞±‰ºöË∂äÊù•Ë∂äÂ§öÔºåÊúâÂèØËÉΩ‰ºöÊíëÊª°ÂÜÖÂ≠òÔºåÂØºËá¥Êï¥‰∏™Á≥ªÁªü‰∏çÂèØÁî®ÔºåËÄå‰∏çÂè™ÊòØÂêéÂè∞‰ªªÂä°Âá∫Áé∞ÈóÆÈ¢ò„ÄÇÂΩìÁÑ∂Êàë‰ª¨ÁöÑÁ≥ªÁªüÊâÄÊúâÁöÑ‰ªªÂä°ÊòØÁî®ÁöÑÂçïÁã¨ÁöÑÊúçÂä°Âô®ÈÉ®ÁΩ≤ÁöÑÔºåËÄåÊàë‰ª¨‰ΩøÁî®‰∏çÂêåËßÑÊ®°ÁöÑÁ∫øÁ®ãÊ±†Ë∑ë‰∏çÂêåÁ±ªÂûãÁöÑ‰ªªÂä°Ôºå‰ΩÜÊòØÂá∫Áé∞ËøôÊ†∑ÈóÆÈ¢òÊó∂‰πü‰ºöÂΩ±ÂìçÂà∞ÂÖ∂‰ªñ‰ªªÂä°„ÄÇ<br>‚Äã        ÂØπÊúçÂä°ÁöÑÂÜÖÂÆπÔºåËøõË°åÂàÜÊûêÂÆå‰∫Ü‰πãÂêéÔºåÂ∞±Â∫îËØ•ÂèäÊó∂ËøõË°åÈÉ®ÁΩ≤ÂàÜÁ¶ªÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ÂÆûÁé∞È´òÊÄßËÉΩÁöÑÂàÜÂ∏ÉÂºèÔºåÈÉ®ÁΩ≤ÂàÜÁ¶ªÁöÑ‰∏Ä‰∫õÂéüÂàôÊúâ:</p>
<ol>
<li><strong>Ê∏†ÈÅìÂàÜÁ¶ªÔºöÂ¶ÇÊó†Á∫øÂÆ¢Êà∑Á´ØÔºåPCÁ´ØÔºåAPIÊé•Âè£Á≠â„ÄÇ</strong></li>
<li><strong>ËøêËê•ÂïÜÁöÑÂàÜÁ¶ªÔºöÂ¶ÇÁîµ‰ø°ÔºåËÅîÈÄöÔºåÊïôËÇ≤ÔºåÊµ∑Â§ñÊúçÂä°Âô®Á≠â„ÄÇ</strong></li>
<li><strong>ÊúçÂä°ÂÜÖÂÆπÂàíÂàÜÔºöÂ¶ÇÊñáÂ≠óÊÄßÁöÑÔºåÂõæÁâáÔºåËßÜÈ¢ëÔºå‰∏ãËΩΩÁ≠âÊúçÂä°ÁöÑÂÜÖÂÆπ„ÄÇ</strong></li>
<li><strong>ÊåâÁÖßËÆøÈóÆÂØÜÈõÜÂûãÊÄßÂàíÂàÜÔºöÂ¶ÇÈ´òÂπ∂ÂèëÁöÑÂíå‰ΩéÂπ∂ÂèëÁöÑÂèØ‰ª•ÂàÜÂºÄÈÉ®ÁΩ≤Âú®‰∏çÂêåÁöÑÁéØÂ¢É‰∏ã„ÄÇ</strong></li>
<li><strong>ÊåâÁÖß‰∏çÂêå‰∏öÂä°Á∫øËøõË°åÂàíÂàÜÔºöÂ¶ÇÂâçÂè∞È°πÁõÆÔºåBBSÔºåÂêéÂè∞ÁÆ°ÁêÜÈ°πÁõÆÁ≠â„ÄÇ</strong></li>
</ol>
<p>‚Äã        ÊúÄÂêéÔºåÂú®‰Ω†ÂÖ®Èù¢‰∫ÜËß£‰Ω†ÁöÑ‰∏öÂä°Ôºå‰Ω†ÁöÑ<strong>Server</strong>Ôºå‰Ω†ÁöÑÁ®ãÂ∫èÁöÑÂü∫Á°Ä‰∏äÈÄöËøáÂàÜÂèëÈÖçÁΩÆÔºåËøòÊúâÁ∫øÁ®ãÊ±†ÁöÑËøáËΩΩÊú∫Âà∂ÈÖçÁΩÆÔºåËøô‰∏™Êó∂ÂÄô‰Ω†Â∞±ÂèØ‰ª•ÂÅöÂà∞Ê≥∞Â±±Â¥©‰∫éÂâçËÄåËâ≤‰∏çÂèòÔºåÈ∫ãÈπøÂÖ¥‰∫éÂ∑¶ËÄåÁõÆ‰∏çÁû¨‰∫Ü„ÄÇ</p>
<h2 id="Á∫øÁ®ãÁöÑÁõëÊéßÂèäÂÖ∂Êó•Â∏∏Â∑•‰Ωú‰∏≠Â¶Ç‰ΩïÂàÜÊûê"><a href="#Á∫øÁ®ãÁöÑÁõëÊéßÂèäÂÖ∂Êó•Â∏∏Â∑•‰Ωú‰∏≠Â¶Ç‰ΩïÂàÜÊûê" class="headerlink" title="Á∫øÁ®ãÁöÑÁõëÊéßÂèäÂÖ∂Êó•Â∏∏Â∑•‰Ωú‰∏≠Â¶Ç‰ΩïÂàÜÊûê"></a>Á∫øÁ®ãÁöÑÁõëÊéßÂèäÂÖ∂Êó•Â∏∏Â∑•‰Ωú‰∏≠Â¶Ç‰ΩïÂàÜÊûê</h2><blockquote>
<p><strong>È∏üÊ¨≤È´òÈ£ûÂÖàÊåØÁøÖ,‰∫∫Ê±Ç‰∏äËøõÂÖàËØª‰π¶„ÄÇ</strong></p>
</blockquote>
<p><img src="/image/Concurrent/Concurrent40.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent40.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        Áúã‰∏çÂà∞‰∏çÁ≠â‰∫é‰∏çÂ≠òÂú®!ËÆ©Êàë‰ª¨Êù•ÁúãÁúãÂ∑•‰Ωú‰∏≠ÊòØÂ¶Ç‰ΩïÊâæÈóÆÈ¢òËß£ÂÜ≥ÈóÆÈ¢òÁöÑ„ÄÇ</p>
<h3 id="JavaÁ∫øÁ®ãÊ±†ÁöÑÁõëÊéß"><a href="#JavaÁ∫øÁ®ãÊ±†ÁöÑÁõëÊéß" class="headerlink" title="JavaÁ∫øÁ®ãÊ±†ÁöÑÁõëÊéß"></a>JavaÁ∫øÁ®ãÊ±†ÁöÑÁõëÊéß</h3><p>‚Äã        Â¶ÇÊûúÊÉ≥ÂÆûÁé∞Á∫øÁ®ãÊ±†ÁöÑÁõëÊéßÔºåÈúÄË¶ÅËá™ÂÆö‰πâÁ∫øÁ®ãÊ±†ÁªßÊâø<code>ThreadPoolExecutor</code>Á±ªÔºåÂπ∂‰∏îÂÆûÁé∞<code>beforeExecute</code>„ÄÅ<code>afterExecute</code>Âíå <code>terminated</code>ÊñπÊ≥ïÔºåÊàë‰ª¨ÂèØ‰ª•Âú®‰ªªÂä°ÊâßË°åÂâç„ÄÅÊâßË°åÂêéÂíåÁ∫øÁ®ãÊ±†ÂÖ≥Èó≠ÂâçÂπ≤‰∏Ä‰∫õ‰∫ãÊÉÖ„ÄÇÊØîÂ¶ÇÔºåÁõëÊéß‰ªªÂä°ÁöÑÂπ≥ÂùáÊâßË°åÊó∂Èó¥ÔºåÊúÄÂ§ßÊâßË°åÊó∂Èó¥ÂíåÊúÄÂ∞èÊâßË°åÊó∂Èó¥Á≠â„ÄÇËøôÂá†‰∏™ÊñπÊ≥ïÂú®Á∫øÁ®ãÊ±†ÈáåÊòØÁ©∫ÊñπÊ≥ï„ÄÇËØ∑Áúã‰∏ãÈù¢‰ª£Á†Å:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//ÊØèÊâßË°å‰∏Ä‰∏™Â∑•‰Ωú‰ªªÂä°Á∫øÁ®ã‰πãÂâçÈÉΩ‰ºöÊâßË°åÊ≠§ÂÆûÁé∞ÁöÑÊñπÊ≥ï</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> beforeExecute <span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> r<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//t-ÊîæÂú®Á∫øÁ®ãÊ±†ÈáåÈù¢Ë¶ÅÊâßË°åÁöÑÁ∫øÁ®ã„ÄÇ</span>
    <span class="token comment">//r-Â∞ÜË¶ÅÊâßË°åËøô‰∏™Á∫øÁ®ãÁöÑÁ∫øÁ®ãÊ±†ÈáåÈù¢ÁöÑÂ∑•‰ΩúÁ∫øÁ®ã„ÄÇ</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//ÊØèÊâßË°å‰∏Ä‰∏™Â∑•‰Ωú‰ªªÂä°Á∫øÁ®ã‰πãÂêéÈÉΩ‰ºöÊâßË°åÁöÑÊñπÊ≥ï</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> afterExecute <span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> t<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//r -Â∑≤ÁªèËøêË°åÁªìÊùüÁöÑÂ∑•‰ΩúÁ∫øÁ®ã„ÄÇ</span>
    <span class="token comment">//t-ËøêË°åÂºÇÂ∏∏„ÄÇ</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//Á∫øÁ®ãÊ±†ÂÖ≥Èó≠‰πãÂâçÂèØ‰ª•Âπ≤‰∏Ä‰∫õ‰∫ãÊÉÖ„ÄÇ</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">terminated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Á∫øÁ®ãÊ±†ÈáåÊúâ‰∏Ä‰∫õÂ±ûÊÄßÂú®ÁõëÊéßÁ∫øÁ®ãÊ±†ÁöÑÊó∂ÂÄôÂèØ‰ª•‰ΩøÁî®Ôºö</p>
<ul>
<li><code>taskCount</code>ÔºöÁ∫øÁ®ãÊ±†ÈúÄË¶ÅÊâßË°åÁöÑ‰ªªÂä°Êï∞Èáè„ÄÇ</li>
<li><code>completedTaskCount</code>ÔºöÁ∫øÁ®ãÊ±†Âú®ËøêË°åËøáÁ®ã‰∏≠Â∑≤ÂÆåÊàêÁöÑ‰ªªÂä°Êï∞Èáè„ÄÇÂ∞è‰∫éÊàñÁ≠â‰∫é<code>taskCount</code>„ÄÇ</li>
<li><code>largestPoolSize</code>ÔºöÁ∫øÁ®ãÊ±†ÊõæÁªèÂàõÂª∫ËøáÁöÑÊúÄÂ§ßÁ∫øÁ®ãÊï∞Èáè„ÄÇÈÄöËøáËøô‰∏™Êï∞ÊçÆÂèØ‰ª•Áü•ÈÅìÁ∫øÁ®ãÊ±†ÊòØÂê¶Êª°Ëøá„ÄÇÂ¶ÇÁ≠â‰∫éÁ∫øÁ®ãÊ±†ÁöÑÊúÄÂ§ßÂ§ßÂ∞è,ÂàôË°®Á§∫Á∫øÁ®ãÊ±†ÊõæÁªèÊª°‰∫Ü„ÄÇ</li>
<li><code>getPoolSize</code>ÔºöÁ∫øÁ®ãÊ±†ÁöÑÁ∫øÁ®ãÊï∞Èáè„ÄÇÂ¶ÇÊûúÁ∫øÁ®ãÊ±†‰∏çÈîÄÊØÅÁöÑËØùÔºåÊ±†ÈáåÁöÑÁ∫øÁ®ã‰∏ç‰ºöËá™Âä®ÈîÄÊØÅÔºåÊâÄ‰ª•Ëøô‰∏™Â§ßÂ∞èÂè™Â¢û‰∏çÂáè„ÄÇ</li>
<li><code>getActiveCount</code>ÔºöËé∑ÂèñÊ¥ªÂä®ÁöÑÁ∫øÁ®ãÊï∞„ÄÇ</li>
</ul>
<p>Â§ßÂÆ∂ÊÉ≥‰∏ÄÊÉ≥Â¶ÇÊûú‰Ω†Êù•ÂÜôÁöÑËØùÂ¶Ç‰ΩïÂéªÂÜô,Êèê‰æõÂÆû‰æã <strong>demo</strong> Â¶Ç‰∏ã,ÊÖ¢ÊÖ¢‰Ωì‰ºö‰∏Ä‰∏ãÔºö</p>
<p>ËøêË°åÁªìÊûúÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Thread</span> <span class="token class-name">Main</span> <span class="token class-name">End</span><span class="token operator">!</span>
work_task before<span class="token operator">:</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">3</span>
work_task before<span class="token operator">:</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">2</span>
work_task before<span class="token operator">:</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span>
work_task after worker thread is <span class="token operator">:</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadpool<span class="token punctuation">.</span></span>MonitorThreadPoolExecutorDemo</span>$<span class="token number">1</span><span class="token annotation punctuation">@1f80458e</span>
work_task after worker thread is <span class="token operator">:</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadpool<span class="token punctuation">.</span></span>MonitorThreadPoolExecutorDemo</span>$<span class="token number">1</span><span class="token annotation punctuation">@3888163e</span>
work_task after worker thread is <span class="token operator">:</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>ctrl<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>threadpool<span class="token punctuation">.</span></span>MonitorThreadPoolExecutorDemo</span>$<span class="token number">1</span><span class="token annotation punctuation">@671c4961</span>
terminated getCorePoolSize<span class="token operator">:</span><span class="token number">5</span>ÔºõgetPoolSize<span class="token operator">:</span><span class="token number">0</span>ÔºõgetTaskCount<span class="token operator">:</span><span class="token number">3</span>ÔºõgetCompletedTaskCount<span class="token operator">:</span><span class="token number">3</span>ÔºõgetLargestPoolSize<span class="token operator">:</span><span class="token number">3</span>ÔºõgetActiveCount<span class="token operator">:</span><span class="token number">0</span>
<span class="token class-name">ThreadPoolExecutor</span> terminated<span class="token operator">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="ForkJoinÂ¶Ç‰ΩïÁõëÊéß"><a href="#ForkJoinÂ¶Ç‰ΩïÁõëÊéß" class="headerlink" title="ForkJoinÂ¶Ç‰ΩïÁõëÊéß"></a>ForkJoinÂ¶Ç‰ΩïÁõëÊéß</h3><p>‚Äã        ÂÖ∂ÂÆû <code>ForkJoin</code>ÁöÑÁõëÊéß‰∏çÂÉè <code>ThreadPoolExecutor</code>ÈÇ£Ê†∑Êèê‰æõ‰∫Ü<code>before</code>Âíå <code>after</code>ÁöÑÊñπÊ≥ïÔºåÂè™ÊòØ<code>ForkJoinPool</code>Êèê‰æõ‰∫Ü‰∏Ä‰∫õÂèØ‰ª•Êü•ÈòÖÂÖ∂Áä∂ÊÄÅ‰ø°ÊÅØÁöÑÊñπÊ≥ï,Â¶Ç‰∏ã:</p>
<ul>
<li><code>getPoolSize()</code>ÔºöÊ≠§ÊñπÊ≥ïËøîÂõû<strong>int</strong>ÂÄºÂÆÉÊòØ<code>ForkJoinPool</code>ÂÜÖÈÉ®Á∫øÁ®ãÊ±†ÁöÑ<code>worker </code>Á∫øÁ®ã‰ª¨ÁöÑÊï∞Èáè„ÄÇ</li>
<li><code>getParallelism()</code>ÔºöÊ≠§ÊñπÊ≥ïËøîÂõûÊ±†ÁöÑÂπ∂Ë°åÁöÑÁ∫ßÂà´„ÄÇ</li>
<li><code>getActiveThreadCount()</code>ÔºöÊ≠§ÊñπÊ≥ïËøîÂõûÂΩìÂâçÊâßË°å‰ªªÂä°ÁöÑÁ∫øÁ®ãÁöÑÊï∞Èáè„ÄÇ</li>
<li><code>getRunningThreadCount()</code>ÔºöÊ≠§ÊñπÊ≥ïËøîÂõûÊ≤°ÊúâË¢´‰ªª‰ΩïÂêåÊ≠•Êú∫Âà∂ÈòªÂ°ûÁöÑÊ≠£Âú®Â∑•‰ΩúÁöÑÁ∫øÁ®ã„ÄÇ</li>
<li><code>getQueuedSubmissionCount()</code>ÔºöÊ≠§ÊñπÊ≥ïËøîÂõûÂ∑≤ÁªèÊèê‰∫§ÁªôÊ±†ËøòÊ≤°ÊúâÂºÄÂßã‰ªñ‰ª¨ÁöÑÊâßË°åÁöÑ‰ªªÂä°Êï∞„ÄÇ</li>
<li><code>getQueuedTaskCount()</code>ÔºöÊ≠§ÊñπÊ≥ïËøîÂõûÂ∑≤ÁªèÊèê‰∫§ÁªôÊ±†Â∑≤ÁªèÂºÄÂßãÂÆÉ‰ª¨ÁöÑÊâßË°åÁöÑ‰ªªÂä°Êï∞„ÄÇ</li>
<li><code>hasQueuedSubmissions()</code>ÔºöÊ≠§ÊñπÊ≥ïËøîÂõû<strong>Boolean</strong>ÂÄºÔºåË°®ÊòéËøô‰∏™Ê±†ÊòØÂê¶Êúâ<code>queued</code>‰ªªÂä°ËøòÊ≤°ÊúâÂºÄÂßãÂÆÉ‰ª¨ÁöÑÊâßË°å„ÄÇ</li>
<li><code>getStealCount()</code>ÔºöÊ≠§ÊñπÊ≥ïËøîÂõû <strong>long</strong> ÂÄºÔºå<code>worker</code> Á∫øÁ®ãÂ∑≤Áªè‰ªéÂè¶‰∏Ä‰∏™Á∫øÁ®ãÂÅ∑ÂèñÂà∞ÁöÑÊó∂Èó¥Êï∞„ÄÇ</li>
<li><code>isTerminated()</code>ÔºöÊ≠§ÊñπÊ≥ïËøîÂõû <strong>Boolean</strong>ÂÄºÔºåË°®Êòé <code>fork/join</code>Ê±†ÊòØÂê¶Â∑≤ÁªèÂÆåÊàêÊâßË°å„ÄÇ<br>    ‰ª•‰∏äÊñπÊ≥ïÊõ¥ÊúâÂä©‰∫éÊàë‰ª¨ÂºÄÂèëËøáÁ®ã‰∏≠Êõ¥Âä†‰∫ÜËß£‰Ω†ÁöÑ<code>forkjoin</code>ÁöÑËÆæËÆ°ÊòØÂê¶ÂêàÁêÜ„ÄÇ<br>    ÂÖ∂ÂÆûÔºåÂÆûÁé∞ËøôÊ†∑ÁöÑÁõëÊéßÊØîËæÉÁÆÄÂçï‰∫ÜÔºåÂ§ßÂÆ∂ÂÜô‰∏Ä‰∏™ËØïËØï„ÄÇÁÆÄÂçïÊù•Áúã‰∏Ä‰∏ã <strong>Demo</strong>ÔºåÊàë‰ª¨Â∞ÜForkJoinTaskDemo ‰æãÂ≠ê‰øÆÊîπÂ¶Ç‰∏ãÔºåÂ¢ûÂä†‰∏Ä‰∏™<code>showLog</code>ÊñπÊ≥ïÁî®Êù•ÊòæÁ§∫ÁõëÊéßÁöÑ‰ø°ÊÅØ:</li>
</ul>
<p>ËøêË°åÁªìÊûúÂ¶Ç‰∏ã:</p>
<h3 id="JavaÂÜÖÂ≠òÁªìÊûÑ"><a href="#JavaÂÜÖÂ≠òÁªìÊûÑ" class="headerlink" title="JavaÂÜÖÂ≠òÁªìÊûÑ"></a>JavaÂÜÖÂ≠òÁªìÊûÑ</h3><p>‚Äã        ÂêéÈù¢Êàë‰ª¨‰ºöËÆ≤Âà∞Á∫øÁ®ã<strong>Dump</strong> ÁöÑÂàÜÊûêÔºåÈÇ£Â∞±‰∏çÂæó‰∏çÂØπ<strong>Java</strong>ÈáåÈù¢ÁöÑ<strong>ÂÜÖÂ≠òÁªìÊûÑ</strong>Êúâ‰∏ÄÂÆöÁöÑ‰∫ÜËß£„ÄÇÂÖ∂ÂÆûÂØπ‰∫éJavaÁ®ãÂ∫èÂëòÊù•ËØ¥Ôºå<strong>Âú®ËôöÊãüÊú∫ÁöÑËá™Âä®ÂÜÖÂ≠òÁÆ°ÁêÜÊú∫Âà∂(ËøôÁßçÊú∫Âà∂ÂèàÁß∞‰∏∫ÂûÉÂúæÂõûÊî∂Êú∫Âà∂„ÄÅgarbagecollector„ÄÅGC)ÁöÑÂ∏ÆÂä©‰∏ãÔºå‰∏çÂÜçÈúÄË¶ÅÊòæÂºèÂú∞‰∏∫ÊØè‰∏Ä‰∏™newÊìç‰ΩúÂéªÂàÜÈÖçÂÜÖÂ≠òÔºåÂõûÊî∂ÂÜÖÂ≠òÔºåËÄå‰∏îÈÄöÂ∏∏ÊÉÖÂÜµ‰∏çÂÆπÊòìÂá∫Áé∞ÂÜÖÂ≠òÊ≥ÑÊºèÂíåÂÜÖÂ≠òÊ∫¢Âá∫ÈóÆÈ¢òÔºåÁúãËµ∑Êù•Áî±ËôöÊãüÊú∫ÁÆ°ÁêÜÂÜÖÂ≠ò‰∏ÄÂàáÈÉΩÂæàÁæéÂ•Ω</strong>„ÄÇ‰∏çËøáÔºåÂú®È´òÂπ∂ÂèëÁöÑÂºÄÂèëÊ®°Âºè‰∏ãÔºå‰∏çÁü•‰∏çËßâÂ∞±‰ºöÊµ™Ë¥πÂæàÂ§öÂÜÖÂ≠òÔºåÂØºËá¥ÁöÑÂêéÊûúÂ∞±ÊòØ<strong>GC</strong>ÂõûÊî∂ÊâßË°åÊó∂Èó¥Â§™È¢ëÁπÅÔºåÂÜÖÂ≠òÊ≥ÑÈú≤ÔºåËøõËÄåÂØºËá¥ÂÜÖÂ≠òÊ∫¢Âá∫Ôºå‰πüÊ≠£ÊòØÂõ†‰∏∫JavaÁ®ãÂ∫èÂëòÊääÂÜÖÂ≠òÊéßÂà∂ÁöÑÊùÉÂäõ‰∫§Áªô‰∫ÜJavaËôöÊãüÊú∫Ôºå‰∏ÄÊó¶Âá∫Áé∞ÂÜÖÂ≠òÊ≥ÑÊºèÂíåÊ∫¢Âá∫ÊñπÈù¢ÁöÑÈóÆÈ¢òÔºåÂ¶ÇÊûú‰∏ç‰∫ÜËß£ËôöÊãüÊú∫ÊòØÊÄéÊ†∑‰ΩøÁî®ÂÜÖÂ≠òÁöÑÔºåÈÇ£ÊéíÊü•ÈîôËØØÂ∞Ü‰ºöÊàê‰∏∫‰∏ÄÈ°πÂºÇÂ∏∏Ëâ∞ÈöæÁöÑÂ∑•‰Ωú„ÄÇ</p>
<h4 id="1-JVMÁöÑÂÜÖÂ≠òÁªìÊûÑ"><a href="#1-JVMÁöÑÂÜÖÂ≠òÁªìÊûÑ" class="headerlink" title="1.JVMÁöÑÂÜÖÂ≠òÁªìÊûÑ"></a>1.JVMÁöÑÂÜÖÂ≠òÁªìÊûÑ</h4><p>‚Äã        <strong>JVM ÁöÑÂÜÖÂ≠òÁªìÊûÑÂÖ∂ÂÆûÂ§ß‰Ωì‰∏äÂàÜÊàê‰∫ÜËøô‰πàÂá†‰∏™ÈÉ®ÂàÜÔºöÁ®ãÂ∫èËÆ°Êï∞Âô®„ÄÅJVMÊ†à„ÄÅÊú¨Âú∞ÊñπÊ≥ïÊ†à„ÄÅÂÖ±‰∫´Â†Ü„ÄÅÊñπÊ≥ïÂå∫„ÄÇ</strong>Â¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent41.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent41.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‚Äã        (1ÔºâÁ®ãÂ∫èËÆ°Êï∞Âô®ÔºöÊòØ‰∏ÄÂùóËæÉÂ∞èÁöÑÂÜÖÂ≠òÁ©∫Èó¥ÔºåÂÖ∂‰ΩúÁî®ÂèØ‰ª•Áúã‰ΩúÊòØÂΩìÂâçÁ∫øÁ®ãÊâÄÊâßË°åÁöÑÂ≠óËäÇÁ†ÅÁöÑË°åÂè∑ÊåáÁ§∫Âô®Â≠óËäÇÁ†ÅËß£ÊûêÂô®Â∑•‰ΩúÊó∂,ÈÄöËøáÊîπÂèòÁ®ãÂ∫èËÆ°Êï∞Âô®ÁöÑÂÄºÊù•ÈÄâÂèñ‰∏ã‰∏ÄÊù°ÈúÄË¶ÅÊâßË°åÁöÑÂ≠óËäÇÁ†ÅÊåá‰ª§„ÄÇJavaËôöÊãüÊú∫ÁöÑÂ§öÁ∫øÁ®ãÊòØÈÄöËøáÁ∫øÁ®ãËΩÆÊµÅÂàáÊç¢Âπ∂ÂàÜÈÖçÂ§ÑÁêÜÂô®ÊâßË°åÊó∂Èó¥ÁâáÊù•ÂÆûÁé∞ÔºåÂú®‰ªª‰Ωï‰∏Ä‰∏™Êó∂ÂàªÔºå‰∏Ä‰∏™Â§ÑÁêÜÂô®Âè™‰ºöÊâßË°å‰∏ÄÊù°Á∫øÁ®ãÊåá‰ª§ÔºåÂõ†Ê≠§Ôºå‰∏∫‰∫ÜÁ°Æ‰øùÁ∫øÁ®ãÂàáÊç¢‰πãÂêéËÉΩÊÅ¢Â§çÂà∞Ê≠£Á°ÆÁöÑÊâßË°å‰ΩçÁΩÆÔºåÊØèÊù°Á∫øÁ®ãÈÉΩÈúÄË¶Å‰∏Ä‰∏™Áã¨Á´ãÁöÑÁ®ãÂ∫èËÆ°Êï∞Âô®ÔºåÂõ†Ê≠§ÔºåÁ®ãÂ∫èËÆ°Êï∞Âô®ÊòØÁ∫øÁ®ãÁßÅÊúâÁöÑÂÜÖÂ≠ò„ÄÇÁ®ãÂ∫èËÆ°Êï∞Âô®ÊòØJavaËôöÊãüÊú∫‰∏≠ÂîØ‰∏Ä‰∏Ä‰∏™Ê≤°ÊúâËßÑÂÆö‰ªª‰ΩïÂÜÖÂ≠òÊ∫¢Âá∫<code>OutOfMemoryError</code>ÁöÑÂÜÖÂ≠òÂå∫Âüü„ÄÇ<br>‚Äã        (2Ôºâ<strong>JVM</strong>Ê†àÔºöJavaËôöÊãüÊú∫Ê†àÔºå‰πüÊòØÁ∫øÁ®ãÁßÅÊúâÁöÑÔºåÂÆÉÁöÑÁîüÂëΩÂë®Êúü‰∏éÁ∫øÁ®ãÁõ∏Âêå„ÄÇËôöÊãüÊú∫Ê†àÊèèËø∞ÁöÑÊòØjavaÊñπÊ≥ïÊâßË°åÁöÑÂÜÖÂ≠òÊ®°Âûã:ÊØè‰∏™ÊñπÊ≥ïË¢´ÊâßË°åÊó∂ÈÉΩ‰ºöÂêåÊó∂ÂàõÂª∫‰∏Ä‰∏™Ê†àÂ∏ßÁî®‰∫éÂ≠òÊîæÂ±ÄÈÉ®ÂèòÈáèË°®„ÄÅÊìç‰ΩúÊï∞Ê†à„ÄÅÂä®ÊÄÅËøûÊé•ÂíåÊñπÊ≥ïÂá∫Âè£Á≠â‰ø°ÊÅØ„ÄÇÊØè‰∏™ÊñπÊ≥ïË¢´Ë∞ÉÁî®Áõ¥Ëá≥ÊâßË°åÂÆåÊàêËøáÁ®ãÔºåÂ∞±ÂØπÂ∫îÁùÄ‰∏Ä‰∏™Ê†àÂ∏ßÂú®ËôöÊãüÊú∫‰∏≠‰ªéÂÖ•Ê†àÂà∞Âá∫Ê†àÁöÑËøáÁ®ã„ÄÇJavaËôöÊãüÊú∫Ê†àÁöÑÂ±ÄÈÉ®ÂèòÈáèË°®Â≠òÊîæ‰∫ÜÁºñËØëÂô®ÂèØÁü•ÁöÑ8ÁßçJavaÂü∫Êú¨Á±ªÂûãÊï∞ÊçÆ„ÄÅÂØπË±°ÂºïÁî®(Ê≥®ÊÑè‰∏çÊòØÂØπË±°ÂÆû‰æãÊú¨Ë∫´)„ÄÅÊñπÊ≥ïËøîÂõûÂú∞ÂùÄ<code>returnAddress</code>„ÄÇÂ±ÄÈÉ®ÂèòÈáèË°®ÊâÄÈúÄÂÜÖÂ≠òÁ©∫Èó¥Âú®ÁºñËØëÊúüÈó¥ÂÆåÊàêÂàÜÈÖçÔºåÂΩìËøõÂÖ•‰∏Ä‰∏™ÊñπÊ≥ïÊó∂ÔºåËØ•ÊñπÊ≥ïÈúÄË¶ÅÂú®Â∏ß‰∏≠ÂàÜÈÖçÂ§öÂ§ßÁöÑÂ±ÄÈÉ®ÂèòÈáèÁ©∫Èó¥ÊòØÂÆåÂÖ®Á°ÆÂÆöÁöÑÔºåÂú®ÊñπÊ≥ïËøêË°åÊúüÈó¥‰∏ç‰ºöÊîπÂèòÂ±ÄÈÉ®ÂèòÈáèË°®ÁöÑÂ§ßÂ∞è„ÄÇJavaËôöÊãüÊú∫Ê†àÊúâ‰∏§ÁßçÂºÇÂ∏∏Áä∂ÂÜµ:Â¶ÇÊûúÂçïÁ∫øÁ®ãËØ∑Ê±ÇÁöÑÊ†àÊ∑±Â∫¶Â§ß‰∫éËôöÊãüÊú∫ÊâÄÂÖÅËÆ∏ÁöÑÊúÄÂ§ßÊ∑±Â∫¶Êó∂ÔºåÊäõÂá∫ <code>StackOverflowError</code> ÂºÇÂ∏∏;Â¶ÇÊûúËôöÊãüÊú∫Ê†àÂèØ‰ª•Âä®ÊÄÅÊâ©Â±ï,ÂΩìÊâ©Â±ïÊó∂Êó†Ê≥ïÁî≥ËØ∑Âà∞Ë∂≥Â§üÂÜÖÂ≠òÊó∂‰ºöÊäõÂá∫ <code>OutOfMemoryError</code> ÂºÇÂ∏∏„ÄÇ<br>‚Äã        (3ÔºâÊú¨Âú∞ÊñπÊ≥ïÊ†à:Êú¨Âú∞ÊñπÊ≥ïÊ†à‰∏éJavaËôöÊãüÊú∫Ê†à‰ΩúÁî®ÈùûÂ∏∏Á±ª‰ººÔºåÂÖ∂Âå∫Âà´ÊòØ: java ËôöÊãüÊú∫Ê†àÊòØ‰∏∫ËôöÊãüÊú∫ÊâßË°åjavaÊñπÊ≥ïÊúçÂä°ÔºåËÄåÊú¨Âú∞ÊñπÊ≥ïÊ†àÊòØ‰∏∫ËôöÊãüÊú∫Ë∞ÉÁî®ÁöÑÊìç‰ΩúÁ≥ªÁªüÊú¨Âú∞ÊñπÊ≥ïÊúçÂä°„ÄÇJavaËôöÊãüÊú∫ËßÑËåÉÊ≤°ÊúâÂØπÊú¨Âú∞ÊñπÊ≥ïÊ†àÁöÑÂÆûÁé∞ÂíåÊï∞ÊçÆÁªìÊûÑÂÅöÂº∫Âà∂ËßÑÂÆöÔºå<code>Sun HotSpot</code>ËôöÊãüÊú∫Áõ¥Êé•ÊääJavaËôöÊãüÊú∫Ê†àÂíåÊú¨Âú∞ÊñπÊ≥ïÊ†àÂêà‰∫å‰∏∫‰∏Ä„ÄÇ<br>‚Äã        (4)ÂÖ±‰∫´Â†Ü:Â†ÜÊòØ javaËôöÊãüÊú∫ÊâÄÁÆ°ÁêÜÁöÑÂÜÖÂ≠òÂå∫Âüü‰∏≠ÊúÄÂ§ß‰∏ÄÂùóÔºåJavaÂ†ÜÊòØË¢´ÊâÄÊúâÁ∫øÁ®ãÊâÄÂÖ±‰∫´ÁöÑ‰∏ÄÂùóÂÜÖÂ≠òÂå∫Âüü,Âú®JavaËôöÊãüÊú∫ÂêØÂä®Êó∂ÂàõÂª∫ÔºåÂ†ÜÂÜÖÂ≠òÁöÑÂîØ‰∏ÄÁõÆÁöÑÂ∞±ÊòØÂ≠òÊîæÂØπË±°ÂÆû‰æã„ÄÇÂá†‰πéÊâÄÊúâÁöÑÂØπË±°ÂÆû‰æãÈÉΩÊòØÂú®Â†ÜÂàÜÈÖçÂÜÖÂ≠ò„ÄÇJavaÂ†ÜÊòØÂûÉÂúæÊî∂ÈõÜÂô®ÁÆ°ÁêÜÁöÑ‰∏ªË¶ÅÂå∫ÂüüÔºå‰ªéÂûÉÂúæÂõûÊî∂ÁöÑËßíÂ∫¶ÁúãÔºåÁî±‰∫éÁé∞Âú®ÁöÑÂûÉÂúæÊî∂ÈõÜÂô®Âü∫Êú¨ÈÉΩÈááÁî®ÁöÑÊòØÂàÜ‰ª£Êî∂ÈõÜÁÆóÊ≥ïÔºåÂõ†Ê≠§JavaÂ†ÜËøòÂèØ‰ª•ÂàùÊ≠•ÁªÜÂàÜ‰∏∫Êñ∞Áîü‰ª£ÂíåÂπ¥ËÄÅ‰ª£„ÄÇJavaËôöÊãüÊú∫ËßÑËåÉËßÑÂÆöÔºåÂ†ÜÂèØ‰ª•Â§Ñ‰∫éÁâ©ÁêÜ‰∏ä‰∏çËøûÁª≠ÁöÑÂÜÖÂ≠òÁ©∫Èó¥‰∏≠ÔºåÂè™Ë¶ÅÈÄªËæë‰∏äÊòØËøûÁª≠ÁöÑÂç≥ÂèØ„ÄÇÂú®ÂÆûÁé∞‰∏äÊó¢ÂèØ‰ª•ÊòØÂõ∫ÂÆöÂ§ßÂ∞èÁöÑÔºå‰πüÂèØ‰ª•ÊòØÂèØÂä®ÊÄÅÊâ©Â±ïÁöÑ„ÄÇÂ¶ÇÊûúÂú®Â†Ü‰∏≠Ê≤°ÊúâÂÜÖÂ≠òÂÆåÊàêÂÆû‰æãÂàÜÈÖç,Âπ∂‰∏îÂ†ÜÂ§ßÂ∞è‰πüÊó†Ê≥ïÂÜçÊâ©Â±ïÊó∂,Â∞Ü‰ºöÊäõÂá∫<code>OutOfMemoryError</code> ÂºÇÂ∏∏„ÄÇ<br>‚Äã        (5)ÊñπÊ≥ïÂå∫:ÊñπÊ≥ïÂå∫‰∏éÂ†Ü‰∏ÄÊ†∑ÔºåÊòØË¢´ÂêÑ‰∏™Á∫øÁ®ãÂÖ±‰∫´ÁöÑÂÜÖÂ≠òÂå∫ÂüüÔºåÂÆÉÁî®‰∫éÂ≠òÂÇ®Â∑≤Ë¢´ËôöÊãüÊú∫Âä†ËΩΩÁöÑÁ±ª‰ø°ÊÅØ„ÄÅÂ∏∏Èáè„ÄÅÈùôÊÄÅÂèòÈáè„ÄÅÂç≥Êó∂ÁºñËØëÂêéÁöÑ‰ª£Á†ÅÁ≠âÊï∞ÊçÆ„ÄÇËôΩÁÑ∂ JavaËôöÊãüÊú∫ËßÑËåÉÊääÊñπÊ≥ïÂå∫ÊèèËø∞‰∏∫Â†ÜÁöÑ‰∏Ä‰∏™ÈÄªËæëÈÉ®ÂàÜÔºå‰ΩÜÊòØÊñπÊ≥ïÂå∫Âç¥Êúâ‰∏Ä‰∏™Âà´ÂêçÂè´<code>Non-Heap</code>(ÈùûÂ†Ü)„ÄÇ<br>‚Äã        <strong>Sun HotSpotËôöÊãüÊú∫</strong>ÊääÊñπÊ≥ïÂå∫Âè´<strong>Ê∞∏‰πÖ‰ª£</strong>(<code>Permanent Generation</code>)ÔºåÊñπÊ≥ïÂå∫‰∏≠ÊúÄÈáçË¶ÅÁöÑÈÉ®ÂàÜÊòØËøêË°åÊó∂Â∏∏ÈáèÊ±†„ÄÇClassÊñá‰ª∂‰∏≠Èô§‰∫ÜÊúâÁ±ªÁöÑÁâàÊú¨„ÄÅÂ≠óÊÆµ„ÄÅÊñπÊ≥ï„ÄÅÊé•Âè£Á≠âÊèèËø∞‰ø°ÊÅØÂ§ñÔºåËøòÊúâ‰∏ÄÈ°π‰ø°ÊÅØÊòØÂ∏∏ÈáèÊ±†ÔºåÁî®‰∫éÂ≠òÊîæÁºñËØëÊúüÁîüÊàêÁöÑÂêÑÁßçÂ≠óÈù¢ÂèòÈáè„ÄÅÁ¨¶Âè∑ÂºïÁî®„ÄÅÁõ¥Êé•ÂºïÁî®Á≠âÔºåËøô‰∫õÂÜÖÂÆπÂ∞ÜÂú®Á±ªÂä†ËΩΩÂêéÂ≠òÊîæÂà∞ÊñπÊ≥ïÂå∫ÁöÑËøêË°åÊó∂Â∏∏ÈáèÊ±†‰∏≠,Âè¶Â§ñÂú®ËøêË°åÊúüÈó¥‰πüÂèØ‰ª•Â∞ÜÊñ∞ÁöÑÂ∏∏ÈáèÂ≠òÊîæÂà∞Â∏∏ÈáèÊ±†‰∏≠„ÄÇ<br>‚Äã        ÂÖ∂ÂÆûÔºåÊàëÊõ¥ÊÑøÊÑèÂ∞ÜÂÆÉÂàÜ‰∏∫Â†ÜÂíåÊ†à‰∏§ÈÉ®ÂàÜÊù•ÁúãÂæÖ„ÄÇJavaËôöÊãüÊú∫ÂÜÖÂ≠òÁªìÊûÑ‰∏≠ÁöÑÁ®ãÂ∫èËÆ°Êï∞Âô®„ÄÅËôöÊãüÊú∫Ê†àÂíåÊú¨Âú∞ÊñπÊ≥ïÊ†àËøô‰∏â‰∏™Âå∫ÂüüÈöèÁ∫øÁ®ãÂàõÂª∫ËÄåÁîüÔºåÈöèÁ∫øÁ®ãÈîÄÊØÅËÄåÁÅ≠ÔºåÂõ†Ê≠§Ëøô‰∏â‰∏™Âå∫ÂüüÁöÑÂÜÖÂ≠òÂàÜÈÖçÂíåÂõûÊî∂ÊòØÁ°ÆÂÆöÁöÑÁîüÂëΩÂë®ÊúüÁöÑÔºåËÄåJavaËôöÊãüÊú∫ÁöÑÂ†ÜÂÜÖÂ≠òÂíåÊñπÊ≥ïÂå∫ÂÜÖÂ≠òÊòØÈÄöËøáÂûÉÂúæÂõûÊî∂Êú∫Âà∂‰∏â‰ª£ÂÖ≥Á≥ªÊù•ÂÆåÊàêÁöÑ,Êé•‰∏ãÊù•Êàë‰ª¨Êù•ËØ¥‰∏Ä‰∏ã„ÄÇ</p>
<h4 id="2-JVMÁöÑÂûÉÂúæÂõûÊî∂Êú∫Âà∂"><a href="#2-JVMÁöÑÂûÉÂúæÂõûÊî∂Êú∫Âà∂" class="headerlink" title="2.JVMÁöÑÂûÉÂúæÂõûÊî∂Êú∫Âà∂"></a>2.JVMÁöÑÂûÉÂúæÂõûÊî∂Êú∫Âà∂</h4><p>‚Äã        ÈíàÂØπÂûÉÂúæÂõûÊî∂ÁÆóÊ≥ïÂ∞Ü<strong>JVM</strong>‰∏≠Â†ÜÂíåÈùûÂ†ÜÁ©∫Èó¥ÂàíÂàÜ‰∏∫‰∏â‰∏™‰ª£Ôºö<strong>Âπ¥ËΩª‰ª£(Young Generation)„ÄÅÂπ¥ËÄÅ‰ª£(Old Generation)ÂíåÊ∞∏‰πÖ‰ª£(Permanent Generation)<strong>ÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫„ÄÇ</strong>Âπ¥ËΩª‰ª£ÂíåËÄÅÂπ¥‰ª£Â∞±ÊòØÊàë‰ª¨‰∏äÈù¢ËØ¥ÁöÑÂÖ±‰∫´Â†Ü</strong>,<strong>Âπ¥ËΩªÂ∏¶‰∏ªË¶ÅÊòØÂä®ÊÄÅÁöÑÂ≠òÂÇ®ÔºåÂπ¥ËΩªÂ∏¶‰∏ªË¶ÅÂÇ®Â≠òÊñ∞‰∫ßÁîüÁöÑÂØπË±°ÔºõÂπ¥ËÄÅ‰ª£ÂÇ®Â≠òÂπ¥ÈæÑÂ§ß‰∫õÁöÑÂØπË±°ÔºõÊ∞∏‰πÖÂ∏¶Â∞±ÊòØÊàë‰ª¨‰∏äÈù¢ËØ¥ÁöÑÊñπÊ≥ïÂå∫Ôºå‰∏ªË¶ÅÂ≠òÂÇ®ÁöÑÊòØJavaÁöÑÁ±ª‰ø°ÊÅØÔºåÂåÖÊã¨Ëß£ÊûêÂæóÂà∞ÁöÑÊñπÊ≥ï„ÄÅÂ±ûÊÄß„ÄÅÂ≠óÊÆµÁ≠âÔºåÊ∞∏‰πÖÂ∏¶Âü∫Êú¨‰∏çÂèÇ‰∏éÂûÉÂúæÂõûÊî∂„ÄÇ</strong>ÊâÄ‰ª•Êàë‰ª¨ËØ¥ÁöÑÂûÉÂúæÂõûÊî∂‰∏ªË¶ÅÊòØÈíàÂØπÂπ¥ËΩª‰ª£ÂíåÂπ¥ËÄÅ‰ª£„ÄÇ<br>‚Äã        Âπ¥ËΩª‰ª£ÂèàÂàÜÊàê3‰∏™ÈÉ®ÂàÜÔºå‰∏Ä‰∏™<strong>eden</strong>Âå∫Âíå‰∏§‰∏™Áõ∏ÂêåÁöÑ<strong>survivor</strong> Âå∫„ÄÇÂàöÂºÄÂßãÂàõÂª∫ÁöÑÂØπË±°ÈÉΩÊòØÊîæÁΩÆÂú®<strong>eden</strong>Âå∫ÁöÑ„ÄÇÂàÜÊàêËøôÊ†∑3‰∏™ÈÉ®ÂàÜÔºå<strong>‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜÁîüÂëΩÂë®ÊúüÁü≠ÁöÑÂØπË±°Â∞ΩÈáèÁïôÂú®Âπ¥ËΩªÂ∏¶</strong>„ÄÇÂΩì<strong>eden</strong>Âå∫Áî≥ËØ∑‰∏çÂà∞Á©∫Èó¥ÁöÑÊó∂ÂÄôÔºåËøõË°å<strong>minorGC</strong>,ÊääÂ≠òÊ¥ªÁöÑÂØπË±°Êã∑Ë¥ùÂà∞ <strong>survivor</strong>„ÄÇ</p>
<p><img src="/image/Concurrent/Concurrent42.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent42.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Âπ¥ËÄÅ‰ª£‰∏ªË¶ÅÂ≠òÊîæÁîüÂëΩÂë®ÊúüÊØîËæÉÈïøÁöÑÂØπË±°ÔºåÊØîÂ¶ÇÁºìÂ≠òÂØπË±°„ÄÇ</p>
<h4 id="3-JVMÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂ËøáÁ®ã"><a href="#3-JVMÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂ËøáÁ®ã" class="headerlink" title="3.JVMÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂ËøáÁ®ã"></a>3.JVMÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂ËøáÁ®ã</h4><p>‚Äã        <strong>JVM</strong>ÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂ËøáÁ®ãÊèèËø∞Â¶Ç‰∏ãÔºö</p>
<ol>
<li>ÂØπË±°Âú®<strong>Eden</strong> Âå∫ÂÆåÊàêÂÜÖÂ≠òÂàÜÈÖç„ÄÇ</li>
<li>ÂΩì <strong>Eden</strong>Âå∫Êª°‰∫ÜÔºåÂÜçÂàõÂª∫ÂØπË±°Ôºå‰ºöÂõ†‰∏∫Áî≥ËØ∑‰∏çÂà∞Á©∫Èó¥ÔºåËß¶Âèë<strong>minorGC</strong>ÔºåËøõË°å **young( eden+1survivor)**Âå∫ÁöÑÂûÉÂúæÂõûÊî∂„ÄÇ</li>
<li><strong>minorGC</strong> Êó∂Ôºå<strong>Eden</strong>‰∏çËÉΩË¢´ÂõûÊî∂ÁöÑÂØπË±°Ë¢´ÊîæÂÖ•Âà∞Á©∫ÁöÑ <strong>survivor</strong> (<strong>Eden</strong>ËÇØÂÆö‰ºöË¢´Ê∏ÖÁ©∫)ÔºåÂè¶‰∏Ä‰∏™<strong>survivor</strong>Èáå‰∏çËÉΩË¢´<strong>GC</strong>ÂõûÊî∂ÁöÑÂØπË±°‰πü‰ºöË¢´ÊîæÂÖ•Ëøô‰∏™<strong>survivor</strong>ÔºåÂßãÁªà‰øùËØÅ‰∏Ä‰∏™<strong>survivor</strong>ÊòØÁ©∫ÁöÑ</li>
<li>ÂΩìÂÅöÁ¨¨3Ê≠•ÁöÑÊó∂ÂÄôÔºåÂ¶ÇÊûúÂèëÁé∞<strong>survivor</strong>Êª°‰∫ÜÔºåÂàôËøô‰∫õÂØπË±°Ë¢´<strong>copy</strong>Âà∞<strong>old</strong> Âå∫ÔºåÊàñËÄÖ<strong>survivor</strong>Âπ∂Ê≤°ÊúâÊª°Ôºå‰ΩÜÊòØÊúâ‰∫õÂØπË±°Â∑≤ÁªèË∂≥Â§ü<strong>Old</strong>Ôºå‰πüË¢´ÊîæÂÖ•<strong>Old</strong> Âå∫ **<code>XX:MaxTenuringThreshold</code>**„ÄÇ</li>
<li>ÂΩì<strong>Old</strong>Âå∫Ë¢´ÊîæÊª°‰πãÂêéÔºåËøõË°å<strong>fullGC</strong>„ÄÇ</li>
</ol>
<p>‰∏ãÈù¢ÂØπminorGC„ÄÅMajorGC„ÄÅFullGCÂÅö‰∏™Ë°•ÂÖÖËØ¥ÊòéÔºö</p>
<ul>
<li><strong>MinorGC</strong>ÔºöÂπ¥ËΩª‰ª£ÊâÄËøõË°åÁöÑÂûÉÂúæÂõûÊî∂ÔºåÈùûÂ∏∏È¢ëÁπÅ,‰∏ÄËà¨ÂõûÊî∂ÈÄüÂ∫¶‰πüÊØîËæÉÂø´„ÄÇ</li>
<li><strong>MajorGC</strong>ÔºöËÄÅÂπ¥‰ª£ËøõË°åÁöÑÂûÉÂúæÂõûÊî∂ÔºåÂèëÁîü‰∏ÄÊ¨° <strong>MajorGC</strong>Ëá≥Â∞ë‰º¥Èöè‰∏ÄÊ¨°<strong>MinorGC</strong>Ôºå‰∏ÄËà¨ÊØî<strong>MinorGC</strong>ÈÄüÂ∫¶ÊÖ¢ÂçÅÂÄç‰ª•‰∏ä„ÄÇ</li>
<li><strong>FullGC</strong>ÔºöÊï¥‰∏™Â†ÜÂÜÖÂ≠òËøõË°åÁöÑÂûÉÂúæÂõûÊî∂ÔºåÂæàÂ§öÊó∂ÂÄôÊòØ<strong>MajorGC</strong>.</li>
</ul>
<p>‚Äã        <strong>MajorGC</strong>Âíå<strong>FullGC</strong>ÊòØÊúÄËÄó<strong>CPU</strong>ÁöÑÔºå‰ºöÂΩ±ÂìçÁ®ãÂ∫èÁöÑÂìçÂ∫îÔºåÊâÄ<strong>‰ª•Ë¶ÅÊ†πÊçÆÁõ∏Â∫îÂéüÂàôÂêàÁêÜËÆæÁΩÆÂπ¥ËΩª‰ª£ÂíåËÄÅÂπ¥‰ª£ÁöÑÂ§ßÂ∞è„ÄÇ</strong>ÊâÄ‰ª•ÁõëÊéßÁöÑÊó∂ÂÄôÂ∞±‰ºöÂèëÁé∞Âπ¥ËΩª‰ª£‰ºöÊúâÈ¢ëÁπÅÁöÑÂõûÊî∂ÔºåËÄå<strong>FullGC</strong>ÊâßË°åÊ¨°Êï∞ÂæàÂ∞ë„ÄÇ<strong>‰∏ÄÊó¶FullGCÈ¢ëÁπÅÂèëÁîüÁöÑÊó∂ÂÄôÔºåÂü∫Êú¨‰∏äÂ∞±Âø´Ë¶ÅÂÜÖÂ≠òÊ∫¢Âá∫‰∫Ü„ÄÇ</strong></p>
<h4 id="4-JVMÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂ËøáÁ®ã‰∏≠ÂØπË±°ÂàÜÈÖçÁöÑÂéüÂàô"><a href="#4-JVMÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂ËøáÁ®ã‰∏≠ÂØπË±°ÂàÜÈÖçÁöÑÂéüÂàô" class="headerlink" title="4.JVMÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂ËøáÁ®ã‰∏≠ÂØπË±°ÂàÜÈÖçÁöÑÂéüÂàô"></a>4.JVMÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂ËøáÁ®ã‰∏≠ÂØπË±°ÂàÜÈÖçÁöÑÂéüÂàô</h4><ol>
<li>ÂØπË±°‰ºòÂÖàÂàÜÈÖçÂú®<strong>Eden</strong>Âå∫ÔºåÂ¶ÇÊûú<strong>Eden</strong>Âå∫Ê≤°ÊúâË∂≥Â§üÁöÑÁ©∫Èó¥Êó∂ÔºåËôöÊãüÊú∫ÊâßË°å‰∏ÄÊ¨°<strong>Minor GC</strong>.</li>
<li>Â§ßÂØπË±°Áõ¥Êé•ËøõÂÖ•ËÄÅÂπ¥‰ª£(Â§ßÂØπË±°ÊòØÊåáÈúÄË¶ÅÂ§ßÈáèËøûÁª≠ÂÜÖÂ≠òÁ©∫Èó¥ÁöÑÂØπË±°)„ÄÇËøôÊ†∑ÂÅöÁöÑÁõÆÁöÑÊòØÈÅøÂÖçÂú®<strong>Eden</strong> Âå∫Âíå‰∏§‰∏™<strong>Survivor</strong>Âå∫‰πãÈó¥ÂèëÁîüÂ§ßÈáèÁöÑÂÜÖÂ≠òÊã∑Ë¥ùÔºàÊñ∞Áîü‰ª£ÈááÁî®Â§çÂà∂ÁÆóÊ≥ïÊî∂ÈõÜÂÜÖÂ≠ò)„ÄÇ</li>
<li>ÈïøÊúüÂ≠òÊ¥ªÁöÑÂØπË±°ËøõÂÖ•ËÄÅÂπ¥‰ª£„ÄÇ<strong>ËôöÊãüÊú∫‰∏∫ÊØè‰∏™ÂØπË±°ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™Âπ¥ÈæÑËÆ°Êï∞Âô®</strong>ÔºåÂ¶ÇÊûúÂØπË±°ÁªèËøá‰∫Ü<strong>1</strong>Ê¨°<strong>Minor GC</strong>ÔºåÈÇ£‰πàÂØπË±°‰ºöËøõÂÖ•<strong>Survivor</strong>Âå∫Ôºõ‰πãÂêéÊØèÁªèËøá‰∏ÄÊ¨°<strong>Minor GC</strong>ÔºåÈÇ£‰πàÂØπË±°ÁöÑÂπ¥ÈæÑÂä†<strong>1</strong>Ôºå<strong>Áõ¥Âà∞ËææÂà∞ÈòÄÂÄºÂØπË±°ËøõÂÖ•ËÄÅÂπ¥Âå∫„ÄÇ</strong></li>
<li>Âä®ÊÄÅÂà§Êñ≠ÂØπË±°ÁöÑÂπ¥ÈæÑ„ÄÇÂ¶ÇÊûú <strong>Survivor</strong>Âå∫‰∏≠Áõ∏ÂêåÂπ¥ÈæÑÁöÑÊâÄÊúâÂØπË±°Â§ßÂ∞èÁöÑÊÄªÂíåÂ§ß‰∫é<strong>Survivor</strong>Á©∫Èó¥ÁöÑ‰∏ÄÂçäÔºåÂπ¥ÈæÑÂ§ß‰∫éÊàñÁ≠â‰∫éËØ•Âπ¥ÈæÑÁöÑÂØπË±°ÂèØ‰ª•Áõ¥Êé•ËøõÂÖ•ËÄÅÂπ¥‰ª£</li>
<li>Á©∫Èó¥ÂàÜÈÖçÊãÖ‰øù„ÄÇÊØèÊ¨°ËøõË°å<strong>Minor GC</strong>Êó∂Ôºå<strong>JVM</strong>‰ºöËÆ°ÁÆó<strong>Survivor</strong>Âå∫ÁßªËá≥ËÄÅÂπ¥Âå∫ÁöÑÂØπË±°ÁöÑÂπ≥ÂùáÂ§ßÂ∞èÔºåÂ¶ÇÊûúËøô‰∏™ÂÄºÂ§ß‰∫éËÄÅÂπ¥Âå∫ÁöÑÂâ©‰ΩôÂÄºÂ§ßÂ∞èÔºåÂàôËøõË°å‰∏ÄÊ¨°<strong>FullGC</strong>ÔºõÂ¶ÇÊûúÂ∞è‰∫éÊ£ÄÊü•<strong>HandlePromotionFailure</strong>ËÆæÁΩÆÔºåÊòØ<strong>true</strong>ÂàôÂè™ËøõË°å<strong>Minor GC</strong>ÔºåÊòØ <strong>false</strong>ÂàôËøõË°å<strong>Full GC</strong>„ÄÇ</li>
</ol>
<h4 id="5-JVMÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂Êú∫Âà∂‰∏ªË¶ÅÊúâ‰∏âÁßç"><a href="#5-JVMÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂Êú∫Âà∂‰∏ªË¶ÅÊúâ‰∏âÁßç" class="headerlink" title="5.JVMÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂Êú∫Âà∂‰∏ªË¶ÅÊúâ‰∏âÁßç"></a>5.JVMÂÜÖÂ≠òÂûÉÂúæÂõûÊî∂Êú∫Âà∂‰∏ªË¶ÅÊúâ‰∏âÁßç</h4><ul>
<li><strong>‰∏≤Ë°åÊî∂ÈõÜÂô®</strong>Ôºö‰ΩøÁî®ÂçïÁ∫øÁ®ãÂ§ÑÁêÜÊâÄÊúâÂûÉÂúæÂõûÊî∂Â∑•‰ΩúÔºåÂõ†‰∏∫Êó†È°ªÂ§öÁ∫øÁ®ã‰∫§‰∫í,ÊâÄ‰ª•ÊïàÁéáÊØîËæÉÈ´ò„ÄÇ</li>
<li><strong>Âπ∂Ë°åÊî∂ÈõÜÂô®</strong>ÔºöÂØπÂπ¥ËΩª‰ª£ËøõË°åÂπ∂Ë°åÂûÉÂúæÂõûÊî∂ÔºåÂõ†Ê≠§ÂèØ‰ª•ÂáèÂ∞ëÂûÉÂúæÂõûÊî∂Êó∂Èó¥„ÄÇ‰∏ÄËà¨Âú®Â§öÁ∫øÁ®ãÂ§öÂ§ÑÁêÜÂô®Êú∫Âô®‰∏ä‰ΩøÁî®„ÄÇ</li>
<li><strong>Âπ∂ÂèëÊî∂ÈõÜÂô®</strong>ÔºöÂèØ‰ª•‰øùËØÅÂ§ßÈÉ®ÂàÜÂ∑•‰ΩúÈÉΩÂπ∂ÂèëËøõË°å(Â∫îÁî®‰∏çÂÅúÊ≠¢)ÔºåÂûÉÂúæÂõûÊî∂Âè™ÊöÇÂÅúÂæàÂ∞ëÁöÑÊó∂Èó¥,Ê≠§Êî∂ÈõÜÂô®ÈÄÇÂêàÂØπÂìçÂ∫îÊó∂Èó¥Ë¶ÅÊ±ÇÊØîËæÉÈ´òÁöÑ‰∏≠„ÄÅÂ§ßËßÑÊ®°Â∫îÁî®„ÄÇ</li>
</ul>
<h4 id="6-Â∏∏ËßÅÁöÑÂÜÖÂ≠òÊ∫¢Âá∫ÁöÑ‰∏âÁßçÊÉÖÂÜµ"><a href="#6-Â∏∏ËßÅÁöÑÂÜÖÂ≠òÊ∫¢Âá∫ÁöÑ‰∏âÁßçÊÉÖÂÜµ" class="headerlink" title="6.Â∏∏ËßÅÁöÑÂÜÖÂ≠òÊ∫¢Âá∫ÁöÑ‰∏âÁßçÊÉÖÂÜµ"></a>6.Â∏∏ËßÅÁöÑÂÜÖÂ≠òÊ∫¢Âá∫ÁöÑ‰∏âÁßçÊÉÖÂÜµ</h4><ol>
<li><p><strong>JVM Heap(Â†ÜÔºâÊ∫¢Âá∫</strong>Ôºö<code>java.lang.OutOfMemoryError</code>: <strong>Java heap space</strong>.<br><strong>JVM</strong>Âú®ÂêØÂä®ÁöÑÊó∂ÂÄô‰ºöËá™Âä®ËÆæÁΩÆ<strong>JVM Heap</strong> ÁöÑÂÄºÔºåÂèØ‰ª•Âà©Áî®<strong>JVM</strong>Êèê‰æõÁöÑ<code>-Xmn</code> <code>-Xms</code> <code>-Xmx</code>Á≠âÈÄâÈ°πËøõË°åËÆæÁΩÆ„ÄÇ<strong>Heap</strong>ÁöÑÂ§ßÂ∞èÊòØ<strong>Young Generation</strong>Âíå<strong>Tenured Generaion</strong>‰πãÂíå„ÄÇÂú®<strong>JVM</strong>‰∏≠Â¶ÇÊûú98%ÁöÑÊó∂Èó¥ÊòØÁî®‰∫é<strong>GC</strong>Ôºå‰∏îÂèØÁî®ÁöÑ<strong>Heap size</strong>‰∏çË∂≥**2%**ÁöÑÊó∂ÂÄôÂ∞ÜÊäõÂá∫Ê≠§ÂºÇÂ∏∏‰ø°ÊÅØ„ÄÇ</p>
<blockquote>
<p><strong>Ëß£ÂÜ≥ÊñπÊ≥ïÔºöÊâãÂä®ËÆæÁΩÆJVM HeapÔºàÂ†Ü)ÁöÑÂ§ßÂ∞è„ÄÇ</strong></p>
</blockquote>
</li>
<li><p><strong>PermGen spaceÊ∫¢Âá∫</strong>Ôºö<code>java.lang.OutOfMemoryError</code>: <strong>PermGen space</strong>.<br><strong>PermGen space</strong>ÁöÑÂÖ®Áß∞ÊòØ<strong>Permanent Generation space</strong>ÔºåÊòØÊåáÂÜÖÂ≠òÁöÑÊ∞∏‰πÖ‰øùÂ≠òÂå∫Âüü„ÄÇ‰∏∫‰ªÄ‰πà‰ºöÂÜÖÂ≠òÊ∫¢Âá∫ÔºåËøôÊòØÁî±‰∫éËøôÂùóÂÜÖÂ≠ò‰∏ªË¶ÅÊòØË¢´<strong>JVM</strong>Â≠òÊîæ<strong>Class</strong>Âíå <strong>Meta</strong>‰ø°ÊÅØÁöÑÔºå<strong>Class</strong> Âú®Ë¢´<strong>Load</strong>ÁöÑÊó∂ÂÄôË¢´ÊîæÂÖ• <strong>PermGen space</strong>Âå∫ÂüüÔºåÂÆÉÂíåÂ≠òÊîæ<strong>Instance</strong>ÁöÑ<strong>Heap</strong>Âå∫Âüü‰∏çÂêåÔºå<strong>sun</strong>ÁöÑ<strong>GC</strong>‰∏ç‰ºöÂú®‰∏ªÁ®ãÂ∫èËøêË°åÊúüÂØπ<strong>PermGen space</strong>ËøõË°åÊ∏ÖÁêÜÔºåÊâÄ‰ª•Â¶ÇÊûú‰Ω†ÁöÑAPP‰ºöËΩΩÂÖ•ÂæàÂ§öCLASSÁöÑËØùÔºåÂ∞±ÂæàÂèØËÉΩÂá∫Áé∞<strong>PermGen space</strong>Ê∫¢Âá∫„ÄÇ‰∏ÄËà¨ÂèëÁîüÂú®Á®ãÂ∫èÁöÑÂêØÂä®Èò∂ÊÆµ„ÄÇ</p>
<blockquote>
<p><strong>Ëß£ÂÜ≥ÊñπÊ≥ïÔºöÈÄöËøá-XX:PermSizeÂíå-XX:MaxPermSizeËÆæÁΩÆÊ∞∏‰πÖ‰ª£Â§ßÂ∞èÂç≥ÂèØ„ÄÇ</strong> </p>
</blockquote>
</li>
<li><p><strong>Ê†àÊ∫¢Âá∫</strong>Ôºö<code>java.lang.StackOverflowError</code> : <strong>Thread Stack space</strong>„ÄÇ<br>Ê†àÊ∫¢Âá∫‰∫ÜÔºå<strong>JVM</strong>‰æùÁÑ∂ÊòØÈááÁî®Ê†àÂºèÁöÑËôöÊãüÊú∫ÔºåËøô‰∏™ÂíåCÂíå PascalÈÉΩÊòØ‰∏ÄÊ†∑ÁöÑ„ÄÇÂáΩÊï∞ÁöÑË∞ÉÁî®ËøáÁ®ãÈÉΩ‰ΩìÁé∞Âú®Â†ÜÊ†àÂíåÈÄÄÊ†à‰∏ä‰∫Ü„ÄÇË∞ÉÁî®ÊûÑÈÄ†ÂáΩÊï∞ÁöÑ‚ÄùÂ±Ç‚ÄùÂ§™Â§ö‰∫ÜÔºå‰ª•Ëá¥‰∫éÊääÊ†àÂå∫Ê∫¢Âá∫‰∫Ü„ÄÇÈÄöÂ∏∏Êù•ËÆ≤Ôºå‰∏ÄËà¨Ê†àÂå∫ËøúËøúÂ∞è‰∫éÂ†ÜÂå∫ÁöÑÔºåÂõ†‰∏∫ÂáΩÊï∞Ë∞ÉÁî®ËøáÁ®ãÂæÄÂæÄ‰∏ç‰ºöÂ§ö‰∫é‰∏äÂçÉÂ±ÇÔºåËÄåÂç≥‰æøÊØè‰∏™ÂáΩÊï∞Ë∞ÉÁî®ÈúÄË¶Å<strong>1KB</strong>ÁöÑÁ©∫Èó¥(Ëøô‰∏™Â§ßÁ∫¶Áõ∏ÂΩì‰∫éÂú®‰∏Ä‰∏™CÂáΩÊï∞ÂÜÖÂ£∞Êòé‰∫Ü256‰∏™<strong>int</strong>Á±ªÂûãÁöÑÂèòÈáè)ÔºåÈÇ£‰πàÊ†àÂå∫‰πü‰∏çËøáÊòØÈúÄË¶Å<strong>1MB</strong>ÁöÑÁ©∫Èó¥„ÄÇ<strong>ÈÄöÂ∏∏Ê†àÁöÑÂ§ßÂ∞èÊòØ1~2MBÁöÑ</strong>„ÄÇÈÄö‰øó‰∏ÄÁÇπËÆ≤Â∞±ÊòØÂçïÁ∫øÁ®ãÁöÑÁ®ãÂ∫èÈúÄË¶ÅÁöÑÂÜÖÂ≠òÂ§™Â§ß‰∫Ü„ÄÇÈÄöÂ∏∏ÈÄíÂΩí‰πü‰∏çË¶ÅÈÄíÂΩíÁöÑÂ±ÇÊ¨°ËøáÂ§öÔºåÂæàÂÆπÊòìÊ∫¢Âá∫„ÄÇ</p>
<blockquote>
<p> <strong>Ëß£ÂÜ≥ÊñπÊ≥ïÔºö‰øÆÊîπÁ®ãÂ∫èÔºåÊàñËÄÖÈÄöËøá-XssÊù•ËÆæÁΩÆÊØè‰∏™Á∫øÁ®ãÁöÑStackÂ§ßÂ∞èÂç≥ÂèØ„ÄÇ</strong> </p>
</blockquote>
</li>
<li><p>ÊâÄ‰ª• <strong>Server</strong> ÂÆπÂô®ÂêØÂä®ÁöÑÊó∂ÂÄôÊàë‰ª¨ÁªèÂ∏∏ÂÖ≥ÂøÉÂíåËÆæÁΩÆ<strong>JVM</strong>ÁöÑÂá†‰∏™ÂèÇÊï∞Â¶Ç‰∏ã(ËØ¶ÁªÜÁöÑ<strong>JVM</strong>ÂèÇÊï∞ËØ∑ÂèÇÁúãÈôÑÂΩï3):</p>
<ul>
<li><p>-<code>Xms</code>Ôºö<strong>java Heap</strong>ÂàùÂßãÂ§ßÂ∞èÔºåÈªòËÆ§ÊòØÁâ©ÁêÜÂÜÖÂ≠òÁöÑ1&#x2F;64„ÄÇ</p>
</li>
<li><p><code>-Xmx</code>Ôºö<strong>java Heap</strong>ÊúÄÂ§ßÂÄºÔºå‰∏çÂèØË∂ÖËøáÁâ©ÁêÜÂÜÖÂ≠ò„ÄÇ</p>
</li>
<li><p><code>-Xmn</code>Ôºö <strong>young generation</strong>ÁöÑ <strong>heap</strong> Â§ßÂ∞èÔºå‰∏ÄËà¨ËÆæÁΩÆ‰∏∫<code>Xmx</code>ÁöÑ‰∏âÂõõÂàÜ‰πã‰∏Ä„ÄÇÂ¢ûÂ§ßÂπ¥ËΩª‰ª£ÂêéÔºåÂ∞Ü‰ºöÂáèÂ∞èÂπ¥ËÄÅ‰ª£Â§ßÂ∞èÔºåÂèØ‰ª•Ê†πÊçÆÁõëÊéßÂêàÁêÜËÆæÁΩÆ„ÄÇ</p>
</li>
<li><p><code>-Xss</code>ÔºöÊØè‰∏™Á∫øÁ®ãÁöÑ<strong>Stack</strong> Â§ßÂ∞èÔºåËÄåÊúÄ‰Ω≥ÂÄºÂ∫îËØ•ÊòØ<strong>128KB</strong>ÔºåÈªòËÆ§ÂÄºÂ•ΩÂÉèÊòØ<strong>512KB</strong></p>
</li>
<li><p><code>-XX:PermSize</code>ÔºöËÆæÂÆöÂÜÖÂ≠òÁöÑÊ∞∏‰πÖ‰øùÂ≠òÂå∫ÂàùÂßãÂ§ßÂ∞èÔºåÁº∫ÁúÅÂÄº‰∏∫<strong>64MB</strong>„ÄÇ</p>
</li>
<li><p><code>-XX:MaxPermSize</code>ÔºöËÆæÂÆöÂÜÖÂ≠òÁöÑÊ∞∏‰πÖ‰øùÂ≠òÂå∫ÊúÄÂ§ßÂ§ßÂ∞èÔºåÁº∫ÁúÅÂÄº‰∏∫<strong>64MB</strong>„ÄÇ</p>
</li>
<li><p><code>-XX:SurvivorRatio</code>Ôºö <strong>Eden</strong> Âå∫‰∏é<strong>Survivor</strong> Âå∫ÁöÑÂ§ßÂ∞èÊØîÂÄºÔºåËÆæÁΩÆ‰∏∫<strong>8</strong>ÔºåÂàô‰∏§‰∏™<strong>Survivor</strong>Âå∫‰∏é‰∏Ä‰∏™<strong>Eden</strong>Âå∫ÁöÑÊØîÂÄº‰∏∫<strong>2:8</strong>Ôºå‰∏Ä‰∏™ <strong>Survivor</strong>Âå∫Âç†Êï¥‰∏™Âπ¥ËΩª‰ª£ÁöÑ<strong>1&#x2F;10</strong>„ÄÇ</p>
</li>
<li><p><code>-XX:+UseParallelGC</code>Ôºö <strong>F</strong> Âπ¥ËΩª‰ª£‰ΩøÁî®Âπ∂ÂèëÊî∂ÈõÜÔºåËÄåÂπ¥ËÄÅ‰ª£‰ªçÊóß‰ΩøÁî®‰∏≤Ë°åÊî∂ÈõÜ„ÄÇ</p>
</li>
<li><p><code>-XX:+UseParNewGC</code>ÔºöËÆæÁΩÆÂπ¥ËΩª‰ª£‰∏∫Âπ∂Ë°åÊî∂ÈõÜÔºå<strong>JDK5.0</strong>‰ª•‰∏äÔºå<strong>JVM</strong>‰ºöÊ†πÊçÆÁ≥ªÁªüÈÖçÁΩÆËá™Ë°åËÆæÁΩÆÔºåËÄåÊó†È°ªÂÜçËÆæÁΩÆÊ≠§ÂÄº„ÄÇ</p>
</li>
<li><p><code>-XX:ParallelGCThreads</code>ÔºöÂπ∂Ë°åÊî∂ÈõÜÂô®ÁöÑÁ∫øÁ®ãÊï∞ÔºåÂÄºÊúÄÂ•ΩÈÖçÁΩÆ‰∏éÂ§ÑÁêÜÂô®Êï∞ÁõÆÁõ∏Á≠âÔºåÂêåÊ†∑ÈÄÇÁî®‰∫é<strong>CMS</strong>„ÄÇ</p>
</li>
<li><p><code>-XX:+UseParallelOldGC</code>ÔºöÂπ¥ËÄÅ‰ª£ÂûÉÂúæÊî∂ÈõÜÊñπÂºè‰∏∫Âπ∂Ë°åÊî∂ÈõÜ( <strong>Parallel Compacting</strong> ) „ÄÇ</p>
</li>
<li><p><code>-XX:MaxGCPauseMillis</code>ÔºöÊØèÊ¨°Âπ¥ËΩª‰ª£ÂûÉÂúæÂõûÊî∂ÁöÑÊúÄÈïøÊó∂Èó¥(ÊúÄÂ§ßÊöÇÂÅúÊó∂Èó¥)ÔºåÂ¶ÇÊûúÊó†Ê≥ïÊª°Ë∂≥Ê≠§Êó∂Èó¥Ôºå<strong>JVM</strong>‰ºöËá™Âä®Ë∞ÉÊï¥Âπ¥ËΩª‰ª£Â§ßÂ∞èÔºå‰ª•Êª°Ë∂≥Ê≠§ÂÄº„ÄÇ</p>
</li>
<li><p><code>-XX:+ScavengeBeforeFullGC</code>Ôºö<strong>Full GC</strong>ÂâçË∞ÉÁî®<strong>YGC</strong>ÔºåÈªòËÆ§ÊòØ<strong>true</strong>.</p>
<ul>
<li><p>ÂÆû‰æãÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">JAVA_OPTS<span class="token operator">=</span><span class="token string">"-Xms4g -Xmx4g -Xmn1024m -XX:PermSize=320M -XX:MaxPermSize=320m -XX:SurvivorRatio=6"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="ÂèØËßÜÂåñÁõëÊéßÂ∑•ÂÖ∑ÁöÑ‰ΩøÁî®"><a href="#ÂèØËßÜÂåñÁõëÊéßÂ∑•ÂÖ∑ÁöÑ‰ΩøÁî®" class="headerlink" title="ÂèØËßÜÂåñÁõëÊéßÂ∑•ÂÖ∑ÁöÑ‰ΩøÁî®"></a>ÂèØËßÜÂåñÁõëÊéßÂ∑•ÂÖ∑ÁöÑ‰ΩøÁî®</h3><ul>
<li><strong>VisualVM</strong> Âú® <code>%JAVA_HOME%\bin\jvisualvm.exe</code> ÔºåÁÇπÂáªÂ∞±ÂèØ‰ª•ÂêØÂä®<strong>VisualVM</strong>„ÄÇ</li>
<li><strong>JConsole</strong> Âú®<code>%JAVA_HOME%\bin\jconsole.exe</code>ÔºåÁÇπÂáªÂ∞±ÂèØ‰ª•ÂêØÂä®<strong>JConsole</strong>„ÄÇ</li>
<li><strong>Oracle Java Mission Control</strong> Âú®<code>%JAVA_HOME%\bin\jmc.exe</code>ÔºåÁÇπÂáªÂ∞±ÂèØ‰ª•ÂêØÂä®<strong>Oracle Java Mission Control</strong></li>
</ul>
<h3 id="Â¶Ç‰ΩïÈÄöËøáÂéãÂäõÊµãËØïÊù•ÊµãËØïÊúçÂä°Âô®ÁöÑÊäóÂéãËÉΩÂäõ"><a href="#Â¶Ç‰ΩïÈÄöËøáÂéãÂäõÊµãËØïÊù•ÊµãËØïÊúçÂä°Âô®ÁöÑÊäóÂéãËÉΩÂäõ" class="headerlink" title="Â¶Ç‰ΩïÈÄöËøáÂéãÂäõÊµãËØïÊù•ÊµãËØïÊúçÂä°Âô®ÁöÑÊäóÂéãËÉΩÂäõ"></a>Â¶Ç‰ΩïÈÄöËøáÂéãÂäõÊµãËØïÊù•ÊµãËØïÊúçÂä°Âô®ÁöÑÊäóÂéãËÉΩÂäõ</h3><ul>
<li><strong>JMeter</strong></li>
</ul>
<h3 id="MultithreadedTCÊµãËØïÂπ∂Âèë‰ªãÁªç"><a href="#MultithreadedTCÊµãËØïÂπ∂Âèë‰ªãÁªç" class="headerlink" title="MultithreadedTCÊµãËØïÂπ∂Âèë‰ªãÁªç"></a>MultithreadedTCÊµãËØïÂπ∂Âèë‰ªãÁªç</h3><p>‚Äã        <strong>MultithreadedTC</strong>ÊòØ‰∏Ä‰∏™JavaÂ∫ìÔºåÁî®Êù•ÊµãËØïÂπ∂ÂèëÂ∫îÁî®„ÄÇÂÆÉÁöÑ‰∏ªË¶ÅÁõÆÁöÑÊòØ‰∏∫‰∫ÜËß£ÂÜ≥Âπ∂ÂèëÂ∫îÁî®ÁöÑ‰∏çÁ°ÆÂÆöÈóÆÈ¢òÔºå‰Ω†‰∏çËÉΩÊéßÂà∂ÂÆÉ‰ª¨ÁöÑÊâßË°åÈ°∫Â∫è„ÄÇ‰∏∫‰∫ÜËøô‰∏™ÁõÆÁöÑÔºåÂÆÉÂåÖÂê´‰∫ÜÂÜÖÈÉ®ËäÇÊãçÂô®Êù•ÊéßÂà∂Â∫îÁî®ÁöÑ‰∏çÂêåÁ∫øÁ®ãÁöÑÊâßË°åÈ°∫Â∫è„ÄÇËøô‰∫õÊµãËØïÁ∫øÁ®ã‰Ωú‰∏∫Á±ªÁöÑÊñπÊ≥ïÊù•ÂÆûÁé∞ÁöÑ„ÄÇÂú®Êú¨ËäÇ‰∏≠ÔºåÊàë‰ª¨‰∏çÂÅöËØ¶ÁªÜËØ¥ÊòéÔºåÂè™ÊòØÂëäËØâÂ§ßÂÆ∂ÊúâËøô‰∏™ÊµãËØïÂ∫ìÔºåÊñπ‰æøÂ§ßÂÆ∂‰ª•ÂêéÂ≠¶‰π†‰ΩøÁî®„ÄÇÊé•‰∏ãÊù•Êàë‰ª¨Áúã‰∏Ä‰∏™‰ΩøÁî® <strong>MultithreadedTC</strong>Â∫ìÊù•‰∏∫<code>LinkedTransferQueue</code>ÂÆûÁé∞‰∏Ä‰∏™ÊµãËØï„ÄÇ<br>‚Äã        Ëøô‰∏™Â∫ì‰æùËµñ<code>junit-4.10.jar</code>Âíå <code>MultithreadedTC-1.01.jar</code>‰∏§‰∏™jarÂåÖÂ∫ì„ÄÇ</p>
<p>‚Äã        <strong>ProducerConsumerTest</strong>ÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ã:</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;1.   ÂàõÂª∫‰∏Ä‰∏™Á±ªÔºåÂêç‰∏∫ ProducerConsumerTestÔºåÊâ©Â±ï MultithreadedTestCase Á±ª„ÄÇ
public class ProducerConsumerTest extends MultithreadedTestCase &#123;

&#x2F;&#x2F;2.   Â£∞Êòé‰∏Ä‰∏™ÁßÅÊúâ LinkedTransferQueue Â±ûÊÄßÔºåÁî® String Á±ª‰∏∫ÂèÇÊï∞ÔºåÂêç‰∏∫ queue„ÄÇ
private LinkedTransferQueue&lt;String&gt; queue;

&#x2F;&#x2F;3.   ÂÆûÁé∞ initialize() ÊñπÊ≥ï„ÄÇÊ≠§ÊñπÊ≥ï‰∏çÊé•Êî∂‰ªª‰ΩïÂèÇÊï∞Ôºå‰πü‰∏çËøîÂõû‰ªª‰ΩïÂÄº„ÄÇÂÆÉË∞ÉÁî®Áà∂Á±ªÁöÑ initialize() ÊñπÊ≥ïÔºåÁÑ∂ÂêéÂàùÂßãÂåñ queue Â±ûÊÄß„ÄÇ
@Override
public void initialize() &#123;
	super.initialize();
	queue&#x3D;new LinkedTransferQueue&lt;String&gt;();
	System.out.printf(&quot;Test: The test has been initialized\n&quot;);
&#125;

&#x2F;&#x2F;4.   ÂÆûÁé∞ thread1() ÊñπÊ≥ï„ÄÇÂÆÉÂ∞ÜÂÆûÁé∞ÁöÑÈÄªËæëÊòØÁ¨¨‰∏Ä‰∏™consumer„ÄÇË∞ÉÁî® queue ÁöÑ take() ÊñπÊ≥ïÔºåÁÑ∂ÂêéÊääËøîÂõûÂÄºÂÜôÂÖ•ÊìçÊéßÂè∞„ÄÇ
public void thread1() throws InterruptedException &#123;
	String ret&#x3D;queue.take();
	System.out.printf(&quot;Thread 1: %s\n&quot;,ret);
&#125;

&#x2F;&#x2F;5.   ÂÆûÁé∞ thread2() ÊñπÊ≥ï„ÄÇÂÆÉÂ∞ÜÂÆûÁé∞ÁöÑÈÄªËæëÊòØÁ¨¨‰∫å‰∏™consumer„ÄÇÈ¶ñÂÖàÔºå‰ΩøÁî® waitForTick() ÊñπÊ≥ïÔºå‰∏ÄÁõ¥Á≠âÂà∞Á¨¨‰∏Ä‰∏™Á∫øÁ®ãÂú® take() ÊñπÊ≥ï‰∏≠ËøõÂÖ•‰ºëÁú†„ÄÇÁÑ∂ÂêéÔºåË∞ÉÁî®queueÁöÑ take() ÊñπÊ≥ïÔºåÂπ∂ÊääËøîÂõûÂÄºÂÜôÂÖ•ÊìçÊéßÂè∞„ÄÇ
public void thread2() throws InterruptedException &#123;
	waitForTick(1);
	String ret&#x3D;queue.take();
	System.out.printf(&quot;Thread 2: %s\n&quot;,ret);
&#125;

&#x2F;&#x2F;6.   ÂÆûÁé∞ thread3() ÊñπÊ≥ï„ÄÇÂÆÉÂ∞ÜÂÆûÁé∞ÁöÑÈÄªËæëÊòØproducer„ÄÇ È¶ñÂÖàÔºå‰ΩøÁî® waitForTick() ‰∏§Ê¨°‰∏ÄÁõ¥Á≠âÂà∞2‰∏™consumersË¢´ÈòªÂ°û„ÄÇÁÑ∂ÂêéÔºåË∞ÉÁî® queueÁöÑ put() ÊñπÊ≥ïÊèíÂÖ•2‰∏™String Âà∞queue‰∏≠„ÄÇ
public void thread3() &#123;
	waitForTick(1);
	waitForTick(2);
	queue.put(&quot;Event 1&quot;);
	queue.put(&quot;Event 2&quot;);
	System.out.printf(&quot;Thread 3: Inserted two elements\n&quot;);
&#125;

&#x2F;&#x2F;7.	ÊúÄÂêéÔºåÂÆûÁé∞ finish() ÊñπÊ≥ï„ÄÇÂÜô‰ø°ÊÅØÂà∞ÊìçÊéßÂè∞Ë°®ÊòéÊµãËØïÁªìÊùüÊâßË°å„ÄÇ‰ΩøÁî®assertEquals() ÊñπÊ≥ïÊ£ÄÊü•2‰∏™‰∫ã‰ª∂Â∑≤ÁªèË¢´consumedÔºàqueueÁöÑÂ§ßÂ∞è‰∏∫0Ôºâ„ÄÇ
public void finish() &#123;
	super.finish();
	System.out.printf(&quot;Test: End\n&quot;);
	assertEquals(true, queue.size()&#x3D;&#x3D;0);
	System.out.printf(&quot;Test: Result: The queue is empty\n&quot;);
&#125;

&#x2F;&#x2F;8.   ÂàõÂª∫‰æãÂ≠êÁöÑ‰∏ªÁ±ªÈÄöËøáÂàõÂª∫‰∏Ä‰∏™Á±ªÔºåÂêç‰∏∫ Main Âπ∂Ê∑ªÂä† main()ÊñπÊ≥ï„ÄÇ
public class Main &#123;

public static void main(String[] args) throws Throwable &#123;

&#x2F;&#x2F;9.   ÂàõÂª∫ ProducerConsumerTest ÂØπË±°ÔºåÂêç‰∏∫ test„ÄÇ
ProducerConsumerTest test&#x3D;new ProducerConsumerTest();

&#x2F;&#x2F;10. ‰ΩøÁî® TestFramework Á±ªÁöÑ runOnce()ÊñπÊ≥ïÊù•ÊâßË°åÊµãËØï„ÄÇ
System.out.printf(&quot;Main: Starting the test\n&quot;);
TestFramework.runOnce(test);
System.out.printf(&quot;Main: The test has finished\n&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>LinkedTransferQueue Á±ªÂÆûÁé∞‰∫Ü‰∏Ä‰∏™ÊµãËØï„ÄÇ‰Ω†ÂèØ‰ª•‰ΩøÁî®Ëøô‰∏™Â∫ìÂíåÂÆÉÁöÑËäÇÊãçÂô®‰∏∫‰ªª‰ΩïÂπ∂ÂèëÂ∫îÁî®ÊàñËÄÖÁ±ªÂÆûÁé∞ÊµãËØï„ÄÇÂú®‰æãÂ≠ê‰∏≠Ôºå‰Ω†ÂÆûÁé∞ÁªèÂÖ∏ÁöÑ producer&#x2F; consumer ÈóÆÈ¢òÔºå2‰∏™consumers Âíå‰∏Ä‰∏™producer„ÄÇ ‰Ω†ÊÉ≥Ë¶ÅÊµãËØïÁöÑÊòØ Âú®bufferÈáåÁöÑÁ¨¨‰∏Ä‰∏™‰ªãÁªçÁöÑ String ÂØπË±°‰ºöË¢´Á¨¨‰∏Ä‰∏™consumer Ê∂àËÄóÔºåÂíåÂú®bufferÈáåÁ¨¨‰∫å‰∏™‰ªãÁªçÁöÑStringÂØπË±°‰ºöË¢´Á¨¨‰∫å‰∏™Âà∞ËææÁöÑconsumerÊ∂àËÄó„ÄÇ</p>
<p>MultithreadedTCÂ∫ìÊòØÂü∫‰∫éJUnit Â∫ìÁöÑ„ÄÇJUnitÂ∫ìÊòØÂú®Java‰∏≠ÊúÄÁªèÂ∏∏Áî®Êù•ÂÆûÁé∞unitÊµãËØïÊó∂‰ΩøÁî®ÁöÑÂ∫ì„ÄÇ‰ΩøÁî® MultithreadedTC Â∫ìÊù•ÂÆûÁé∞‰∏Ä‰∏™Âü∫Êú¨ÊµãËØïÔºå‰Ω†ÂøÖÈ°ªÊâ©Â±ï MultithreadedTestCase Á±ª„ÄÇËøô‰∏™Á±ªÊâ©Â±ï‰∫Ü junit.framework.AssertJUnit Á±ªÔºåÂåÖÂê´‰∫ÜÂÖ®ÈÉ®Ê£ÄÊü•ÊµãËØïÁªìÊûúÁöÑÊñπÊ≥ï„ÄÇÂÆÉÂπ∂Ê≤°ÊúâÊâ©Â±ï junit.framework.TestCase Á±ªÔºå‰ΩøÁî®‰Ω†‰∏çËÉΩÂú®ÂÖ∂‰ªñ JUnit ÊµãËØï‰∏≠ÂØºÂÖ•MultithreadedTCÊµãËØï„ÄÇ</p>
<p>ÁÑ∂ÂêéÔºå‰Ω†ÂÆûÁé∞‰∫Ü‰ª•‰∏ãËøô‰∫õÊñπÊ≥ïÔºö</p>
<p>initialize(): Ê≠§ÊñπÊ≥ïÁöÑÂÆûÁé∞ÊòØÂèØÈÄâÁöÑ„ÄÇÂΩì‰Ω†ÂºÄÂßãÊµãËØïÊó∂ÔºåÂÆÉÂ∞±‰ºöÊâßË°åÔºå‰∏∫‰∫ÜÂàùÂßãÂåñÊµãËØï‰∏≠‰ΩøÁî®ÁöÑÂØπË±°ËÄå‰ΩøÁî®ÂÆÉ„ÄÇ<br>finish(): Ê≠§ÊñπÊ≥ïÁöÑÂÆûÁé∞ÊòØÂèØÈÄâÁöÑ„ÄÇÂΩìÊµãËØïÁªìÊùüÊó∂ÔºåÂÆÉÂ∞±‰ºöÊâßË°å„ÄÇ‰Ω†ÂèØ‰ª•‰ΩøÁî®ÂÆÉÂú®ÊµãËØïÊàñËÄÖÊ£ÄÊü•ÊµãËØïÁªìÊûúÊúüÈó¥Êù•ÂÖ≥Èó≠ÊàñËÄÖÈáäÊîæËµÑÊ∫ê„ÄÇ<br>ÂÆûÁé∞ÊµãËØïÁöÑÊñπÊ≥ïÔºöËøô‰∫õÊñπÊ≥ïÁöÑ‰∏ªË¶ÅÈÄªËæëÂ∞±ÊòØÊµãËØï‰Ω†ÁöÑÂÆûÁé∞„ÄÇ‰ªñ‰ª¨Áî®thread‰Ωú‰∏∫ÂßãÂÖ≥ÈîÆËØçËøûÊé•ÁùÄÂ≠óÁ¨¶‰∏≤ ‰æãÂ¶Ç, thread1()„ÄÇ</p>
<p>‰ΩøÁî® waitForTick() ÊñπÊ≥ïÊù•ÊéßÂà∂Á∫øÁ®ãÁöÑÊâßË°åÈ°∫Â∫è„ÄÇÊ≠§ÊñπÊ≥ïÊé•Êî∂‰∏Ä‰∏™Êï¥Êï∞type‰Ωú‰∏∫ÂèÇÊï∞ÔºåÊääÊ≠£Âú®ÊâßË°åÁöÑthreadÊîæÂÖ•‰ºëÁú†Áõ¥Âà∞ÂÖ®ÈÉ®Âú®ÊµãËØïÈáåËøêË°åÁöÑÁ∫øÁ®ãÈÉΩË¢´ÈòªÂ°û„ÄÇÁ≠â‰ªñ‰ª¨Ë¢´ÈòªÂ°ûÊó∂Ôºå MultithreadedTC Â∫ìË∞ÉÁî® waitForTick() ÊñπÊ≥ï ÊÅ¢Â§çË¢´ÈòªÂ°ûÁöÑÁ∫øÁ®ã„ÄÇ</p>
<p>‰º†ÈÄíÁªô waitForTick() ÊñπÊ≥ï‰Ωú‰∏∫ÂèÇÊï∞ÁöÑÊï¥Êï∞ÊòØÁî®Êù•ÊéßÂà∂ÊâßË°åÈ°∫Â∫èÁöÑ„ÄÇMultithreadedTC Â∫ìÁöÑËäÇÊãçÂô®Êúâ‰∏™ÂÜÖÈÉ®ËÆ°Êï∞Âô®„ÄÇÂΩìÂÖ®ÈÉ®Á∫øÁ®ãË¢´ÈòªÂ°ûÊó∂ÔºåÂ∫ìÂ¢ûÂä†ËÆ°Êï∞Âô®Âà∞‰∏ã‰∏™Âú® waitForTick() Ë∞ÉÁî®‰∏≠ÁöÑÊï∞Â≠óÔºåÈÇ£‰πàË¢´ÈòªÂ°ûÁöÑ„ÄÇ</p>
<p>‰ªéÂÜÖÈÉ®Êù•ËØ¥ÔºåÂΩì MultithreadedTC Â∫ì ÊâßË°åÊµãËØïÔºåÈ¶ñÂÖàÂÆÉÊâßË°å ÊñπÊ≥ï„ÄÇÁÑ∂ÂêéÔºåÂÆÉÂàõÂª∫ÊØè‰∏™Áî®thread‰Ωú‰∏∫ÂÖ≥ÈîÆËØçÂºÄÂ§¥ÁöÑÊñπÊ≥ïÁöÑÁ∫øÁ®ãÔºà‰æãÂ≠ê‰∏≠ÊòØÔºåÊñπÊ≥ï thread1(), thread2(), Âíå thread3()ÔºâÔºåÂΩìÂÖ®ÈÉ®Á∫øÁ®ãÈÉΩÁªìÊùüËøêË°åÂêéÔºåÂ∞±ÊâßË°å finish() ÊñπÊ≥ï„ÄÇ‰∏∫‰∫ÜËøêË°åÊµãËØïÔºå‰Ω†Ë¶Å‰ΩøÁî® TestFramework Á±ªÁöÑ runOnce() ÊñπÊ≥ï„ÄÇ</p>
<p>Êõ¥Â§ö‚Ä¶</p>
<p>Â¶ÇÊûú MultithreadedTC library Ê£ÄÊµãÁöÑÂÖ®ÈÉ®Á∫øÁ®ãÈÉΩË¢´ÈòªÂ°ûÔºå‰ΩÜÊòØÊ≤°Êúâ‰∏Ä‰∏™ÊòØË¢´ waitForTick() ÊñπÊ≥ïÈòªÂ°ûÁöÑÔºåÈÇ£‰πàÊµãËØïÂ∞±‰ºöË¢´ËÆ§‰∏∫Âú®deadlockÁä∂ÊÄÅÔºåÂπ∂ÊäõÂá∫ java.lang.IllegalStateException ÂºÇÂ∏∏„ÄÇ</p>
<h1 id="JAVAÂÜÖÂ≠òÊ®°Âûã"><a href="#JAVAÂÜÖÂ≠òÊ®°Âûã" class="headerlink" title="JAVAÂÜÖÂ≠òÊ®°Âûã"></a>JAVAÂÜÖÂ≠òÊ®°Âûã</h1><p><a target="_blank" rel="noopener" href="https://www.infoq.cn/profile/1C70A577591245/publish">Á®ãÊôìÊòé - InfoQ</a></p>
<p><a target="_blank" rel="noopener" href="https://www.infoq.cn/news/ftf-java-volatile">ËÅäËÅäÂπ∂ÂèëÔºà‰∏ÄÔºâ‚Äî‚ÄîÊ∑±ÂÖ•ÂàÜÊûêVolatileÁöÑÂÆûÁé∞ÂéüÁêÜ-InfoQ</a></p>
<p><a target="_blank" rel="noopener" href="https://xie.infoq.cn/article/a3e40b17eb9eb3a799c32e46b">ÊøÄÂä®ÔºÅÈòøÈáåÊäÄÊúØÂÆòÁ∫ØÊâãÊâìÔºå1263È°µÂπ∂ÂèëÁºñÁ®ãÂÖ®Á≥ªÁ¨îËÆ∞ÔºåÈôêÊó∂ÂºÄÊ∫ê - InfoQ ÂÜô‰ΩúÂπ≥Âè∞</a></p>
<p><a target="_blank" rel="noopener" href="https://xie.infoq.cn/article/4862293d3862488cc0133dc25">‰∏öÁïåÊñ∞Ê†áÊùÜÔºÅÈòøÈáåÂºÄÊ∫êËá™Á†îÈ´òÂπ∂ÂèëÁºñÁ®ãÊ†∏ÂøÉÁ¨îËÆ∞Ôºà2021ÊúÄÊñ∞ÁâàÔºâ - InfoQ ÂÜô‰ΩúÂπ≥Âè∞</a></p>
<h2 id="Âü∫Á°Ä"><a href="#Âü∫Á°Ä" class="headerlink" title="Âü∫Á°Ä"></a>Âü∫Á°Ä</h2><h3 id="Âπ∂ÂèëÁºñÁ®ãÊ®°ÂûãÁöÑÂàÜÁ±ª"><a href="#Âπ∂ÂèëÁºñÁ®ãÊ®°ÂûãÁöÑÂàÜÁ±ª" class="headerlink" title="Âπ∂ÂèëÁºñÁ®ãÊ®°ÂûãÁöÑÂàÜÁ±ª"></a>Âπ∂ÂèëÁºñÁ®ãÊ®°ÂûãÁöÑÂàÜÁ±ª</h3><p>Âú®Âπ∂ÂèëÁºñÁ®ã‰∏≠ÔºåÊàë‰ª¨ÈúÄË¶ÅÂ§ÑÁêÜ‰∏§‰∏™ÂÖ≥ÈîÆÈóÆÈ¢òÔºöÁ∫øÁ®ã‰πãÈó¥Â¶Ç‰ΩïÈÄö‰ø°ÂèäÁ∫øÁ®ã‰πãÈó¥Â¶Ç‰ΩïÂêåÊ≠•ÔºàËøôÈáåÁöÑÁ∫øÁ®ãÊòØÊåáÂπ∂ÂèëÊâßË°åÁöÑÊ¥ªÂä®ÂÆû‰ΩìÔºâ„ÄÇÈÄö‰ø°ÊòØÊåáÁ∫øÁ®ã‰πãÈó¥‰ª•‰ΩïÁßçÊú∫Âà∂Êù•‰∫§Êç¢‰ø°ÊÅØ„ÄÇÂú®ÂëΩ‰ª§ÂºèÁºñÁ®ã‰∏≠ÔºåÁ∫øÁ®ã‰πãÈó¥ÁöÑÈÄö‰ø°Êú∫Âà∂Êúâ‰∏§ÁßçÔºöÂÖ±‰∫´ÂÜÖÂ≠òÂíåÊ∂àÊÅØ‰º†ÈÄí„ÄÇ</p>
<p>Âú®ÂÖ±‰∫´ÂÜÖÂ≠òÁöÑÂπ∂ÂèëÊ®°ÂûãÈáåÔºåÁ∫øÁ®ã‰πãÈó¥ÂÖ±‰∫´Á®ãÂ∫èÁöÑÂÖ¨ÂÖ±Áä∂ÊÄÅÔºåÁ∫øÁ®ã‰πãÈó¥ÈÄöËøáÂÜô - ËØªÂÜÖÂ≠ò‰∏≠ÁöÑÂÖ¨ÂÖ±Áä∂ÊÄÅÊù•ÈöêÂºèËøõË°åÈÄö‰ø°„ÄÇÂú®Ê∂àÊÅØ‰º†ÈÄíÁöÑÂπ∂ÂèëÊ®°ÂûãÈáåÔºåÁ∫øÁ®ã‰πãÈó¥Ê≤°ÊúâÂÖ¨ÂÖ±Áä∂ÊÄÅÔºåÁ∫øÁ®ã‰πãÈó¥ÂøÖÈ°ªÈÄöËøáÊòéÁ°ÆÁöÑÂèëÈÄÅÊ∂àÊÅØÊù•ÊòæÂºèËøõË°åÈÄö‰ø°„ÄÇ</p>
<p>ÂêåÊ≠•ÊòØÊåáÁ®ãÂ∫èÁî®‰∫éÊéßÂà∂‰∏çÂêåÁ∫øÁ®ã‰πãÈó¥Êìç‰ΩúÂèëÁîüÁõ∏ÂØπÈ°∫Â∫èÁöÑÊú∫Âà∂„ÄÇÂú®ÂÖ±‰∫´ÂÜÖÂ≠òÂπ∂ÂèëÊ®°ÂûãÈáåÔºåÂêåÊ≠•ÊòØÊòæÂºèËøõË°åÁöÑ„ÄÇÁ®ãÂ∫èÂëòÂøÖÈ°ªÊòæÂºèÊåáÂÆöÊüê‰∏™ÊñπÊ≥ïÊàñÊüêÊÆµ‰ª£Á†ÅÈúÄË¶ÅÂú®Á∫øÁ®ã‰πãÈó¥‰∫íÊñ•ÊâßË°å„ÄÇÂú®Ê∂àÊÅØ‰º†ÈÄíÁöÑÂπ∂ÂèëÊ®°ÂûãÈáåÔºåÁî±‰∫éÊ∂àÊÅØÁöÑÂèëÈÄÅÂøÖÈ°ªÂú®Ê∂àÊÅØÁöÑÊé•Êî∂‰πãÂâçÔºåÂõ†Ê≠§ÂêåÊ≠•ÊòØÈöêÂºèËøõË°åÁöÑ„ÄÇ</p>
<p>Java ÁöÑÂπ∂ÂèëÈááÁî®ÁöÑÊòØÂÖ±‰∫´ÂÜÖÂ≠òÊ®°ÂûãÔºåJava Á∫øÁ®ã‰πãÈó¥ÁöÑÈÄö‰ø°ÊÄªÊòØÈöêÂºèËøõË°åÔºåÊï¥‰∏™ÈÄö‰ø°ËøáÁ®ãÂØπÁ®ãÂ∫èÂëòÂÆåÂÖ®ÈÄèÊòé„ÄÇÂ¶ÇÊûúÁºñÂÜôÂ§öÁ∫øÁ®ãÁ®ãÂ∫èÁöÑ Java Á®ãÂ∫èÂëò‰∏çÁêÜËß£ÈöêÂºèËøõË°åÁöÑÁ∫øÁ®ã‰πãÈó¥ÈÄö‰ø°ÁöÑÂ∑•‰ΩúÊú∫Âà∂ÔºåÂæàÂèØËÉΩ‰ºöÈÅáÂà∞ÂêÑÁßçÂ•áÊÄ™ÁöÑÂÜÖÂ≠òÂèØËßÅÊÄßÈóÆÈ¢ò„ÄÇ</p>
<p><strong>‰ªÄ‰πàÊòØJMMÔºü</strong></p>
<blockquote>
<p><code>JMM</code>ÔºöJavaÁ∫øÁ®ãÂÖ±‰∫´ÂÜÖÂ≠òÊ®°ÂûãÔºå‰∏çÂ≠òÂú®ÁöÑ‰∏úË•øÔºåÊ¶ÇÂøµÔºÅÁ∫¶ÂÆöÔºÅ</p>
</blockquote>
<p><strong>‰ªéJDK5ÂºÄÂßãÔºåJava‰ΩøÁî®Êñ∞ÁöÑÂÜÖÂ≠òÊ®°ÂûãÔºåÊñ∞ÂÜÖÂ≠òÊ®°ÂûãÂÆåÂÖ®ÊäõÂºÉ‰∫ÜÊóßÂÜÖÂ≠òÊ®°ÂûãÁöÑ‰∏ªÂÜÖÂ≠òÂíåÂ∑•‰ΩúÂÜÖÂ≠òÁöÑÊ¶ÇÂøµÔºå‰πüÊäõÂºÉ‰∫ÜÊóßÂÜÖÂ≠òÊ®°ÂûãÁöÑ8‰∏™ÂÜÖÂ≠òÊìç‰Ωú„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåÊñ∞ÂÜÖÂ≠òÊ®°ÂûãÂÆåÂÖ®ÊòØÈáçÊñ∞ËÆæËÆ°ÁöÑ‚ÄùÔºåËøôÈáåËØ¥ÁöÑ8‰∏™ÂÜÖÂ≠òÊìç‰ΩúÔºåÊåáÁöÑÊòØread „ÄÅload „ÄÅuse „ÄÅassign „ÄÅstore „ÄÅwrite „ÄÅlock „ÄÅunlockÂêß</strong></p>
<p><strong>ÂÖ≥‰∫éJMMÁöÑ‰∏Ä‰∫õÂêåÊ≠•ÁöÑÁ∫¶ÂÆöÔºö</strong></p>
<p>1„ÄÅÁ∫øÁ®ãËß£ÈîÅÂâçÔºåÂøÖÈ°ªÊääÂÖ±‰∫´ÂèòÈáè<strong>Á´ãÂàª</strong>Âà∑Êñ∞Âõû‰∏ªÁâ©ÁêÜÂÜÖÂ≠ò„ÄÇ</p>
<p>2„ÄÅÁ∫øÁ®ãÂä†ÈîÅÂâçÔºåÂøÖÈ°ªËØªÂèñ‰∏ªÁâ©ÁêÜÂÜÖÂ≠ò‰∏≠ÁöÑÊúÄÊñ∞ÁöÑÂÄºÂà∞Â∑•‰ΩúÂÜÖÂ≠ò‰∏≠„ÄÇ</p>
<p>3„ÄÅÂä†ÈîÅÂíåËß£ÈîÅÊòØÂêå‰∏ÄÊääÈîÅ„ÄÇ</p>
<blockquote>
<p><strong>JavaÂÖ±‰∫´ÂÜÖÂ≠òÊ®°ÂûãÁöÑ8ÁßçÊìç‰Ωú</strong></p>
</blockquote>
<p><img src="/image/Concurrent/Concurrent43.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent43.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>ÂÖ≥‰∫é‰∏ªÂÜÖÂ≠ò‰∏éÂ∑•‰ΩúÂÜÖÂ≠ò‰πãÈó¥ÁöÑ‰∫§‰∫íÂçèËÆÆÔºåÂç≥‰∏Ä‰∏™ÂèòÈáèÂ¶Ç‰Ωï‰ªé‰∏ªÂÜÖÂ≠òÊã∑Ë¥ùÂà∞Â∑•‰ΩúÂÜÖÂ≠ò„ÄÇÂ¶Ç‰Ωï‰ªéÂ∑•‰ΩúÂÜÖÂ≠òÂêåÊ≠•Âà∞‰∏ªÂÜÖÂ≠ò‰∏≠ÁöÑÂÆûÁé∞ÁªÜËäÇ„ÄÇjavaÂÜÖÂ≠òÊ®°ÂûãÂÆö‰πâ‰∫Ü8ÁßçÊìç‰ΩúÊù•ÂÆåÊàê„ÄÇ<strong>Ëøô8ÁßçÊìç‰ΩúÊØè‰∏ÄÁßçÈÉΩÊòØÂéüÂ≠êÊìç‰Ωú</strong>„ÄÇ8ÁßçÊìç‰ΩúÂ¶Ç‰∏ãÔºö</p>
<ul>
<li><strong>lock(ÈîÅÂÆö)Ôºö‰ΩúÁî®‰∫é‰∏ªÂÜÖÂ≠òÔºåÂÆÉÊää‰∏Ä‰∏™ÂèòÈáèÊ†áËÆ∞‰∏∫‰∏ÄÊù°Á∫øÁ®ãÁã¨Âç†Áä∂ÊÄÅÔºõ</strong></li>
<li><strong>read(ËØªÂèñ)Ôºö‰ΩúÁî®‰∫é‰∏ªÂÜÖÂ≠òÔºåÂÆÉÊääÂèòÈáèÂÄº‰ªé‰∏ªÂÜÖÂ≠ò‰º†ÈÄÅÂà∞Á∫øÁ®ãÁöÑÂ∑•‰ΩúÂÜÖÂ≠ò‰∏≠Ôºå‰ª•‰æøÈöèÂêéÁöÑloadÂä®‰Ωú‰ΩøÁî®Ôºõ</strong></li>
<li><strong>load(ËΩΩÂÖ•)Ôºö‰ΩúÁî®‰∫éÂ∑•‰ΩúÂÜÖÂ≠òÔºåÂÆÉÊääreadÊìç‰ΩúÁöÑÂÄºÊîæÂÖ•Â∑•‰ΩúÂÜÖÂ≠ò‰∏≠ÁöÑÂèòÈáèÂâØÊú¨‰∏≠Ôºõ</strong></li>
<li><strong>use(‰ΩøÁî®)Ôºö‰ΩúÁî®‰∫éÂ∑•‰ΩúÂÜÖÂ≠òÔºåÂÆÉÊääÂ∑•‰ΩúÂÜÖÂ≠ò‰∏≠ÁöÑÂÄº‰º†ÈÄíÁªôÊâßË°åÂºïÊìéÔºåÊØèÂΩìËôöÊãüÊú∫ÈÅáÂà∞‰∏Ä‰∏™ÈúÄË¶Å‰ΩøÁî®Ëøô‰∏™ÂèòÈáèÁöÑÊåá‰ª§Êó∂ÂÄôÔºåÂ∞Ü‰ºöÊâßË°åËøô‰∏™Âä®‰ΩúÔºõ</strong></li>
<li><strong>assign(ËµãÂÄº)Ôºö‰ΩúÁî®‰∫éÂ∑•‰ΩúÂÜÖÂ≠òÔºåÂÆÉÊää‰ªéÊâßË°åÂºïÊìéËé∑ÂèñÁöÑÂÄºËµãÂÄºÁªôÂ∑•‰ΩúÂÜÖÂ≠ò‰∏≠ÁöÑÂèòÈáèÔºåÊØèÂΩìËôöÊãüÊú∫ÈÅáÂà∞‰∏Ä‰∏™ÁªôÂèòÈáèËµãÂÄºÁöÑÊåá‰ª§Êó∂ÂÄôÔºåÊâßË°åËØ•Êìç‰ΩúÔºõ</strong></li>
<li><strong>store(Â≠òÂÇ®)Ôºö‰ΩúÁî®‰∫éÂ∑•‰ΩúÂÜÖÂ≠òÔºåÂÆÉÊääÂ∑•‰ΩúÂÜÖÂ≠ò‰∏≠ÁöÑ‰∏Ä‰∏™ÂèòÈáè‰º†ÈÄÅÁªô‰∏ªÂÜÖÂ≠ò‰∏≠Ôºå‰ª•Â§áÈöèÂêéÁöÑwriteÊìç‰Ωú‰ΩøÁî®Ôºõ</strong></li>
<li><strong>write(ÂÜôÂÖ•)Ôºö‰ΩúÁî®‰∫é‰∏ªÂÜÖÂ≠òÔºåÂÆÉÊäästore‰º†ÈÄÅÂÄºÊîæÂà∞‰∏ªÂÜÖÂ≠ò‰∏≠ÁöÑÂèòÈáè‰∏≠„ÄÇ</strong></li>
<li><strong>unlock(Ëß£ÈîÅ)Ôºö‰ΩúÁî®‰∫é‰∏ªÂÜÖÂ≠òÔºåÂÆÉÂ∞Ü‰∏Ä‰∏™Â§Ñ‰∫éÈîÅÂÆöÁä∂ÊÄÅÁöÑÂèòÈáèÈáäÊîæÂá∫Êù•ÔºåÈáäÊîæÂêéÁöÑÂèòÈáèÊâçËÉΩÂ§üË¢´ÂÖ∂‰ªñÁ∫øÁ®ãÈîÅÂÆöÔºõ</strong></li>
</ul>
<p>JavaÂÜÖÂ≠òÊ®°ÂûãËøòËßÑÂÆö‰∫ÜÊâßË°å‰∏äËø∞8ÁßçÂü∫Êú¨Êìç‰ΩúÊó∂ÂøÖÈ°ªÊª°Ë∂≥Â¶Ç‰∏ãËßÑÂàô:</p>
<ul>
<li><strong>‰∏çÂÖÅËÆ∏readÂíåload„ÄÅstoreÂíåwriteÊìç‰Ωú‰πã‰∏ÄÂçïÁã¨Âá∫Áé∞ÔºàÂç≥‰∏çÂÖÅËÆ∏‰∏Ä‰∏™ÂèòÈáè‰ªé‰∏ªÂ≠òËØªÂèñ‰∫Ü‰ΩÜÊòØÂ∑•‰ΩúÂÜÖÂ≠ò‰∏çÊé•ÂèóÔºåÊàñËÄÖ‰ªéÂ∑•‰ΩúÂÜÖÂ≠òÂèëËµ∑‰ºöÂÜô‰∫Ü‰ΩÜÊòØ‰∏ªÂ≠ò‰∏çÊé•ÂèóÁöÑÊÉÖÂÜµÔºâÔºå‰ª•‰∏ä‰∏§‰∏™Êìç‰ΩúÂøÖÈ°ªÊåâÈ°∫Â∫èÊâßË°åÔºå‰ΩÜÊ≤°Êúâ‰øùËØÅÂøÖÈ°ªËøûÁª≠ÊâßË°åÔºå‰πüÂ∞±ÊòØËØ¥Ôºåread‰∏éload‰πãÈó¥„ÄÅstore‰∏éwrite‰πãÈó¥ÊòØÂèØÊèíÂÖ•ÂÖ∂‰ªñÊåá‰ª§ÁöÑ„ÄÇ</strong></li>
<li><strong>‰∏çÂÖÅËÆ∏‰∏Ä‰∏™Á∫øÁ®ã‰∏¢ÂºÉÂÆÉÁöÑÊúÄËøëÁöÑassignÊìç‰ΩúÔºåÂç≥ÂèòÈáèÂú®Â∑•‰ΩúÂÜÖÂ≠ò‰∏≠ÊîπÂèò‰∫Ü‰πãÂêéÂøÖÈ°ªÊääËØ•ÂèòÂåñÂêåÊ≠•Âõû‰∏ªÂÜÖÂ≠ò„ÄÇ</strong></li>
<li><strong>‰∏çÂÖÅËÆ∏‰∏Ä‰∏™Á∫øÁ®ãÊó†ÂéüÂõ†Âú∞ÔºàÊ≤°ÊúâÂèëÁîüËøá‰ªª‰ΩïassignÊìç‰ΩúÔºâÊääÊï∞ÊçÆ‰ªéÁ∫øÁ®ãÁöÑÂ∑•‰ΩúÂÜÖÂ≠òÂêåÊ≠•Âõû‰∏ªÂÜÖÂ≠ò‰∏≠„ÄÇ</strong></li>
<li><strong>‰∏Ä‰∏™Êñ∞ÁöÑÂèòÈáèÂè™ËÉΩ‰ªé‰∏ªÂÜÖÂ≠ò‰∏≠‚ÄúËØûÁîü‚ÄùÔºå‰∏çÂÖÅËÆ∏Âú®Â∑•‰ΩúÂÜÖÂ≠ò‰∏≠Áõ¥Êé•‰ΩøÁî®‰∏Ä‰∏™Êú™Ë¢´ÂàùÂßãÂåñÔºàloadÊàñassignÔºâÁöÑÂèòÈáèÔºåÊç¢Âè•ËØùËØ¥Â∞±ÊòØÂØπ‰∏Ä‰∏™ÂèòÈáèÂÆûÊñΩuseÂíåstoreÊìç‰Ωú‰πãÂâçÔºåÂøÖÈ°ªÂÖàÊâßË°åËøá‰∫ÜassignÂíåloadÊìç‰Ωú„ÄÇ</strong></li>
<li><strong>‰∏Ä‰∏™ÂèòÈáèÂú®Âêå‰∏Ä‰∏™Êó∂ÂàªÂè™ÂÖÅËÆ∏‰∏ÄÊù°Á∫øÁ®ãÂØπÂÖ∂ÊâßË°ålockÊìç‰ΩúÔºå‰ΩÜlockÊìç‰ΩúÂèØ‰ª•Ë¢´Âêå‰∏Ä‰∏™Êù°Á∫øÁ®ãÈáçÂ§çÊâßË°åÂ§öÊ¨°ÔºåÂ§öÊ¨°ÊâßË°ålockÂêéÔºåÂè™ÊúâÊâßË°åÁõ∏ÂêåÊ¨°Êï∞ÁöÑunlockÊìç‰ΩúÔºåÂèòÈáèÊâç‰ºöË¢´Ëß£ÈîÅ„ÄÇ</strong></li>
<li><strong>Â¶ÇÊûúÂØπ‰∏Ä‰∏™ÂèòÈáèÊâßË°ålockÊìç‰ΩúÔºåÂ∞Ü‰ºöÊ∏ÖÁ©∫Â∑•‰ΩúÂÜÖÂ≠ò‰∏≠Ê≠§ÂèòÈáèÁöÑÂÄºÔºåÂú®ÊâßË°åÂºïÊìé‰ΩøÁî®Ëøô‰∏™ÂèòÈáèÂâçÔºåÈúÄË¶ÅÈáçÊñ∞ÊâßË°åloadÊàñassignÊìç‰ΩúÂàùÂßãÂåñÂèòÈáèÁöÑÂÄº„ÄÇ</strong></li>
<li><strong>Â¶ÇÊûú‰∏Ä‰∏™ÂèòÈáèÂÆûÁé∞Ê≤°ÊúâË¢´lockÊìç‰ΩúÈîÅÂÆöÔºåÂàô‰∏çÂÖÅËÆ∏ÂØπÂÆÉÊâßË°åunlockÊìç‰ΩúÔºå‰πü‰∏çÂÖÅËÆ∏Âéªunlock‰∏Ä‰∏™Ë¢´ÂÖ∂‰ªñÁ∫øÁ®ãÈîÅÂÆöÁöÑÂèòÈáè„ÄÇ</strong></li>
<li><strong>ÂØπ‰∏Ä‰∏™ÂèòÈáèÊâßË°åunlockÊìç‰Ωú‰πãÂâçÔºåÂøÖÈ°ªÂÖàÊääÊ≠§ÂèòÈáèÂêåÊ≠•Âõû‰∏ªÂÜÖÂ≠òÔºàÊâßË°åstoreÂíåwriteÊìç‰ΩúÔºâ„ÄÇ</strong></li>
</ul>
<h3 id="Java-ÂÜÖÂ≠òÊ®°ÂûãÁöÑÊäΩË±°"><a href="#Java-ÂÜÖÂ≠òÊ®°ÂûãÁöÑÊäΩË±°" class="headerlink" title="Java ÂÜÖÂ≠òÊ®°ÂûãÁöÑÊäΩË±°"></a>Java ÂÜÖÂ≠òÊ®°ÂûãÁöÑÊäΩË±°</h3><p>Âú® java ‰∏≠ÔºåÊâÄÊúâÂÆû‰æãÂüü„ÄÅÈùôÊÄÅÂüüÂíåÊï∞ÁªÑÂÖÉÁ¥†Â≠òÂÇ®Âú®Â†ÜÂÜÖÂ≠ò‰∏≠ÔºåÂ†ÜÂÜÖÂ≠òÂú®Á∫øÁ®ã‰πãÈó¥ÂÖ±‰∫´ÔºàÊú¨Êñá‰ΩøÁî®‚ÄúÂÖ±‰∫´ÂèòÈáè‚ÄùËøô‰∏™ÊúØËØ≠‰ª£ÊåáÂÆû‰æãÂüüÔºåÈùôÊÄÅÂüüÂíåÊï∞ÁªÑÂÖÉÁ¥†Ôºâ„ÄÇÂ±ÄÈÉ®ÂèòÈáèÔºàLocal variablesÔºâÔºåÊñπÊ≥ïÂÆö‰πâÂèÇÊï∞Ôºàjava ËØ≠Ë®ÄËßÑËåÉÁß∞‰πã‰∏∫ formal method parametersÔºâÂíåÂºÇÂ∏∏Â§ÑÁêÜÂô®ÂèÇÊï∞Ôºàexception handler parametersÔºâ‰∏ç‰ºöÂú®Á∫øÁ®ã‰πãÈó¥ÂÖ±‰∫´ÔºåÂÆÉ‰ª¨‰∏ç‰ºöÊúâÂÜÖÂ≠òÂèØËßÅÊÄßÈóÆÈ¢òÔºå‰πü‰∏çÂèóÂÜÖÂ≠òÊ®°ÂûãÁöÑÂΩ±Âìç„ÄÇ</p>
<p>Java Á∫øÁ®ã‰πãÈó¥ÁöÑÈÄö‰ø°Áî± Java ÂÜÖÂ≠òÊ®°ÂûãÔºàÊú¨ÊñáÁÆÄÁß∞‰∏∫ JMMÔºâÊéßÂà∂ÔºåJMM ÂÜ≥ÂÆö‰∏Ä‰∏™Á∫øÁ®ãÂØπÂÖ±‰∫´ÂèòÈáèÁöÑÂÜôÂÖ•‰ΩïÊó∂ÂØπÂè¶‰∏Ä‰∏™Á∫øÁ®ãÂèØËßÅ„ÄÇ‰ªéÊäΩË±°ÁöÑËßíÂ∫¶Êù•ÁúãÔºåJMM ÂÆö‰πâ‰∫ÜÁ∫øÁ®ãÂíå‰∏ªÂÜÖÂ≠ò‰πãÈó¥ÁöÑÊäΩË±°ÂÖ≥Á≥ªÔºöÁ∫øÁ®ã‰πãÈó¥ÁöÑÂÖ±‰∫´ÂèòÈáèÂ≠òÂÇ®Âú®‰∏ªÂÜÖÂ≠òÔºàmain memoryÔºâ‰∏≠ÔºåÊØè‰∏™Á∫øÁ®ãÈÉΩÊúâ‰∏Ä‰∏™ÁßÅÊúâÁöÑÊú¨Âú∞ÂÜÖÂ≠òÔºàlocal memoryÔºâÔºåÊú¨Âú∞ÂÜÖÂ≠ò‰∏≠Â≠òÂÇ®‰∫ÜËØ•Á∫øÁ®ã‰ª•ËØª &#x2F; ÂÜôÂÖ±‰∫´ÂèòÈáèÁöÑÂâØÊú¨„ÄÇÊú¨Âú∞ÂÜÖÂ≠òÊòØ JMM ÁöÑ‰∏Ä‰∏™ÊäΩË±°Ê¶ÇÂøµÔºåÂπ∂‰∏çÁúüÂÆûÂ≠òÂú®„ÄÇÂÆÉÊ∂µÁõñ‰∫ÜÁºìÂ≠òÔºåÂÜôÁºìÂÜ≤Âå∫ÔºåÂØÑÂ≠òÂô®‰ª•ÂèäÂÖ∂‰ªñÁöÑÁ°¨‰ª∂ÂíåÁºñËØëÂô®‰ºòÂåñ„ÄÇJava ÂÜÖÂ≠òÊ®°ÂûãÁöÑÊäΩË±°Á§∫ÊÑèÂõæÂ¶Ç‰∏ãÔºö</p>
<p><img src="/image/Concurrent/Concurrent44.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent44.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‰ªé‰∏äÂõæÊù•ÁúãÔºåÁ∫øÁ®ã A ‰∏éÁ∫øÁ®ã B ‰πãÈó¥Â¶ÇË¶ÅÈÄö‰ø°ÁöÑËØùÔºåÂøÖÈ°ªË¶ÅÁªèÂéÜ‰∏ãÈù¢ 2 ‰∏™Ê≠•È™§Ôºö</p>
<ol>
<li>È¶ñÂÖàÔºåÁ∫øÁ®ã A ÊääÊú¨Âú∞ÂÜÖÂ≠ò A ‰∏≠Êõ¥Êñ∞ËøáÁöÑÂÖ±‰∫´ÂèòÈáèÂà∑Êñ∞Âà∞‰∏ªÂÜÖÂ≠ò‰∏≠Âéª„ÄÇ</li>
<li>ÁÑ∂ÂêéÔºåÁ∫øÁ®ã B Âà∞‰∏ªÂÜÖÂ≠ò‰∏≠ÂéªËØªÂèñÁ∫øÁ®ã A ‰πãÂâçÂ∑≤Êõ¥Êñ∞ËøáÁöÑÂÖ±‰∫´ÂèòÈáè„ÄÇ</li>
</ol>
<p>‰∏ãÈù¢ÈÄöËøáÁ§∫ÊÑèÂõæÊù•ËØ¥ÊòéËøô‰∏§‰∏™Ê≠•È™§Ôºö</p>
<p><img src="/image/Concurrent/Concurrent45.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent45.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Â¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÊú¨Âú∞ÂÜÖÂ≠ò A Âíå B Êúâ‰∏ªÂÜÖÂ≠ò‰∏≠ÂÖ±‰∫´ÂèòÈáè x ÁöÑÂâØÊú¨„ÄÇÂÅáËÆæÂàùÂßãÊó∂ÔºåËøô‰∏â‰∏™ÂÜÖÂ≠ò‰∏≠ÁöÑ x ÂÄºÈÉΩ‰∏∫ 0„ÄÇÁ∫øÁ®ã A Âú®ÊâßË°åÊó∂ÔºåÊääÊõ¥Êñ∞ÂêéÁöÑ x ÂÄºÔºàÂÅáËÆæÂÄº‰∏∫ 1Ôºâ‰∏¥Êó∂Â≠òÊîæÂú®Ëá™Â∑±ÁöÑÊú¨Âú∞ÂÜÖÂ≠ò A ‰∏≠„ÄÇÂΩìÁ∫øÁ®ã A ÂíåÁ∫øÁ®ã B ÈúÄË¶ÅÈÄö‰ø°Êó∂ÔºåÁ∫øÁ®ã A È¶ñÂÖà‰ºöÊääËá™Â∑±Êú¨Âú∞ÂÜÖÂ≠ò‰∏≠‰øÆÊîπÂêéÁöÑ x ÂÄºÂà∑Êñ∞Âà∞‰∏ªÂÜÖÂ≠ò‰∏≠ÔºåÊ≠§Êó∂‰∏ªÂÜÖÂ≠ò‰∏≠ÁöÑ x ÂÄºÂèò‰∏∫‰∫Ü 1„ÄÇÈöèÂêéÔºåÁ∫øÁ®ã B Âà∞‰∏ªÂÜÖÂ≠ò‰∏≠ÂéªËØªÂèñÁ∫øÁ®ã A Êõ¥Êñ∞ÂêéÁöÑ x ÂÄºÔºåÊ≠§Êó∂Á∫øÁ®ã B ÁöÑÊú¨Âú∞ÂÜÖÂ≠òÁöÑ x ÂÄº‰πüÂèò‰∏∫‰∫Ü 1„ÄÇ</p>
<p>‰ªéÊï¥‰ΩìÊù•ÁúãÔºåËøô‰∏§‰∏™Ê≠•È™§ÂÆûË¥®‰∏äÊòØÁ∫øÁ®ã A Âú®ÂêëÁ∫øÁ®ã B ÂèëÈÄÅÊ∂àÊÅØÔºåËÄå‰∏îËøô‰∏™ÈÄö‰ø°ËøáÁ®ãÂøÖÈ°ªË¶ÅÁªèËøá‰∏ªÂÜÖÂ≠ò„ÄÇJMM ÈÄöËøáÊéßÂà∂‰∏ªÂÜÖÂ≠ò‰∏éÊØè‰∏™Á∫øÁ®ãÁöÑÊú¨Âú∞ÂÜÖÂ≠ò‰πãÈó¥ÁöÑ‰∫§‰∫íÔºåÊù•‰∏∫ java Á®ãÂ∫èÂëòÊèê‰æõÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅ„ÄÇ</p>
<h3 id="ÈáçÊéíÂ∫è"><a href="#ÈáçÊéíÂ∫è" class="headerlink" title="ÈáçÊéíÂ∫è"></a>ÈáçÊéíÂ∫è</h3><p>Âú®ÊâßË°åÁ®ãÂ∫èÊó∂‰∏∫‰∫ÜÊèêÈ´òÊÄßËÉΩÔºåÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®Â∏∏Â∏∏‰ºöÂØπÊåá‰ª§ÂÅöÈáçÊéíÂ∫è„ÄÇÈáçÊéíÂ∫èÂàÜ‰∏âÁßçÁ±ªÂûãÔºö</p>
<ol>
<li>ÁºñËØëÂô®‰ºòÂåñÁöÑÈáçÊéíÂ∫è„ÄÇÁºñËØëÂô®Âú®‰∏çÊîπÂèòÂçïÁ∫øÁ®ãÁ®ãÂ∫èËØ≠‰πâÁöÑÂâçÊèê‰∏ãÔºåÂèØ‰ª•ÈáçÊñ∞ÂÆâÊéíËØ≠Âè•ÁöÑÊâßË°åÈ°∫Â∫è„ÄÇ</li>
<li>Êåá‰ª§Á∫ßÂπ∂Ë°åÁöÑÈáçÊéíÂ∫è„ÄÇÁé∞‰ª£Â§ÑÁêÜÂô®ÈááÁî®‰∫ÜÊåá‰ª§Á∫ßÂπ∂Ë°åÊäÄÊúØÔºàInstruction-Level ParallelismÔºå ILPÔºâÊù•Â∞ÜÂ§öÊù°Êåá‰ª§ÈáçÂè†ÊâßË°å„ÄÇÂ¶ÇÊûú‰∏çÂ≠òÂú®Êï∞ÊçÆ‰æùËµñÊÄßÔºåÂ§ÑÁêÜÂô®ÂèØ‰ª•ÊîπÂèòËØ≠Âè•ÂØπÂ∫îÊú∫Âô®Êåá‰ª§ÁöÑÊâßË°åÈ°∫Â∫è„ÄÇ</li>
<li>ÂÜÖÂ≠òÁ≥ªÁªüÁöÑÈáçÊéíÂ∫è„ÄÇÁî±‰∫éÂ§ÑÁêÜÂô®‰ΩøÁî®ÁºìÂ≠òÂíåËØª &#x2F; ÂÜôÁºìÂÜ≤Âå∫ÔºåËøô‰ΩøÂæóÂä†ËΩΩÂíåÂ≠òÂÇ®Êìç‰ΩúÁúã‰∏äÂéªÂèØËÉΩÊòØÂú®‰π±Â∫èÊâßË°å„ÄÇ</li>
</ol>
<p>‰ªé java Ê∫ê‰ª£Á†ÅÂà∞ÊúÄÁªàÂÆûÈôÖÊâßË°åÁöÑÊåá‰ª§Â∫èÂàóÔºå‰ºöÂàÜÂà´ÁªèÂéÜ‰∏ãÈù¢‰∏âÁßçÈáçÊéíÂ∫èÔºö</p>
<p><img src="/image/Concurrent/Concurrent46.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent46.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‰∏äËø∞ÁöÑ 1 Â±û‰∫éÁºñËØëÂô®ÈáçÊéíÂ∫èÔºå2 Âíå 3 Â±û‰∫éÂ§ÑÁêÜÂô®ÈáçÊéíÂ∫è„ÄÇËøô‰∫õÈáçÊéíÂ∫èÈÉΩÂèØËÉΩ‰ºöÂØºËá¥Â§öÁ∫øÁ®ãÁ®ãÂ∫èÂá∫Áé∞ÂÜÖÂ≠òÂèØËßÅÊÄßÈóÆÈ¢ò„ÄÇÂØπ‰∫éÁºñËØëÂô®ÔºåJMM ÁöÑÁºñËØëÂô®ÈáçÊéíÂ∫èËßÑÂàô‰ºöÁ¶ÅÊ≠¢ÁâπÂÆöÁ±ªÂûãÁöÑÁºñËØëÂô®ÈáçÊéíÂ∫èÔºà‰∏çÊòØÊâÄÊúâÁöÑÁºñËØëÂô®ÈáçÊéíÂ∫èÈÉΩË¶ÅÁ¶ÅÊ≠¢Ôºâ„ÄÇÂØπ‰∫éÂ§ÑÁêÜÂô®ÈáçÊéíÂ∫èÔºåJMM ÁöÑÂ§ÑÁêÜÂô®ÈáçÊéíÂ∫èËßÑÂàô‰ºöË¶ÅÊ±Ç java ÁºñËØëÂô®Âú®ÁîüÊàêÊåá‰ª§Â∫èÂàóÊó∂ÔºåÊèíÂÖ•ÁâπÂÆöÁ±ªÂûãÁöÑÂÜÖÂ≠òÂ±èÈöúÔºàmemory barriersÔºåintel Áß∞‰πã‰∏∫ memory fenceÔºâÊåá‰ª§ÔºåÈÄöËøáÂÜÖÂ≠òÂ±èÈöúÊåá‰ª§Êù•Á¶ÅÊ≠¢ÁâπÂÆöÁ±ªÂûãÁöÑÂ§ÑÁêÜÂô®ÈáçÊéíÂ∫èÔºà‰∏çÊòØÊâÄÊúâÁöÑÂ§ÑÁêÜÂô®ÈáçÊéíÂ∫èÈÉΩË¶ÅÁ¶ÅÊ≠¢Ôºâ„ÄÇ</p>
<p>JMM Â±û‰∫éËØ≠Ë®ÄÁ∫ßÁöÑÂÜÖÂ≠òÊ®°ÂûãÔºåÂÆÉÁ°Æ‰øùÂú®‰∏çÂêåÁöÑÁºñËØëÂô®Âíå‰∏çÂêåÁöÑÂ§ÑÁêÜÂô®Âπ≥Âè∞‰πã‰∏äÔºåÈÄöËøáÁ¶ÅÊ≠¢ÁâπÂÆöÁ±ªÂûãÁöÑÁºñËØëÂô®ÈáçÊéíÂ∫èÂíåÂ§ÑÁêÜÂô®ÈáçÊéíÂ∫èÔºå‰∏∫Á®ãÂ∫èÂëòÊèê‰æõ‰∏ÄËá¥ÁöÑÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅ„ÄÇ</p>
<h3 id="Â§ÑÁêÜÂô®ÈáçÊéíÂ∫è‰∏éÂÜÖÂ≠òÂ±èÈöúÊåá‰ª§"><a href="#Â§ÑÁêÜÂô®ÈáçÊéíÂ∫è‰∏éÂÜÖÂ≠òÂ±èÈöúÊåá‰ª§" class="headerlink" title="Â§ÑÁêÜÂô®ÈáçÊéíÂ∫è‰∏éÂÜÖÂ≠òÂ±èÈöúÊåá‰ª§"></a>Â§ÑÁêÜÂô®ÈáçÊéíÂ∫è‰∏éÂÜÖÂ≠òÂ±èÈöúÊåá‰ª§</h3><p>Áé∞‰ª£ÁöÑÂ§ÑÁêÜÂô®‰ΩøÁî®ÂÜôÁºìÂÜ≤Âå∫Êù•‰∏¥Êó∂‰øùÂ≠òÂêëÂÜÖÂ≠òÂÜôÂÖ•ÁöÑÊï∞ÊçÆ„ÄÇÂÜôÁºìÂÜ≤Âå∫ÂèØ‰ª•‰øùËØÅÊåá‰ª§ÊµÅÊ∞¥Á∫øÊåÅÁª≠ËøêË°åÔºåÂÆÉÂèØ‰ª•ÈÅøÂÖçÁî±‰∫éÂ§ÑÁêÜÂô®ÂÅúÈ°ø‰∏ãÊù•Á≠âÂæÖÂêëÂÜÖÂ≠òÂÜôÂÖ•Êï∞ÊçÆËÄå‰∫ßÁîüÁöÑÂª∂Ëøü„ÄÇÂêåÊó∂ÔºåÈÄöËøá‰ª•ÊâπÂ§ÑÁêÜÁöÑÊñπÂºèÂà∑Êñ∞ÂÜôÁºìÂÜ≤Âå∫Ôºå‰ª•ÂèäÂêàÂπ∂ÂÜôÁºìÂÜ≤Âå∫‰∏≠ÂØπÂêå‰∏ÄÂÜÖÂ≠òÂú∞ÂùÄÁöÑÂ§öÊ¨°ÂÜôÔºåÂèØ‰ª•ÂáèÂ∞ëÂØπÂÜÖÂ≠òÊÄªÁ∫øÁöÑÂç†Áî®„ÄÇËôΩÁÑ∂ÂÜôÁºìÂÜ≤Âå∫ÊúâËøô‰πàÂ§öÂ•ΩÂ§ÑÔºå‰ΩÜÊØè‰∏™Â§ÑÁêÜÂô®‰∏äÁöÑÂÜôÁºìÂÜ≤Âå∫Ôºå‰ªÖ‰ªÖÂØπÂÆÉÊâÄÂú®ÁöÑÂ§ÑÁêÜÂô®ÂèØËßÅ„ÄÇËøô‰∏™ÁâπÊÄß‰ºöÂØπÂÜÖÂ≠òÊìç‰ΩúÁöÑÊâßË°åÈ°∫Â∫è‰∫ßÁîüÈáçË¶ÅÁöÑÂΩ±ÂìçÔºöÂ§ÑÁêÜÂô®ÂØπÂÜÖÂ≠òÁöÑËØª &#x2F; ÂÜôÊìç‰ΩúÁöÑÊâßË°åÈ°∫Â∫èÔºå‰∏ç‰∏ÄÂÆö‰∏éÂÜÖÂ≠òÂÆûÈôÖÂèëÁîüÁöÑËØª &#x2F; ÂÜôÊìç‰ΩúÈ°∫Â∫è‰∏ÄËá¥ÔºÅ‰∏∫‰∫ÜÂÖ∑‰ΩìËØ¥ÊòéÔºåËØ∑Áúã‰∏ãÈù¢Á§∫‰æãÔºö</p>
<pre class="line-numbers language-none"><code class="language-none">Processor A Processor B 

a &#x3D; 1; &#x2F;&#x2F;A1
x &#x3D; b; &#x2F;&#x2F;A2 

b &#x3D; 2; &#x2F;&#x2F;B1
y &#x3D; a; &#x2F;&#x2F;B2 ÂàùÂßãÁä∂ÊÄÅÔºöa &#x3D; b &#x3D; 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>Â§ÑÁêÜÂô®ÂÖÅËÆ∏ÊâßË°åÂêéÂæóÂà∞ÁªìÊûúÔºöx &#x3D; y &#x3D; 0 ÂÅáËÆæÂ§ÑÁêÜÂô® A ÂíåÂ§ÑÁêÜÂô® B ÊåâÁ®ãÂ∫èÁöÑÈ°∫Â∫èÂπ∂Ë°åÊâßË°åÂÜÖÂ≠òËÆøÈóÆÔºåÊúÄÁªàÂç¥ÂèØËÉΩÂæóÂà∞ x &#x3D; y &#x3D; 0 ÁöÑÁªìÊûú„ÄÇÂÖ∑‰ΩìÁöÑÂéüÂõ†Â¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="/image/Concurrent/Concurrent47.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent47.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>ËøôÈáåÂ§ÑÁêÜÂô® A ÂíåÂ§ÑÁêÜÂô® B ÂèØ‰ª•ÂêåÊó∂ÊääÂÖ±‰∫´ÂèòÈáèÂÜôÂÖ•Ëá™Â∑±ÁöÑÂÜôÁºìÂÜ≤Âå∫ÔºàA1ÔºåB1ÔºâÔºåÁÑ∂Âêé‰ªéÂÜÖÂ≠ò‰∏≠ËØªÂèñÂè¶‰∏Ä‰∏™ÂÖ±‰∫´ÂèòÈáèÔºàA2ÔºåB2ÔºâÔºåÊúÄÂêéÊâçÊääËá™Â∑±ÂÜôÁºìÂ≠òÂå∫‰∏≠‰øùÂ≠òÁöÑËÑèÊï∞ÊçÆÂà∑Êñ∞Âà∞ÂÜÖÂ≠ò‰∏≠ÔºàA3ÔºåB3Ôºâ„ÄÇÂΩì‰ª•ËøôÁßçÊó∂Â∫èÊâßË°åÊó∂ÔºåÁ®ãÂ∫èÂ∞±ÂèØ‰ª•ÂæóÂà∞ x &#x3D; y &#x3D; 0 ÁöÑÁªìÊûú„ÄÇ</p>
<p>‰ªéÂÜÖÂ≠òÊìç‰ΩúÂÆûÈôÖÂèëÁîüÁöÑÈ°∫Â∫èÊù•ÁúãÔºåÁõ¥Âà∞Â§ÑÁêÜÂô® A ÊâßË°å A3 Êù•Âà∑Êñ∞Ëá™Â∑±ÁöÑÂÜôÁºìÂ≠òÂå∫ÔºåÂÜôÊìç‰Ωú A1 ÊâçÁÆóÁúüÊ≠£ÊâßË°å‰∫Ü„ÄÇËôΩÁÑ∂Â§ÑÁêÜÂô® A ÊâßË°åÂÜÖÂ≠òÊìç‰ΩúÁöÑÈ°∫Â∫è‰∏∫ÔºöA1-&gt;A2Ôºå‰ΩÜÂÜÖÂ≠òÊìç‰ΩúÂÆûÈôÖÂèëÁîüÁöÑÈ°∫Â∫èÂç¥ÊòØÔºöA2-&gt;A1„ÄÇÊ≠§Êó∂ÔºåÂ§ÑÁêÜÂô® A ÁöÑÂÜÖÂ≠òÊìç‰ΩúÈ°∫Â∫èË¢´ÈáçÊéíÂ∫è‰∫ÜÔºàÂ§ÑÁêÜÂô® B ÁöÑÊÉÖÂÜµÂíåÂ§ÑÁêÜÂô® A ‰∏ÄÊ†∑ÔºåËøôÈáåÂ∞±‰∏çËµòËø∞‰∫ÜÔºâ„ÄÇ</p>
<p>ËøôÈáåÁöÑÂÖ≥ÈîÆÊòØÔºåÁî±‰∫éÂÜôÁºìÂÜ≤Âå∫‰ªÖÂØπËá™Â∑±ÁöÑÂ§ÑÁêÜÂô®ÂèØËßÅÔºåÂÆÉ‰ºöÂØºËá¥Â§ÑÁêÜÂô®ÊâßË°åÂÜÖÂ≠òÊìç‰ΩúÁöÑÈ°∫Â∫èÂèØËÉΩ‰ºö‰∏éÂÜÖÂ≠òÂÆûÈôÖÁöÑÊìç‰ΩúÊâßË°åÈ°∫Â∫è‰∏ç‰∏ÄËá¥„ÄÇÁî±‰∫éÁé∞‰ª£ÁöÑÂ§ÑÁêÜÂô®ÈÉΩ‰ºö‰ΩøÁî®ÂÜôÁºìÂÜ≤Âå∫ÔºåÂõ†Ê≠§Áé∞‰ª£ÁöÑÂ§ÑÁêÜÂô®ÈÉΩ‰ºöÂÖÅËÆ∏ÂØπÂÜô - ËØªÊìçÂÅöÈáçÊéíÂ∫è„ÄÇ</p>
<p>‰∏∫‰∫Ü‰øùËØÅÂÜÖÂ≠òÂèØËßÅÊÄßÔºåjava ÁºñËØëÂô®Âú®ÁîüÊàêÊåá‰ª§Â∫èÂàóÁöÑÈÄÇÂΩì‰ΩçÁΩÆ‰ºöÊèíÂÖ•ÂÜÖÂ≠òÂ±èÈöúÊåá‰ª§Êù•Á¶ÅÊ≠¢ÁâπÂÆöÁ±ªÂûãÁöÑÂ§ÑÁêÜÂô®ÈáçÊéíÂ∫è„ÄÇJMM ÊääÂÜÖÂ≠òÂ±èÈöúÊåá‰ª§ÂàÜ‰∏∫‰∏ãÂàóÂõõÁ±ªÔºö</p>
<p>‰∏ãÈù¢ÊòØÂ∏∏ËßÅÂ§ÑÁêÜÂô®ÂÖÅËÆ∏ÁöÑÈáçÊéíÂ∫èÁ±ªÂûãÁöÑÂàóË°®Ôºö</p>
<table>
<thead>
<tr>
<th>Â±èÈöúÁ±ªÂûã</th>
<th>Êåá‰ª§Á§∫‰æã</th>
<th>ËØ¥Êòé</th>
</tr>
</thead>
<tbody><tr>
<td>LoadLoad  Barriers</td>
<td>Load1; LoadLoad; Load2</td>
<td>Á°Æ‰øùLoad1Êï∞ÊçÆÁöÑË£ÖËΩΩÔºå‰πãÂâç‰∫éLoad2ÂèäÊâÄÊúâÂêéÁª≠Ë£ÖËΩΩÊåá‰ª§ÁöÑË£ÖËΩΩ„ÄÇ</td>
</tr>
<tr>
<td>StoreStore  Barriers</td>
<td>Store1; StoreStore; Store2</td>
<td>Á°Æ‰øùStore1Êï∞ÊçÆÂØπÂÖ∂‰ªñÂ§ÑÁêÜÂô®ÂèØËßÅÔºàÂà∑Êñ∞Âà∞ÂÜÖÂ≠òÔºâÔºå‰πãÂâç‰∫éStore2ÂèäÊâÄÊúâÂêéÁª≠Â≠òÂÇ®Êåá‰ª§ÁöÑÂ≠òÂÇ®„ÄÇ</td>
</tr>
<tr>
<td>LoadStore Barriers</td>
<td>Load1; LoadStore; Store2</td>
<td>Á°Æ‰øùLoad1Êï∞ÊçÆË£ÖËΩΩÔºå‰πãÂâç‰∫éStore2ÂèäÊâÄÊúâÂêéÁª≠ÁöÑÂ≠òÂÇ®Êåá‰ª§Âà∑Êñ∞Âà∞ÂÜÖÂ≠ò„ÄÇ</td>
</tr>
<tr>
<td>StoreLoad Barriers</td>
<td>Store1; StoreLoad; Load2</td>
<td>Á°Æ‰øùStore1Êï∞ÊçÆÂØπÂÖ∂‰ªñÂ§ÑÁêÜÂô®ÂèòÂæóÂèØËßÅÔºàÊåáÂà∑Êñ∞Âà∞ÂÜÖÂ≠òÔºâÔºå‰πãÂâç‰∫éLoad2ÂèäÊâÄÊúâÂêéÁª≠Ë£ÖËΩΩÊåá‰ª§ÁöÑË£ÖËΩΩ„ÄÇStoreLoad Barriers‰ºö‰ΩøËØ•Â±èÈöú‰πãÂâçÁöÑÊâÄÊúâÂÜÖÂ≠òËÆøÈóÆÊåá‰ª§ÔºàÂ≠òÂÇ®ÂíåË£ÖËΩΩÊåá‰ª§ÔºâÂÆåÊàê‰πãÂêéÔºåÊâçÊâßË°åËØ•Â±èÈöú‰πãÂêéÁöÑÂÜÖÂ≠òËÆøÈóÆÊåá‰ª§„ÄÇ</td>
</tr>
</tbody></table>
<h3 id="happens-before"><a href="#happens-before" class="headerlink" title="happens-before"></a>happens-before</h3><p>‰ªé JDK5 ÂºÄÂßãÔºåjava ‰ΩøÁî®Êñ∞ÁöÑ JSR -133 ÂÜÖÂ≠òÊ®°ÂûãÔºàÊú¨ÊñáÈô§ÈùûÁâπÂà´ËØ¥ÊòéÔºåÈíàÂØπÁöÑÈÉΩÊòØ JSR- 133 ÂÜÖÂ≠òÊ®°ÂûãÔºâ„ÄÇ<strong>JSR-133 ÊèêÂá∫‰∫Ü happens-before ÁöÑÊ¶ÇÂøµÔºåÈÄöËøáËøô‰∏™Ê¶ÇÂøµÊù•ÈòêËø∞Êìç‰Ωú‰πãÈó¥ÁöÑÂÜÖÂ≠òÂèØËßÅÊÄß</strong>„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™Êìç‰ΩúÊâßË°åÁöÑÁªìÊûúÈúÄË¶ÅÂØπÂè¶‰∏Ä‰∏™Êìç‰ΩúÂèØËßÅÔºåÈÇ£‰πàËøô‰∏§‰∏™Êìç‰Ωú‰πãÈó¥ÂøÖÈ°ªÂ≠òÂú® <strong>happens-before</strong> ÂÖ≥Á≥ª„ÄÇËøôÈáåÊèêÂà∞ÁöÑ‰∏§‰∏™Êìç‰ΩúÊó¢ÂèØ‰ª•ÊòØÂú®‰∏Ä‰∏™Á∫øÁ®ã‰πãÂÜÖÔºå‰πüÂèØ‰ª•ÊòØÂú®‰∏çÂêåÁ∫øÁ®ã‰πãÈó¥„ÄÇ ‰∏éÁ®ãÂ∫èÂëòÂØÜÂàáÁõ∏ÂÖ≥ÁöÑ <strong>happens-before</strong> ËßÑÂàôÂ¶Ç‰∏ãÔºö</p>
<ul>
<li><strong>Á®ãÂ∫èÈ°∫Â∫èËßÑÂàôÔºö‰∏Ä‰∏™Á∫øÁ®ã‰∏≠ÁöÑÊØè‰∏™Êìç‰ΩúÔºåhappens- before ‰∫éËØ•Á∫øÁ®ã‰∏≠ÁöÑ‰ªªÊÑèÂêéÁª≠Êìç‰Ωú„ÄÇ</strong></li>
<li><strong>ÁõëËßÜÂô®ÈîÅËßÑÂàôÔºöÂØπ‰∏Ä‰∏™ÁõëËßÜÂô®ÈîÅÁöÑËß£ÈîÅÔºåhappens- before ‰∫éÈöèÂêéÂØπËøô‰∏™ÁõëËßÜÂô®ÈîÅÁöÑÂä†ÈîÅ„ÄÇ</strong></li>
<li><strong>volatile ÂèòÈáèËßÑÂàôÔºöÂØπ‰∏Ä‰∏™ volatile ÂüüÁöÑÂÜôÔºåhappens- before ‰∫é‰ªªÊÑèÂêéÁª≠ÂØπËøô‰∏™ volatile ÂüüÁöÑËØª„ÄÇ</strong></li>
<li><strong>‰º†ÈÄíÊÄßÔºöÂ¶ÇÊûú A happens- before BÔºå‰∏î B happens- before CÔºåÈÇ£‰πà A happens- before C„ÄÇ</strong></li>
<li><strong>start()ËßÑÂàôÔºöÂ¶ÇÊûúÁ∫øÁ®ãAÊâßË°åÊìç‰ΩúThreadB.start()ÔºàÂêØÂä®Á∫øÁ®ãBÔºâÔºåÈÇ£‰πàAÁ∫øÁ®ãÁöÑThreadB.start()Êìç‰Ωúhappens-before‰∫éÁ∫øÁ®ãB‰∏≠ÁöÑ‰ªªÊÑèÊìç‰Ωú„ÄÇ</strong></li>
<li><strong>join()ËßÑÂàôÔºöÂ¶ÇÊûúÁ∫øÁ®ãAÊâßË°åÊìç‰ΩúThreadB.join()Âπ∂ÊàêÂäüËøîÂõûÔºåÈÇ£‰πàÁ∫øÁ®ãB‰∏≠ÁöÑ‰ªªÊÑèÊìç‰Ωúhappens-before‰∫éÁ∫øÁ®ãA‰ªéThreadB.join()Êìç‰ΩúÊàêÂäüËøîÂõû„ÄÇ</strong></li>
<li><strong>Á∫øÁ®ã‰∏≠Êñ≠ËßÑÂàôÔºöÂØπÁ∫øÁ®ãinterruptÊñπÊ≥ïÁöÑË∞ÉÁî®happens-before‰∫éË¢´‰∏≠Êñ≠Á∫øÁ®ãÁöÑ‰ª£Á†ÅÊ£ÄÊµãÂà∞‰∏≠Êñ≠‰∫ã‰ª∂ÁöÑÂèëÁîü</strong></li>
</ul>
<p>Ê≥®ÊÑèÔºå‰∏§‰∏™Êìç‰Ωú‰πãÈó¥ÂÖ∑Êúâ happens-before ÂÖ≥Á≥ªÔºåÂπ∂‰∏çÊÑèÂë≥ÁùÄÂâç‰∏Ä‰∏™Êìç‰ΩúÂøÖÈ°ªË¶ÅÂú®Âêé‰∏Ä‰∏™Êìç‰Ωú‰πãÂâçÊâßË°åÔºÅhappens-before ‰ªÖ‰ªÖË¶ÅÊ±ÇÂâç‰∏Ä‰∏™Êìç‰ΩúÔºàÊâßË°åÁöÑÁªìÊûúÔºâÂØπÂêé‰∏Ä‰∏™Êìç‰ΩúÂèØËßÅÔºå‰∏îÂâç‰∏Ä‰∏™Êìç‰ΩúÊåâÈ°∫Â∫èÊéíÂú®Á¨¨‰∫å‰∏™Êìç‰Ωú‰πãÂâçÔºàthe first is visible to and ordered before the secondÔºâ„ÄÇhappens- before ÁöÑÂÆö‰πâÂæàÂæÆÂ¶ôÔºåÂêéÊñá‰ºöÂÖ∑‰ΩìËØ¥Êòé happens-before ‰∏∫‰ªÄ‰πàË¶ÅËøô‰πàÂÆö‰πâ„ÄÇ</p>
<p>happens-before ‰∏é JMM ÁöÑÂÖ≥Á≥ªÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="/image/Concurrent/Concurrent48.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent48.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Â¶Ç‰∏äÂõæÊâÄÁ§∫Ôºå‰∏Ä‰∏™ happens-before ËßÑÂàôÈÄöÂ∏∏ÂØπÂ∫î‰∫éÂ§ö‰∏™ÁºñËØëÂô®ÈáçÊéíÂ∫èËßÑÂàôÂíåÂ§ÑÁêÜÂô®ÈáçÊéíÂ∫èËßÑÂàô„ÄÇÂØπ‰∫é java Á®ãÂ∫èÂëòÊù•ËØ¥Ôºåhappens-before ËßÑÂàôÁÆÄÂçïÊòìÊáÇÔºåÂÆÉÈÅøÂÖçÁ®ãÂ∫èÂëò‰∏∫‰∫ÜÁêÜËß£ JMM Êèê‰æõÁöÑÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅËÄåÂéªÂ≠¶‰π†Â§çÊùÇÁöÑÈáçÊéíÂ∫èËßÑÂàô‰ª•ÂèäËøô‰∫õËßÑÂàôÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇ</p>
<h2 id="ÈáçÊéíÂ∫è-1"><a href="#ÈáçÊéíÂ∫è-1" class="headerlink" title="ÈáçÊéíÂ∫è"></a>ÈáçÊéíÂ∫è</h2><h3 id="Êï∞ÊçÆ‰æùËµñÊÄß"><a href="#Êï∞ÊçÆ‰æùËµñÊÄß" class="headerlink" title="Êï∞ÊçÆ‰æùËµñÊÄß"></a>Êï∞ÊçÆ‰æùËµñÊÄß</h3><p>Â¶ÇÊûú‰∏§‰∏™Êìç‰ΩúËÆøÈóÆÂêå‰∏Ä‰∏™ÂèòÈáèÔºå‰∏îËøô‰∏§‰∏™Êìç‰Ωú‰∏≠Êúâ‰∏Ä‰∏™‰∏∫ÂÜôÊìç‰ΩúÔºåÊ≠§Êó∂Ëøô‰∏§‰∏™Êìç‰Ωú‰πãÈó¥Â∞±Â≠òÂú®Êï∞ÊçÆ‰æùËµñÊÄß„ÄÇÊï∞ÊçÆ‰æùËµñÂàÜ‰∏ãÂàó‰∏âÁßçÁ±ªÂûãÔºö</p>
<p>ÂêçÁß∞ ‰ª£Á†ÅÁ§∫‰æã ËØ¥Êòé ÂÜôÂêéËØª a &#x3D; 1;b &#x3D; a; ÂÜô‰∏Ä‰∏™ÂèòÈáè‰πãÂêéÔºåÂÜçËØªËøô‰∏™‰ΩçÁΩÆ„ÄÇ ÂÜôÂêéÂÜô a &#x3D; 1;a &#x3D; 2; ÂÜô‰∏Ä‰∏™ÂèòÈáè‰πãÂêéÔºåÂÜçÂÜôËøô‰∏™ÂèòÈáè„ÄÇ ËØªÂêéÂÜô a &#x3D; b;b &#x3D; 1; ËØª‰∏Ä‰∏™ÂèòÈáè‰πãÂêéÔºåÂÜçÂÜôËøô‰∏™ÂèòÈáè„ÄÇ‰∏äÈù¢‰∏âÁßçÊÉÖÂÜµÔºåÂè™Ë¶ÅÈáçÊéíÂ∫è‰∏§‰∏™Êìç‰ΩúÁöÑÊâßË°åÈ°∫Â∫èÔºåÁ®ãÂ∫èÁöÑÊâßË°åÁªìÊûúÂ∞Ü‰ºöË¢´ÊîπÂèò„ÄÇ</p>
<p>ÂâçÈù¢ÊèêÂà∞ËøáÔºåÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÂèØËÉΩ‰ºöÂØπÊìç‰ΩúÂÅöÈáçÊéíÂ∫è„ÄÇÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®Âú®ÈáçÊéíÂ∫èÊó∂Ôºå‰ºöÈÅµÂÆàÊï∞ÊçÆ‰æùËµñÊÄßÔºåÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®‰∏ç‰ºöÊîπÂèòÂ≠òÂú®Êï∞ÊçÆ‰æùËµñÂÖ≥Á≥ªÁöÑ‰∏§‰∏™Êìç‰ΩúÁöÑÊâßË°åÈ°∫Â∫è„ÄÇ</p>
<p>Ê≥®ÊÑèÔºåËøôÈáåÊâÄËØ¥ÁöÑÊï∞ÊçÆ‰æùËµñÊÄß‰ªÖÈíàÂØπÂçï‰∏™Â§ÑÁêÜÂô®‰∏≠ÊâßË°åÁöÑÊåá‰ª§Â∫èÂàóÂíåÂçï‰∏™Á∫øÁ®ã‰∏≠ÊâßË°åÁöÑÊìç‰ΩúÔºå‰∏çÂêåÂ§ÑÁêÜÂô®‰πãÈó¥Âíå‰∏çÂêåÁ∫øÁ®ã‰πãÈó¥ÁöÑÊï∞ÊçÆ‰æùËµñÊÄß‰∏çË¢´ÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ËÄÉËôë„ÄÇ</p>
<h3 id="as-if-serial-ËØ≠‰πâ"><a href="#as-if-serial-ËØ≠‰πâ" class="headerlink" title="as-if-serial ËØ≠‰πâ"></a>as-if-serial ËØ≠‰πâ</h3><p>as-if-serial ËØ≠‰πâÁöÑÊÑèÊÄùÊåáÔºö‰∏çÁÆ°ÊÄé‰πàÈáçÊéíÂ∫èÔºàÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®‰∏∫‰∫ÜÊèêÈ´òÂπ∂Ë°åÂ∫¶ÔºâÔºåÔºàÂçïÁ∫øÁ®ãÔºâÁ®ãÂ∫èÁöÑÊâßË°åÁªìÊûú‰∏çËÉΩË¢´ÊîπÂèò„ÄÇÁºñËØëÂô®Ôºåruntime ÂíåÂ§ÑÁêÜÂô®ÈÉΩÂøÖÈ°ªÈÅµÂÆà as-if-serial ËØ≠‰πâ„ÄÇ</p>
<p>‰∏∫‰∫ÜÈÅµÂÆà as-if-serial ËØ≠‰πâÔºåÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®‰∏ç‰ºöÂØπÂ≠òÂú®Êï∞ÊçÆ‰æùËµñÂÖ≥Á≥ªÁöÑÊìç‰ΩúÂÅöÈáçÊéíÂ∫èÔºåÂõ†‰∏∫ËøôÁßçÈáçÊéíÂ∫è‰ºöÊîπÂèòÊâßË°åÁªìÊûú„ÄÇ‰ΩÜÊòØÔºåÂ¶ÇÊûúÊìç‰Ωú‰πãÈó¥‰∏çÂ≠òÂú®Êï∞ÊçÆ‰æùËµñÂÖ≥Á≥ªÔºåËøô‰∫õÊìç‰ΩúÂèØËÉΩË¢´ÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÈáçÊéíÂ∫è„ÄÇ‰∏∫‰∫ÜÂÖ∑‰ΩìËØ¥ÊòéÔºåËØ∑Áúã‰∏ãÈù¢ËÆ°ÁÆóÂúÜÈù¢ÁßØÁöÑ‰ª£Á†ÅÁ§∫‰æãÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">double</span> pi  <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>    <span class="token comment">//A</span>
<span class="token keyword">double</span> r   <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>     <span class="token comment">//B</span>
<span class="token keyword">double</span> area <span class="token operator">=</span> pi <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">;</span> <span class="token comment">//C</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>‰∏äÈù¢‰∏â‰∏™Êìç‰ΩúÁöÑÊï∞ÊçÆ‰æùËµñÂÖ≥Á≥ªÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="/image/Concurrent/Concurrent49.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent49.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Â¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåA Âíå C ‰πãÈó¥Â≠òÂú®Êï∞ÊçÆ‰æùËµñÂÖ≥Á≥ªÔºåÂêåÊó∂ B Âíå C ‰πãÈó¥‰πüÂ≠òÂú®Êï∞ÊçÆ‰æùËµñÂÖ≥Á≥ª„ÄÇÂõ†Ê≠§Âú®ÊúÄÁªàÊâßË°åÁöÑÊåá‰ª§Â∫èÂàó‰∏≠ÔºåC ‰∏çËÉΩË¢´ÈáçÊéíÂ∫èÂà∞ A Âíå B ÁöÑÂâçÈù¢ÔºàC ÊéíÂà∞ A Âíå B ÁöÑÂâçÈù¢ÔºåÁ®ãÂ∫èÁöÑÁªìÊûúÂ∞Ü‰ºöË¢´ÊîπÂèòÔºâ„ÄÇ‰ΩÜ A Âíå B ‰πãÈó¥Ê≤°ÊúâÊï∞ÊçÆ‰æùËµñÂÖ≥Á≥ªÔºåÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÂèØ‰ª•ÈáçÊéíÂ∫è A Âíå B ‰πãÈó¥ÁöÑÊâßË°åÈ°∫Â∫è„ÄÇ‰∏ãÂõæÊòØËØ•Á®ãÂ∫èÁöÑ‰∏§ÁßçÊâßË°åÈ°∫Â∫èÔºö</p>
<p><img src="/image/Concurrent/Concurrent50.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent50.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>as-if-serial ËØ≠‰πâÊääÂçïÁ∫øÁ®ãÁ®ãÂ∫è‰øùÊä§‰∫ÜËµ∑Êù•ÔºåÈÅµÂÆà as-if-serial ËØ≠‰πâÁöÑÁºñËØëÂô®Ôºåruntime ÂíåÂ§ÑÁêÜÂô®ÂÖ±Âêå‰∏∫ÁºñÂÜôÂçïÁ∫øÁ®ãÁ®ãÂ∫èÁöÑÁ®ãÂ∫èÂëòÂàõÂª∫‰∫Ü‰∏Ä‰∏™ÂπªËßâÔºöÂçïÁ∫øÁ®ãÁ®ãÂ∫èÊòØÊåâÁ®ãÂ∫èÁöÑÈ°∫Â∫èÊù•ÊâßË°åÁöÑ„ÄÇas-if-serial ËØ≠‰πâ‰ΩøÂçïÁ∫øÁ®ãÁ®ãÂ∫èÂëòÊó†ÈúÄÊãÖÂøÉÈáçÊéíÂ∫è‰ºöÂπ≤Êâ∞‰ªñ‰ª¨Ôºå‰πüÊó†ÈúÄÊãÖÂøÉÂÜÖÂ≠òÂèØËßÅÊÄßÈóÆÈ¢ò„ÄÇ</p>
<h3 id="Á®ãÂ∫èÈ°∫Â∫èËßÑÂàô"><a href="#Á®ãÂ∫èÈ°∫Â∫èËßÑÂàô" class="headerlink" title="Á®ãÂ∫èÈ°∫Â∫èËßÑÂàô"></a>Á®ãÂ∫èÈ°∫Â∫èËßÑÂàô</h3><p>Ê†πÊçÆ happens- before ÁöÑÁ®ãÂ∫èÈ°∫Â∫èËßÑÂàôÔºå‰∏äÈù¢ËÆ°ÁÆóÂúÜÁöÑÈù¢ÁßØÁöÑÁ§∫‰æã‰ª£Á†ÅÂ≠òÂú®‰∏â‰∏™ happens- before ÂÖ≥Á≥ªÔºö</p>
<ol>
<li>A happens- before BÔºõ</li>
<li>B happens- before CÔºõ</li>
<li>A happens- before CÔºõ</li>
</ol>
<p>ËøôÈáåÁöÑÁ¨¨ 3 ‰∏™ happens- before ÂÖ≥Á≥ªÔºåÊòØÊ†πÊçÆ happens- before ÁöÑ‰º†ÈÄíÊÄßÊé®ÂØºÂá∫Êù•ÁöÑ„ÄÇ</p>
<p>ËøôÈáå A happens- before BÔºå‰ΩÜÂÆûÈôÖÊâßË°åÊó∂ B Âç¥ÂèØ‰ª•ÊéíÂú® A ‰πãÂâçÊâßË°åÔºàÁúã‰∏äÈù¢ÁöÑÈáçÊéíÂ∫èÂêéÁöÑÊâßË°åÈ°∫Â∫èÔºâ„ÄÇÂú®Á¨¨‰∏ÄÁ´†ÊèêÂà∞ËøáÔºåÂ¶ÇÊûú A happens- before BÔºåJMM Âπ∂‰∏çË¶ÅÊ±Ç A ‰∏ÄÂÆöË¶ÅÂú® B ‰πãÂâçÊâßË°å„ÄÇJMM ‰ªÖ‰ªÖË¶ÅÊ±ÇÂâç‰∏Ä‰∏™Êìç‰ΩúÔºàÊâßË°åÁöÑÁªìÊûúÔºâÂØπÂêé‰∏Ä‰∏™Êìç‰ΩúÂèØËßÅÔºå‰∏îÂâç‰∏Ä‰∏™Êìç‰ΩúÊåâÈ°∫Â∫èÊéíÂú®Á¨¨‰∫å‰∏™Êìç‰Ωú‰πãÂâç„ÄÇËøôÈáåÊìç‰Ωú A ÁöÑÊâßË°åÁªìÊûú‰∏çÈúÄË¶ÅÂØπÊìç‰Ωú B ÂèØËßÅÔºõËÄå‰∏îÈáçÊéíÂ∫èÊìç‰Ωú A ÂíåÊìç‰Ωú B ÂêéÁöÑÊâßË°åÁªìÊûúÔºå‰∏éÊìç‰Ωú A ÂíåÊìç‰Ωú B Êåâ happens- before È°∫Â∫èÊâßË°åÁöÑÁªìÊûú‰∏ÄËá¥„ÄÇÂú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåJMM ‰ºöËÆ§‰∏∫ËøôÁßçÈáçÊéíÂ∫èÂπ∂‰∏çÈùûÊ≥ïÔºànot illegalÔºâÔºåJMM ÂÖÅËÆ∏ËøôÁßçÈáçÊéíÂ∫è„ÄÇ</p>
<p>Âú®ËÆ°ÁÆóÊú∫‰∏≠ÔºåËΩØ‰ª∂ÊäÄÊúØÂíåÁ°¨‰ª∂ÊäÄÊúØÊúâ‰∏Ä‰∏™ÂÖ±ÂêåÁöÑÁõÆÊ†áÔºöÂú®‰∏çÊîπÂèòÁ®ãÂ∫èÊâßË°åÁªìÊûúÁöÑÂâçÊèê‰∏ãÔºåÂ∞ΩÂèØËÉΩÁöÑÂºÄÂèëÂπ∂Ë°åÂ∫¶„ÄÇÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÈÅµ‰ªéËøô‰∏ÄÁõÆÊ†áÔºå‰ªé happens- before ÁöÑÂÆö‰πâÊàë‰ª¨ÂèØ‰ª•ÁúãÂá∫ÔºåJMM ÂêåÊ†∑ÈÅµ‰ªéËøô‰∏ÄÁõÆÊ†á„ÄÇ</p>
<h3 id="ÈáçÊéíÂ∫èÂØπÂ§öÁ∫øÁ®ãÁöÑÂΩ±Âìç"><a href="#ÈáçÊéíÂ∫èÂØπÂ§öÁ∫øÁ®ãÁöÑÂΩ±Âìç" class="headerlink" title="ÈáçÊéíÂ∫èÂØπÂ§öÁ∫øÁ®ãÁöÑÂΩ±Âìç"></a>ÈáçÊéíÂ∫èÂØπÂ§öÁ∫øÁ®ãÁöÑÂΩ±Âìç</h3><p>Áé∞Âú®ËÆ©Êàë‰ª¨Êù•ÁúãÁúãÔºåÈáçÊéíÂ∫èÊòØÂê¶‰ºöÊîπÂèòÂ§öÁ∫øÁ®ãÁ®ãÂ∫èÁöÑÊâßË°åÁªìÊûú„ÄÇËØ∑Áúã‰∏ãÈù¢ÁöÑÁ§∫‰æã‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">ReorderExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                   <span class="token comment">//1</span>
       flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>             <span class="token comment">//2</span>
    <span class="token punctuation">&#125;</span>

    <span class="token class-name">Public</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//3</span>
           <span class="token keyword">int</span> i <span class="token operator">=</span>  a <span class="token operator">*</span> a<span class="token punctuation">;</span>        <span class="token comment">//4</span>
           ‚Ä¶‚Ä¶
       <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>flag ÂèòÈáèÊòØ‰∏™Ê†áËÆ∞ÔºåÁî®Êù•Ê†áËØÜÂèòÈáè a ÊòØÂê¶Â∑≤Ë¢´ÂÜôÂÖ•„ÄÇËøôÈáåÂÅáËÆæÊúâ‰∏§‰∏™Á∫øÁ®ã A Âíå BÔºåA È¶ñÂÖàÊâßË°å writer() ÊñπÊ≥ïÔºåÈöèÂêé B Á∫øÁ®ãÊé•ÁùÄÊâßË°å reader() ÊñπÊ≥ï„ÄÇÁ∫øÁ®ã B Âú®ÊâßË°åÊìç‰Ωú 4 Êó∂ÔºåËÉΩÂê¶ÁúãÂà∞Á∫øÁ®ã A Âú®Êìç‰Ωú 1 ÂØπÂÖ±‰∫´ÂèòÈáè a ÁöÑÂÜôÂÖ•Ôºü</p>
<p>Á≠îÊ°àÊòØÔºö‰∏ç‰∏ÄÂÆöËÉΩÁúãÂà∞„ÄÇ</p>
<p>Áî±‰∫éÊìç‰Ωú 1 ÂíåÊìç‰Ωú 2 Ê≤°ÊúâÊï∞ÊçÆ‰æùËµñÂÖ≥Á≥ªÔºåÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÂèØ‰ª•ÂØπËøô‰∏§‰∏™Êìç‰ΩúÈáçÊéíÂ∫èÔºõÂêåÊ†∑ÔºåÊìç‰Ωú 3 ÂíåÊìç‰Ωú 4 Ê≤°ÊúâÊï∞ÊçÆ‰æùËµñÂÖ≥Á≥ªÔºåÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®‰πüÂèØ‰ª•ÂØπËøô‰∏§‰∏™Êìç‰ΩúÈáçÊéíÂ∫è„ÄÇËÆ©Êàë‰ª¨ÂÖàÊù•ÁúãÁúãÔºåÂΩìÊìç‰Ωú 1 ÂíåÊìç‰Ωú 2 ÈáçÊéíÂ∫èÊó∂ÔºåÂèØËÉΩ‰ºö‰∫ßÁîü‰ªÄ‰πàÊïàÊûúÔºüËØ∑Áúã‰∏ãÈù¢ÁöÑÁ®ãÂ∫èÊâßË°åÊó∂Â∫èÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent51.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent51.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Â¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÊìç‰Ωú 1 ÂíåÊìç‰Ωú 2 ÂÅö‰∫ÜÈáçÊéíÂ∫è„ÄÇÁ®ãÂ∫èÊâßË°åÊó∂ÔºåÁ∫øÁ®ã A È¶ñÂÖàÂÜôÊ†áËÆ∞ÂèòÈáè flagÔºåÈöèÂêéÁ∫øÁ®ã B ËØªËøô‰∏™ÂèòÈáè„ÄÇÁî±‰∫éÊù°‰ª∂Âà§Êñ≠‰∏∫ÁúüÔºåÁ∫øÁ®ã B Â∞ÜËØªÂèñÂèòÈáè a„ÄÇÊ≠§Êó∂ÔºåÂèòÈáè a ËøòÊ†πÊú¨Ê≤°ÊúâË¢´Á∫øÁ®ã A ÂÜôÂÖ•ÔºåÂú®ËøôÈáåÂ§öÁ∫øÁ®ãÁ®ãÂ∫èÁöÑËØ≠‰πâË¢´ÈáçÊéíÂ∫èÁ†¥Âùè‰∫ÜÔºÅ</p>
<p>‚ÄªÊ≥®ÔºöÊú¨ÊñáÁªü‰∏ÄÁî®Á∫¢Ëâ≤ÁöÑËôöÁÆ≠Á∫øË°®Á§∫ÈîôËØØÁöÑËØªÊìç‰ΩúÔºåÁî®ÁªøËâ≤ÁöÑËôöÁÆ≠Á∫øË°®Á§∫Ê≠£Á°ÆÁöÑËØªÊìç‰Ωú„ÄÇ</p>
<p>‰∏ãÈù¢ÂÜçËÆ©Êàë‰ª¨ÁúãÁúãÔºåÂΩìÊìç‰Ωú 3 ÂíåÊìç‰Ωú 4 ÈáçÊéíÂ∫èÊó∂‰ºö‰∫ßÁîü‰ªÄ‰πàÊïàÊûúÔºàÂÄüÂä©Ëøô‰∏™ÈáçÊéíÂ∫èÔºåÂèØ‰ª•È°∫‰æøËØ¥ÊòéÊéßÂà∂‰æùËµñÊÄßÔºâ„ÄÇ‰∏ãÈù¢ÊòØÊìç‰Ωú 3 ÂíåÊìç‰Ωú 4 ÈáçÊéíÂ∫èÂêéÔºåÁ®ãÂ∫èÁöÑÊâßË°åÊó∂Â∫èÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent52.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent52.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Âú®Á®ãÂ∫è‰∏≠ÔºåÊìç‰Ωú 3 ÂíåÊìç‰Ωú 4 Â≠òÂú®ÊéßÂà∂‰æùËµñÂÖ≥Á≥ª„ÄÇÂΩì‰ª£Á†Å‰∏≠Â≠òÂú®ÊéßÂà∂‰æùËµñÊÄßÊó∂Ôºå‰ºöÂΩ±ÂìçÊåá‰ª§Â∫èÂàóÊâßË°åÁöÑÂπ∂Ë°åÂ∫¶„ÄÇ‰∏∫Ê≠§ÔºåÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®‰ºöÈááÁî®ÁåúÊµãÔºàSpeculationÔºâÊâßË°åÊù•ÂÖãÊúçÊéßÂà∂Áõ∏ÂÖ≥ÊÄßÂØπÂπ∂Ë°åÂ∫¶ÁöÑÂΩ±Âìç„ÄÇ‰ª•Â§ÑÁêÜÂô®ÁöÑÁåúÊµãÊâßË°å‰∏∫‰æãÔºåÊâßË°åÁ∫øÁ®ã B ÁöÑÂ§ÑÁêÜÂô®ÂèØ‰ª•ÊèêÂâçËØªÂèñÂπ∂ËÆ°ÁÆó a*aÔºåÁÑ∂ÂêéÊääËÆ°ÁÆóÁªìÊûú‰∏¥Êó∂‰øùÂ≠òÂà∞‰∏Ä‰∏™Âêç‰∏∫ÈáçÊéíÂ∫èÁºìÂÜ≤Ôºàreorder buffer ROBÔºâÁöÑÁ°¨‰ª∂ÁºìÂ≠ò‰∏≠„ÄÇÂΩìÊé•‰∏ãÊù•Êìç‰Ωú 3 ÁöÑÊù°‰ª∂Âà§Êñ≠‰∏∫ÁúüÊó∂ÔºåÂ∞±ÊääËØ•ËÆ°ÁÆóÁªìÊûúÂÜôÂÖ•ÂèòÈáè i ‰∏≠„ÄÇ</p>
<p>‰ªéÂõæ‰∏≠Êàë‰ª¨ÂèØ‰ª•ÁúãÂá∫ÔºåÁåúÊµãÊâßË°åÂÆûË¥®‰∏äÂØπÊìç‰Ωú 3 Âíå 4 ÂÅö‰∫ÜÈáçÊéíÂ∫è„ÄÇÈáçÊéíÂ∫èÂú®ËøôÈáåÁ†¥Âùè‰∫ÜÂ§öÁ∫øÁ®ãÁ®ãÂ∫èÁöÑËØ≠‰πâÔºÅ</p>
<p>Âú®ÂçïÁ∫øÁ®ãÁ®ãÂ∫è‰∏≠ÔºåÂØπÂ≠òÂú®ÊéßÂà∂‰æùËµñÁöÑÊìç‰ΩúÈáçÊéíÂ∫èÔºå‰∏ç‰ºöÊîπÂèòÊâßË°åÁªìÊûúÔºàËøô‰πüÊòØ as-if-serial ËØ≠‰πâÂÖÅËÆ∏ÂØπÂ≠òÂú®ÊéßÂà∂‰æùËµñÁöÑÊìç‰ΩúÂÅöÈáçÊéíÂ∫èÁöÑÂéüÂõ†ÔºâÔºõ‰ΩÜÂú®Â§öÁ∫øÁ®ãÁ®ãÂ∫è‰∏≠ÔºåÂØπÂ≠òÂú®ÊéßÂà∂‰æùËµñÁöÑÊìç‰ΩúÈáçÊéíÂ∫èÔºåÂèØËÉΩ‰ºöÊîπÂèòÁ®ãÂ∫èÁöÑÊâßË°åÁªìÊûú„ÄÇ</p>
<h2 id="È°∫Â∫è‰∏ÄËá¥ÊÄß"><a href="#È°∫Â∫è‰∏ÄËá¥ÊÄß" class="headerlink" title="È°∫Â∫è‰∏ÄËá¥ÊÄß"></a>È°∫Â∫è‰∏ÄËá¥ÊÄß</h2><h3 id="Êï∞ÊçÆÁ´û‰∫â‰∏éÈ°∫Â∫è‰∏ÄËá¥ÊÄß‰øùËØÅ"><a href="#Êï∞ÊçÆÁ´û‰∫â‰∏éÈ°∫Â∫è‰∏ÄËá¥ÊÄß‰øùËØÅ" class="headerlink" title="Êï∞ÊçÆÁ´û‰∫â‰∏éÈ°∫Â∫è‰∏ÄËá¥ÊÄß‰øùËØÅ"></a>Êï∞ÊçÆÁ´û‰∫â‰∏éÈ°∫Â∫è‰∏ÄËá¥ÊÄß‰øùËØÅ</h3><p>ÂΩìÁ®ãÂ∫èÊú™Ê≠£Á°ÆÂêåÊ≠•Êó∂ÔºåÂ∞±‰ºöÂ≠òÂú®Êï∞ÊçÆÁ´û‰∫â„ÄÇjava ÂÜÖÂ≠òÊ®°ÂûãËßÑËåÉÂØπÊï∞ÊçÆÁ´û‰∫âÁöÑÂÆö‰πâÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>Âú®‰∏Ä‰∏™Á∫øÁ®ã‰∏≠ÂÜô‰∏Ä‰∏™ÂèòÈáèÔºå</li>
<li>Âú®Âè¶‰∏Ä‰∏™Á∫øÁ®ãËØªÂêå‰∏Ä‰∏™ÂèòÈáèÔºå</li>
<li>ËÄå‰∏îÂÜôÂíåËØªÊ≤°ÊúâÈÄöËøáÂêåÊ≠•Êù•ÊéíÂ∫è„ÄÇ</li>
</ul>
<p>ÂΩì‰ª£Á†Å‰∏≠ÂåÖÂê´Êï∞ÊçÆÁ´û‰∫âÊó∂ÔºåÁ®ãÂ∫èÁöÑÊâßË°åÂæÄÂæÄ‰∫ßÁîüËøùÂèçÁõ¥ËßâÁöÑÁªìÊûúÔºàÂâç‰∏ÄÁ´†ÁöÑÁ§∫‰æãÊ≠£ÊòØÂ¶ÇÊ≠§Ôºâ„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™Â§öÁ∫øÁ®ãÁ®ãÂ∫èËÉΩÊ≠£Á°ÆÂêåÊ≠•ÔºåËøô‰∏™Á®ãÂ∫èÂ∞ÜÊòØ‰∏Ä‰∏™Ê≤°ÊúâÊï∞ÊçÆÁ´û‰∫âÁöÑÁ®ãÂ∫è„ÄÇ</p>
<p>JMM ÂØπÊ≠£Á°ÆÂêåÊ≠•ÁöÑÂ§öÁ∫øÁ®ãÁ®ãÂ∫èÁöÑÂÜÖÂ≠ò‰∏ÄËá¥ÊÄßÂÅö‰∫ÜÂ¶Ç‰∏ã‰øùËØÅÔºö</p>
<ul>
<li>Â¶ÇÊûúÁ®ãÂ∫èÊòØÊ≠£Á°ÆÂêåÊ≠•ÁöÑÔºåÁ®ãÂ∫èÁöÑÊâßË°åÂ∞ÜÂÖ∑ÊúâÈ°∫Â∫è‰∏ÄËá¥ÊÄßÔºàsequentially consistentÔºâ‚ÄìÂç≥Á®ãÂ∫èÁöÑÊâßË°åÁªìÊûú‰∏éËØ•Á®ãÂ∫èÂú®È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã‰∏≠ÁöÑÊâßË°åÁªìÊûúÁõ∏ÂêåÔºàÈ©¨‰∏äÊàë‰ª¨Â∞Ü‰ºöÁúãÂà∞ÔºåËøôÂØπ‰∫éÁ®ãÂ∫èÂëòÊù•ËØ¥ÊòØ‰∏Ä‰∏™ÊûÅÂº∫ÁöÑ‰øùËØÅÔºâ„ÄÇËøôÈáåÁöÑÂêåÊ≠•ÊòØÊåáÂπø‰πâ‰∏äÁöÑÂêåÊ≠•ÔºåÂåÖÊã¨ÂØπÂ∏∏Áî®ÂêåÊ≠•ÂéüËØ≠ÔºàlockÔºåvolatile Âíå finalÔºâÁöÑÊ≠£Á°Æ‰ΩøÁî®„ÄÇ</li>
</ul>
<h3 id="È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã"><a href="#È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã" class="headerlink" title="È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã"></a>È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã</h3><p>È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°ÂûãÊòØ‰∏Ä‰∏™Ë¢´ËÆ°ÁÆóÊú∫ÁßëÂ≠¶ÂÆ∂ÁêÜÊÉ≥Âåñ‰∫ÜÁöÑÁêÜËÆ∫ÂèÇËÄÉÊ®°ÂûãÔºåÂÆÉ‰∏∫Á®ãÂ∫èÂëòÊèê‰æõ‰∫ÜÊûÅÂº∫ÁöÑÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅ„ÄÇÈ°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°ÂûãÊúâ‰∏§Â§ßÁâπÊÄßÔºö</p>
<ul>
<li>‰∏Ä‰∏™Á∫øÁ®ã‰∏≠ÁöÑÊâÄÊúâÊìç‰ΩúÂøÖÈ°ªÊåâÁÖßÁ®ãÂ∫èÁöÑÈ°∫Â∫èÊù•ÊâßË°å„ÄÇ</li>
<li>Ôºà‰∏çÁÆ°Á®ãÂ∫èÊòØÂê¶ÂêåÊ≠•ÔºâÊâÄÊúâÁ∫øÁ®ãÈÉΩÂè™ËÉΩÁúãÂà∞‰∏Ä‰∏™Âçï‰∏ÄÁöÑÊìç‰ΩúÊâßË°åÈ°∫Â∫è„ÄÇÂú®È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã‰∏≠ÔºåÊØè‰∏™Êìç‰ΩúÈÉΩÂøÖÈ°ªÂéüÂ≠êÊâßË°å‰∏îÁ´ãÂàªÂØπÊâÄÊúâÁ∫øÁ®ãÂèØËßÅ„ÄÇ</li>
</ul>
<p>È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã‰∏∫Á®ãÂ∫èÂëòÊèê‰æõÁöÑËßÜÂõæÂ¶Ç‰∏ãÔºö</p>
<p><img src="/image/Concurrent/Concurrent53.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent53.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Âú®Ê¶ÇÂøµ‰∏äÔºåÈ°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°ÂûãÊúâ‰∏Ä‰∏™Âçï‰∏ÄÁöÑÂÖ®Â±ÄÂÜÖÂ≠òÔºåËøô‰∏™ÂÜÖÂ≠òÈÄöËøá‰∏Ä‰∏™Â∑¶Âè≥ÊëÜÂä®ÁöÑÂºÄÂÖ≥ÂèØ‰ª•ËøûÊé•Âà∞‰ªªÊÑè‰∏Ä‰∏™Á∫øÁ®ã„ÄÇÂêåÊó∂ÔºåÊØè‰∏Ä‰∏™Á∫øÁ®ãÂøÖÈ°ªÊåâÁ®ãÂ∫èÁöÑÈ°∫Â∫èÊù•ÊâßË°åÂÜÖÂ≠òËØª &#x2F; ÂÜôÊìç‰Ωú„ÄÇ‰ªé‰∏äÂõæÊàë‰ª¨ÂèØ‰ª•ÁúãÂá∫ÔºåÂú®‰ªªÊÑèÊó∂Èó¥ÁÇπÊúÄÂ§öÂè™ËÉΩÊúâ‰∏Ä‰∏™Á∫øÁ®ãÂèØ‰ª•ËøûÊé•Âà∞ÂÜÖÂ≠ò„ÄÇÂΩìÂ§ö‰∏™Á∫øÁ®ãÂπ∂ÂèëÊâßË°åÊó∂ÔºåÂõæ‰∏≠ÁöÑÂºÄÂÖ≥Ë£ÖÁΩÆËÉΩÊääÊâÄÊúâÁ∫øÁ®ãÁöÑÊâÄÊúâÂÜÖÂ≠òËØª &#x2F; ÂÜôÊìç‰Ωú‰∏≤Ë°åÂåñ„ÄÇ</p>
<p>‰∏∫‰∫ÜÊõ¥Â•ΩÁöÑÁêÜËß£Ôºå‰∏ãÈù¢Êàë‰ª¨ÈÄöËøá‰∏§‰∏™Á§∫ÊÑèÂõæÊù•ÂØπÈ°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°ÂûãÁöÑÁâπÊÄßÂÅöËøõ‰∏ÄÊ≠•ÁöÑËØ¥Êòé„ÄÇ</p>
<p>ÂÅáËÆæÊúâ‰∏§‰∏™Á∫øÁ®ã A Âíå B Âπ∂ÂèëÊâßË°å„ÄÇÂÖ∂‰∏≠ A Á∫øÁ®ãÊúâ‰∏â‰∏™Êìç‰ΩúÔºåÂÆÉ‰ª¨Âú®Á®ãÂ∫è‰∏≠ÁöÑÈ°∫Â∫èÊòØÔºöA1-&gt;A2-&gt;A3„ÄÇB Á∫øÁ®ã‰πüÊúâ‰∏â‰∏™Êìç‰ΩúÔºåÂÆÉ‰ª¨Âú®Á®ãÂ∫è‰∏≠ÁöÑÈ°∫Â∫èÊòØÔºöB1-&gt;B2-&gt;B3„ÄÇ</p>
<p>ÂÅáËÆæËøô‰∏§‰∏™Á∫øÁ®ã‰ΩøÁî®ÁõëËßÜÂô®Êù•Ê≠£Á°ÆÂêåÊ≠•ÔºöA Á∫øÁ®ãÁöÑ‰∏â‰∏™Êìç‰ΩúÊâßË°åÂêéÈáäÊîæÁõëËßÜÂô®ÔºåÈöèÂêé B Á∫øÁ®ãËé∑ÂèñÂêå‰∏Ä‰∏™ÁõëËßÜÂô®„ÄÇÈÇ£‰πàÁ®ãÂ∫èÂú®È°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°Âûã‰∏≠ÁöÑÊâßË°åÊïàÊûúÂ∞ÜÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="/image/Concurrent/Concurrent54.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent54.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Áé∞Âú®Êàë‰ª¨ÂÜçÂÅáËÆæËøô‰∏§‰∏™Á∫øÁ®ãÊ≤°ÊúâÂÅöÂêåÊ≠•Ôºå‰∏ãÈù¢ÊòØËøô‰∏™Êú™ÂêåÊ≠•Á®ãÂ∫èÂú®È°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°Âûã‰∏≠ÁöÑÊâßË°åÁ§∫ÊÑèÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent55.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent55.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Êú™ÂêåÊ≠•Á®ãÂ∫èÂú®È°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°Âûã‰∏≠ËôΩÁÑ∂Êï¥‰ΩìÊâßË°åÈ°∫Â∫èÊòØÊó†Â∫èÁöÑÔºå‰ΩÜÊâÄÊúâÁ∫øÁ®ãÈÉΩÂè™ËÉΩÁúãÂà∞‰∏Ä‰∏™‰∏ÄËá¥ÁöÑÊï¥‰ΩìÊâßË°åÈ°∫Â∫è„ÄÇ‰ª•‰∏äÂõæ‰∏∫‰æãÔºåÁ∫øÁ®ã A Âíå B ÁúãÂà∞ÁöÑÊâßË°åÈ°∫Â∫èÈÉΩÊòØÔºöB1-&gt;A1-&gt;A2-&gt;B2-&gt;A3-&gt;B3„ÄÇ‰πãÊâÄ‰ª•ËÉΩÂæóÂà∞Ëøô‰∏™‰øùËØÅÊòØÂõ†‰∏∫È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã‰∏≠ÁöÑÊØè‰∏™Êìç‰ΩúÂøÖÈ°ªÁ´ãÂç≥ÂØπ‰ªªÊÑèÁ∫øÁ®ãÂèØËßÅ„ÄÇ</p>
<p>‰ΩÜÊòØÔºåÂú® JMM ‰∏≠Â∞±Ê≤°ÊúâËøô‰∏™‰øùËØÅ„ÄÇÊú™ÂêåÊ≠•Á®ãÂ∫èÂú® JMM ‰∏≠‰∏ç‰ΩÜÊï¥‰ΩìÁöÑÊâßË°åÈ°∫Â∫èÊòØÊó†Â∫èÁöÑÔºåËÄå‰∏îÊâÄÊúâÁ∫øÁ®ãÁúãÂà∞ÁöÑÊìç‰ΩúÊâßË°åÈ°∫Â∫è‰πüÂèØËÉΩ‰∏ç‰∏ÄËá¥„ÄÇÊØîÂ¶ÇÔºåÂú®ÂΩìÂâçÁ∫øÁ®ãÊääÂÜôËøáÁöÑÊï∞ÊçÆÁºìÂ≠òÂú®Êú¨Âú∞ÂÜÖÂ≠ò‰∏≠Ôºå‰∏îËøòÊ≤°ÊúâÂà∑Êñ∞Âà∞‰∏ªÂÜÖÂ≠ò‰πãÂâçÔºåËøô‰∏™ÂÜôÊìç‰Ωú‰ªÖÂØπÂΩìÂâçÁ∫øÁ®ãÂèØËßÅÔºõ‰ªéÂÖ∂‰ªñÁ∫øÁ®ãÁöÑËßíÂ∫¶Êù•ËßÇÂØüÔºå‰ºöËÆ§‰∏∫Ëøô‰∏™ÂÜôÊìç‰ΩúÊ†πÊú¨ËøòÊ≤°ÊúâË¢´ÂΩìÂâçÁ∫øÁ®ãÊâßË°å„ÄÇÂè™ÊúâÂΩìÂâçÁ∫øÁ®ãÊääÊú¨Âú∞ÂÜÖÂ≠ò‰∏≠ÂÜôËøáÁöÑÊï∞ÊçÆÂà∑Êñ∞Âà∞‰∏ªÂÜÖÂ≠ò‰πãÂêéÔºåËøô‰∏™ÂÜôÊìç‰ΩúÊâçËÉΩÂØπÂÖ∂‰ªñÁ∫øÁ®ãÂèØËßÅ„ÄÇÂú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÂΩìÂâçÁ∫øÁ®ãÂíåÂÖ∂ÂÆÉÁ∫øÁ®ãÁúãÂà∞ÁöÑÊìç‰ΩúÊâßË°åÈ°∫Â∫èÂ∞Ü‰∏ç‰∏ÄËá¥„ÄÇ</p>
<h3 id="ÂêåÊ≠•Á®ãÂ∫èÁöÑÈ°∫Â∫è‰∏ÄËá¥ÊÄßÊïàÊûú"><a href="#ÂêåÊ≠•Á®ãÂ∫èÁöÑÈ°∫Â∫è‰∏ÄËá¥ÊÄßÊïàÊûú" class="headerlink" title="ÂêåÊ≠•Á®ãÂ∫èÁöÑÈ°∫Â∫è‰∏ÄËá¥ÊÄßÊïàÊûú"></a>ÂêåÊ≠•Á®ãÂ∫èÁöÑÈ°∫Â∫è‰∏ÄËá¥ÊÄßÊïàÊûú</h3><p>‰∏ãÈù¢Êàë‰ª¨ÂØπÂâçÈù¢ÁöÑÁ§∫‰æãÁ®ãÂ∫è ReorderExample Áî®ÁõëËßÜÂô®Êù•ÂêåÊ≠•ÔºåÁúãÁúãÊ≠£Á°ÆÂêåÊ≠•ÁöÑÁ®ãÂ∫èÂ¶Ç‰ΩïÂÖ∑ÊúâÈ°∫Â∫è‰∏ÄËá¥ÊÄß„ÄÇ</p>
<p>ËØ∑Áúã‰∏ãÈù¢ÁöÑÁ§∫‰æã‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">SynchronizedExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
       flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           <span class="token keyword">int</span> i <span class="token operator">=</span> a<span class="token punctuation">;</span>
           ‚Ä¶‚Ä¶
       <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‰∏äÈù¢Á§∫‰æã‰ª£Á†Å‰∏≠ÔºåÂÅáËÆæ A Á∫øÁ®ãÊâßË°å writer() ÊñπÊ≥ïÂêéÔºåB Á∫øÁ®ãÊâßË°å reader() ÊñπÊ≥ï„ÄÇËøôÊòØ‰∏Ä‰∏™Ê≠£Á°ÆÂêåÊ≠•ÁöÑÂ§öÁ∫øÁ®ãÁ®ãÂ∫è„ÄÇÊ†πÊçÆ JMM ËßÑËåÉÔºåËØ•Á®ãÂ∫èÁöÑÊâßË°åÁªìÊûúÂ∞Ü‰∏éËØ•Á®ãÂ∫èÂú®È°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°Âûã‰∏≠ÁöÑÊâßË°åÁªìÊûúÁõ∏Âêå„ÄÇ‰∏ãÈù¢ÊòØËØ•Á®ãÂ∫èÂú®‰∏§‰∏™ÂÜÖÂ≠òÊ®°Âûã‰∏≠ÁöÑÊâßË°åÊó∂Â∫èÂØπÊØîÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent56.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent56.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Âú®È°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°Âûã‰∏≠ÔºåÊâÄÊúâÊìç‰ΩúÂÆåÂÖ®ÊåâÁ®ãÂ∫èÁöÑÈ°∫Â∫è‰∏≤Ë°åÊâßË°å„ÄÇËÄåÂú® JMM ‰∏≠Ôºå‰∏¥ÁïåÂå∫ÂÜÖÁöÑ‰ª£Á†ÅÂèØ‰ª•ÈáçÊéíÂ∫èÔºà‰ΩÜ JMM ‰∏çÂÖÅËÆ∏‰∏¥ÁïåÂå∫ÂÜÖÁöÑ‰ª£Á†Å‚ÄúÈÄ∏Âá∫‚ÄùÂà∞‰∏¥ÁïåÂå∫‰πãÂ§ñÔºåÈÇ£Ê†∑‰ºöÁ†¥ÂùèÁõëËßÜÂô®ÁöÑËØ≠‰πâÔºâ„ÄÇJMM ‰ºöÂú®ÈÄÄÂá∫ÁõëËßÜÂô®ÂíåËøõÂÖ•ÁõëËßÜÂô®Ëøô‰∏§‰∏™ÂÖ≥ÈîÆÊó∂Èó¥ÁÇπÂÅö‰∏Ä‰∫õÁâπÂà´Â§ÑÁêÜÔºå‰ΩøÂæóÁ∫øÁ®ãÂú®Ëøô‰∏§‰∏™Êó∂Èó¥ÁÇπÂÖ∑Êúâ‰∏éÈ°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°ÂûãÁõ∏ÂêåÁöÑÂÜÖÂ≠òËßÜÂõæÔºàÂÖ∑‰ΩìÁªÜËäÇÂêéÊñá‰ºöËØ¥ÊòéÔºâ„ÄÇËôΩÁÑ∂Á∫øÁ®ã A Âú®‰∏¥ÁïåÂå∫ÂÜÖÂÅö‰∫ÜÈáçÊéíÂ∫èÔºå‰ΩÜÁî±‰∫éÁõëËßÜÂô®ÁöÑ‰∫íÊñ•ÊâßË°åÁöÑÁâπÊÄßÔºåËøôÈáåÁöÑÁ∫øÁ®ã B Ê†πÊú¨Êó†Ê≥ï‚ÄúËßÇÂØü‚ÄùÂà∞Á∫øÁ®ã A Âú®‰∏¥ÁïåÂå∫ÂÜÖÁöÑÈáçÊéíÂ∫è„ÄÇËøôÁßçÈáçÊéíÂ∫èÊó¢ÊèêÈ´ò‰∫ÜÊâßË°åÊïàÁéáÔºåÂèàÊ≤°ÊúâÊîπÂèòÁ®ãÂ∫èÁöÑÊâßË°åÁªìÊûú„ÄÇ</p>
<p>‰ªéËøôÈáåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ JMM Âú®ÂÖ∑‰ΩìÂÆûÁé∞‰∏äÁöÑÂü∫Êú¨ÊñπÈíàÔºöÂú®‰∏çÊîπÂèòÔºàÊ≠£Á°ÆÂêåÊ≠•ÁöÑÔºâÁ®ãÂ∫èÊâßË°åÁªìÊûúÁöÑÂâçÊèê‰∏ãÔºåÂ∞ΩÂèØËÉΩÁöÑ‰∏∫ÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÁöÑ‰ºòÂåñÊâìÂºÄÊñπ‰æø‰πãÈó®„ÄÇ</p>
<h3 id="Êú™ÂêåÊ≠•Á®ãÂ∫èÁöÑÊâßË°åÁâπÊÄß"><a href="#Êú™ÂêåÊ≠•Á®ãÂ∫èÁöÑÊâßË°åÁâπÊÄß" class="headerlink" title="Êú™ÂêåÊ≠•Á®ãÂ∫èÁöÑÊâßË°åÁâπÊÄß"></a>Êú™ÂêåÊ≠•Á®ãÂ∫èÁöÑÊâßË°åÁâπÊÄß</h3><p>ÂØπ‰∫éÊú™ÂêåÊ≠•ÊàñÊú™Ê≠£Á°ÆÂêåÊ≠•ÁöÑÂ§öÁ∫øÁ®ãÁ®ãÂ∫èÔºåJMM Âè™Êèê‰æõÊúÄÂ∞èÂÆâÂÖ®ÊÄßÔºöÁ∫øÁ®ãÊâßË°åÊó∂ËØªÂèñÂà∞ÁöÑÂÄºÔºåË¶Å‰πàÊòØ‰πãÂâçÊüê‰∏™Á∫øÁ®ãÂÜôÂÖ•ÁöÑÂÄºÔºåË¶Å‰πàÊòØÈªòËÆ§ÂÄºÔºà0ÔºånullÔºåfalseÔºâÔºåJMM ‰øùËØÅÁ∫øÁ®ãËØªÊìç‰ΩúËØªÂèñÂà∞ÁöÑÂÄº‰∏ç‰ºöÊó†‰∏≠ÁîüÊúâÔºàout of thin airÔºâÁöÑÂÜíÂá∫Êù•„ÄÇ‰∏∫‰∫ÜÂÆûÁé∞ÊúÄÂ∞èÂÆâÂÖ®ÊÄßÔºåJVM Âú®Â†Ü‰∏äÂàÜÈÖçÂØπË±°Êó∂ÔºåÈ¶ñÂÖà‰ºöÊ∏ÖÈõ∂ÂÜÖÂ≠òÁ©∫Èó¥ÔºåÁÑ∂ÂêéÊâç‰ºöÂú®‰∏äÈù¢ÂàÜÈÖçÂØπË±°ÔºàJVM ÂÜÖÈÉ®‰ºöÂêåÊ≠•Ëøô‰∏§‰∏™Êìç‰ΩúÔºâ„ÄÇÂõ†Ê≠§ÔºåÂú®‰ª•Ê∏ÖÈõ∂ÁöÑÂÜÖÂ≠òÁ©∫Èó¥Ôºàpre-zeroed memoryÔºâÂàÜÈÖçÂØπË±°Êó∂ÔºåÂüüÁöÑÈªòËÆ§ÂàùÂßãÂåñÂ∑≤ÁªèÂÆåÊàê‰∫Ü„ÄÇ</p>
<p>JMM ‰∏ç‰øùËØÅÊú™ÂêåÊ≠•Á®ãÂ∫èÁöÑÊâßË°åÁªìÊûú‰∏éËØ•Á®ãÂ∫èÂú®È°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°Âûã‰∏≠ÁöÑÊâßË°åÁªìÊûú‰∏ÄËá¥„ÄÇÂõ†‰∏∫Êú™ÂêåÊ≠•Á®ãÂ∫èÂú®È°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°Âûã‰∏≠ÊâßË°åÊó∂ÔºåÊï¥‰Ωì‰∏äÊòØÊó†Â∫èÁöÑÔºåÂÖ∂ÊâßË°åÁªìÊûúÊó†Ê≥ïÈ¢ÑÁü•„ÄÇ‰øùËØÅÊú™ÂêåÊ≠•Á®ãÂ∫èÂú®‰∏§‰∏™Ê®°Âûã‰∏≠ÁöÑÊâßË°åÁªìÊûú‰∏ÄËá¥ÊØ´Êó†ÊÑè‰πâ„ÄÇ</p>
<p>ÂíåÈ°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°Âûã‰∏ÄÊ†∑ÔºåÊú™ÂêåÊ≠•Á®ãÂ∫èÂú® JMM ‰∏≠ÁöÑÊâßË°åÊó∂ÔºåÊï¥‰Ωì‰∏ä‰πüÊòØÊó†Â∫èÁöÑÔºåÂÖ∂ÊâßË°åÁªìÊûú‰πüÊó†Ê≥ïÈ¢ÑÁü•„ÄÇÂêåÊó∂ÔºåÊú™ÂêåÊ≠•Á®ãÂ∫èÂú®Ëøô‰∏§‰∏™Ê®°Âûã‰∏≠ÁöÑÊâßË°åÁâπÊÄßÊúâ‰∏ãÈù¢Âá†‰∏™Â∑ÆÂºÇÔºö</p>
<ol>
<li>È°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°Âûã‰øùËØÅÂçïÁ∫øÁ®ãÂÜÖÁöÑÊìç‰Ωú‰ºöÊåâÁ®ãÂ∫èÁöÑÈ°∫Â∫èÊâßË°åÔºåËÄå JMM ‰∏ç‰øùËØÅÂçïÁ∫øÁ®ãÂÜÖÁöÑÊìç‰Ωú‰ºöÊåâÁ®ãÂ∫èÁöÑÈ°∫Â∫èÊâßË°åÔºàÊØîÂ¶Ç‰∏äÈù¢Ê≠£Á°ÆÂêåÊ≠•ÁöÑÂ§öÁ∫øÁ®ãÁ®ãÂ∫èÂú®‰∏¥ÁïåÂå∫ÂÜÖÁöÑÈáçÊéíÂ∫èÔºâ„ÄÇËøô‰∏ÄÁÇπÂâçÈù¢Â∑≤ÁªèËÆ≤Ëøá‰∫ÜÔºåËøôÈáåÂ∞±‰∏çÂÜçËµòËø∞„ÄÇ</li>
<li>È°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°Âûã‰øùËØÅÊâÄÊúâÁ∫øÁ®ãÂè™ËÉΩÁúãÂà∞‰∏ÄËá¥ÁöÑÊìç‰ΩúÊâßË°åÈ°∫Â∫èÔºåËÄå JMM ‰∏ç‰øùËØÅÊâÄÊúâÁ∫øÁ®ãËÉΩÁúãÂà∞‰∏ÄËá¥ÁöÑÊìç‰ΩúÊâßË°åÈ°∫Â∫è„ÄÇËøô‰∏ÄÁÇπÂâçÈù¢‰πüÂ∑≤ÁªèËÆ≤ËøáÔºåËøôÈáåÂ∞±‰∏çÂÜçËµòËø∞„ÄÇ</li>
<li>JMM ‰∏ç‰øùËØÅÂØπ 64 ‰ΩçÁöÑ long ÂûãÂíå double ÂûãÂèòÈáèÁöÑËØª &#x2F; ÂÜôÊìç‰ΩúÂÖ∑ÊúâÂéüÂ≠êÊÄßÔºåËÄåÈ°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°Âûã‰øùËØÅÂØπÊâÄÊúâÁöÑÂÜÖÂ≠òËØª &#x2F; ÂÜôÊìç‰ΩúÈÉΩÂÖ∑ÊúâÂéüÂ≠êÊÄß„ÄÇ</li>
</ol>
<p>Á¨¨ 3 ‰∏™Â∑ÆÂºÇ‰∏éÂ§ÑÁêÜÂô®ÊÄªÁ∫øÁöÑÂ∑•‰ΩúÊú∫Âà∂ÂØÜÂàáÁõ∏ÂÖ≥„ÄÇÂú®ËÆ°ÁÆóÊú∫‰∏≠ÔºåÊï∞ÊçÆÈÄöËøáÊÄªÁ∫øÂú®Â§ÑÁêÜÂô®ÂíåÂÜÖÂ≠ò‰πãÈó¥‰º†ÈÄí„ÄÇÊØèÊ¨°Â§ÑÁêÜÂô®ÂíåÂÜÖÂ≠ò‰πãÈó¥ÁöÑÊï∞ÊçÆ‰º†ÈÄíÈÉΩÊòØÈÄöËøá‰∏ÄÁ≥ªÂàóÊ≠•È™§Êù•ÂÆåÊàêÁöÑÔºåËøô‰∏ÄÁ≥ªÂàóÊ≠•È™§Áß∞‰πã‰∏∫ÊÄªÁ∫ø‰∫ãÂä°Ôºàbus transactionÔºâ„ÄÇÊÄªÁ∫ø‰∫ãÂä°ÂåÖÊã¨ËØª‰∫ãÂä°Ôºàread transactionÔºâÂíåÂÜô‰∫ãÂä°Ôºàwrite transactionÔºâ„ÄÇËØª‰∫ãÂä°‰ªéÂÜÖÂ≠ò‰º†ÈÄÅÊï∞ÊçÆÂà∞Â§ÑÁêÜÂô®ÔºåÂÜô‰∫ãÂä°‰ªéÂ§ÑÁêÜÂô®‰º†ÈÄÅÊï∞ÊçÆÂà∞ÂÜÖÂ≠òÔºåÊØè‰∏™‰∫ãÂä°‰ºöËØª &#x2F; ÂÜôÂÜÖÂ≠ò‰∏≠‰∏Ä‰∏™ÊàñÂ§ö‰∏™Áâ©ÁêÜ‰∏äËøûÁª≠ÁöÑÂ≠ó„ÄÇËøôÈáåÁöÑÂÖ≥ÈîÆÊòØÔºåÊÄªÁ∫ø‰ºöÂêåÊ≠•ËØïÂõæÂπ∂Âèë‰ΩøÁî®ÊÄªÁ∫øÁöÑ‰∫ãÂä°„ÄÇÂú®‰∏Ä‰∏™Â§ÑÁêÜÂô®ÊâßË°åÊÄªÁ∫ø‰∫ãÂä°ÊúüÈó¥ÔºåÊÄªÁ∫ø‰ºöÁ¶ÅÊ≠¢ÂÖ∂ÂÆÉÊâÄÊúâÁöÑÂ§ÑÁêÜÂô®Âíå I&#x2F;O ËÆæÂ§áÊâßË°åÂÜÖÂ≠òÁöÑËØª &#x2F; ÂÜô„ÄÇ‰∏ãÈù¢ËÆ©Êàë‰ª¨ÈÄöËøá‰∏Ä‰∏™Á§∫ÊÑèÂõæÊù•ËØ¥ÊòéÊÄªÁ∫øÁöÑÂ∑•‰ΩúÊú∫Âà∂Ôºö</p>
<p><img src="/image/Concurrent/Concurrent57.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent57.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Â¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÂÅáËÆæÂ§ÑÁêÜÂô® AÔºåB Âíå C ÂêåÊó∂ÂêëÊÄªÁ∫øÂèëËµ∑ÊÄªÁ∫ø‰∫ãÂä°ÔºåËøôÊó∂ÊÄªÁ∫ø‰ª≤Ë£ÅÔºàbus arbitrationÔºâ‰ºöÂØπÁ´û‰∫â‰ΩúÂá∫Ë£ÅÂÜ≥ÔºåËøôÈáåÊàë‰ª¨ÂÅáËÆæÊÄªÁ∫øÂú®‰ª≤Ë£ÅÂêéÂà§ÂÆöÂ§ÑÁêÜÂô® A Âú®Á´û‰∫â‰∏≠Ëé∑ËÉúÔºàÊÄªÁ∫ø‰ª≤Ë£Å‰ºöÁ°Æ‰øùÊâÄÊúâÂ§ÑÁêÜÂô®ÈÉΩËÉΩÂÖ¨Âπ≥ÁöÑËÆøÈóÆÂÜÖÂ≠òÔºâ„ÄÇÊ≠§Êó∂Â§ÑÁêÜÂô® A ÁªßÁª≠ÂÆÉÁöÑÊÄªÁ∫ø‰∫ãÂä°ÔºåËÄåÂÖ∂ÂÆÉ‰∏§‰∏™Â§ÑÁêÜÂô®ÂàôË¶ÅÁ≠âÂæÖÂ§ÑÁêÜÂô® A ÁöÑÊÄªÁ∫ø‰∫ãÂä°ÂÆåÊàêÂêéÊâçËÉΩÂºÄÂßãÂÜçÊ¨°ÊâßË°åÂÜÖÂ≠òËÆøÈóÆ„ÄÇÂÅáËÆæÂú®Â§ÑÁêÜÂô® A ÊâßË°åÊÄªÁ∫ø‰∫ãÂä°ÊúüÈó¥Ôºà‰∏çÁÆ°Ëøô‰∏™ÊÄªÁ∫ø‰∫ãÂä°ÊòØËØª‰∫ãÂä°ËøòÊòØÂÜô‰∫ãÂä°ÔºâÔºåÂ§ÑÁêÜÂô® D ÂêëÊÄªÁ∫øÂèëËµ∑‰∫ÜÊÄªÁ∫ø‰∫ãÂä°ÔºåÊ≠§Êó∂Â§ÑÁêÜÂô® D ÁöÑËøô‰∏™ËØ∑Ê±Ç‰ºöË¢´ÊÄªÁ∫øÁ¶ÅÊ≠¢„ÄÇ</p>
<p>ÊÄªÁ∫øÁöÑËøô‰∫õÂ∑•‰ΩúÊú∫Âà∂ÂèØ‰ª•ÊääÊâÄÊúâÂ§ÑÁêÜÂô®ÂØπÂÜÖÂ≠òÁöÑËÆøÈóÆ‰ª•‰∏≤Ë°åÂåñÁöÑÊñπÂºèÊù•ÊâßË°åÔºõÂú®‰ªªÊÑèÊó∂Èó¥ÁÇπÔºåÊúÄÂ§öÂè™ËÉΩÊúâ‰∏Ä‰∏™Â§ÑÁêÜÂô®ËÉΩËÆøÈóÆÂÜÖÂ≠ò„ÄÇËøô‰∏™ÁâπÊÄßÁ°Æ‰øù‰∫ÜÂçï‰∏™ÊÄªÁ∫ø‰∫ãÂä°‰πã‰∏≠ÁöÑÂÜÖÂ≠òËØª &#x2F; ÂÜôÊìç‰ΩúÂÖ∑ÊúâÂéüÂ≠êÊÄß„ÄÇ</p>
<p>Âú®‰∏Ä‰∫õ 32 ‰ΩçÁöÑÂ§ÑÁêÜÂô®‰∏äÔºåÂ¶ÇÊûúË¶ÅÊ±ÇÂØπ 64 ‰ΩçÊï∞ÊçÆÁöÑËØª &#x2F; ÂÜôÊìç‰ΩúÂÖ∑ÊúâÂéüÂ≠êÊÄßÔºå‰ºöÊúâÊØîËæÉÂ§ßÁöÑÂºÄÈîÄ„ÄÇ‰∏∫‰∫ÜÁÖßÈ°æËøôÁßçÂ§ÑÁêÜÂô®Ôºåjava ËØ≠Ë®ÄËßÑËåÉÈºìÂä±‰ΩÜ‰∏çÂº∫Ê±Ç JVM ÂØπ 64 ‰ΩçÁöÑ long ÂûãÂèòÈáèÂíå double ÂûãÂèòÈáèÁöÑËØª &#x2F; ÂÜôÂÖ∑ÊúâÂéüÂ≠êÊÄß„ÄÇÂΩì JVM Âú®ËøôÁßçÂ§ÑÁêÜÂô®‰∏äËøêË°åÊó∂Ôºå‰ºöÊää‰∏Ä‰∏™ 64 ‰Ωç long&#x2F; double ÂûãÂèòÈáèÁöÑËØª &#x2F; ÂÜôÊìç‰ΩúÊãÜÂàÜ‰∏∫‰∏§‰∏™ 32 ‰ΩçÁöÑËØª &#x2F; ÂÜôÊìç‰ΩúÊù•ÊâßË°å„ÄÇËøô‰∏§‰∏™ 32 ‰ΩçÁöÑËØª &#x2F; ÂÜôÊìç‰ΩúÂèØËÉΩ‰ºöË¢´ÂàÜÈÖçÂà∞‰∏çÂêåÁöÑÊÄªÁ∫ø‰∫ãÂä°‰∏≠ÊâßË°åÔºåÊ≠§Êó∂ÂØπËøô‰∏™ 64 ‰ΩçÂèòÈáèÁöÑËØª &#x2F; ÂÜôÂ∞Ü‰∏çÂÖ∑ÊúâÂéüÂ≠êÊÄß„ÄÇ</p>
<p>ÂΩìÂçï‰∏™ÂÜÖÂ≠òÊìç‰Ωú‰∏çÂÖ∑ÊúâÂéüÂ≠êÊÄßÔºåÂ∞ÜÂèØËÉΩ‰ºö‰∫ßÁîüÊÑèÊÉ≥‰∏çÂà∞ÂêéÊûú„ÄÇËØ∑Áúã‰∏ãÈù¢Á§∫ÊÑèÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent58.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent58.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Â¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÂÅáËÆæÂ§ÑÁêÜÂô® A ÂÜô‰∏Ä‰∏™ long ÂûãÂèòÈáèÔºåÂêåÊó∂Â§ÑÁêÜÂô® B Ë¶ÅËØªËøô‰∏™ long ÂûãÂèòÈáè„ÄÇÂ§ÑÁêÜÂô® A ‰∏≠ 64 ‰ΩçÁöÑÂÜôÊìç‰ΩúË¢´ÊãÜÂàÜ‰∏∫‰∏§‰∏™ 32 ‰ΩçÁöÑÂÜôÊìç‰ΩúÔºå‰∏îËøô‰∏§‰∏™ 32 ‰ΩçÁöÑÂÜôÊìç‰ΩúË¢´ÂàÜÈÖçÂà∞‰∏çÂêåÁöÑÂÜô‰∫ãÂä°‰∏≠ÊâßË°å„ÄÇÂêåÊó∂Â§ÑÁêÜÂô® B ‰∏≠ 64 ‰ΩçÁöÑËØªÊìç‰ΩúË¢´ÊãÜÂàÜ‰∏∫‰∏§‰∏™ 32 ‰ΩçÁöÑËØªÊìç‰ΩúÔºå‰∏îËøô‰∏§‰∏™ 32 ‰ΩçÁöÑËØªÊìç‰ΩúË¢´ÂàÜÈÖçÂà∞Âêå‰∏Ä‰∏™ÁöÑËØª‰∫ãÂä°‰∏≠ÊâßË°å„ÄÇÂΩìÂ§ÑÁêÜÂô® A Âíå B Êåâ‰∏äÂõæÁöÑÊó∂Â∫èÊù•ÊâßË°åÊó∂ÔºåÂ§ÑÁêÜÂô® B Â∞ÜÁúãÂà∞‰ªÖ‰ªÖË¢´Â§ÑÁêÜÂô® A‚ÄúÂÜô‰∫Ü‰∏ÄÂçä‚ÄúÁöÑÊó†ÊïàÂÄº„ÄÇ</p>
<h2 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h2><h3 id="volatile-ÁöÑÁâπÊÄß"><a href="#volatile-ÁöÑÁâπÊÄß" class="headerlink" title="volatile ÁöÑÁâπÊÄß"></a>volatile ÁöÑÁâπÊÄß</h3><p>ÂΩìÊàë‰ª¨Â£∞ÊòéÂÖ±‰∫´ÂèòÈáè‰∏∫ volatile ÂêéÔºåÂØπËøô‰∏™ÂèòÈáèÁöÑËØª &#x2F; ÂÜôÂ∞Ü‰ºöÂæàÁâπÂà´„ÄÇÁêÜËß£ volatile ÁâπÊÄßÁöÑ‰∏Ä‰∏™Â•ΩÊñπÊ≥ïÊòØÔºöÊääÂØπ volatile ÂèòÈáèÁöÑÂçï‰∏™ËØª &#x2F; ÂÜôÔºåÁúãÊàêÊòØ‰ΩøÁî®Âêå‰∏Ä‰∏™ÁõëËßÜÂô®ÈîÅÂØπËøô‰∫õÂçï‰∏™ËØª &#x2F; ÂÜôÊìç‰ΩúÂÅö‰∫ÜÂêåÊ≠•„ÄÇ‰∏ãÈù¢Êàë‰ª¨ÈÄöËøáÂÖ∑‰ΩìÁöÑÁ§∫‰æãÊù•ËØ¥ÊòéÔºåËØ∑Áúã‰∏ãÈù¢ÁöÑÁ§∫‰æã‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">class</span> <span class="token class-name">VolatileFeaturesExample</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">volatile</span> <span class="token keyword">long</span> vl <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>  <span class="token comment">// ‰ΩøÁî® volatile Â£∞Êòé 64 ‰ΩçÁöÑ long ÂûãÂèòÈáè</span>

   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">long</span> l<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       vl <span class="token operator">=</span> l<span class="token punctuation">;</span>   <span class="token comment">// Âçï‰∏™ volatile ÂèòÈáèÁöÑÂÜô</span>
   <span class="token punctuation">&#125;</span>

   <span class="token keyword">public</span> <span class="token keyword">void</span> getAndIncrement <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       vl<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token comment">// Â§çÂêàÔºàÂ§ö‰∏™Ôºâvolatile ÂèòÈáèÁöÑËØª / ÂÜô</span>
   <span class="token punctuation">&#125;</span>


   <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">return</span> vl<span class="token punctuation">;</span>   <span class="token comment">// Âçï‰∏™ volatile ÂèòÈáèÁöÑËØª</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÂÅáËÆæÊúâÂ§ö‰∏™Á∫øÁ®ãÂàÜÂà´Ë∞ÉÁî®‰∏äÈù¢Á®ãÂ∫èÁöÑ‰∏â‰∏™ÊñπÊ≥ïÔºåËøô‰∏™Á®ãÂ∫èÂú®ËØ≠ÊÑè‰∏äÂíå‰∏ãÈù¢Á®ãÂ∫èÁ≠â‰ª∑Ôºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">class</span> <span class="token class-name">VolatileFeaturesExample</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">long</span> vl <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>               <span class="token comment">// 64 ‰ΩçÁöÑ long ÂûãÊôÆÈÄöÂèòÈáè</span>

   <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">long</span> l<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token comment">// ÂØπÂçï‰∏™ÁöÑÊôÆÈÄö ÂèòÈáèÁöÑÂÜôÁî®Âêå‰∏Ä‰∏™ÁõëËßÜÂô®ÂêåÊ≠•</span>
       vl <span class="token operator">=</span> l<span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

   <span class="token keyword">public</span> <span class="token keyword">void</span> getAndIncrement <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ÊôÆÈÄöÊñπÊ≥ïË∞ÉÁî®</span>
       <span class="token keyword">long</span> temp <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// Ë∞ÉÁî®Â∑≤ÂêåÊ≠•ÁöÑËØªÊñπÊ≥ï</span>
       temp <span class="token operator">+=</span> <span class="token number">1L</span><span class="token punctuation">;</span>                  <span class="token comment">// ÊôÆÈÄöÂÜôÊìç‰Ωú</span>
       <span class="token function">set</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// Ë∞ÉÁî®Â∑≤ÂêåÊ≠•ÁöÑÂÜôÊñπÊ≥ï</span>
   <span class="token punctuation">&#125;</span>
   <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">long</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
   <span class="token comment">// ÂØπÂçï‰∏™ÁöÑÊôÆÈÄöÂèòÈáèÁöÑËØªÁî®Âêå‰∏Ä‰∏™ÁõëËßÜÂô®ÂêåÊ≠•</span>
       <span class="token keyword">return</span> vl<span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Â¶Ç‰∏äÈù¢Á§∫‰æãÁ®ãÂ∫èÊâÄÁ§∫ÔºåÂØπ‰∏Ä‰∏™ volatile ÂèòÈáèÁöÑÂçï‰∏™ËØª &#x2F; ÂÜôÊìç‰ΩúÔºå‰∏éÂØπ‰∏Ä‰∏™ÊôÆÈÄöÂèòÈáèÁöÑËØª &#x2F; ÂÜôÊìç‰Ωú‰ΩøÁî®Âêå‰∏Ä‰∏™ÁõëËßÜÂô®ÈîÅÊù•ÂêåÊ≠•ÔºåÂÆÉ‰ª¨‰πãÈó¥ÁöÑÊâßË°åÊïàÊûúÁõ∏Âêå„ÄÇ</p>
<p>ÁõëËßÜÂô®ÈîÅÁöÑ happens-before ËßÑÂàô‰øùËØÅÈáäÊîæÁõëËßÜÂô®ÂíåËé∑ÂèñÁõëËßÜÂô®ÁöÑ‰∏§‰∏™Á∫øÁ®ã‰πãÈó¥ÁöÑÂÜÖÂ≠òÂèØËßÅÊÄßÔºåËøôÊÑèÂë≥ÁùÄÂØπ‰∏Ä‰∏™ volatile ÂèòÈáèÁöÑËØªÔºåÊÄªÊòØËÉΩÁúãÂà∞Ôºà‰ªªÊÑèÁ∫øÁ®ãÔºâÂØπËøô‰∏™ volatile ÂèòÈáèÊúÄÂêéÁöÑÂÜôÂÖ•„ÄÇ</p>
<p>ÁõëËßÜÂô®ÈîÅÁöÑËØ≠‰πâÂÜ≥ÂÆö‰∫Ü‰∏¥ÁïåÂå∫‰ª£Á†ÅÁöÑÊâßË°åÂÖ∑ÊúâÂéüÂ≠êÊÄß„ÄÇËøôÊÑèÂë≥ÁùÄÂç≥‰ΩøÊòØ 64 ‰ΩçÁöÑ long ÂûãÂíå double ÂûãÂèòÈáèÔºåÂè™Ë¶ÅÂÆÉÊòØ volatile ÂèòÈáèÔºåÂØπËØ•ÂèòÈáèÁöÑËØªÂÜôÂ∞±Â∞ÜÂÖ∑ÊúâÂéüÂ≠êÊÄß„ÄÇÂ¶ÇÊûúÊòØÂ§ö‰∏™ volatile Êìç‰ΩúÊàñÁ±ª‰ºº‰∫é volatile++ ËøôÁßçÂ§çÂêàÊìç‰ΩúÔºåËøô‰∫õÊìç‰ΩúÊï¥‰Ωì‰∏ä‰∏çÂÖ∑ÊúâÂéüÂ≠êÊÄß„ÄÇ</p>
<p>ÁÆÄËÄåË®Ä‰πãÔºåvolatile ÂèòÈáèËá™Ë∫´ÂÖ∑Êúâ‰∏ãÂàóÁâπÊÄßÔºö</p>
<ul>
<li>ÂèØËßÅÊÄß„ÄÇÂØπ‰∏Ä‰∏™ volatile ÂèòÈáèÁöÑËØªÔºåÊÄªÊòØËÉΩÁúãÂà∞Ôºà‰ªªÊÑèÁ∫øÁ®ãÔºâÂØπËøô‰∏™ volatile ÂèòÈáèÊúÄÂêéÁöÑÂÜôÂÖ•„ÄÇ</li>
<li>ÂéüÂ≠êÊÄßÔºöÂØπ‰ªªÊÑèÂçï‰∏™ volatile ÂèòÈáèÁöÑËØª &#x2F; ÂÜôÂÖ∑ÊúâÂéüÂ≠êÊÄßÔºå‰ΩÜÁ±ª‰ºº‰∫é volatile++ ËøôÁßçÂ§çÂêàÊìç‰Ωú‰∏çÂÖ∑ÊúâÂéüÂ≠êÊÄß„ÄÇ</li>
</ul>
<h3 id="volatile-ÂÜô-ËØªÂª∫Á´ãÁöÑ-happens-before-ÂÖ≥Á≥ª"><a href="#volatile-ÂÜô-ËØªÂª∫Á´ãÁöÑ-happens-before-ÂÖ≥Á≥ª" class="headerlink" title="volatile ÂÜô - ËØªÂª∫Á´ãÁöÑ happens before ÂÖ≥Á≥ª"></a>volatile ÂÜô - ËØªÂª∫Á´ãÁöÑ happens before ÂÖ≥Á≥ª</h3><p>‰∏äÈù¢ËÆ≤ÁöÑÊòØ volatile ÂèòÈáèËá™Ë∫´ÁöÑÁâπÊÄßÔºåÂØπÁ®ãÂ∫èÂëòÊù•ËØ¥Ôºåvolatile ÂØπÁ∫øÁ®ãÁöÑÂÜÖÂ≠òÂèØËßÅÊÄßÁöÑÂΩ±ÂìçÊØî volatile Ëá™Ë∫´ÁöÑÁâπÊÄßÊõ¥‰∏∫ÈáçË¶ÅÔºå‰πüÊõ¥ÈúÄË¶ÅÊàë‰ª¨ÂéªÂÖ≥Ê≥®„ÄÇ</p>
<p>‰ªé JSR-133 ÂºÄÂßãÔºåvolatile ÂèòÈáèÁöÑÂÜô - ËØªÂèØ‰ª•ÂÆûÁé∞Á∫øÁ®ã‰πãÈó¥ÁöÑÈÄö‰ø°„ÄÇ</p>
<p>‰ªéÂÜÖÂ≠òËØ≠‰πâÁöÑËßíÂ∫¶Êù•ËØ¥Ôºåvolatile ‰∏éÁõëËßÜÂô®ÈîÅÊúâÁõ∏ÂêåÁöÑÊïàÊûúÔºövolatile ÂÜôÂíåÁõëËßÜÂô®ÁöÑÈáäÊîæÊúâÁõ∏ÂêåÁöÑÂÜÖÂ≠òËØ≠‰πâÔºõvolatile ËØª‰∏éÁõëËßÜÂô®ÁöÑËé∑ÂèñÊúâÁõ∏ÂêåÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇ</p>
<p>ËØ∑Áúã‰∏ãÈù¢‰ΩøÁî® volatile ÂèòÈáèÁöÑÁ§∫‰æã‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">class</span> <span class="token class-name">VolatileExample</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                   <span class="token comment">//1</span>
       flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>               <span class="token comment">//2</span>
   <span class="token punctuation">&#125;</span>

   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//3</span>
           <span class="token keyword">int</span> i <span class="token operator">=</span>  a<span class="token punctuation">;</span>           <span class="token comment">//4</span>
           ‚Ä¶‚Ä¶
       <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÂÅáËÆæÁ∫øÁ®ã A ÊâßË°å writer() ÊñπÊ≥ï‰πãÂêéÔºåÁ∫øÁ®ã B ÊâßË°å reader() ÊñπÊ≥ï„ÄÇÊ†πÊçÆ happens before ËßÑÂàôÔºåËøô‰∏™ËøáÁ®ãÂª∫Á´ãÁöÑ happens before ÂÖ≥Á≥ªÂèØ‰ª•ÂàÜ‰∏∫‰∏§Á±ªÔºö</p>
<ol>
<li>Ê†πÊçÆÁ®ãÂ∫èÊ¨°Â∫èËßÑÂàôÔºå1 happens before 2; 3 happens before 4„ÄÇ</li>
<li>Ê†πÊçÆ volatile ËßÑÂàôÔºå2 happens before 3„ÄÇ</li>
<li>Ê†πÊçÆ happens before ÁöÑ‰º†ÈÄíÊÄßËßÑÂàôÔºå1 happens before 4„ÄÇ</li>
</ol>
<p>‰∏äËø∞ happens before ÂÖ≥Á≥ªÁöÑÂõæÂΩ¢ÂåñË°®Áé∞ÂΩ¢ÂºèÂ¶Ç‰∏ãÔºö</p>
<p><img src="/image/Concurrent/Concurrent59.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent59.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Âú®‰∏äÂõæ‰∏≠ÔºåÊØè‰∏Ä‰∏™ÁÆ≠Â§¥ÈìæÊé•ÁöÑ‰∏§‰∏™ËäÇÁÇπÔºå‰ª£Ë°®‰∫Ü‰∏Ä‰∏™ happens before ÂÖ≥Á≥ª„ÄÇÈªëËâ≤ÁÆ≠Â§¥Ë°®Á§∫Á®ãÂ∫èÈ°∫Â∫èËßÑÂàôÔºõÊ©ôËâ≤ÁÆ≠Â§¥Ë°®Á§∫ volatile ËßÑÂàôÔºõËìùËâ≤ÁÆ≠Â§¥Ë°®Á§∫ÁªÑÂêàËøô‰∫õËßÑÂàôÂêéÊèê‰æõÁöÑ happens before ‰øùËØÅ„ÄÇ</p>
<p>ËøôÈáå A Á∫øÁ®ãÂÜô‰∏Ä‰∏™ volatile ÂèòÈáèÂêéÔºåB Á∫øÁ®ãËØªÂêå‰∏Ä‰∏™ volatile ÂèòÈáè„ÄÇA Á∫øÁ®ãÂú®ÂÜô volatile ÂèòÈáè‰πãÂâçÊâÄÊúâÂèØËßÅÁöÑÂÖ±‰∫´ÂèòÈáèÔºåÂú® B Á∫øÁ®ãËØªÂêå‰∏Ä‰∏™ volatile ÂèòÈáèÂêéÔºåÂ∞ÜÁ´ãÂç≥ÂèòÂæóÂØπ B Á∫øÁ®ãÂèØËßÅ„ÄÇ</p>
<h3 id="volatile-ÂÜô-ËØªÁöÑÂÜÖÂ≠òËØ≠‰πâ"><a href="#volatile-ÂÜô-ËØªÁöÑÂÜÖÂ≠òËØ≠‰πâ" class="headerlink" title="volatile ÂÜô - ËØªÁöÑÂÜÖÂ≠òËØ≠‰πâ"></a>volatile ÂÜô - ËØªÁöÑÂÜÖÂ≠òËØ≠‰πâ</h3><p>volatile ÂÜôÁöÑÂÜÖÂ≠òËØ≠‰πâÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>ÂΩìÂÜô‰∏Ä‰∏™ volatile ÂèòÈáèÊó∂ÔºåJMM ‰ºöÊääËØ•Á∫øÁ®ãÂØπÂ∫îÁöÑÊú¨Âú∞ÂÜÖÂ≠ò‰∏≠ÁöÑÂÖ±‰∫´ÂèòÈáèÂà∑Êñ∞Âà∞‰∏ªÂÜÖÂ≠ò„ÄÇ</li>
</ul>
<p>‰ª•‰∏äÈù¢Á§∫‰æãÁ®ãÂ∫è VolatileExample ‰∏∫‰æãÔºåÂÅáËÆæÁ∫øÁ®ã A È¶ñÂÖàÊâßË°å writer() ÊñπÊ≥ïÔºåÈöèÂêéÁ∫øÁ®ã B ÊâßË°å reader() ÊñπÊ≥ïÔºåÂàùÂßãÊó∂‰∏§‰∏™Á∫øÁ®ãÁöÑÊú¨Âú∞ÂÜÖÂ≠ò‰∏≠ÁöÑ flag Âíå a ÈÉΩÊòØÂàùÂßãÁä∂ÊÄÅ„ÄÇ‰∏ãÂõæÊòØÁ∫øÁ®ã A ÊâßË°å volatile ÂÜôÂêéÔºåÂÖ±‰∫´ÂèòÈáèÁöÑÁä∂ÊÄÅÁ§∫ÊÑèÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent60.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent60.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Â¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÁ∫øÁ®ã A Âú®ÂÜô flag ÂèòÈáèÂêéÔºåÊú¨Âú∞ÂÜÖÂ≠ò A ‰∏≠Ë¢´Á∫øÁ®ã A Êõ¥Êñ∞ËøáÁöÑ‰∏§‰∏™ÂÖ±‰∫´ÂèòÈáèÁöÑÂÄºË¢´Âà∑Êñ∞Âà∞‰∏ªÂÜÖÂ≠ò‰∏≠„ÄÇÊ≠§Êó∂ÔºåÊú¨Âú∞ÂÜÖÂ≠ò A Âíå‰∏ªÂÜÖÂ≠ò‰∏≠ÁöÑÂÖ±‰∫´ÂèòÈáèÁöÑÂÄºÊòØ‰∏ÄËá¥ÁöÑ„ÄÇ</p>
<p>volatile ËØªÁöÑÂÜÖÂ≠òËØ≠‰πâÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>ÂΩìËØª‰∏Ä‰∏™ volatile ÂèòÈáèÊó∂ÔºåJMM ‰ºöÊääËØ•Á∫øÁ®ãÂØπÂ∫îÁöÑÊú¨Âú∞ÂÜÖÂ≠òÁΩÆ‰∏∫Êó†Êïà„ÄÇÁ∫øÁ®ãÊé•‰∏ãÊù•Â∞Ü‰ªé‰∏ªÂÜÖÂ≠ò‰∏≠ËØªÂèñÂÖ±‰∫´ÂèòÈáè„ÄÇ</li>
</ul>
<p>‰∏ãÈù¢ÊòØÁ∫øÁ®ã B ËØªÂêå‰∏Ä‰∏™ volatile ÂèòÈáèÂêéÔºåÂÖ±‰∫´ÂèòÈáèÁöÑÁä∂ÊÄÅÁ§∫ÊÑèÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent61.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent61.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Â¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÂú®ËØª flag ÂèòÈáèÂêéÔºåÊú¨Âú∞ÂÜÖÂ≠ò B Â∑≤ÁªèË¢´ÁΩÆ‰∏∫Êó†Êïà„ÄÇÊ≠§Êó∂ÔºåÁ∫øÁ®ã B ÂøÖÈ°ª‰ªé‰∏ªÂÜÖÂ≠ò‰∏≠ËØªÂèñÂÖ±‰∫´ÂèòÈáè„ÄÇÁ∫øÁ®ã B ÁöÑËØªÂèñÊìç‰ΩúÂ∞ÜÂØºËá¥Êú¨Âú∞ÂÜÖÂ≠ò B ‰∏é‰∏ªÂÜÖÂ≠ò‰∏≠ÁöÑÂÖ±‰∫´ÂèòÈáèÁöÑÂÄº‰πüÂèòÊàê‰∏ÄËá¥ÁöÑ‰∫Ü„ÄÇ</p>
<p>Â¶ÇÊûúÊàë‰ª¨Êää volatile ÂÜôÂíå volatile ËØªËøô‰∏§‰∏™Ê≠•È™§ÁªºÂêàËµ∑Êù•ÁúãÁöÑËØùÔºåÂú®ËØªÁ∫øÁ®ã B ËØª‰∏Ä‰∏™ volatile ÂèòÈáèÂêéÔºåÂÜôÁ∫øÁ®ã A Âú®ÂÜôËøô‰∏™ volatile ÂèòÈáè‰πãÂâçÊâÄÊúâÂèØËßÅÁöÑÂÖ±‰∫´ÂèòÈáèÁöÑÂÄºÈÉΩÂ∞ÜÁ´ãÂç≥ÂèòÂæóÂØπËØªÁ∫øÁ®ã B ÂèØËßÅ„ÄÇ</p>
<p>‰∏ãÈù¢ÂØπ volatile ÂÜôÂíå volatile ËØªÁöÑÂÜÖÂ≠òËØ≠‰πâÂÅö‰∏™ÊÄªÁªìÔºö</p>
<ul>
<li>Á∫øÁ®ã A ÂÜô‰∏Ä‰∏™ volatile ÂèòÈáèÔºåÂÆûË¥®‰∏äÊòØÁ∫øÁ®ã A ÂêëÊé•‰∏ãÊù•Â∞ÜË¶ÅËØªËøô‰∏™ volatile ÂèòÈáèÁöÑÊüê‰∏™Á∫øÁ®ãÂèëÂá∫‰∫ÜÔºàÂÖ∂ÂØπÂÖ±‰∫´ÂèòÈáèÊâÄÂú®‰øÆÊîπÁöÑÔºâÊ∂àÊÅØ„ÄÇ</li>
<li>Á∫øÁ®ã B ËØª‰∏Ä‰∏™ volatile ÂèòÈáèÔºåÂÆûË¥®‰∏äÊòØÁ∫øÁ®ã B Êé•Êî∂‰∫Ü‰πãÂâçÊüê‰∏™Á∫øÁ®ãÂèëÂá∫ÁöÑÔºàÂú®ÂÜôËøô‰∏™ volatile ÂèòÈáè‰πãÂâçÂØπÂÖ±‰∫´ÂèòÈáèÊâÄÂÅö‰øÆÊîπÁöÑÔºâÊ∂àÊÅØ„ÄÇ</li>
<li>Á∫øÁ®ã A ÂÜô‰∏Ä‰∏™ volatile ÂèòÈáèÔºåÈöèÂêéÁ∫øÁ®ã B ËØªËøô‰∏™ volatile ÂèòÈáèÔºåËøô‰∏™ËøáÁ®ãÂÆûË¥®‰∏äÊòØÁ∫øÁ®ã A ÈÄöËøá‰∏ªÂÜÖÂ≠òÂêëÁ∫øÁ®ã B ÂèëÈÄÅÊ∂àÊÅØ„ÄÇ</li>
</ul>
<h3 id="volatile-ÂÜÖÂ≠òËØ≠‰πâÁöÑÂÆûÁé∞"><a href="#volatile-ÂÜÖÂ≠òËØ≠‰πâÁöÑÂÆûÁé∞" class="headerlink" title="volatile ÂÜÖÂ≠òËØ≠‰πâÁöÑÂÆûÁé∞"></a>volatile ÂÜÖÂ≠òËØ≠‰πâÁöÑÂÆûÁé∞</h3><p>‰∏ãÈù¢ÔºåËÆ©Êàë‰ª¨Êù•ÁúãÁúã JMM Â¶Ç‰ΩïÂÆûÁé∞ volatile ÂÜô &#x2F; ËØªÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇ</p>
<p>ÂâçÊñáÊàë‰ª¨ÊèêÂà∞ËøáÈáçÊéíÂ∫èÂàÜ‰∏∫ÁºñËØëÂô®ÈáçÊéíÂ∫èÂíåÂ§ÑÁêÜÂô®ÈáçÊéíÂ∫è„ÄÇ‰∏∫‰∫ÜÂÆûÁé∞ volatile ÂÜÖÂ≠òËØ≠‰πâÔºåJMM ‰ºöÂàÜÂà´ÈôêÂà∂Ëøô‰∏§ÁßçÁ±ªÂûãÁöÑÈáçÊéíÂ∫èÁ±ªÂûã„ÄÇ‰∏ãÈù¢ÊòØ JMM ÈíàÂØπÁºñËØëÂô®Âà∂ÂÆöÁöÑ volatile ÈáçÊéíÂ∫èËßÑÂàôË°®Ôºö</p>
<p>ÊòØÂê¶ËÉΩÈáçÊéíÂ∫è Á¨¨‰∫å‰∏™Êìç‰Ωú Á¨¨‰∏Ä‰∏™Êìç‰Ωú ÊôÆÈÄöËØª &#x2F; ÂÜô volatile ËØª volatile ÂÜô ÊôÆÈÄöËØª &#x2F; ÂÜô NO volatile ËØª NO NO NO volatile ÂÜô NO NO ‰∏æ‰æãÊù•ËØ¥ÔºåÁ¨¨‰∏âË°åÊúÄÂêé‰∏Ä‰∏™ÂçïÂÖÉÊ†ºÁöÑÊÑèÊÄùÊòØÔºöÂú®Á®ãÂ∫èÈ°∫Â∫è‰∏≠ÔºåÂΩìÁ¨¨‰∏Ä‰∏™Êìç‰Ωú‰∏∫ÊôÆÈÄöÂèòÈáèÁöÑËØªÊàñÂÜôÊó∂ÔºåÂ¶ÇÊûúÁ¨¨‰∫å‰∏™Êìç‰Ωú‰∏∫ volatile ÂÜôÔºåÂàôÁºñËØëÂô®‰∏çËÉΩÈáçÊéíÂ∫èËøô‰∏§‰∏™Êìç‰Ωú„ÄÇ</p>
<p>‰ªé‰∏äË°®Êàë‰ª¨ÂèØ‰ª•ÁúãÂá∫Ôºö</p>
<ul>
<li>ÂΩìÁ¨¨‰∫å‰∏™Êìç‰ΩúÊòØ volatile ÂÜôÊó∂Ôºå‰∏çÁÆ°Á¨¨‰∏Ä‰∏™Êìç‰ΩúÊòØ‰ªÄ‰πàÔºåÈÉΩ‰∏çËÉΩÈáçÊéíÂ∫è„ÄÇËøô‰∏™ËßÑÂàôÁ°Æ‰øù volatile ÂÜô‰πãÂâçÁöÑÊìç‰Ωú‰∏ç‰ºöË¢´ÁºñËØëÂô®ÈáçÊéíÂ∫èÂà∞ volatile ÂÜô‰πãÂêé„ÄÇ</li>
<li>ÂΩìÁ¨¨‰∏Ä‰∏™Êìç‰ΩúÊòØ volatile ËØªÊó∂Ôºå‰∏çÁÆ°Á¨¨‰∫å‰∏™Êìç‰ΩúÊòØ‰ªÄ‰πàÔºåÈÉΩ‰∏çËÉΩÈáçÊéíÂ∫è„ÄÇËøô‰∏™ËßÑÂàôÁ°Æ‰øù volatile ËØª‰πãÂêéÁöÑÊìç‰Ωú‰∏ç‰ºöË¢´ÁºñËØëÂô®ÈáçÊéíÂ∫èÂà∞ volatile ËØª‰πãÂâç„ÄÇ</li>
<li>ÂΩìÁ¨¨‰∏Ä‰∏™Êìç‰ΩúÊòØ volatile ÂÜôÔºåÁ¨¨‰∫å‰∏™Êìç‰ΩúÊòØ volatile ËØªÊó∂Ôºå‰∏çËÉΩÈáçÊéíÂ∫è„ÄÇ</li>
</ul>
<p>‰∏∫‰∫ÜÂÆûÁé∞ volatile ÁöÑÂÜÖÂ≠òËØ≠‰πâÔºåÁºñËØëÂô®Âú®ÁîüÊàêÂ≠óËäÇÁ†ÅÊó∂Ôºå‰ºöÂú®Êåá‰ª§Â∫èÂàó‰∏≠ÊèíÂÖ•ÂÜÖÂ≠òÂ±èÈöúÊù•Á¶ÅÊ≠¢ÁâπÂÆöÁ±ªÂûãÁöÑÂ§ÑÁêÜÂô®ÈáçÊéíÂ∫è„ÄÇÂØπ‰∫éÁºñËØëÂô®Êù•ËØ¥ÔºåÂèëÁé∞‰∏Ä‰∏™ÊúÄ‰ºòÂ∏ÉÁΩÆÊù•ÊúÄÂ∞èÂåñÊèíÂÖ•Â±èÈöúÁöÑÊÄªÊï∞Âá†‰πé‰∏çÂèØËÉΩÔºå‰∏∫Ê≠§ÔºåJMM ÈááÂèñ‰øùÂÆàÁ≠ñÁï•„ÄÇ‰∏ãÈù¢ÊòØÂü∫‰∫é‰øùÂÆàÁ≠ñÁï•ÁöÑ JMM ÂÜÖÂ≠òÂ±èÈöúÊèíÂÖ•Á≠ñÁï•Ôºö</p>
<ul>
<li>Âú®ÊØè‰∏™ volatile ÂÜôÊìç‰ΩúÁöÑÂâçÈù¢ÊèíÂÖ•‰∏Ä‰∏™ StoreStore Â±èÈöú„ÄÇ</li>
<li>Âú®ÊØè‰∏™ volatile ÂÜôÊìç‰ΩúÁöÑÂêéÈù¢ÊèíÂÖ•‰∏Ä‰∏™ StoreLoad Â±èÈöú„ÄÇ</li>
<li>Âú®ÊØè‰∏™ volatile ËØªÊìç‰ΩúÁöÑÂêéÈù¢ÊèíÂÖ•‰∏Ä‰∏™ LoadLoad Â±èÈöú„ÄÇ</li>
<li>Âú®ÊØè‰∏™ volatile ËØªÊìç‰ΩúÁöÑÂêéÈù¢ÊèíÂÖ•‰∏Ä‰∏™ LoadStore Â±èÈöú„ÄÇ</li>
</ul>
<p>‰∏äËø∞ÂÜÖÂ≠òÂ±èÈöúÊèíÂÖ•Á≠ñÁï•ÈùûÂ∏∏‰øùÂÆàÔºå‰ΩÜÂÆÉÂèØ‰ª•‰øùËØÅÂú®‰ªªÊÑèÂ§ÑÁêÜÂô®Âπ≥Âè∞Ôºå‰ªªÊÑèÁöÑÁ®ãÂ∫è‰∏≠ÈÉΩËÉΩÂæóÂà∞Ê≠£Á°ÆÁöÑ volatile ÂÜÖÂ≠òËØ≠‰πâ„ÄÇ</p>
<p>‰∏ãÈù¢ÊòØ‰øùÂÆàÁ≠ñÁï•‰∏ãÔºåvolatile ÂÜôÊèíÂÖ•ÂÜÖÂ≠òÂ±èÈöúÂêéÁîüÊàêÁöÑÊåá‰ª§Â∫èÂàóÁ§∫ÊÑèÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent62.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent62.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‰∏äÂõæ‰∏≠ÁöÑ StoreStore Â±èÈöúÂèØ‰ª•‰øùËØÅÂú® volatile ÂÜô‰πãÂâçÔºåÂÖ∂ÂâçÈù¢ÁöÑÊâÄÊúâÊôÆÈÄöÂÜôÊìç‰ΩúÂ∑≤ÁªèÂØπ‰ªªÊÑèÂ§ÑÁêÜÂô®ÂèØËßÅ‰∫Ü„ÄÇËøôÊòØÂõ†‰∏∫ StoreStore Â±èÈöúÂ∞Ü‰øùÈöú‰∏äÈù¢ÊâÄÊúâÁöÑÊôÆÈÄöÂÜôÂú® volatile ÂÜô‰πãÂâçÂà∑Êñ∞Âà∞‰∏ªÂÜÖÂ≠ò„ÄÇ</p>
<p>ËøôÈáåÊØîËæÉÊúâÊÑèÊÄùÁöÑÊòØ volatile ÂÜôÂêéÈù¢ÁöÑ StoreLoad Â±èÈöú„ÄÇËøô‰∏™Â±èÈöúÁöÑ‰ΩúÁî®ÊòØÈÅøÂÖç volatile ÂÜô‰∏éÂêéÈù¢ÂèØËÉΩÊúâÁöÑ volatile ËØª &#x2F; ÂÜôÊìç‰ΩúÈáçÊéíÂ∫è„ÄÇÂõ†‰∏∫ÁºñËØëÂô®Â∏∏Â∏∏Êó†Ê≥ïÂáÜÁ°ÆÂà§Êñ≠Âú®‰∏Ä‰∏™ volatile ÂÜôÁöÑÂêéÈù¢ÔºåÊòØÂê¶ÈúÄË¶ÅÊèíÂÖ•‰∏Ä‰∏™ StoreLoad Â±èÈöúÔºàÊØîÂ¶ÇÔºå‰∏Ä‰∏™ volatile ÂÜô‰πãÂêéÊñπÊ≥ïÁ´ãÂç≥ returnÔºâ„ÄÇ‰∏∫‰∫Ü‰øùËØÅËÉΩÊ≠£Á°ÆÂÆûÁé∞ volatile ÁöÑÂÜÖÂ≠òËØ≠‰πâÔºåJMM Âú®ËøôÈáåÈááÂèñ‰∫Ü‰øùÂÆàÁ≠ñÁï•ÔºöÂú®ÊØè‰∏™ volatile ÂÜôÁöÑÂêéÈù¢ÊàñÂú®ÊØè‰∏™ volatile ËØªÁöÑÂâçÈù¢ÊèíÂÖ•‰∏Ä‰∏™ StoreLoad Â±èÈöú„ÄÇ‰ªéÊï¥‰ΩìÊâßË°åÊïàÁéáÁöÑËßíÂ∫¶ËÄÉËôëÔºåJMM ÈÄâÊã©‰∫ÜÂú®ÊØè‰∏™ volatile ÂÜôÁöÑÂêéÈù¢ÊèíÂÖ•‰∏Ä‰∏™ StoreLoad Â±èÈöú„ÄÇÂõ†‰∏∫ volatile ÂÜô - ËØªÂÜÖÂ≠òËØ≠‰πâÁöÑÂ∏∏ËßÅ‰ΩøÁî®Ê®°ÂºèÊòØÔºö‰∏Ä‰∏™ÂÜôÁ∫øÁ®ãÂÜô volatile ÂèòÈáèÔºåÂ§ö‰∏™ËØªÁ∫øÁ®ãËØªÂêå‰∏Ä‰∏™ volatile ÂèòÈáè„ÄÇÂΩìËØªÁ∫øÁ®ãÁöÑÊï∞ÈáèÂ§ßÂ§ßË∂ÖËøáÂÜôÁ∫øÁ®ãÊó∂ÔºåÈÄâÊã©Âú® volatile ÂÜô‰πãÂêéÊèíÂÖ• StoreLoad Â±èÈöúÂ∞ÜÂ∏¶Êù•ÂèØËßÇÁöÑÊâßË°åÊïàÁéáÁöÑÊèêÂçá„ÄÇ‰ªéËøôÈáåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ JMM Âú®ÂÆûÁé∞‰∏äÁöÑ‰∏Ä‰∏™ÁâπÁÇπÔºöÈ¶ñÂÖàÁ°Æ‰øùÊ≠£Á°ÆÊÄßÔºåÁÑ∂ÂêéÂÜçÂéªËøΩÊ±ÇÊâßË°åÊïàÁéá„ÄÇ</p>
<p>‰∏ãÈù¢ÊòØÂú®‰øùÂÆàÁ≠ñÁï•‰∏ãÔºåvolatile ËØªÊèíÂÖ•ÂÜÖÂ≠òÂ±èÈöúÂêéÁîüÊàêÁöÑÊåá‰ª§Â∫èÂàóÁ§∫ÊÑèÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent63.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent63.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‰∏äÂõæ‰∏≠ÁöÑ LoadLoad Â±èÈöúÁî®Êù•Á¶ÅÊ≠¢Â§ÑÁêÜÂô®Êää‰∏äÈù¢ÁöÑ volatile ËØª‰∏é‰∏ãÈù¢ÁöÑÊôÆÈÄöËØªÈáçÊéíÂ∫è„ÄÇLoadStore Â±èÈöúÁî®Êù•Á¶ÅÊ≠¢Â§ÑÁêÜÂô®Êää‰∏äÈù¢ÁöÑ volatile ËØª‰∏é‰∏ãÈù¢ÁöÑÊôÆÈÄöÂÜôÈáçÊéíÂ∫è„ÄÇ</p>
<p>‰∏äËø∞ volatile ÂÜôÂíå volatile ËØªÁöÑÂÜÖÂ≠òÂ±èÈöúÊèíÂÖ•Á≠ñÁï•ÈùûÂ∏∏‰øùÂÆà„ÄÇÂú®ÂÆûÈôÖÊâßË°åÊó∂ÔºåÂè™Ë¶Å‰∏çÊîπÂèò volatile ÂÜô - ËØªÁöÑÂÜÖÂ≠òËØ≠‰πâÔºåÁºñËØëÂô®ÂèØ‰ª•Ê†πÊçÆÂÖ∑‰ΩìÊÉÖÂÜµÁúÅÁï•‰∏çÂøÖË¶ÅÁöÑÂ±èÈöú„ÄÇ‰∏ãÈù¢Êàë‰ª¨ÈÄöËøáÂÖ∑‰ΩìÁöÑÁ§∫‰æã‰ª£Á†ÅÊù•ËØ¥ÊòéÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">class</span> <span class="token class-name">VolatileBarrierExample</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">int</span> a<span class="token punctuation">;</span>
   <span class="token keyword">volatile</span> <span class="token keyword">int</span> v1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">volatile</span> <span class="token keyword">int</span> v2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

   <span class="token keyword">void</span> <span class="token function">readAndWrite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">int</span> i <span class="token operator">=</span> v1<span class="token punctuation">;</span>           <span class="token comment">// Á¨¨‰∏Ä‰∏™ volatile ËØª</span>
       <span class="token keyword">int</span> j <span class="token operator">=</span> v2<span class="token punctuation">;</span>           <span class="token comment">// Á¨¨‰∫å‰∏™ volatile ËØª</span>
       a <span class="token operator">=</span> i <span class="token operator">+</span> j<span class="token punctuation">;</span>            <span class="token comment">// ÊôÆÈÄöÂÜô</span>
       v1 <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token comment">// Á¨¨‰∏Ä‰∏™ volatile ÂÜô</span>
       v2 <span class="token operator">=</span> j <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>          <span class="token comment">// Á¨¨‰∫å‰∏™ volatile ÂÜô</span>
   <span class="token punctuation">&#125;</span>

   ‚Ä¶                    <span class="token comment">// ÂÖ∂‰ªñÊñπÊ≥ï</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÈíàÂØπ readAndWrite() ÊñπÊ≥ïÔºåÁºñËØëÂô®Âú®ÁîüÊàêÂ≠óËäÇÁ†ÅÊó∂ÂèØ‰ª•ÂÅöÂ¶Ç‰∏ãÁöÑ‰ºòÂåñÔºö</p>
<p><img src="/image/Concurrent/Concurrent64.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent64.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Ê≥®ÊÑèÔºåÊúÄÂêéÁöÑ StoreLoad Â±èÈöú‰∏çËÉΩÁúÅÁï•„ÄÇÂõ†‰∏∫Á¨¨‰∫å‰∏™ volatile ÂÜô‰πãÂêéÔºåÊñπÊ≥ïÁ´ãÂç≥ return„ÄÇÊ≠§Êó∂ÁºñËØëÂô®ÂèØËÉΩÊó†Ê≥ïÂáÜÁ°ÆÊñ≠ÂÆöÂêéÈù¢ÊòØÂê¶‰ºöÊúâ volatile ËØªÊàñÂÜôÔºå‰∏∫‰∫ÜÂÆâÂÖ®Ëµ∑ËßÅÔºåÁºñËØëÂô®Â∏∏Â∏∏‰ºöÂú®ËøôÈáåÊèíÂÖ•‰∏Ä‰∏™ StoreLoad Â±èÈöú„ÄÇ</p>
<p>‰∏äÈù¢ÁöÑ‰ºòÂåñÊòØÈíàÂØπ‰ªªÊÑèÂ§ÑÁêÜÂô®Âπ≥Âè∞ÔºåÁî±‰∫é‰∏çÂêåÁöÑÂ§ÑÁêÜÂô®Êúâ‰∏çÂêå‚ÄúÊùæÁ¥ßÂ∫¶‚ÄùÁöÑÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°ÂûãÔºåÂÜÖÂ≠òÂ±èÈöúÁöÑÊèíÂÖ•ËøòÂèØ‰ª•Ê†πÊçÆÂÖ∑‰ΩìÁöÑÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°ÂûãÁªßÁª≠‰ºòÂåñ„ÄÇ‰ª• x86 Â§ÑÁêÜÂô®‰∏∫‰æãÔºå‰∏äÂõæ‰∏≠Èô§ÊúÄÂêéÁöÑ StoreLoad Â±èÈöúÂ§ñÔºåÂÖ∂ÂÆÉÁöÑÂ±èÈöúÈÉΩ‰ºöË¢´ÁúÅÁï•„ÄÇ</p>
<p>ÂâçÈù¢‰øùÂÆàÁ≠ñÁï•‰∏ãÁöÑ volatile ËØªÂíåÂÜôÔºåÂú® x86 Â§ÑÁêÜÂô®Âπ≥Âè∞ÂèØ‰ª•‰ºòÂåñÊàêÔºö</p>
<p><img src="/image/Concurrent/Concurrent65.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent65.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>ÂâçÊñáÊèêÂà∞ËøáÔºåx86 Â§ÑÁêÜÂô®‰ªÖ‰ºöÂØπÂÜô - ËØªÊìç‰ΩúÂÅöÈáçÊéíÂ∫è„ÄÇX86 ‰∏ç‰ºöÂØπËØª - ËØªÔºåËØª - ÂÜôÂíåÂÜô - ÂÜôÊìç‰ΩúÂÅöÈáçÊéíÂ∫èÔºåÂõ†Ê≠§Âú® x86 Â§ÑÁêÜÂô®‰∏≠‰ºöÁúÅÁï•ÊéâËøô‰∏âÁßçÊìç‰ΩúÁ±ªÂûãÂØπÂ∫îÁöÑÂÜÖÂ≠òÂ±èÈöú„ÄÇÂú® x86 ‰∏≠ÔºåJMM ‰ªÖÈúÄÂú® volatile ÂÜôÂêéÈù¢ÊèíÂÖ•‰∏Ä‰∏™ StoreLoad Â±èÈöúÂç≥ÂèØÊ≠£Á°ÆÂÆûÁé∞ volatile ÂÜô - ËØªÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇËøôÊÑèÂë≥ÁùÄÂú® x86 Â§ÑÁêÜÂô®‰∏≠Ôºåvolatile ÂÜôÁöÑÂºÄÈîÄÊØî volatile ËØªÁöÑÂºÄÈîÄ‰ºöÂ§ßÂæàÂ§öÔºàÂõ†‰∏∫ÊâßË°å StoreLoad Â±èÈöúÂºÄÈîÄ‰ºöÊØîËæÉÂ§ßÔºâ„ÄÇ</p>
<h3 id="JSR-133-‰∏∫‰ªÄ‰πàË¶ÅÂ¢ûÂº∫-volatile-ÁöÑÂÜÖÂ≠òËØ≠‰πâ"><a href="#JSR-133-‰∏∫‰ªÄ‰πàË¶ÅÂ¢ûÂº∫-volatile-ÁöÑÂÜÖÂ≠òËØ≠‰πâ" class="headerlink" title="JSR-133 ‰∏∫‰ªÄ‰πàË¶ÅÂ¢ûÂº∫ volatile ÁöÑÂÜÖÂ≠òËØ≠‰πâ"></a>JSR-133 ‰∏∫‰ªÄ‰πàË¶ÅÂ¢ûÂº∫ volatile ÁöÑÂÜÖÂ≠òËØ≠‰πâ</h3><p>Âú® JSR-133 ‰πãÂâçÁöÑÊóß Java ÂÜÖÂ≠òÊ®°Âûã‰∏≠ÔºåËôΩÁÑ∂‰∏çÂÖÅËÆ∏ volatile ÂèòÈáè‰πãÈó¥ÈáçÊéíÂ∫èÔºå‰ΩÜÊóßÁöÑ Java ÂÜÖÂ≠òÊ®°ÂûãÂÖÅËÆ∏ volatile ÂèòÈáè‰∏éÊôÆÈÄöÂèòÈáè‰πãÈó¥ÈáçÊéíÂ∫è„ÄÇÂú®ÊóßÁöÑÂÜÖÂ≠òÊ®°Âûã‰∏≠ÔºåVolatileExample Á§∫‰æãÁ®ãÂ∫èÂèØËÉΩË¢´ÈáçÊéíÂ∫èÊàê‰∏ãÂàóÊó∂Â∫èÊù•ÊâßË°åÔºö</p>
<p><img src="/image/Concurrent/Concurrent66.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent66.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Âú®ÊóßÁöÑÂÜÖÂ≠òÊ®°Âûã‰∏≠ÔºåÂΩì 1 Âíå 2 ‰πãÈó¥Ê≤°ÊúâÊï∞ÊçÆ‰æùËµñÂÖ≥Á≥ªÊó∂Ôºå1 Âíå 2 ‰πãÈó¥Â∞±ÂèØËÉΩË¢´ÈáçÊéíÂ∫èÔºà3 Âíå 4 Á±ª‰ººÔºâ„ÄÇÂÖ∂ÁªìÊûúÂ∞±ÊòØÔºöËØªÁ∫øÁ®ã B ÊâßË°å 4 Êó∂Ôºå‰∏ç‰∏ÄÂÆöËÉΩÁúãÂà∞ÂÜôÁ∫øÁ®ã A Âú®ÊâßË°å 1 Êó∂ÂØπÂÖ±‰∫´ÂèòÈáèÁöÑ‰øÆÊîπ„ÄÇ</p>
<p>Âõ†Ê≠§Âú®ÊóßÁöÑÂÜÖÂ≠òÊ®°Âûã‰∏≠ Ôºåvolatile ÁöÑÂÜô - ËØªÊ≤°ÊúâÁõëËßÜÂô®ÁöÑÈáäÊîæ - Ëé∑ÊâÄÂÖ∑ÊúâÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇ‰∏∫‰∫ÜÊèê‰æõ‰∏ÄÁßçÊØîÁõëËßÜÂô®ÈîÅÊõ¥ËΩªÈáèÁ∫ßÁöÑÁ∫øÁ®ã‰πãÈó¥ÈÄö‰ø°ÁöÑÊú∫Âà∂ÔºåJSR-133 ‰∏ìÂÆ∂ÁªÑÂÜ≥ÂÆöÂ¢ûÂº∫ volatile ÁöÑÂÜÖÂ≠òËØ≠‰πâÔºö‰∏•Ê†ºÈôêÂà∂ÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÂØπ volatile ÂèòÈáè‰∏éÊôÆÈÄöÂèòÈáèÁöÑÈáçÊéíÂ∫èÔºåÁ°Æ‰øù volatile ÁöÑÂÜô - ËØªÂíåÁõëËßÜÂô®ÁöÑÈáäÊîæ - Ëé∑Âèñ‰∏ÄÊ†∑ÔºåÂÖ∑ÊúâÁõ∏ÂêåÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇ‰ªéÁºñËØëÂô®ÈáçÊéíÂ∫èËßÑÂàôÂíåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÂ±èÈöúÊèíÂÖ•Á≠ñÁï•Êù•ÁúãÔºåÂè™Ë¶Å volatile ÂèòÈáè‰∏éÊôÆÈÄöÂèòÈáè‰πãÈó¥ÁöÑÈáçÊéíÂ∫èÂèØËÉΩ‰ºöÁ†¥Âùè volatile ÁöÑÂÜÖÂ≠òËØ≠ÊÑèÔºåËøôÁßçÈáçÊéíÂ∫èÂ∞±‰ºöË¢´ÁºñËØëÂô®ÈáçÊéíÂ∫èËßÑÂàôÂíåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÂ±èÈöúÊèíÂÖ•Á≠ñÁï•Á¶ÅÊ≠¢„ÄÇ</p>
<p>Áî±‰∫é volatile ‰ªÖ‰ªÖ‰øùËØÅÂØπÂçï‰∏™ volatile ÂèòÈáèÁöÑËØª &#x2F; ÂÜôÂÖ∑ÊúâÂéüÂ≠êÊÄßÔºåËÄåÁõëËßÜÂô®ÈîÅÁöÑ‰∫íÊñ•ÊâßË°åÁöÑÁâπÊÄßÂèØ‰ª•Á°Æ‰øùÂØπÊï¥‰∏™‰∏¥ÁïåÂå∫‰ª£Á†ÅÁöÑÊâßË°åÂÖ∑ÊúâÂéüÂ≠êÊÄß„ÄÇÂú®ÂäüËÉΩ‰∏äÔºåÁõëËßÜÂô®ÈîÅÊØî volatile Êõ¥Âº∫Â§ßÔºõÂú®ÂèØ‰º∏Áº©ÊÄßÂíåÊâßË°åÊÄßËÉΩ‰∏äÔºåvolatile Êõ¥Êúâ‰ºòÂäø„ÄÇÂ¶ÇÊûúËØªËÄÖÊÉ≥Âú®Á®ãÂ∫è‰∏≠Áî® volatile ‰ª£ÊõøÁõëËßÜÂô®ÈîÅÔºåËØ∑‰∏ÄÂÆöË∞®ÊÖé„ÄÇ</p>
<h2 id="ÈîÅ"><a href="#ÈîÅ" class="headerlink" title="ÈîÅ"></a>ÈîÅ</h2><h3 id="ÈîÅÁöÑÈáäÊîæ-Ëé∑ÂèñÂª∫Á´ãÁöÑ-happens-before-ÂÖ≥Á≥ª"><a href="#ÈîÅÁöÑÈáäÊîæ-Ëé∑ÂèñÂª∫Á´ãÁöÑ-happens-before-ÂÖ≥Á≥ª" class="headerlink" title="ÈîÅÁöÑÈáäÊîæ - Ëé∑ÂèñÂª∫Á´ãÁöÑ happens before ÂÖ≥Á≥ª"></a>ÈîÅÁöÑÈáäÊîæ - Ëé∑ÂèñÂª∫Á´ãÁöÑ happens before ÂÖ≥Á≥ª</h3><p>ÈîÅÊòØ java Âπ∂ÂèëÁºñÁ®ã‰∏≠ÊúÄÈáçË¶ÅÁöÑÂêåÊ≠•Êú∫Âà∂„ÄÇÈîÅÈô§‰∫ÜËÆ©‰∏¥ÁïåÂå∫‰∫íÊñ•ÊâßË°åÂ§ñÔºåËøòÂèØ‰ª•ËÆ©ÈáäÊîæÈîÅÁöÑÁ∫øÁ®ãÂêëËé∑ÂèñÂêå‰∏Ä‰∏™ÈîÅÁöÑÁ∫øÁ®ãÂèëÈÄÅÊ∂àÊÅØ„ÄÇ</p>
<p>‰∏ãÈù¢ÊòØÈîÅÈáäÊîæ - Ëé∑ÂèñÁöÑÁ§∫‰æã‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"> 
<span class="token keyword">class</span> <span class="token class-name">MonitorExample</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 
   <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//1</span>
       a<span class="token operator">++</span><span class="token punctuation">;</span>                             <span class="token comment">//2</span>
   <span class="token punctuation">&#125;</span>                                    <span class="token comment">//3</span>
 
   <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//4</span>
       <span class="token keyword">int</span> i <span class="token operator">=</span> a<span class="token punctuation">;</span>                       <span class="token comment">//5</span>
       ‚Ä¶‚Ä¶
   <span class="token punctuation">&#125;</span>                                    <span class="token comment">//6</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÂÅáËÆæÁ∫øÁ®ã A ÊâßË°å writer() ÊñπÊ≥ïÔºåÈöèÂêéÁ∫øÁ®ã B ÊâßË°å reader() ÊñπÊ≥ï„ÄÇÊ†πÊçÆ happens before ËßÑÂàôÔºåËøô‰∏™ËøáÁ®ãÂåÖÂê´ÁöÑ happens before ÂÖ≥Á≥ªÂèØ‰ª•ÂàÜ‰∏∫‰∏§Á±ªÔºö</p>
<ol>
<li>Ê†πÊçÆÁ®ãÂ∫èÊ¨°Â∫èËßÑÂàôÔºå1 happens before 2, 2 happens before 3; 4 happens before 5, 5 happens before 6„ÄÇ</li>
<li>Ê†πÊçÆÁõëËßÜÂô®ÈîÅËßÑÂàôÔºå3 happens before 4„ÄÇ</li>
<li>Ê†πÊçÆ happens before ÁöÑ‰º†ÈÄíÊÄßÔºå2 happens before 5„ÄÇ</li>
</ol>
<p>‰∏äËø∞ happens before ÂÖ≥Á≥ªÁöÑÂõæÂΩ¢ÂåñË°®Áé∞ÂΩ¢ÂºèÂ¶Ç‰∏ãÔºö</p>
<p><img src="/image/Concurrent/Concurrent67.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent67.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Âú®‰∏äÂõæ‰∏≠ÔºåÊØè‰∏Ä‰∏™ÁÆ≠Â§¥ÈìæÊé•ÁöÑ‰∏§‰∏™ËäÇÁÇπÔºå‰ª£Ë°®‰∫Ü‰∏Ä‰∏™ happens before ÂÖ≥Á≥ª„ÄÇÈªëËâ≤ÁÆ≠Â§¥Ë°®Á§∫Á®ãÂ∫èÈ°∫Â∫èËßÑÂàôÔºõÊ©ôËâ≤ÁÆ≠Â§¥Ë°®Á§∫ÁõëËßÜÂô®ÈîÅËßÑÂàôÔºõËìùËâ≤ÁÆ≠Â§¥Ë°®Á§∫ÁªÑÂêàËøô‰∫õËßÑÂàôÂêéÊèê‰æõÁöÑ happens before ‰øùËØÅ„ÄÇ</p>
<p>‰∏äÂõæË°®Á§∫Âú®Á∫øÁ®ã A ÈáäÊîæ‰∫ÜÈîÅ‰πãÂêéÔºåÈöèÂêéÁ∫øÁ®ã B Ëé∑ÂèñÂêå‰∏Ä‰∏™ÈîÅ„ÄÇÂú®‰∏äÂõæ‰∏≠Ôºå2 happens before 5„ÄÇÂõ†Ê≠§ÔºåÁ∫øÁ®ã A Âú®ÈáäÊîæÈîÅ‰πãÂâçÊâÄÊúâÂèØËßÅÁöÑÂÖ±‰∫´ÂèòÈáèÔºåÂú®Á∫øÁ®ã B Ëé∑ÂèñÂêå‰∏Ä‰∏™ÈîÅ‰πãÂêéÔºåÂ∞ÜÁ´ãÂàªÂèòÂæóÂØπ B Á∫øÁ®ãÂèØËßÅ„ÄÇ</p>
<h3 id="ÈîÅÈáäÊîæÂíåËé∑ÂèñÁöÑÂÜÖÂ≠òËØ≠‰πâ"><a href="#ÈîÅÈáäÊîæÂíåËé∑ÂèñÁöÑÂÜÖÂ≠òËØ≠‰πâ" class="headerlink" title="ÈîÅÈáäÊîæÂíåËé∑ÂèñÁöÑÂÜÖÂ≠òËØ≠‰πâ"></a>ÈîÅÈáäÊîæÂíåËé∑ÂèñÁöÑÂÜÖÂ≠òËØ≠‰πâ</h3><p>ÂΩìÁ∫øÁ®ãÈáäÊîæÈîÅÊó∂ÔºåJMM ‰ºöÊääËØ•Á∫øÁ®ãÂØπÂ∫îÁöÑÊú¨Âú∞ÂÜÖÂ≠ò‰∏≠ÁöÑÂÖ±‰∫´ÂèòÈáèÂà∑Êñ∞Âà∞‰∏ªÂÜÖÂ≠ò‰∏≠„ÄÇ‰ª•‰∏äÈù¢ÁöÑ MonitorExample Á®ãÂ∫è‰∏∫‰æãÔºåA Á∫øÁ®ãÈáäÊîæÈîÅÂêéÔºåÂÖ±‰∫´Êï∞ÊçÆÁöÑÁä∂ÊÄÅÁ§∫ÊÑèÂõæÂ¶Ç‰∏ãÔºö</p>
<p><img src="/image/Concurrent/Concurrent68.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent68.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>ÂΩìÁ∫øÁ®ãËé∑ÂèñÈîÅÊó∂ÔºåJMM ‰ºöÊääËØ•Á∫øÁ®ãÂØπÂ∫îÁöÑÊú¨Âú∞ÂÜÖÂ≠òÁΩÆ‰∏∫Êó†Êïà„ÄÇ‰ªéËÄå‰ΩøÂæóË¢´ÁõëËßÜÂô®‰øùÊä§ÁöÑ‰∏¥ÁïåÂå∫‰ª£Á†ÅÂøÖÈ°ªË¶Å‰ªé‰∏ªÂÜÖÂ≠ò‰∏≠ÂéªËØªÂèñÂÖ±‰∫´ÂèòÈáè„ÄÇ‰∏ãÈù¢ÊòØÈîÅËé∑ÂèñÁöÑÁä∂ÊÄÅÁ§∫ÊÑèÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent69.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent69.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>ÂØπÊØîÈîÅÈáäÊîæ - Ëé∑ÂèñÁöÑÂÜÖÂ≠òËØ≠‰πâ‰∏é volatile ÂÜô - ËØªÁöÑÂÜÖÂ≠òËØ≠‰πâÔºåÂèØ‰ª•ÁúãÂá∫ÔºöÈîÅÈáäÊîæ‰∏é volatile ÂÜôÊúâÁõ∏ÂêåÁöÑÂÜÖÂ≠òËØ≠‰πâÔºõÈîÅËé∑Âèñ‰∏é volatile ËØªÊúâÁõ∏ÂêåÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇ</p>
<p>‰∏ãÈù¢ÂØπÈîÅÈáäÊîæÂíåÈîÅËé∑ÂèñÁöÑÂÜÖÂ≠òËØ≠‰πâÂÅö‰∏™ÊÄªÁªìÔºö</p>
<ul>
<li>Á∫øÁ®ã A ÈáäÊîæ‰∏Ä‰∏™ÈîÅÔºåÂÆûË¥®‰∏äÊòØÁ∫øÁ®ã A ÂêëÊé•‰∏ãÊù•Â∞ÜË¶ÅËé∑ÂèñËøô‰∏™ÈîÅÁöÑÊüê‰∏™Á∫øÁ®ãÂèëÂá∫‰∫ÜÔºàÁ∫øÁ®ã A ÂØπÂÖ±‰∫´ÂèòÈáèÊâÄÂÅö‰øÆÊîπÁöÑÔºâÊ∂àÊÅØ„ÄÇ</li>
<li>Á∫øÁ®ã B Ëé∑Âèñ‰∏Ä‰∏™ÈîÅÔºåÂÆûË¥®‰∏äÊòØÁ∫øÁ®ã B Êé•Êî∂‰∫Ü‰πãÂâçÊüê‰∏™Á∫øÁ®ãÂèëÂá∫ÁöÑÔºàÂú®ÈáäÊîæËøô‰∏™ÈîÅ‰πãÂâçÂØπÂÖ±‰∫´ÂèòÈáèÊâÄÂÅö‰øÆÊîπÁöÑÔºâÊ∂àÊÅØ„ÄÇ</li>
<li>Á∫øÁ®ã A ÈáäÊîæÈîÅÔºåÈöèÂêéÁ∫øÁ®ã B Ëé∑ÂèñËøô‰∏™ÈîÅÔºåËøô‰∏™ËøáÁ®ãÂÆûË¥®‰∏äÊòØÁ∫øÁ®ã A ÈÄöËøá‰∏ªÂÜÖÂ≠òÂêëÁ∫øÁ®ã B ÂèëÈÄÅÊ∂àÊÅØ„ÄÇ</li>
</ul>
<h3 id="ÈîÅÂÜÖÂ≠òËØ≠‰πâÁöÑÂÆûÁé∞"><a href="#ÈîÅÂÜÖÂ≠òËØ≠‰πâÁöÑÂÆûÁé∞" class="headerlink" title="ÈîÅÂÜÖÂ≠òËØ≠‰πâÁöÑÂÆûÁé∞"></a>ÈîÅÂÜÖÂ≠òËØ≠‰πâÁöÑÂÆûÁé∞</h3><p>Êú¨ÊñáÂ∞ÜÂÄüÂä© ReentrantLock ÁöÑÊ∫ê‰ª£Á†ÅÔºåÊù•ÂàÜÊûêÈîÅÂÜÖÂ≠òËØ≠‰πâÁöÑÂÖ∑‰ΩìÂÆûÁé∞Êú∫Âà∂„ÄÇ</p>
<p>ËØ∑Áúã‰∏ãÈù¢ÁöÑÁ§∫‰æã‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">class</span> <span class="token class-name">ReentrantLockExample</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// Ëé∑ÂèñÈîÅ</span>
   <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
       a<span class="token operator">++</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
       lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ÈáäÊîæÈîÅ</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> reader <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// Ëé∑ÂèñÈîÅ</span>
   <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">int</span> i <span class="token operator">=</span> a<span class="token punctuation">;</span>
       ‚Ä¶‚Ä¶
   <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
       lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ÈáäÊîæÈîÅ</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Âú® ReentrantLock ‰∏≠ÔºåË∞ÉÁî® lock() ÊñπÊ≥ïËé∑ÂèñÈîÅÔºõË∞ÉÁî® unlock() ÊñπÊ≥ïÈáäÊîæÈîÅ„ÄÇ</p>
<p>ReentrantLock ÁöÑÂÆûÁé∞‰æùËµñ‰∫é java ÂêåÊ≠•Âô®Ê°ÜÊû∂ AbstractQueuedSynchronizerÔºàÊú¨ÊñáÁÆÄÁß∞‰πã‰∏∫ AQSÔºâ„ÄÇAQS ‰ΩøÁî®‰∏Ä‰∏™Êï¥ÂûãÁöÑ volatile ÂèòÈáèÔºàÂëΩÂêç‰∏∫ stateÔºâÊù•Áª¥Êä§ÂêåÊ≠•Áä∂ÊÄÅÔºåÈ©¨‰∏äÊàë‰ª¨‰ºöÁúãÂà∞ÔºåËøô‰∏™ volatile ÂèòÈáèÊòØ ReentrantLock ÂÜÖÂ≠òËØ≠‰πâÂÆûÁé∞ÁöÑÂÖ≥ÈîÆ„ÄÇ ‰∏ãÈù¢ÊòØ ReentrantLock ÁöÑÁ±ªÂõæÔºà‰ªÖÁîªÂá∫‰∏éÊú¨ÊñáÁõ∏ÂÖ≥ÁöÑÈÉ®ÂàÜÔºâÔºö</p>
<p><img src="/image/Concurrent/Concurrent70.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent70.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>ReentrantLock ÂàÜ‰∏∫ÂÖ¨Âπ≥ÈîÅÂíåÈùûÂÖ¨Âπ≥ÈîÅÔºåÊàë‰ª¨È¶ñÂÖàÂàÜÊûêÂÖ¨Âπ≥ÈîÅ„ÄÇ</p>
<p>‰ΩøÁî®ÂÖ¨Âπ≥ÈîÅÊó∂ÔºåÂä†ÈîÅÊñπÊ≥ï lock() ÁöÑÊñπÊ≥ïË∞ÉÁî®ËΩ®ËøπÂ¶Ç‰∏ãÔºö</p>
<ol>
<li>ReentrantLock : lock()</li>
<li>FairSync : lock()</li>
<li>AbstractQueuedSynchronizer : acquire(int arg)</li>
<li>ReentrantLock : tryAcquire(int acquires)</li>
</ol>
<p>Âú®Á¨¨ 4 Ê≠•ÁúüÊ≠£ÂºÄÂßãÂä†ÈîÅÔºå‰∏ãÈù¢ÊòØËØ•ÊñπÊ≥ïÁöÑÊ∫ê‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">final</span> <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Ëé∑ÂèñÈîÅÁöÑÂºÄÂßãÔºåÈ¶ñÂÖàËØª volatile ÂèòÈáè state</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFirst</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
           <span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> acquires<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">==</span> <span class="token function">getExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">int</span> nextc <span class="token operator">=</span> c <span class="token operator">+</span> acquires<span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>nextc <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>  
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Maximum lock count exceeded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">setState</span><span class="token punctuation">(</span>nextc<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‰ªé‰∏äÈù¢Ê∫ê‰ª£Á†Å‰∏≠Êàë‰ª¨ÂèØ‰ª•ÁúãÂá∫ÔºåÂä†ÈîÅÊñπÊ≥ïÈ¶ñÂÖàËØª volatile ÂèòÈáè state„ÄÇ</p>
<p>Âú®‰ΩøÁî®ÂÖ¨Âπ≥ÈîÅÊó∂ÔºåËß£ÈîÅÊñπÊ≥ï unlock() ÁöÑÊñπÊ≥ïË∞ÉÁî®ËΩ®ËøπÂ¶Ç‰∏ãÔºö</p>
<ol>
<li>ReentrantLock : unlock()</li>
<li>AbstractQueuedSynchronizer : release(int arg)</li>
<li>Sync : tryRelease(int releases)</li>
</ol>
<p>Âú®Á¨¨ 3 Ê≠•ÁúüÊ≠£ÂºÄÂßãÈáäÊîæÈîÅÔºå‰∏ãÈù¢ÊòØËØ•ÊñπÊ≥ïÁöÑÊ∫ê‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryRelease</span><span class="token punctuation">(</span><span class="token keyword">int</span> releases<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> releases<span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">getExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalMonitorStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">boolean</span> free <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       free <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
       <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token function">setState</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// ÈáäÊîæÈîÅÁöÑÊúÄÂêéÔºåÂÜô volatile ÂèòÈáè state</span>
   <span class="token keyword">return</span> free<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>‰ªé‰∏äÈù¢ÁöÑÊ∫ê‰ª£Á†ÅÊàë‰ª¨ÂèØ‰ª•ÁúãÂá∫ÔºåÂú®ÈáäÊîæÈîÅÁöÑÊúÄÂêéÂÜô volatile ÂèòÈáè state„ÄÇ</p>
<p>ÂÖ¨Âπ≥ÈîÅÂú®ÈáäÊîæÈîÅÁöÑÊúÄÂêéÂÜô volatile ÂèòÈáè stateÔºõÂú®Ëé∑ÂèñÈîÅÊó∂È¶ñÂÖàËØªËøô‰∏™ volatile ÂèòÈáè„ÄÇÊ†πÊçÆ volatile ÁöÑ happens-before ËßÑÂàôÔºåÈáäÊîæÈîÅÁöÑÁ∫øÁ®ãÂú®ÂÜô volatile ÂèòÈáè‰πãÂâçÂèØËßÅÁöÑÂÖ±‰∫´ÂèòÈáèÔºåÂú®Ëé∑ÂèñÈîÅÁöÑÁ∫øÁ®ãËØªÂèñÂêå‰∏Ä‰∏™ volatile ÂèòÈáèÂêéÂ∞ÜÁ´ãÂç≥ÂèòÁöÑÂØπËé∑ÂèñÈîÅÁöÑÁ∫øÁ®ãÂèØËßÅ„ÄÇ</p>
<p>Áé∞Âú®Êàë‰ª¨ÂàÜÊûêÈùûÂÖ¨Âπ≥ÈîÅÁöÑÂÜÖÂ≠òËØ≠‰πâÁöÑÂÆûÁé∞„ÄÇ</p>
<p>ÈùûÂÖ¨Âπ≥ÈîÅÁöÑÈáäÊîæÂíåÂÖ¨Âπ≥ÈîÅÂÆåÂÖ®‰∏ÄÊ†∑ÔºåÊâÄ‰ª•ËøôÈáå‰ªÖ‰ªÖÂàÜÊûêÈùûÂÖ¨Âπ≥ÈîÅÁöÑËé∑Âèñ„ÄÇ</p>
<p>‰ΩøÁî®ÂÖ¨Âπ≥ÈîÅÊó∂ÔºåÂä†ÈîÅÊñπÊ≥ï lock() ÁöÑÊñπÊ≥ïË∞ÉÁî®ËΩ®ËøπÂ¶Ç‰∏ãÔºö</p>
<ol>
<li>ReentrantLock : lock()</li>
<li>NonfairSync : lock()</li>
<li>AbstractQueuedSynchronizer : compareAndSetState(int expect, int update)</li>
</ol>
<p>Âú®Á¨¨ 3 Ê≠•ÁúüÊ≠£ÂºÄÂßãÂä†ÈîÅÔºå‰∏ãÈù¢ÊòØËØ•ÊñπÊ≥ïÁöÑÊ∫ê‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token keyword">int</span> expect<span class="token punctuation">,</span> <span class="token keyword">int</span> update<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">return</span> unsafe<span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> stateOffset<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËØ•ÊñπÊ≥ï‰ª•ÂéüÂ≠êÊìç‰ΩúÁöÑÊñπÂºèÊõ¥Êñ∞ state ÂèòÈáèÔºåÊú¨ÊñáÊää java ÁöÑ compareAndSet() ÊñπÊ≥ïË∞ÉÁî®ÁÆÄÁß∞‰∏∫ CAS„ÄÇJDK ÊñáÊ°£ÂØπËØ•ÊñπÊ≥ïÁöÑËØ¥ÊòéÂ¶Ç‰∏ãÔºöÂ¶ÇÊûúÂΩìÂâçÁä∂ÊÄÅÂÄºÁ≠â‰∫éÈ¢ÑÊúüÂÄºÔºåÂàô‰ª•ÂéüÂ≠êÊñπÂºèÂ∞ÜÂêåÊ≠•Áä∂ÊÄÅËÆæÁΩÆ‰∏∫ÁªôÂÆöÁöÑÊõ¥Êñ∞ÂÄº„ÄÇÊ≠§Êìç‰ΩúÂÖ∑Êúâ volatile ËØªÂíåÂÜôÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇ</p>
<p>ËøôÈáåÊàë‰ª¨ÂàÜÂà´‰ªéÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÁöÑËßíÂ∫¶Êù•ÂàÜÊûê,CAS Â¶Ç‰ΩïÂêåÊó∂ÂÖ∑Êúâ volatile ËØªÂíå volatile ÂÜôÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇ</p>
<p>ÂâçÊñáÊàë‰ª¨ÊèêÂà∞ËøáÔºåÁºñËØëÂô®‰∏ç‰ºöÂØπ volatile ËØª‰∏é volatile ËØªÂêéÈù¢ÁöÑ‰ªªÊÑèÂÜÖÂ≠òÊìç‰ΩúÈáçÊéíÂ∫èÔºõÁºñËØëÂô®‰∏ç‰ºöÂØπ volatile ÂÜô‰∏é volatile ÂÜôÂâçÈù¢ÁöÑ‰ªªÊÑèÂÜÖÂ≠òÊìç‰ΩúÈáçÊéíÂ∫è„ÄÇÁªÑÂêàËøô‰∏§‰∏™Êù°‰ª∂ÔºåÊÑèÂë≥ÁùÄ‰∏∫‰∫ÜÂêåÊó∂ÂÆûÁé∞ volatile ËØªÂíå volatile ÂÜôÁöÑÂÜÖÂ≠òËØ≠‰πâÔºåÁºñËØëÂô®‰∏çËÉΩÂØπ CAS ‰∏é CAS ÂâçÈù¢ÂíåÂêéÈù¢ÁöÑ‰ªªÊÑèÂÜÖÂ≠òÊìç‰ΩúÈáçÊéíÂ∫è„ÄÇ</p>
<p>‰∏ãÈù¢Êàë‰ª¨Êù•ÂàÜÊûêÂú®Â∏∏ËßÅÁöÑ intel x86 Â§ÑÁêÜÂô®‰∏≠ÔºåCAS ÊòØÂ¶Ç‰ΩïÂêåÊó∂ÂÖ∑Êúâ volatile ËØªÂíå volatile ÂÜôÁöÑÂÜÖÂ≠òËØ≠‰πâÁöÑ„ÄÇ</p>
<p>‰∏ãÈù¢ÊòØ sun.misc.Unsafe Á±ªÁöÑ compareAndSwapInt() ÊñπÊ≥ïÁöÑÊ∫ê‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span>
                                             <span class="token keyword">int</span> expected<span class="token punctuation">,</span>
                                             <span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÂèØ‰ª•ÁúãÂà∞ËøôÊòØ‰∏™Êú¨Âú∞ÊñπÊ≥ïË∞ÉÁî®„ÄÇËøô‰∏™Êú¨Âú∞ÊñπÊ≥ïÂú® openjdk ‰∏≠‰æùÊ¨°Ë∞ÉÁî®ÁöÑ c++ ‰ª£Á†Å‰∏∫Ôºöunsafe.cppÔºåatomic.cpp Âíå atomic_windows_x86.inline.hpp„ÄÇËøô‰∏™Êú¨Âú∞ÊñπÊ≥ïÁöÑÊúÄÁªàÂÆûÁé∞Âú® openjdk ÁöÑÂ¶Ç‰∏ã‰ΩçÁΩÆÔºöopenjdk-7-fcs-src-b147-27_jun_2011\openjdk\hotspot\src\os_cpu\windows_x86\vm\ atomic_windows_x86.inline.hppÔºàÂØπÂ∫î‰∫é windows Êìç‰ΩúÁ≥ªÁªüÔºåX86 Â§ÑÁêÜÂô®Ôºâ„ÄÇ‰∏ãÈù¢ÊòØÂØπÂ∫î‰∫é intel x86 Â§ÑÁêÜÂô®ÁöÑÊ∫ê‰ª£Á†ÅÁöÑÁâáÊÆµÔºö</p>
<pre class="line-numbers language-none"><code class="language-none">
&#x2F;&#x2F; Adding a lock prefix to an instruction on MP machine
&#x2F;&#x2F; VC++ doesn&#39;t like the lock prefix to be on a single line
&#x2F;&#x2F; so we can&#39;t insert a label after the lock prefix.
&#x2F;&#x2F; By emitting a lock prefix, we can define a label after it.
#define LOCK_IF_MP(mp) __asm cmp mp, 0  \
                      __asm je L0      \
                      __asm _emit 0xF0 \
                      __asm L0:

inline jint     Atomic::cmpxchg    (jint     exchange_value, volatile jint*     dest, jint     compare_value) &#123;
 &#x2F;&#x2F; alternative for InterlockedCompareExchange
 int mp &#x3D; os::is_MP();
 __asm &#123;
   mov edx, dest
   mov ecx, exchange_value
   mov eax, compare_value
   LOCK_IF_MP(mp)
   cmpxchg dword ptr [edx], ecx
 &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Â¶Ç‰∏äÈù¢Ê∫ê‰ª£Á†ÅÊâÄÁ§∫ÔºåÁ®ãÂ∫è‰ºöÊ†πÊçÆÂΩìÂâçÂ§ÑÁêÜÂô®ÁöÑÁ±ªÂûãÊù•ÂÜ≥ÂÆöÊòØÂê¶‰∏∫ cmpxchg Êåá‰ª§Ê∑ªÂä† lock ÂâçÁºÄ„ÄÇÂ¶ÇÊûúÁ®ãÂ∫èÊòØÂú®Â§öÂ§ÑÁêÜÂô®‰∏äËøêË°åÔºåÂ∞±‰∏∫ cmpxchg Êåá‰ª§Âä†‰∏ä lock ÂâçÁºÄÔºàlock cmpxchgÔºâ„ÄÇÂèç‰πãÔºåÂ¶ÇÊûúÁ®ãÂ∫èÊòØÂú®ÂçïÂ§ÑÁêÜÂô®‰∏äËøêË°åÔºåÂ∞±ÁúÅÁï• lock ÂâçÁºÄÔºàÂçïÂ§ÑÁêÜÂô®Ëá™Ë∫´‰ºöÁª¥Êä§ÂçïÂ§ÑÁêÜÂô®ÂÜÖÁöÑÈ°∫Â∫è‰∏ÄËá¥ÊÄßÔºå‰∏çÈúÄË¶Å lock ÂâçÁºÄÊèê‰æõÁöÑÂÜÖÂ≠òÂ±èÈöúÊïàÊûúÔºâ„ÄÇ</p>
<p>intel ÁöÑÊâãÂÜåÂØπ lock ÂâçÁºÄÁöÑËØ¥ÊòéÂ¶Ç‰∏ãÔºö</p>
<ol>
<li>Á°Æ‰øùÂØπÂÜÖÂ≠òÁöÑËØª - Êîπ - ÂÜôÊìç‰ΩúÂéüÂ≠êÊâßË°å„ÄÇÂú® Pentium Âèä Pentium ‰πãÂâçÁöÑÂ§ÑÁêÜÂô®‰∏≠ÔºåÂ∏¶Êúâ lock ÂâçÁºÄÁöÑÊåá‰ª§Âú®ÊâßË°åÊúüÈó¥‰ºöÈîÅ‰ΩèÊÄªÁ∫øÔºå‰ΩøÂæóÂÖ∂‰ªñÂ§ÑÁêÜÂô®ÊöÇÊó∂Êó†Ê≥ïÈÄöËøáÊÄªÁ∫øËÆøÈóÆÂÜÖÂ≠ò„ÄÇÂæàÊòæÁÑ∂ÔºåËøô‰ºöÂ∏¶Êù•ÊòÇË¥µÁöÑÂºÄÈîÄ„ÄÇ‰ªé Pentium 4ÔºåIntel Xeon Âèä P6 Â§ÑÁêÜÂô®ÂºÄÂßãÔºåintel Âú®ÂéüÊúâÊÄªÁ∫øÈîÅÁöÑÂü∫Á°Ä‰∏äÂÅö‰∫Ü‰∏Ä‰∏™ÂæàÊúâÊÑè‰πâÁöÑ‰ºòÂåñÔºöÂ¶ÇÊûúË¶ÅËÆøÈóÆÁöÑÂÜÖÂ≠òÂå∫ÂüüÔºàarea of memoryÔºâÂú® lock ÂâçÁºÄÊåá‰ª§ÊâßË°åÊúüÈó¥Â∑≤ÁªèÂú®Â§ÑÁêÜÂô®ÂÜÖÈÉ®ÁöÑÁºìÂ≠ò‰∏≠Ë¢´ÈîÅÂÆöÔºàÂç≥ÂåÖÂê´ËØ•ÂÜÖÂ≠òÂå∫ÂüüÁöÑÁºìÂ≠òË°åÂΩìÂâçÂ§Ñ‰∫éÁã¨Âç†Êàñ‰ª•‰øÆÊîπÁä∂ÊÄÅÔºâÔºåÂπ∂‰∏îËØ•ÂÜÖÂ≠òÂå∫ÂüüË¢´ÂÆåÂÖ®ÂåÖÂê´Âú®Âçï‰∏™ÁºìÂ≠òË°åÔºàcache lineÔºâ‰∏≠ÔºåÈÇ£‰πàÂ§ÑÁêÜÂô®Â∞ÜÁõ¥Êé•ÊâßË°åËØ•Êåá‰ª§„ÄÇÁî±‰∫éÂú®Êåá‰ª§ÊâßË°åÊúüÈó¥ËØ•ÁºìÂ≠òË°å‰ºö‰∏ÄÁõ¥Ë¢´ÈîÅÂÆöÔºåÂÖ∂ÂÆÉÂ§ÑÁêÜÂô®Êó†Ê≥ïËØª &#x2F; ÂÜôËØ•Êåá‰ª§Ë¶ÅËÆøÈóÆÁöÑÂÜÖÂ≠òÂå∫ÂüüÔºåÂõ†Ê≠§ËÉΩ‰øùËØÅÊåá‰ª§ÊâßË°åÁöÑÂéüÂ≠êÊÄß„ÄÇËøô‰∏™Êìç‰ΩúËøáÁ®ãÂè´ÂÅöÁºìÂ≠òÈîÅÂÆöÔºàcache lockingÔºâÔºåÁºìÂ≠òÈîÅÂÆöÂ∞ÜÂ§ßÂ§ßÈôç‰Ωé lock ÂâçÁºÄÊåá‰ª§ÁöÑÊâßË°åÂºÄÈîÄÔºå‰ΩÜÊòØÂΩìÂ§öÂ§ÑÁêÜÂô®‰πãÈó¥ÁöÑÁ´û‰∫âÁ®ãÂ∫¶ÂæàÈ´òÊàñËÄÖÊåá‰ª§ËÆøÈóÆÁöÑÂÜÖÂ≠òÂú∞ÂùÄÊú™ÂØπÈΩêÊó∂Ôºå‰ªçÁÑ∂‰ºöÈîÅ‰ΩèÊÄªÁ∫ø„ÄÇ</li>
<li>Á¶ÅÊ≠¢ËØ•Êåá‰ª§‰∏é‰πãÂâçÂíå‰πãÂêéÁöÑËØªÂíåÂÜôÊåá‰ª§ÈáçÊéíÂ∫è„ÄÇ</li>
<li>ÊääÂÜôÁºìÂÜ≤Âå∫‰∏≠ÁöÑÊâÄÊúâÊï∞ÊçÆÂà∑Êñ∞Âà∞ÂÜÖÂ≠ò‰∏≠„ÄÇ</li>
</ol>
<p>‰∏äÈù¢ÁöÑÁ¨¨ 2 ÁÇπÂíåÁ¨¨ 3 ÁÇπÊâÄÂÖ∑ÊúâÁöÑÂÜÖÂ≠òÂ±èÈöúÊïàÊûúÔºåË∂≥‰ª•ÂêåÊó∂ÂÆûÁé∞ volatile ËØªÂíå volatile ÂÜôÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇ</p>
<p>ÁªèËøá‰∏äÈù¢ÁöÑËøô‰∫õÂàÜÊûêÔºåÁé∞Âú®Êàë‰ª¨Áªà‰∫éËÉΩÊòéÁôΩ‰∏∫‰ªÄ‰πà JDK ÊñáÊ°£ËØ¥ CAS ÂêåÊó∂ÂÖ∑Êúâ volatile ËØªÂíå volatile ÂÜôÁöÑÂÜÖÂ≠òËØ≠‰πâ‰∫Ü„ÄÇ</p>
<p>Áé∞Âú®ÂØπÂÖ¨Âπ≥ÈîÅÂíåÈùûÂÖ¨Âπ≥ÈîÅÁöÑÂÜÖÂ≠òËØ≠‰πâÂÅö‰∏™ÊÄªÁªìÔºö</p>
<ul>
<li>ÂÖ¨Âπ≥ÈîÅÂíåÈùûÂÖ¨Âπ≥ÈîÅÈáäÊîæÊó∂ÔºåÊúÄÂêéÈÉΩË¶ÅÂÜô‰∏Ä‰∏™ volatile ÂèòÈáè state„ÄÇ</li>
<li>ÂÖ¨Âπ≥ÈîÅËé∑ÂèñÊó∂ÔºåÈ¶ñÂÖà‰ºöÂéªËØªËøô‰∏™ volatile ÂèòÈáè„ÄÇ</li>
<li>ÈùûÂÖ¨Âπ≥ÈîÅËé∑ÂèñÊó∂ÔºåÈ¶ñÂÖà‰ºöÁî® CAS Êõ¥Êñ∞Ëøô‰∏™ volatile ÂèòÈáè, Ëøô‰∏™Êìç‰ΩúÂêåÊó∂ÂÖ∑Êúâ volatile ËØªÂíå volatile ÂÜôÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇ</li>
</ul>
<p>‰ªéÊú¨ÊñáÂØπ ReentrantLock ÁöÑÂàÜÊûêÂèØ‰ª•ÁúãÂá∫ÔºåÈîÅÈáäÊîæ - Ëé∑ÂèñÁöÑÂÜÖÂ≠òËØ≠‰πâÁöÑÂÆûÁé∞Ëá≥Â∞ëÊúâ‰∏ãÈù¢‰∏§ÁßçÊñπÂºèÔºö</p>
<ol>
<li>Âà©Áî® volatile ÂèòÈáèÁöÑÂÜô - ËØªÊâÄÂÖ∑ÊúâÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇ</li>
<li>Âà©Áî® CAS ÊâÄÈôÑÂ∏¶ÁöÑ volatile ËØªÂíå volatile ÂÜôÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇ</li>
</ol>
<h3 id="concurrent-ÂåÖÁöÑÂÆûÁé∞"><a href="#concurrent-ÂåÖÁöÑÂÆûÁé∞" class="headerlink" title="concurrent ÂåÖÁöÑÂÆûÁé∞"></a>concurrent ÂåÖÁöÑÂÆûÁé∞</h3><p>Áî±‰∫é java ÁöÑ CAS ÂêåÊó∂ÂÖ∑Êúâ volatile ËØªÂíå volatile ÂÜôÁöÑÂÜÖÂ≠òËØ≠‰πâÔºåÂõ†Ê≠§ Java Á∫øÁ®ã‰πãÈó¥ÁöÑÈÄö‰ø°Áé∞Âú®Êúâ‰∫Ü‰∏ãÈù¢ÂõõÁßçÊñπÂºèÔºö</p>
<ol>
<li>A Á∫øÁ®ãÂÜô volatile ÂèòÈáèÔºåÈöèÂêé B Á∫øÁ®ãËØªËøô‰∏™ volatile ÂèòÈáè„ÄÇ</li>
<li>A Á∫øÁ®ãÂÜô volatile ÂèòÈáèÔºåÈöèÂêé B Á∫øÁ®ãÁî® CAS Êõ¥Êñ∞Ëøô‰∏™ volatile ÂèòÈáè„ÄÇ</li>
<li>A Á∫øÁ®ãÁî® CAS Êõ¥Êñ∞‰∏Ä‰∏™ volatile ÂèòÈáèÔºåÈöèÂêé B Á∫øÁ®ãÁî® CAS Êõ¥Êñ∞Ëøô‰∏™ volatile ÂèòÈáè„ÄÇ</li>
<li>A Á∫øÁ®ãÁî® CAS Êõ¥Êñ∞‰∏Ä‰∏™ volatile ÂèòÈáèÔºåÈöèÂêé B Á∫øÁ®ãËØªËøô‰∏™ volatile ÂèòÈáè„ÄÇ</li>
</ol>
<p>Java ÁöÑ CAS ‰ºö‰ΩøÁî®Áé∞‰ª£Â§ÑÁêÜÂô®‰∏äÊèê‰æõÁöÑÈ´òÊïàÊú∫Âô®Á∫ßÂà´ÂéüÂ≠êÊåá‰ª§ÔºåËøô‰∫õÂéüÂ≠êÊåá‰ª§‰ª•ÂéüÂ≠êÊñπÂºèÂØπÂÜÖÂ≠òÊâßË°åËØª - Êîπ - ÂÜôÊìç‰ΩúÔºåËøôÊòØÂú®Â§öÂ§ÑÁêÜÂô®‰∏≠ÂÆûÁé∞ÂêåÊ≠•ÁöÑÂÖ≥ÈîÆÔºà‰ªéÊú¨Ë¥®‰∏äÊù•ËØ¥ÔºåËÉΩÂ§üÊîØÊåÅÂéüÂ≠êÊÄßËØª - Êîπ - ÂÜôÊåá‰ª§ÁöÑËÆ°ÁÆóÊú∫Âô®ÔºåÊòØÈ°∫Â∫èËÆ°ÁÆóÂõæÁÅµÊú∫ÁöÑÂºÇÊ≠•Á≠â‰ª∑Êú∫Âô®ÔºåÂõ†Ê≠§‰ªª‰ΩïÁé∞‰ª£ÁöÑÂ§öÂ§ÑÁêÜÂô®ÈÉΩ‰ºöÂéªÊîØÊåÅÊüêÁßçËÉΩÂØπÂÜÖÂ≠òÊâßË°åÂéüÂ≠êÊÄßËØª - Êîπ - ÂÜôÊìç‰ΩúÁöÑÂéüÂ≠êÊåá‰ª§Ôºâ„ÄÇÂêåÊó∂Ôºåvolatile ÂèòÈáèÁöÑËØª &#x2F; ÂÜôÂíå CAS ÂèØ‰ª•ÂÆûÁé∞Á∫øÁ®ã‰πãÈó¥ÁöÑÈÄö‰ø°„ÄÇÊääËøô‰∫õÁâπÊÄßÊï¥ÂêàÂú®‰∏ÄËµ∑ÔºåÂ∞±ÂΩ¢Êàê‰∫ÜÊï¥‰∏™ concurrent ÂåÖÂæó‰ª•ÂÆûÁé∞ÁöÑÂü∫Áü≥„ÄÇÂ¶ÇÊûúÊàë‰ª¨‰ªîÁªÜÂàÜÊûê concurrent ÂåÖÁöÑÊ∫ê‰ª£Á†ÅÂÆûÁé∞Ôºå‰ºöÂèëÁé∞‰∏Ä‰∏™ÈÄöÁî®ÂåñÁöÑÂÆûÁé∞Ê®°ÂºèÔºö</p>
<ol>
<li>È¶ñÂÖàÔºåÂ£∞ÊòéÂÖ±‰∫´ÂèòÈáè‰∏∫ volatileÔºõ</li>
<li>ÁÑ∂ÂêéÔºå‰ΩøÁî® CAS ÁöÑÂéüÂ≠êÊù°‰ª∂Êõ¥Êñ∞Êù•ÂÆûÁé∞Á∫øÁ®ã‰πãÈó¥ÁöÑÂêåÊ≠•Ôºõ</li>
<li>ÂêåÊó∂ÔºåÈÖçÂêà‰ª• volatile ÁöÑËØª &#x2F; ÂÜôÂíå CAS ÊâÄÂÖ∑ÊúâÁöÑ volatile ËØªÂíåÂÜôÁöÑÂÜÖÂ≠òËØ≠‰πâÊù•ÂÆûÁé∞Á∫øÁ®ã‰πãÈó¥ÁöÑÈÄö‰ø°„ÄÇ</li>
</ol>
<p>AQSÔºåÈùûÈòªÂ°ûÊï∞ÊçÆÁªìÊûÑÂíåÂéüÂ≠êÂèòÈáèÁ±ªÔºàjava.util.concurrent.atomic ÂåÖ‰∏≠ÁöÑÁ±ªÔºâÔºåËøô‰∫õ concurrent ÂåÖ‰∏≠ÁöÑÂü∫Á°ÄÁ±ªÈÉΩÊòØ‰ΩøÁî®ËøôÁßçÊ®°ÂºèÊù•ÂÆûÁé∞ÁöÑÔºåËÄå concurrent ÂåÖ‰∏≠ÁöÑÈ´òÂ±ÇÁ±ªÂèàÊòØ‰æùËµñ‰∫éËøô‰∫õÂü∫Á°ÄÁ±ªÊù•ÂÆûÁé∞ÁöÑ„ÄÇ‰ªéÊï¥‰ΩìÊù•ÁúãÔºåconcurrent ÂåÖÁöÑÂÆûÁé∞Á§∫ÊÑèÂõæÂ¶Ç‰∏ãÔºö</p>
<p><img src="/image/Concurrent/Concurrent71.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent71.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‰∏éÂâçÈù¢‰ªãÁªçÁöÑÈîÅÂíå volatile Áõ∏ÊØîËæÉÔºåÂØπ final ÂüüÁöÑËØªÂíåÂÜôÊõ¥ÂÉèÊòØÊôÆÈÄöÁöÑÂèòÈáèËÆøÈóÆ„ÄÇÂØπ‰∫é final ÂüüÔºåÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®Ë¶ÅÈÅµÂÆà‰∏§‰∏™ÈáçÊéíÂ∫èËßÑÂàôÔºö</p>
<ol>
<li>Âú®ÊûÑÈÄ†ÂáΩÊï∞ÂÜÖÂØπ‰∏Ä‰∏™ final ÂüüÁöÑÂÜôÂÖ•Ôºå‰∏éÈöèÂêéÊääËøô‰∏™Ë¢´ÊûÑÈÄ†ÂØπË±°ÁöÑÂºïÁî®ËµãÂÄºÁªô‰∏Ä‰∏™ÂºïÁî®ÂèòÈáèÔºåËøô‰∏§‰∏™Êìç‰Ωú‰πãÈó¥‰∏çËÉΩÈáçÊéíÂ∫è„ÄÇ</li>
<li>ÂàùÊ¨°ËØª‰∏Ä‰∏™ÂåÖÂê´ final ÂüüÁöÑÂØπË±°ÁöÑÂºïÁî®Ôºå‰∏éÈöèÂêéÂàùÊ¨°ËØªËøô‰∏™ final ÂüüÔºåËøô‰∏§‰∏™Êìç‰Ωú‰πãÈó¥‰∏çËÉΩÈáçÊéíÂ∫è„ÄÇ</li>
</ol>
<p>‰∏ãÈù¢ÔºåÊàë‰ª¨ÈÄöËøá‰∏Ä‰∫õÁ§∫‰æãÊÄßÁöÑ‰ª£Á†ÅÊù•ÂàÜÂà´ËØ¥ÊòéËøô‰∏§‰∏™ËßÑÂàôÔºö</p>
<p>Óô∂Â§çÂà∂‰ª£Á†Å</p>
<pre class="line-numbers language-none"><code class="language-none"> 
public class FinalExample &#123;
   int i;                            &#x2F;&#x2F; ÊôÆÈÄöÂèòÈáè
   final int j;                      &#x2F;&#x2F;final ÂèòÈáè
   static FinalExample obj;
 
   public void FinalExample () &#123;     &#x2F;&#x2F; ÊûÑÈÄ†ÂáΩÊï∞
       i &#x3D; 1;                        &#x2F;&#x2F; ÂÜôÊôÆÈÄöÂüü
       j &#x3D; 2;                        &#x2F;&#x2F; ÂÜô final Âüü
   &#125;
 
   public static void writer () &#123;    &#x2F;&#x2F; ÂÜôÁ∫øÁ®ã A ÊâßË°å
       obj &#x3D; new FinalExample ();
   &#125;
 
   public static void reader () &#123;       &#x2F;&#x2F; ËØªÁ∫øÁ®ã B ÊâßË°å
       FinalExample object &#x3D; obj;       &#x2F;&#x2F; ËØªÂØπË±°ÂºïÁî®
       int a &#x3D; object.i;                &#x2F;&#x2F; ËØªÊôÆÈÄöÂüü
       int b &#x3D; object.j;                &#x2F;&#x2F; ËØª final Âüü
   &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËøôÈáåÂÅáËÆæ‰∏Ä‰∏™Á∫øÁ®ã A ÊâßË°å writer () ÊñπÊ≥ïÔºåÈöèÂêéÂè¶‰∏Ä‰∏™Á∫øÁ®ã B ÊâßË°å reader () ÊñπÊ≥ï„ÄÇ‰∏ãÈù¢Êàë‰ª¨ÈÄöËøáËøô‰∏§‰∏™Á∫øÁ®ãÁöÑ‰∫§‰∫íÊù•ËØ¥ÊòéËøô‰∏§‰∏™ËßÑÂàô„ÄÇ</p>
<h2 id="final"><a href="#final" class="headerlink" title="final"></a>final</h2><h3 id="ÂÜô-final-ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàô"><a href="#ÂÜô-final-ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàô" class="headerlink" title="ÂÜô final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàô"></a>ÂÜô final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàô</h3><p>ÂÜô final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàôÁ¶ÅÊ≠¢Êää final ÂüüÁöÑÂÜôÈáçÊéíÂ∫èÂà∞ÊûÑÈÄ†ÂáΩÊï∞‰πãÂ§ñ„ÄÇËøô‰∏™ËßÑÂàôÁöÑÂÆûÁé∞ÂåÖÂê´‰∏ãÈù¢ 2 ‰∏™ÊñπÈù¢Ôºö</p>
<ul>
<li>JMM Á¶ÅÊ≠¢ÁºñËØëÂô®Êää final ÂüüÁöÑÂÜôÈáçÊéíÂ∫èÂà∞ÊûÑÈÄ†ÂáΩÊï∞‰πãÂ§ñ„ÄÇ</li>
<li>ÁºñËØëÂô®‰ºöÂú® final ÂüüÁöÑÂÜô‰πãÂêéÔºåÊûÑÈÄ†ÂáΩÊï∞ return ‰πãÂâçÔºåÊèíÂÖ•‰∏Ä‰∏™ StoreStore Â±èÈöú„ÄÇËøô‰∏™Â±èÈöúÁ¶ÅÊ≠¢Â§ÑÁêÜÂô®Êää final ÂüüÁöÑÂÜôÈáçÊéíÂ∫èÂà∞ÊûÑÈÄ†ÂáΩÊï∞‰πãÂ§ñ„ÄÇ</li>
</ul>
<p>Áé∞Âú®ËÆ©Êàë‰ª¨ÂàÜÊûê writer () ÊñπÊ≥ï„ÄÇwriter () ÊñπÊ≥ïÂè™ÂåÖÂê´‰∏ÄË°å‰ª£Á†ÅÔºöfinalExample &#x3D; new FinalExample ()„ÄÇËøôË°å‰ª£Á†ÅÂåÖÂê´‰∏§‰∏™Ê≠•È™§Ôºö</p>
<ol>
<li>ÊûÑÈÄ†‰∏Ä‰∏™ FinalExample Á±ªÂûãÁöÑÂØπË±°Ôºõ</li>
<li>ÊääËøô‰∏™ÂØπË±°ÁöÑÂºïÁî®ËµãÂÄºÁªôÂºïÁî®ÂèòÈáè obj„ÄÇ</li>
</ol>
<p>ÂÅáËÆæÁ∫øÁ®ã B ËØªÂØπË±°ÂºïÁî®‰∏éËØªÂØπË±°ÁöÑÊàêÂëòÂüü‰πãÈó¥Ê≤°ÊúâÈáçÊéíÂ∫èÔºàÈ©¨‰∏ä‰ºöËØ¥Êòé‰∏∫‰ªÄ‰πàÈúÄË¶ÅËøô‰∏™ÂÅáËÆæÔºâÔºå‰∏ãÂõæÊòØ‰∏ÄÁßçÂèØËÉΩÁöÑÊâßË°åÊó∂Â∫èÔºö</p>
<p><img src="/image/Concurrent/Concurrent72.jpg" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent72.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Âú®‰∏äÂõæ‰∏≠ÔºåÂÜôÊôÆÈÄöÂüüÁöÑÊìç‰ΩúË¢´ÁºñËØëÂô®ÈáçÊéíÂ∫èÂà∞‰∫ÜÊûÑÈÄ†ÂáΩÊï∞‰πãÂ§ñÔºåËØªÁ∫øÁ®ã B ÈîôËØØÁöÑËØªÂèñ‰∫ÜÊôÆÈÄöÂèòÈáè i ÂàùÂßãÂåñ‰πãÂâçÁöÑÂÄº„ÄÇËÄåÂÜô final ÂüüÁöÑÊìç‰ΩúÔºåË¢´ÂÜô final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàô‚ÄúÈôêÂÆö‚ÄùÂú®‰∫ÜÊûÑÈÄ†ÂáΩÊï∞‰πãÂÜÖÔºåËØªÁ∫øÁ®ã B Ê≠£Á°ÆÁöÑËØªÂèñ‰∫Ü final ÂèòÈáèÂàùÂßãÂåñ‰πãÂêéÁöÑÂÄº„ÄÇ</p>
<p>ÂÜô final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàôÂèØ‰ª•Á°Æ‰øùÔºöÂú®ÂØπË±°ÂºïÁî®‰∏∫‰ªªÊÑèÁ∫øÁ®ãÂèØËßÅ‰πãÂâçÔºåÂØπË±°ÁöÑ final ÂüüÂ∑≤ÁªèË¢´Ê≠£Á°ÆÂàùÂßãÂåñËøá‰∫ÜÔºåËÄåÊôÆÈÄöÂüü‰∏çÂÖ∑ÊúâËøô‰∏™‰øùÈöú„ÄÇ‰ª•‰∏äÂõæ‰∏∫‰æãÔºåÂú®ËØªÁ∫øÁ®ã B‚ÄúÁúãÂà∞‚ÄùÂØπË±°ÂºïÁî® obj Êó∂ÔºåÂæàÂèØËÉΩ obj ÂØπË±°ËøòÊ≤°ÊúâÊûÑÈÄ†ÂÆåÊàêÔºàÂØπÊôÆÈÄöÂüü i ÁöÑÂÜôÊìç‰ΩúË¢´ÈáçÊéíÂ∫èÂà∞ÊûÑÈÄ†ÂáΩÊï∞Â§ñÔºåÊ≠§Êó∂ÂàùÂßãÂÄº 2 ËøòÊ≤°ÊúâÂÜôÂÖ•ÊôÆÈÄöÂüü iÔºâ„ÄÇ</p>
<h3 id="ËØª-final-ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàô"><a href="#ËØª-final-ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàô" class="headerlink" title="ËØª final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàô"></a>ËØª final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàô</h3><p>ËØª final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàôÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>Âú®‰∏Ä‰∏™Á∫øÁ®ã‰∏≠ÔºåÂàùÊ¨°ËØªÂØπË±°ÂºïÁî®‰∏éÂàùÊ¨°ËØªËØ•ÂØπË±°ÂåÖÂê´ÁöÑ final ÂüüÔºåJMM Á¶ÅÊ≠¢Â§ÑÁêÜÂô®ÈáçÊéíÂ∫èËøô‰∏§‰∏™Êìç‰ΩúÔºàÊ≥®ÊÑèÔºåËøô‰∏™ËßÑÂàô‰ªÖ‰ªÖÈíàÂØπÂ§ÑÁêÜÂô®Ôºâ„ÄÇÁºñËØëÂô®‰ºöÂú®ËØª final ÂüüÊìç‰ΩúÁöÑÂâçÈù¢ÊèíÂÖ•‰∏Ä‰∏™ LoadLoad Â±èÈöú„ÄÇ</li>
</ul>
<p>ÂàùÊ¨°ËØªÂØπË±°ÂºïÁî®‰∏éÂàùÊ¨°ËØªËØ•ÂØπË±°ÂåÖÂê´ÁöÑ final ÂüüÔºåËøô‰∏§‰∏™Êìç‰Ωú‰πãÈó¥Â≠òÂú®Èó¥Êé•‰æùËµñÂÖ≥Á≥ª„ÄÇÁî±‰∫éÁºñËØëÂô®ÈÅµÂÆàÈó¥Êé•‰æùËµñÂÖ≥Á≥ªÔºåÂõ†Ê≠§ÁºñËØëÂô®‰∏ç‰ºöÈáçÊéíÂ∫èËøô‰∏§‰∏™Êìç‰Ωú„ÄÇÂ§ßÂ§öÊï∞Â§ÑÁêÜÂô®‰πü‰ºöÈÅµÂÆàÈó¥Êé•‰æùËµñÔºåÂ§ßÂ§öÊï∞Â§ÑÁêÜÂô®‰πü‰∏ç‰ºöÈáçÊéíÂ∫èËøô‰∏§‰∏™Êìç‰Ωú„ÄÇ‰ΩÜÊúâÂ∞ëÊï∞Â§ÑÁêÜÂô®ÂÖÅËÆ∏ÂØπÂ≠òÂú®Èó¥Êé•‰æùËµñÂÖ≥Á≥ªÁöÑÊìç‰ΩúÂÅöÈáçÊéíÂ∫èÔºàÊØîÂ¶Ç alpha Â§ÑÁêÜÂô®ÔºâÔºåËøô‰∏™ËßÑÂàôÂ∞±ÊòØ‰∏ìÈó®Áî®Êù•ÈíàÂØπËøôÁßçÂ§ÑÁêÜÂô®„ÄÇ</p>
<p>reader() ÊñπÊ≥ïÂåÖÂê´‰∏â‰∏™Êìç‰ΩúÔºö</p>
<ol>
<li>ÂàùÊ¨°ËØªÂºïÁî®ÂèòÈáè obj;</li>
<li>ÂàùÊ¨°ËØªÂºïÁî®ÂèòÈáè obj ÊåáÂêëÂØπË±°ÁöÑÊôÆÈÄöÂüü j„ÄÇ</li>
<li>ÂàùÊ¨°ËØªÂºïÁî®ÂèòÈáè obj ÊåáÂêëÂØπË±°ÁöÑ final Âüü i„ÄÇ</li>
</ol>
<p>Áé∞Âú®Êàë‰ª¨ÂÅáËÆæÂÜôÁ∫øÁ®ã A Ê≤°ÊúâÂèëÁîü‰ªª‰ΩïÈáçÊéíÂ∫èÔºåÂêåÊó∂Á®ãÂ∫èÂú®‰∏çÈÅµÂÆàÈó¥Êé•‰æùËµñÁöÑÂ§ÑÁêÜÂô®‰∏äÊâßË°åÔºå‰∏ãÈù¢ÊòØ‰∏ÄÁßçÂèØËÉΩÁöÑÊâßË°åÊó∂Â∫èÔºö</p>
<p><img src="/image/Concurrent/Concurrent73.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent73.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Âú®‰∏äÂõæ‰∏≠ÔºåËØªÂØπË±°ÁöÑÊôÆÈÄöÂüüÁöÑÊìç‰ΩúË¢´Â§ÑÁêÜÂô®ÈáçÊéíÂ∫èÂà∞ËØªÂØπË±°ÂºïÁî®‰πãÂâç„ÄÇËØªÊôÆÈÄöÂüüÊó∂ÔºåËØ•ÂüüËøòÊ≤°ÊúâË¢´ÂÜôÁ∫øÁ®ã A ÂÜôÂÖ•ÔºåËøôÊòØ‰∏Ä‰∏™ÈîôËØØÁöÑËØªÂèñÊìç‰Ωú„ÄÇËÄåËØª final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàô‰ºöÊääËØªÂØπË±° final ÂüüÁöÑÊìç‰Ωú‚ÄúÈôêÂÆö‚ÄùÂú®ËØªÂØπË±°ÂºïÁî®‰πãÂêéÔºåÊ≠§Êó∂ËØ• final ÂüüÂ∑≤ÁªèË¢´ A Á∫øÁ®ãÂàùÂßãÂåñËøá‰∫ÜÔºåËøôÊòØ‰∏Ä‰∏™Ê≠£Á°ÆÁöÑËØªÂèñÊìç‰Ωú„ÄÇ</p>
<p>ËØª final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàôÂèØ‰ª•Á°Æ‰øùÔºöÂú®ËØª‰∏Ä‰∏™ÂØπË±°ÁöÑ final Âüü‰πãÂâçÔºå‰∏ÄÂÆö‰ºöÂÖàËØªÂåÖÂê´Ëøô‰∏™ final ÂüüÁöÑÂØπË±°ÁöÑÂºïÁî®„ÄÇÂú®Ëøô‰∏™Á§∫‰æãÁ®ãÂ∫è‰∏≠ÔºåÂ¶ÇÊûúËØ•ÂºïÁî®‰∏ç‰∏∫ nullÔºåÈÇ£‰πàÂºïÁî®ÂØπË±°ÁöÑ final Âüü‰∏ÄÂÆöÂ∑≤ÁªèË¢´ A Á∫øÁ®ãÂàùÂßãÂåñËøá‰∫Ü„ÄÇ</p>
<h3 id="Â¶ÇÊûú-final-ÂüüÊòØÂºïÁî®Á±ªÂûã"><a href="#Â¶ÇÊûú-final-ÂüüÊòØÂºïÁî®Á±ªÂûã" class="headerlink" title="Â¶ÇÊûú final ÂüüÊòØÂºïÁî®Á±ªÂûã"></a>Â¶ÇÊûú final ÂüüÊòØÂºïÁî®Á±ªÂûã</h3><p>‰∏äÈù¢Êàë‰ª¨ÁúãÂà∞ÁöÑ final ÂüüÊòØÂü∫Á°ÄÊï∞ÊçÆÁ±ªÂûãÔºå‰∏ãÈù¢ËÆ©Êàë‰ª¨ÁúãÁúãÂ¶ÇÊûú final ÂüüÊòØÂºïÁî®Á±ªÂûãÔºåÂ∞Ü‰ºöÊúâ‰ªÄ‰πàÊïàÊûúÔºü</p>
<p>ËØ∑Áúã‰∏ãÂàóÁ§∫‰æã‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalReferenceExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> intArray<span class="token punctuation">;</span>                     <span class="token comment">//final ÊòØÂºïÁî®Á±ªÂûã</span>
    <span class="token keyword">static</span> <span class="token class-name">FinalReferenceExample</span> obj<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">FinalReferenceExample</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// ÊûÑÈÄ†ÂáΩÊï∞</span>
       intArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>              <span class="token comment">//1</span>
       intArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                   <span class="token comment">//2</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> writerOne <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token comment">// ÂÜôÁ∫øÁ®ã A ÊâßË°å</span>
       obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FinalReferenceExample</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//3</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> writerTwo <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token comment">// ÂÜôÁ∫øÁ®ã B ÊâßË°å</span>
       obj<span class="token punctuation">.</span>intArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>                 <span class="token comment">//4</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> reader <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>              <span class="token comment">// ËØªÁ∫øÁ®ã C ÊâßË°å</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//5</span>
           <span class="token keyword">int</span> temp1 <span class="token operator">=</span> obj<span class="token punctuation">.</span>intArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">//6</span>
       <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ËøôÈáå final Âüü‰∏∫‰∏Ä‰∏™ÂºïÁî®Á±ªÂûãÔºåÂÆÉÂºïÁî®‰∏Ä‰∏™ int ÂûãÁöÑÊï∞ÁªÑÂØπË±°„ÄÇÂØπ‰∫éÂºïÁî®Á±ªÂûãÔºåÂÜô final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàôÂØπÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®Â¢ûÂä†‰∫ÜÂ¶Ç‰∏ãÁ∫¶ÊùüÔºö</p>
<ol>
<li>Âú®ÊûÑÈÄ†ÂáΩÊï∞ÂÜÖÂØπ‰∏Ä‰∏™ final ÂºïÁî®ÁöÑÂØπË±°ÁöÑÊàêÂëòÂüüÁöÑÂÜôÂÖ•Ôºå‰∏éÈöèÂêéÂú®ÊûÑÈÄ†ÂáΩÊï∞Â§ñÊääËøô‰∏™Ë¢´ÊûÑÈÄ†ÂØπË±°ÁöÑÂºïÁî®ËµãÂÄºÁªô‰∏Ä‰∏™ÂºïÁî®ÂèòÈáèÔºåËøô‰∏§‰∏™Êìç‰Ωú‰πãÈó¥‰∏çËÉΩÈáçÊéíÂ∫è„ÄÇ</li>
</ol>
<p>ÂØπ‰∏äÈù¢ÁöÑÁ§∫‰æãÁ®ãÂ∫èÔºåÊàë‰ª¨ÂÅáËÆæÈ¶ñÂÖàÁ∫øÁ®ã A ÊâßË°å writerOne() ÊñπÊ≥ïÔºåÊâßË°åÂÆåÂêéÁ∫øÁ®ã B ÊâßË°å writerTwo() ÊñπÊ≥ïÔºåÊâßË°åÂÆåÂêéÁ∫øÁ®ã C ÊâßË°å reader () ÊñπÊ≥ï„ÄÇ‰∏ãÈù¢ÊòØ‰∏ÄÁßçÂèØËÉΩÁöÑÁ∫øÁ®ãÊâßË°åÊó∂Â∫èÔºö</p>
<p><img src="/image/Concurrent/Concurrent74.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent74.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Âú®‰∏äÂõæ‰∏≠Ôºå1 ÊòØÂØπ final ÂüüÁöÑÂÜôÂÖ•Ôºå2 ÊòØÂØπËøô‰∏™ final ÂüüÂºïÁî®ÁöÑÂØπË±°ÁöÑÊàêÂëòÂüüÁöÑÂÜôÂÖ•Ôºå3 ÊòØÊääË¢´ÊûÑÈÄ†ÁöÑÂØπË±°ÁöÑÂºïÁî®ËµãÂÄºÁªôÊüê‰∏™ÂºïÁî®ÂèòÈáè„ÄÇËøôÈáåÈô§‰∫ÜÂâçÈù¢ÊèêÂà∞ÁöÑ 1 ‰∏çËÉΩÂíå 3 ÈáçÊéíÂ∫èÂ§ñÔºå2 Âíå 3 ‰πü‰∏çËÉΩÈáçÊéíÂ∫è„ÄÇ</p>
<p>JMM ÂèØ‰ª•Á°Æ‰øùËØªÁ∫øÁ®ã C Ëá≥Â∞ëËÉΩÁúãÂà∞ÂÜôÁ∫øÁ®ã A Âú®ÊûÑÈÄ†ÂáΩÊï∞‰∏≠ÂØπ final ÂºïÁî®ÂØπË±°ÁöÑÊàêÂëòÂüüÁöÑÂÜôÂÖ•„ÄÇÂç≥ C Ëá≥Â∞ëËÉΩÁúãÂà∞Êï∞ÁªÑ‰∏ãÊ†á 0 ÁöÑÂÄº‰∏∫ 1„ÄÇËÄåÂÜôÁ∫øÁ®ã B ÂØπÊï∞ÁªÑÂÖÉÁ¥†ÁöÑÂÜôÂÖ•ÔºåËØªÁ∫øÁ®ã C ÂèØËÉΩÁúãÁöÑÂà∞Ôºå‰πüÂèØËÉΩÁúã‰∏çÂà∞„ÄÇJMM ‰∏ç‰øùËØÅÁ∫øÁ®ã B ÁöÑÂÜôÂÖ•ÂØπËØªÁ∫øÁ®ã C ÂèØËßÅÔºåÂõ†‰∏∫ÂÜôÁ∫øÁ®ã B ÂíåËØªÁ∫øÁ®ã C ‰πãÈó¥Â≠òÂú®Êï∞ÊçÆÁ´û‰∫âÔºåÊ≠§Êó∂ÁöÑÊâßË°åÁªìÊûú‰∏çÂèØÈ¢ÑÁü•„ÄÇ</p>
<p>Â¶ÇÊûúÊÉ≥Ë¶ÅÁ°Æ‰øùËØªÁ∫øÁ®ã C ÁúãÂà∞ÂÜôÁ∫øÁ®ã B ÂØπÊï∞ÁªÑÂÖÉÁ¥†ÁöÑÂÜôÂÖ•ÔºåÂÜôÁ∫øÁ®ã B ÂíåËØªÁ∫øÁ®ã C ‰πãÈó¥ÈúÄË¶Å‰ΩøÁî®ÂêåÊ≠•ÂéüËØ≠Ôºàlock Êàñ volatileÔºâÊù•Á°Æ‰øùÂÜÖÂ≠òÂèØËßÅÊÄß„ÄÇ</p>
<h3 id="‰∏∫‰ªÄ‰πà-final-ÂºïÁî®‰∏çËÉΩ‰ªéÊûÑÈÄ†ÂáΩÊï∞ÂÜÖ‚ÄúÈÄ∏Âá∫‚Äù"><a href="#‰∏∫‰ªÄ‰πà-final-ÂºïÁî®‰∏çËÉΩ‰ªéÊûÑÈÄ†ÂáΩÊï∞ÂÜÖ‚ÄúÈÄ∏Âá∫‚Äù" class="headerlink" title="‰∏∫‰ªÄ‰πà final ÂºïÁî®‰∏çËÉΩ‰ªéÊûÑÈÄ†ÂáΩÊï∞ÂÜÖ‚ÄúÈÄ∏Âá∫‚Äù"></a>‰∏∫‰ªÄ‰πà final ÂºïÁî®‰∏çËÉΩ‰ªéÊûÑÈÄ†ÂáΩÊï∞ÂÜÖ‚ÄúÈÄ∏Âá∫‚Äù</h3><p>ÂâçÈù¢Êàë‰ª¨ÊèêÂà∞ËøáÔºåÂÜô final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàôÂèØ‰ª•Á°Æ‰øùÔºöÂú®ÂºïÁî®ÂèòÈáè‰∏∫‰ªªÊÑèÁ∫øÁ®ãÂèØËßÅ‰πãÂâçÔºåËØ•ÂºïÁî®ÂèòÈáèÊåáÂêëÁöÑÂØπË±°ÁöÑ final ÂüüÂ∑≤ÁªèÂú®ÊûÑÈÄ†ÂáΩÊï∞‰∏≠Ë¢´Ê≠£Á°ÆÂàùÂßãÂåñËøá‰∫Ü„ÄÇÂÖ∂ÂÆûË¶ÅÂæóÂà∞Ëøô‰∏™ÊïàÊûúÔºåËøòÈúÄË¶Å‰∏Ä‰∏™‰øùËØÅÔºöÂú®ÊûÑÈÄ†ÂáΩÊï∞ÂÜÖÈÉ®Ôºå‰∏çËÉΩËÆ©Ëøô‰∏™Ë¢´ÊûÑÈÄ†ÂØπË±°ÁöÑÂºïÁî®‰∏∫ÂÖ∂‰ªñÁ∫øÁ®ãÂèØËßÅÔºå‰πüÂ∞±ÊòØÂØπË±°ÂºïÁî®‰∏çËÉΩÂú®ÊûÑÈÄ†ÂáΩÊï∞‰∏≠‚ÄúÈÄ∏Âá∫‚Äù„ÄÇ‰∏∫‰∫ÜËØ¥ÊòéÈóÆÈ¢òÔºåËÆ©Êàë‰ª¨Êù•Áúã‰∏ãÈù¢Á§∫‰æã‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalReferenceEscapeExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">FinalReferenceEscapeExample</span> obj<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">FinalReferenceEscapeExample</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                              <span class="token comment">//1 ÂÜô final Âüü</span>
       obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>                          <span class="token comment">//2 this ÂºïÁî®Âú®Ê≠§‚ÄúÈÄ∏Âá∫‚Äù</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">new</span> <span class="token class-name">FinalReferenceEscapeExample</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> reader <span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                     <span class="token comment">//3</span>
           <span class="token keyword">int</span> temp <span class="token operator">=</span> obj<span class="token punctuation">.</span>i<span class="token punctuation">;</span>                 <span class="token comment">//4</span>
       <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ÂÅáËÆæ‰∏Ä‰∏™Á∫øÁ®ã A ÊâßË°å writer() ÊñπÊ≥ïÔºåÂè¶‰∏Ä‰∏™Á∫øÁ®ã B ÊâßË°å reader() ÊñπÊ≥ï„ÄÇËøôÈáåÁöÑÊìç‰Ωú 2 ‰ΩøÂæóÂØπË±°ËøòÊú™ÂÆåÊàêÊûÑÈÄ†ÂâçÂ∞±‰∏∫Á∫øÁ®ã B ÂèØËßÅ„ÄÇÂç≥‰ΩøËøôÈáåÁöÑÊìç‰Ωú 2 ÊòØÊûÑÈÄ†ÂáΩÊï∞ÁöÑÊúÄÂêé‰∏ÄÊ≠•Ôºå‰∏îÂç≥‰ΩøÂú®Á®ãÂ∫è‰∏≠Êìç‰Ωú 2 ÊéíÂú®Êìç‰Ωú 1 ÂêéÈù¢ÔºåÊâßË°å read() ÊñπÊ≥ïÁöÑÁ∫øÁ®ã‰ªçÁÑ∂ÂèØËÉΩÊó†Ê≥ïÁúãÂà∞ final ÂüüË¢´ÂàùÂßãÂåñÂêéÁöÑÂÄºÔºåÂõ†‰∏∫ËøôÈáåÁöÑÊìç‰Ωú 1 ÂíåÊìç‰Ωú 2 ‰πãÈó¥ÂèØËÉΩË¢´ÈáçÊéíÂ∫è„ÄÇÂÆûÈôÖÁöÑÊâßË°åÊó∂Â∫èÂèØËÉΩÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="/image/Concurrent/Concurrent75.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent75.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‰ªé‰∏äÂõæÊàë‰ª¨ÂèØ‰ª•ÁúãÂá∫ÔºöÂú®ÊûÑÈÄ†ÂáΩÊï∞ËøîÂõûÂâçÔºåË¢´ÊûÑÈÄ†ÂØπË±°ÁöÑÂºïÁî®‰∏çËÉΩ‰∏∫ÂÖ∂‰ªñÁ∫øÁ®ãÂèØËßÅÔºåÂõ†‰∏∫Ê≠§Êó∂ÁöÑ final ÂüüÂèØËÉΩËøòÊ≤°ÊúâË¢´ÂàùÂßãÂåñ„ÄÇÂú®ÊûÑÈÄ†ÂáΩÊï∞ËøîÂõûÂêéÔºå‰ªªÊÑèÁ∫øÁ®ãÈÉΩÂ∞Ü‰øùËØÅËÉΩÁúãÂà∞ final ÂüüÊ≠£Á°ÆÂàùÂßãÂåñ‰πãÂêéÁöÑÂÄº„ÄÇ</p>
<h3 id="final-ËØ≠‰πâÂú®Â§ÑÁêÜÂô®‰∏≠ÁöÑÂÆûÁé∞"><a href="#final-ËØ≠‰πâÂú®Â§ÑÁêÜÂô®‰∏≠ÁöÑÂÆûÁé∞" class="headerlink" title="final ËØ≠‰πâÂú®Â§ÑÁêÜÂô®‰∏≠ÁöÑÂÆûÁé∞"></a>final ËØ≠‰πâÂú®Â§ÑÁêÜÂô®‰∏≠ÁöÑÂÆûÁé∞</h3><p>Áé∞Âú®Êàë‰ª¨‰ª• x86 Â§ÑÁêÜÂô®‰∏∫‰æãÔºåËØ¥Êòé final ËØ≠‰πâÂú®Â§ÑÁêÜÂô®‰∏≠ÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇ</p>
<p>‰∏äÈù¢Êàë‰ª¨ÊèêÂà∞ÔºåÂÜô final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàô‰ºöË¶ÅÊ±ÇËØëÁºñÂô®Âú® final ÂüüÁöÑÂÜô‰πãÂêéÔºåÊûÑÈÄ†ÂáΩÊï∞ return ‰πãÂâçÔºåÊèíÂÖ•‰∏Ä‰∏™ StoreStore ÈöúÂ±è„ÄÇËØª final ÂüüÁöÑÈáçÊéíÂ∫èËßÑÂàôË¶ÅÊ±ÇÁºñËØëÂô®Âú®ËØª final ÂüüÁöÑÊìç‰ΩúÂâçÈù¢ÊèíÂÖ•‰∏Ä‰∏™ LoadLoad Â±èÈöú„ÄÇ</p>
<p>Áî±‰∫é x86 Â§ÑÁêÜÂô®‰∏ç‰ºöÂØπÂÜô - ÂÜôÊìç‰ΩúÂÅöÈáçÊéíÂ∫èÔºåÊâÄ‰ª•Âú® x86 Â§ÑÁêÜÂô®‰∏≠ÔºåÂÜô final ÂüüÈúÄË¶ÅÁöÑ StoreStore ÈöúÂ±è‰ºöË¢´ÁúÅÁï•Êéâ„ÄÇÂêåÊ†∑ÔºåÁî±‰∫é x86 Â§ÑÁêÜÂô®‰∏ç‰ºöÂØπÂ≠òÂú®Èó¥Êé•‰æùËµñÂÖ≥Á≥ªÁöÑÊìç‰ΩúÂÅöÈáçÊéíÂ∫èÔºåÊâÄ‰ª•Âú® x86 Â§ÑÁêÜÂô®‰∏≠ÔºåËØª final ÂüüÈúÄË¶ÅÁöÑ LoadLoad Â±èÈöú‰πü‰ºöË¢´ÁúÅÁï•Êéâ„ÄÇ‰πüÂ∞±ÊòØËØ¥Âú® x86 Â§ÑÁêÜÂô®‰∏≠Ôºåfinal ÂüüÁöÑËØª &#x2F; ÂÜô‰∏ç‰ºöÊèíÂÖ•‰ªª‰ΩïÂÜÖÂ≠òÂ±èÈöúÔºÅ</p>
<h3 id="JSR-133-‰∏∫‰ªÄ‰πàË¶ÅÂ¢ûÂº∫-final-ÁöÑËØ≠‰πâ"><a href="#JSR-133-‰∏∫‰ªÄ‰πàË¶ÅÂ¢ûÂº∫-final-ÁöÑËØ≠‰πâ" class="headerlink" title="JSR-133 ‰∏∫‰ªÄ‰πàË¶ÅÂ¢ûÂº∫ final ÁöÑËØ≠‰πâ"></a>JSR-133 ‰∏∫‰ªÄ‰πàË¶ÅÂ¢ûÂº∫ final ÁöÑËØ≠‰πâ</h3><p>Âú®ÊóßÁöÑ Java ÂÜÖÂ≠òÊ®°Âûã‰∏≠ ÔºåÊúÄ‰∏•ÈáçÁöÑ‰∏Ä‰∏™Áº∫Èô∑Â∞±ÊòØÁ∫øÁ®ãÂèØËÉΩÁúãÂà∞ final ÂüüÁöÑÂÄº‰ºöÊîπÂèò„ÄÇÊØîÂ¶ÇÔºå‰∏Ä‰∏™Á∫øÁ®ãÂΩìÂâçÁúãÂà∞‰∏Ä‰∏™Êï¥ÂΩ¢ final ÂüüÁöÑÂÄº‰∏∫ 0ÔºàËøòÊú™ÂàùÂßãÂåñ‰πãÂâçÁöÑÈªòËÆ§ÂÄºÔºâÔºåËøá‰∏ÄÊÆµÊó∂Èó¥‰πãÂêéËøô‰∏™Á∫øÁ®ãÂÜçÂéªËØªËøô‰∏™ final ÂüüÁöÑÂÄºÊó∂ÔºåÂç¥ÂèëÁé∞ÂÄºÂèò‰∏∫‰∫Ü 1ÔºàË¢´Êüê‰∏™Á∫øÁ®ãÂàùÂßãÂåñ‰πãÂêéÁöÑÂÄºÔºâ„ÄÇÊúÄÂ∏∏ËßÅÁöÑ‰æãÂ≠êÂ∞±ÊòØÂú®ÊóßÁöÑ Java ÂÜÖÂ≠òÊ®°Âûã‰∏≠ÔºåString ÁöÑÂÄºÂèØËÉΩ‰ºöÊîπÂèòÔºàÂèÇËÄÉÊñáÁåÆ 2 ‰∏≠Êúâ‰∏Ä‰∏™ÂÖ∑‰ΩìÁöÑ‰æãÂ≠êÔºåÊÑüÂÖ¥Ë∂£ÁöÑËØªËÄÖÂèØ‰ª•Ëá™Ë°åÂèÇËÄÉÔºåËøôÈáåÂ∞±‰∏çËµòËø∞‰∫ÜÔºâ„ÄÇ</p>
<p>‰∏∫‰∫Ü‰øÆË°•Ëøô‰∏™ÊºèÊ¥ûÔºåJSR-133 ‰∏ìÂÆ∂ÁªÑÂ¢ûÂº∫‰∫Ü final ÁöÑËØ≠‰πâ„ÄÇÈÄöËøá‰∏∫ final ÂüüÂ¢ûÂä†ÂÜôÂíåËØªÈáçÊéíÂ∫èËßÑÂàôÔºåÂèØ‰ª•‰∏∫ java Á®ãÂ∫èÂëòÊèê‰æõÂàùÂßãÂåñÂÆâÂÖ®‰øùËØÅÔºöÂè™Ë¶ÅÂØπË±°ÊòØÊ≠£Á°ÆÊûÑÈÄ†ÁöÑÔºàË¢´ÊûÑÈÄ†ÂØπË±°ÁöÑÂºïÁî®Âú®ÊûÑÈÄ†ÂáΩÊï∞‰∏≠Ê≤°Êúâ‚ÄúÈÄ∏Âá∫‚ÄùÔºâÔºåÈÇ£‰πà‰∏çÈúÄË¶Å‰ΩøÁî®ÂêåÊ≠•ÔºàÊåá lock Âíå volatile ÁöÑ‰ΩøÁî®ÔºâÔºåÂ∞±ÂèØ‰ª•‰øùËØÅ‰ªªÊÑèÁ∫øÁ®ãÈÉΩËÉΩÁúãÂà∞Ëøô‰∏™ final ÂüüÂú®ÊûÑÈÄ†ÂáΩÊï∞‰∏≠Ë¢´ÂàùÂßãÂåñ‰πãÂêéÁöÑÂÄº„ÄÇ</p>
<h2 id="ÊÄªÁªì"><a href="#ÊÄªÁªì" class="headerlink" title="ÊÄªÁªì"></a>ÊÄªÁªì</h2><h3 id="Â§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°Âûã"><a href="#Â§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°Âûã" class="headerlink" title="Â§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°Âûã"></a>Â§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°Âûã</h3><p>È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°ÂûãÊòØ‰∏Ä‰∏™ÁêÜËÆ∫ÂèÇËÄÉÊ®°ÂûãÔºåJMM ÂíåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°ÂûãÂú®ËÆæËÆ°Êó∂ÈÄöÂ∏∏‰ºöÊääÈ°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã‰Ωú‰∏∫ÂèÇÁÖß„ÄÇJMM ÂíåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°ÂûãÂú®ËÆæËÆ°Êó∂‰ºöÂØπÈ°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°ÂûãÂÅö‰∏Ä‰∫õÊîæÊùæÔºåÂõ†‰∏∫Â¶ÇÊûúÂÆåÂÖ®ÊåâÁÖßÈ°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°ÂûãÊù•ÂÆûÁé∞Â§ÑÁêÜÂô®Âíå JMMÔºåÈÇ£‰πàÂæàÂ§öÁöÑÂ§ÑÁêÜÂô®ÂíåÁºñËØëÂô®‰ºòÂåñÈÉΩË¶ÅË¢´Á¶ÅÊ≠¢ÔºåËøôÂØπÊâßË°åÊÄßËÉΩÂ∞Ü‰ºöÊúâÂæàÂ§ßÁöÑÂΩ±Âìç„ÄÇ</p>
<p>Ê†πÊçÆÂØπ‰∏çÂêåÁ±ªÂûãËØª &#x2F; ÂÜôÊìç‰ΩúÁªÑÂêàÁöÑÊâßË°åÈ°∫Â∫èÁöÑÊîæÊùæÔºåÂèØ‰ª•ÊääÂ∏∏ËßÅÂ§ÑÁêÜÂô®ÁöÑÂÜÖÂ≠òÊ®°ÂûãÂàíÂàÜ‰∏∫‰∏ãÈù¢Âá†ÁßçÁ±ªÂûãÔºö</p>
<ol>
<li>ÊîæÊùæÁ®ãÂ∫è‰∏≠ÂÜô - ËØªÊìç‰ΩúÁöÑÈ°∫Â∫èÔºåÁî±Ê≠§‰∫ßÁîü‰∫Ü total store ordering ÂÜÖÂ≠òÊ®°ÂûãÔºàÁÆÄÁß∞‰∏∫ TSOÔºâ„ÄÇ</li>
<li>Âú®ÂâçÈù¢ 1 ÁöÑÂü∫Á°Ä‰∏äÔºåÁªßÁª≠ÊîæÊùæÁ®ãÂ∫è‰∏≠ÂÜô - ÂÜôÊìç‰ΩúÁöÑÈ°∫Â∫èÔºåÁî±Ê≠§‰∫ßÁîü‰∫Ü partial store order ÂÜÖÂ≠òÊ®°ÂûãÔºàÁÆÄÁß∞‰∏∫ PSOÔºâ„ÄÇ</li>
<li>Âú®ÂâçÈù¢ 1 Âíå 2 ÁöÑÂü∫Á°Ä‰∏äÔºåÁªßÁª≠ÊîæÊùæÁ®ãÂ∫è‰∏≠ËØª - ÂÜôÂíåËØª - ËØªÊìç‰ΩúÁöÑÈ°∫Â∫èÔºåÁî±Ê≠§‰∫ßÁîü‰∫Ü relaxed memory order ÂÜÖÂ≠òÊ®°ÂûãÔºàÁÆÄÁß∞‰∏∫ RMOÔºâÂíå PowerPC ÂÜÖÂ≠òÊ®°Âûã„ÄÇ</li>
</ol>
<p>Ê≥®ÊÑèÔºåËøôÈáåÂ§ÑÁêÜÂô®ÂØπËØª &#x2F; ÂÜôÊìç‰ΩúÁöÑÊîæÊùæÔºåÊòØ‰ª•‰∏§‰∏™Êìç‰Ωú‰πãÈó¥‰∏çÂ≠òÂú®Êï∞ÊçÆ‰æùËµñÊÄß‰∏∫ÂâçÊèêÁöÑÔºàÂõ†‰∏∫Â§ÑÁêÜÂô®Ë¶ÅÈÅµÂÆà as-if-serial ËØ≠‰πâÔºåÂ§ÑÁêÜÂô®‰∏ç‰ºöÂØπÂ≠òÂú®Êï∞ÊçÆ‰æùËµñÊÄßÁöÑ‰∏§‰∏™ÂÜÖÂ≠òÊìç‰ΩúÂÅöÈáçÊéíÂ∫èÔºâ„ÄÇ</p>
<p>Áî±‰∫éÂ∏∏ËßÅÁöÑÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°ÂûãÊØî JMM Ë¶ÅÂº±Ôºåjava ÁºñËØëÂô®Âú®ÁîüÊàêÂ≠óËäÇÁ†ÅÊó∂Ôºå‰ºöÂú®ÊâßË°åÊåá‰ª§Â∫èÂàóÁöÑÈÄÇÂΩì‰ΩçÁΩÆÊèíÂÖ•ÂÜÖÂ≠òÂ±èÈöúÊù•ÈôêÂà∂Â§ÑÁêÜÂô®ÁöÑÈáçÊéíÂ∫è„ÄÇÂêåÊó∂ÔºåÁî±‰∫éÂêÑÁßçÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°ÂûãÁöÑÂº∫Âº±Âπ∂‰∏çÁõ∏ÂêåÔºå‰∏∫‰∫ÜÂú®‰∏çÂêåÁöÑÂ§ÑÁêÜÂô®Âπ≥Âè∞ÂêëÁ®ãÂ∫èÂëòÂ±ïÁ§∫‰∏Ä‰∏™‰∏ÄËá¥ÁöÑÂÜÖÂ≠òÊ®°ÂûãÔºåJMM Âú®‰∏çÂêåÁöÑÂ§ÑÁêÜÂô®‰∏≠ÈúÄË¶ÅÊèíÂÖ•ÁöÑÂÜÖÂ≠òÂ±èÈöúÁöÑÊï∞ÈáèÂíåÁßçÁ±ª‰πü‰∏çÁõ∏Âêå„ÄÇ‰∏ãÂõæÂ±ïÁ§∫‰∫Ü JMM Âú®‰∏çÂêåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°Âûã‰∏≠ÈúÄË¶ÅÊèíÂÖ•ÁöÑÂÜÖÂ≠òÂ±èÈöúÁöÑÁ§∫ÊÑèÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent76.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent76.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Â¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåJMM Â±èËîΩ‰∫Ü‰∏çÂêåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°ÂûãÁöÑÂ∑ÆÂºÇÔºåÂÆÉÂú®‰∏çÂêåÁöÑÂ§ÑÁêÜÂô®Âπ≥Âè∞‰πã‰∏ä‰∏∫ java Á®ãÂ∫èÂëòÂëàÁé∞‰∫Ü‰∏Ä‰∏™‰∏ÄËá¥ÁöÑÂÜÖÂ≠òÊ®°Âûã„ÄÇ</p>
<h3 id="JMMÔºåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°Âûã‰∏éÈ°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã‰πãÈó¥ÁöÑÂÖ≥Á≥ª"><a href="#JMMÔºåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°Âûã‰∏éÈ°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã‰πãÈó¥ÁöÑÂÖ≥Á≥ª" class="headerlink" title="JMMÔºåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°Âûã‰∏éÈ°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã‰πãÈó¥ÁöÑÂÖ≥Á≥ª"></a>JMMÔºåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°Âûã‰∏éÈ°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã‰πãÈó¥ÁöÑÂÖ≥Á≥ª</h3><p>JMM ÊòØ‰∏Ä‰∏™ËØ≠Ë®ÄÁ∫ßÁöÑÂÜÖÂ≠òÊ®°ÂûãÔºåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°ÂûãÊòØÁ°¨‰ª∂Á∫ßÁöÑÂÜÖÂ≠òÊ®°ÂûãÔºåÈ°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°ÂûãÊòØ‰∏Ä‰∏™ÁêÜËÆ∫ÂèÇËÄÉÊ®°Âûã„ÄÇ‰∏ãÈù¢ÊòØËØ≠Ë®ÄÂÜÖÂ≠òÊ®°ÂûãÔºåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°ÂûãÂíåÈ°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°ÂûãÁöÑÂº∫Âº±ÂØπÊØîÁ§∫ÊÑèÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent77.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent77.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‰ªé‰∏äÂõæÊàë‰ª¨ÂèØ‰ª•ÁúãÂá∫ÔºöÂ∏∏ËßÅÁöÑ 4 ÁßçÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°ÂûãÊØîÂ∏∏Áî®ÁöÑ 3 ‰∏≠ËØ≠Ë®ÄÂÜÖÂ≠òÊ®°ÂûãË¶ÅÂº±ÔºåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°ÂûãÂíåËØ≠Ë®ÄÂÜÖÂ≠òÊ®°ÂûãÈÉΩÊØîÈ°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°ÂûãË¶ÅÂº±„ÄÇÂêåÂ§ÑÁêÜÂô®ÂÜÖÂ≠òÊ®°Âûã‰∏ÄÊ†∑ÔºåË∂äÊòØËøΩÊ±ÇÊâßË°åÊÄßËÉΩÁöÑËØ≠Ë®ÄÔºåÂÜÖÂ≠òÊ®°ÂûãËÆæËÆ°ÁöÑ‰ºöË∂äÂº±„ÄÇ</p>
<h3 id="JMM-ÁöÑËÆæËÆ°"><a href="#JMM-ÁöÑËÆæËÆ°" class="headerlink" title="JMM ÁöÑËÆæËÆ°"></a>JMM ÁöÑËÆæËÆ°</h3><p><strong>‰ªé JMM ËÆæËÆ°ËÄÖÁöÑËßíÂ∫¶Êù•ËØ¥ÔºåÂú®ËÆæËÆ° JMM Êó∂ÔºåÈúÄË¶ÅËÄÉËôë‰∏§‰∏™ÂÖ≥ÈîÆÂõ†Á¥†Ôºö</strong></p>
<ul>
<li><strong>Á®ãÂ∫èÂëòÂØπÂÜÖÂ≠òÊ®°ÂûãÁöÑ‰ΩøÁî®„ÄÇÁ®ãÂ∫èÂëòÂ∏åÊúõÂÜÖÂ≠òÊ®°ÂûãÊòì‰∫éÁêÜËß£ÔºåÊòì‰∫éÁºñÁ®ã„ÄÇÁ®ãÂ∫èÂëòÂ∏åÊúõÂü∫‰∫é‰∏Ä‰∏™Âº∫ÂÜÖÂ≠òÊ®°ÂûãÊù•ÁºñÂÜô‰ª£Á†Å„ÄÇ</strong></li>
<li><strong>ÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÂØπÂÜÖÂ≠òÊ®°ÂûãÁöÑÂÆûÁé∞„ÄÇÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®Â∏åÊúõÂÜÖÂ≠òÊ®°ÂûãÂØπÂÆÉ‰ª¨ÁöÑÊùüÁºöË∂äÂ∞ëË∂äÂ•ΩÔºåËøôÊ†∑ÂÆÉ‰ª¨Â∞±ÂèØ‰ª•ÂÅöÂ∞ΩÂèØËÉΩÂ§öÁöÑ‰ºòÂåñÊù•ÊèêÈ´òÊÄßËÉΩ„ÄÇÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®Â∏åÊúõÂÆûÁé∞‰∏Ä‰∏™Âº±ÂÜÖÂ≠òÊ®°Âûã„ÄÇ</strong></li>
</ul>
<p>Áî±‰∫éËøô‰∏§‰∏™Âõ†Á¥†‰∫íÁõ∏ÁüõÁõæÔºåÊâÄ‰ª• JSR-133 ‰∏ìÂÆ∂ÁªÑÂú®ËÆæËÆ° JMM Êó∂ÁöÑÊ†∏ÂøÉÁõÆÊ†áÂ∞±ÊòØÊâæÂà∞‰∏Ä‰∏™Â•ΩÁöÑÂπ≥Ë°°ÁÇπÔºö‰∏ÄÊñπÈù¢Ë¶Å‰∏∫Á®ãÂ∫èÂëòÊèê‰æõË∂≥Â§üÂº∫ÁöÑÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅÔºõÂè¶‰∏ÄÊñπÈù¢ÔºåÂØπÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÁöÑÈôêÂà∂Ë¶ÅÂ∞ΩÂèØËÉΩÁöÑÊîæÊùæ„ÄÇ‰∏ãÈù¢ËÆ©Êàë‰ª¨ÁúãÁúã JSR-133 ÊòØÂ¶Ç‰ΩïÂÆûÁé∞Ëøô‰∏ÄÁõÆÊ†áÁöÑ„ÄÇ</p>
<p>‰∏∫‰∫ÜÂÖ∑‰ΩìËØ¥ÊòéÔºåËØ∑ÁúãÂâçÈù¢ÊèêÂà∞ËøáÁöÑËÆ°ÁÆóÂúÜÈù¢ÁßØÁöÑÁ§∫‰æã‰ª£Á†ÅÔºö</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">double</span> pi  <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>    <span class="token comment">//A</span>
<span class="token keyword">double</span> r   <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>     <span class="token comment">//B</span>
<span class="token keyword">double</span> area <span class="token operator">=</span> pi <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">;</span> <span class="token comment">//C</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>‰∏äÈù¢ËÆ°ÁÆóÂúÜÁöÑÈù¢ÁßØÁöÑÁ§∫‰æã‰ª£Á†ÅÂ≠òÂú®‰∏â‰∏™ happens- before ÂÖ≥Á≥ªÔºö</p>
<ol>
<li>A happens- before BÔºõ</li>
<li>B happens- before CÔºõ</li>
<li>A happens- before CÔºõ</li>
</ol>
<p>Áî±‰∫é A happens- before BÔºåhappens- before ÁöÑÂÆö‰πâ‰ºöË¶ÅÊ±ÇÔºöA Êìç‰ΩúÊâßË°åÁöÑÁªìÊûúË¶ÅÂØπ B ÂèØËßÅÔºå‰∏î A Êìç‰ΩúÁöÑÊâßË°åÈ°∫Â∫èÊéíÂú® B Êìç‰Ωú‰πãÂâç„ÄÇ ‰ΩÜÊòØ‰ªéÁ®ãÂ∫èËØ≠‰πâÁöÑËßíÂ∫¶Êù•ËØ¥ÔºåÂØπ A Âíå B ÂÅöÈáçÊéíÂ∫èÂç≥‰∏ç‰ºöÊîπÂèòÁ®ãÂ∫èÁöÑÊâßË°åÁªìÊûúÔºå‰πüËøòËÉΩÊèêÈ´òÁ®ãÂ∫èÁöÑÊâßË°åÊÄßËÉΩÔºàÂÖÅËÆ∏ËøôÁßçÈáçÊéíÂ∫èÂáèÂ∞ë‰∫ÜÂØπÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®‰ºòÂåñÁöÑÊùüÁºöÔºâ„ÄÇ‰πüÂ∞±ÊòØËØ¥Ôºå‰∏äÈù¢Ëøô 3 ‰∏™ happens- before ÂÖ≥Á≥ª‰∏≠ÔºåËôΩÁÑ∂ 2 Âíå 3 ÊòØÂøÖÈúÄË¶ÅÁöÑÔºå‰ΩÜ 1 ÊòØ‰∏çÂøÖË¶ÅÁöÑ„ÄÇÂõ†Ê≠§ÔºåJMM Êää happens- before Ë¶ÅÊ±ÇÁ¶ÅÊ≠¢ÁöÑÈáçÊéíÂ∫èÂàÜ‰∏∫‰∫Ü‰∏ãÈù¢‰∏§Á±ªÔºö</p>
<ul>
<li>‰ºöÊîπÂèòÁ®ãÂ∫èÊâßË°åÁªìÊûúÁöÑÈáçÊéíÂ∫è„ÄÇ</li>
<li>‰∏ç‰ºöÊîπÂèòÁ®ãÂ∫èÊâßË°åÁªìÊûúÁöÑÈáçÊéíÂ∫è„ÄÇ</li>
</ul>
<p>JMM ÂØπËøô‰∏§Áßç‰∏çÂêåÊÄßË¥®ÁöÑÈáçÊéíÂ∫èÔºåÈááÂèñ‰∫Ü‰∏çÂêåÁöÑÁ≠ñÁï•Ôºö</p>
<ul>
<li>ÂØπ‰∫é‰ºöÊîπÂèòÁ®ãÂ∫èÊâßË°åÁªìÊûúÁöÑÈáçÊéíÂ∫èÔºåJMM Ë¶ÅÊ±ÇÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÂøÖÈ°ªÁ¶ÅÊ≠¢ËøôÁßçÈáçÊéíÂ∫è„ÄÇ</li>
<li>ÂØπ‰∫é‰∏ç‰ºöÊîπÂèòÁ®ãÂ∫èÊâßË°åÁªìÊûúÁöÑÈáçÊéíÂ∫èÔºåJMM ÂØπÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®‰∏ç‰ΩúË¶ÅÊ±ÇÔºàJMM ÂÖÅËÆ∏ËøôÁßçÈáçÊéíÂ∫èÔºâ„ÄÇ</li>
</ul>
<p>‰∏ãÈù¢ÊòØ JMM ÁöÑËÆæËÆ°Á§∫ÊÑèÂõæÔºö</p>
<p><img src="/image/Concurrent/Concurrent78.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent78.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>‰ªé‰∏äÂõæÂèØ‰ª•ÁúãÂá∫‰∏§ÁÇπÔºö</p>
<ul>
<li>JMM ÂêëÁ®ãÂ∫èÂëòÊèê‰æõÁöÑ happens- before ËßÑÂàôËÉΩÊª°Ë∂≥Á®ãÂ∫èÂëòÁöÑÈúÄÊ±Ç„ÄÇJMM ÁöÑ happens- before ËßÑÂàô‰∏ç‰ΩÜÁÆÄÂçïÊòìÊáÇÔºåËÄå‰∏î‰πüÂêëÁ®ãÂ∫èÂëòÊèê‰æõ‰∫ÜË∂≥Â§üÂº∫ÁöÑÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅÔºàÊúâ‰∫õÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅÂÖ∂ÂÆûÂπ∂‰∏ç‰∏ÄÂÆöÁúüÂÆûÂ≠òÂú®ÔºåÊØîÂ¶Ç‰∏äÈù¢ÁöÑ A happens- before BÔºâ„ÄÇ</li>
<li>JMM ÂØπÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÁöÑÊùüÁºöÂ∑≤ÁªèÂ∞ΩÂèØËÉΩÁöÑÂ∞ë„ÄÇ‰ªé‰∏äÈù¢ÁöÑÂàÜÊûêÊàë‰ª¨ÂèØ‰ª•ÁúãÂá∫ÔºåJMM ÂÖ∂ÂÆûÊòØÂú®ÈÅµÂæ™‰∏Ä‰∏™Âü∫Êú¨ÂéüÂàôÔºöÂè™Ë¶Å‰∏çÊîπÂèòÁ®ãÂ∫èÁöÑÊâßË°åÁªìÊûúÔºàÊåáÁöÑÊòØÂçïÁ∫øÁ®ãÁ®ãÂ∫èÂíåÊ≠£Á°ÆÂêåÊ≠•ÁöÑÂ§öÁ∫øÁ®ãÁ®ãÂ∫èÔºâÔºåÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÊÄé‰πà‰ºòÂåñÈÉΩË°å„ÄÇÊØîÂ¶ÇÔºåÂ¶ÇÊûúÁºñËØëÂô®ÁªèËøáÁªÜËá¥ÁöÑÂàÜÊûêÂêéÔºåËÆ§ÂÆö‰∏Ä‰∏™ÈîÅÂè™‰ºöË¢´Âçï‰∏™Á∫øÁ®ãËÆøÈóÆÔºåÈÇ£‰πàËøô‰∏™ÈîÅÂèØ‰ª•Ë¢´Ê∂àÈô§„ÄÇÂÜçÊØîÂ¶ÇÔºåÂ¶ÇÊûúÁºñËØëÂô®ÁªèËøáÁªÜËá¥ÁöÑÂàÜÊûêÂêéÔºåËÆ§ÂÆö‰∏Ä‰∏™ volatile ÂèòÈáè‰ªÖ‰ªÖÂè™‰ºöË¢´Âçï‰∏™Á∫øÁ®ãËÆøÈóÆÔºåÈÇ£‰πàÁºñËØëÂô®ÂèØ‰ª•ÊääËøô‰∏™ volatile ÂèòÈáèÂΩì‰Ωú‰∏Ä‰∏™ÊôÆÈÄöÂèòÈáèÊù•ÂØπÂæÖ„ÄÇËøô‰∫õ‰ºòÂåñÊó¢‰∏ç‰ºöÊîπÂèòÁ®ãÂ∫èÁöÑÊâßË°åÁªìÊûúÔºåÂèàËÉΩÊèêÈ´òÁ®ãÂ∫èÁöÑÊâßË°åÊïàÁéá„ÄÇ</li>
</ul>
<h3 id="JMM-ÁöÑÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅ"><a href="#JMM-ÁöÑÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅ" class="headerlink" title="JMM ÁöÑÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅ"></a>JMM ÁöÑÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅ</h3><p>Java Á®ãÂ∫èÁöÑÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅÊåâÁ®ãÂ∫èÁ±ªÂûãÂèØ‰ª•ÂàÜ‰∏∫‰∏ãÂàó‰∏âÁ±ªÔºö</p>
<ol>
<li>ÂçïÁ∫øÁ®ãÁ®ãÂ∫è„ÄÇÂçïÁ∫øÁ®ãÁ®ãÂ∫è‰∏ç‰ºöÂá∫Áé∞ÂÜÖÂ≠òÂèØËßÅÊÄßÈóÆÈ¢ò„ÄÇÁºñËØëÂô®Ôºåruntime ÂíåÂ§ÑÁêÜÂô®‰ºöÂÖ±ÂêåÁ°Æ‰øùÂçïÁ∫øÁ®ãÁ®ãÂ∫èÁöÑÊâßË°åÁªìÊûú‰∏éËØ•Á®ãÂ∫èÂú®È°∫Â∫è‰∏ÄËá¥ÊÄßÊ®°Âûã‰∏≠ÁöÑÊâßË°åÁªìÊûúÁõ∏Âêå„ÄÇ</li>
<li>Ê≠£Á°ÆÂêåÊ≠•ÁöÑÂ§öÁ∫øÁ®ãÁ®ãÂ∫è„ÄÇÊ≠£Á°ÆÂêåÊ≠•ÁöÑÂ§öÁ∫øÁ®ãÁ®ãÂ∫èÁöÑÊâßË°åÂ∞ÜÂÖ∑ÊúâÈ°∫Â∫è‰∏ÄËá¥ÊÄßÔºàÁ®ãÂ∫èÁöÑÊâßË°åÁªìÊûú‰∏éËØ•Á®ãÂ∫èÂú®È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã‰∏≠ÁöÑÊâßË°åÁªìÊûúÁõ∏ÂêåÔºâ„ÄÇËøôÊòØ JMM ÂÖ≥Ê≥®ÁöÑÈáçÁÇπÔºåJMM ÈÄöËøáÈôêÂà∂ÁºñËØëÂô®ÂíåÂ§ÑÁêÜÂô®ÁöÑÈáçÊéíÂ∫èÊù•‰∏∫Á®ãÂ∫èÂëòÊèê‰æõÂÜÖÂ≠òÂèØËßÅÊÄß‰øùËØÅ„ÄÇ</li>
<li>Êú™ÂêåÊ≠• &#x2F; Êú™Ê≠£Á°ÆÂêåÊ≠•ÁöÑÂ§öÁ∫øÁ®ãÁ®ãÂ∫è„ÄÇJMM ‰∏∫ÂÆÉ‰ª¨Êèê‰æõ‰∫ÜÊúÄÂ∞èÂÆâÂÖ®ÊÄß‰øùÈöúÔºöÁ∫øÁ®ãÊâßË°åÊó∂ËØªÂèñÂà∞ÁöÑÂÄºÔºåË¶Å‰πàÊòØ‰πãÂâçÊüê‰∏™Á∫øÁ®ãÂÜôÂÖ•ÁöÑÂÄºÔºåË¶Å‰πàÊòØÈªòËÆ§ÂÄºÔºà0ÔºånullÔºåfalseÔºâ„ÄÇ</li>
</ol>
<p>‰∏ãÂõæÂ±ïÁ§∫‰∫ÜËøô‰∏âÁ±ªÁ®ãÂ∫èÂú® JMM ‰∏≠‰∏éÂú®È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã‰∏≠ÁöÑÊâßË°åÁªìÊûúÁöÑÂºÇÂêåÔºö</p>
<p><img src="/image/Concurrent/Concurrent79.png" class="lazyload placeholder" data-srcset="/image/Concurrent/Concurrent79.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<p>Âè™Ë¶ÅÂ§öÁ∫øÁ®ãÁ®ãÂ∫èÊòØÊ≠£Á°ÆÂêåÊ≠•ÁöÑÔºåJMM ‰øùËØÅËØ•Á®ãÂ∫èÂú®‰ªªÊÑèÁöÑÂ§ÑÁêÜÂô®Âπ≥Âè∞‰∏äÁöÑÊâßË°åÁªìÊûúÔºå‰∏éËØ•Á®ãÂ∫èÂú®È°∫Â∫è‰∏ÄËá¥ÊÄßÂÜÖÂ≠òÊ®°Âûã‰∏≠ÁöÑÊâßË°åÁªìÊûú‰∏ÄËá¥„ÄÇ</p>
<h3 id="JSR-133-ÂØπÊóßÂÜÖÂ≠òÊ®°ÂûãÁöÑ‰øÆË°•"><a href="#JSR-133-ÂØπÊóßÂÜÖÂ≠òÊ®°ÂûãÁöÑ‰øÆË°•" class="headerlink" title="JSR-133 ÂØπÊóßÂÜÖÂ≠òÊ®°ÂûãÁöÑ‰øÆË°•"></a>JSR-133 ÂØπÊóßÂÜÖÂ≠òÊ®°ÂûãÁöÑ‰øÆË°•</h3><p>JSR-133 ÂØπ JDK5 ‰πãÂâçÁöÑÊóßÂÜÖÂ≠òÊ®°ÂûãÁöÑ‰øÆË°•‰∏ªË¶ÅÊúâ‰∏§‰∏™Ôºö</p>
<ul>
<li>Â¢ûÂº∫ volatile ÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇÊóßÂÜÖÂ≠òÊ®°ÂûãÂÖÅËÆ∏ volatile ÂèòÈáè‰∏éÊôÆÈÄöÂèòÈáèÈáçÊéíÂ∫è„ÄÇJSR-133 ‰∏•Ê†ºÈôêÂà∂ volatile ÂèòÈáè‰∏éÊôÆÈÄöÂèòÈáèÁöÑÈáçÊéíÂ∫èÔºå‰Ωø volatile ÁöÑÂÜô - ËØªÂíåÈîÅÁöÑÈáäÊîæ - Ëé∑ÂèñÂÖ∑ÊúâÁõ∏ÂêåÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇ</li>
<li>Â¢ûÂº∫ final ÁöÑÂÜÖÂ≠òËØ≠‰πâ„ÄÇÂú®ÊóßÂÜÖÂ≠òÊ®°Âûã‰∏≠ÔºåÂ§öÊ¨°ËØªÂèñÂêå‰∏Ä‰∏™ final ÂèòÈáèÁöÑÂÄºÂèØËÉΩ‰ºö‰∏çÁõ∏Âêå„ÄÇ‰∏∫Ê≠§ÔºåJSR-133 ‰∏∫ final Â¢ûÂä†‰∫Ü‰∏§‰∏™ÈáçÊéíÂ∫èËßÑÂàô„ÄÇÁé∞Âú®Ôºåfinal ÂÖ∑Êúâ‰∫ÜÂàùÂßãÂåñÂÆâÂÖ®ÊÄß„ÄÇ</li>
</ul>

      </div>
      <div class="post-tags-categories">
        
        <div class="tags">
          
            <a href="/tags/Java-Concurrent/" class="">
              Java-Concurrent
            </a>
          
        </div>
        
      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>‰ΩúËÄÖ:  </strong>ctrl</a>
    </li>
    <li class="post-copyright-link">
    <strong>ÊñáÁ´†ÈìæÊé•:  </strong>
    <a href="/2022/11/23/java-concurrent/" target="_blank" title="Java-Concurrent">http://example.com/2022/11/23/java-concurrent/</a>
    </li>
    <li class="post-copyright-license">
      <strong>ÁâàÊùÉÂ£∞Êòé:   </strong>
      Êú¨ÁΩëÁ´ôÊâÄÊúâÊñáÁ´†Èô§ÁâπÂà´Â£∞ÊòéÂ§ñ,ÂùáÈááÁî® <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      ËÆ∏ÂèØÂçèËÆÆ„ÄÇËΩ¨ËΩΩËØ∑Ê≥®ÊòéÂá∫Â§Ñ!
    </li>
  </ul>
<div>
      
    </article>
    <!-- ‰∏ä‰∏ÄÁØáÊñáÁ´†Âíå‰∏ã‰∏ÄÁØáÊñáÁ´† -->
    
      <!-- ÊñáÁ´†ËØ¶ÊÉÖÈ°µÁöÑ‰∏ä‰∏ÄÈ°µÂíå‰∏ã‰∏ÄÈ°µ -->
<div class="post-nav">





  
  <div class="post-nav-next post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="/medias/1.jpg" class="lazyload placeholder" data-srcset="/medias/1.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" src="" alt="">
    </div>
    <a href="/2022/11/22/learn-springcloud/" class="post-nav-link">
      <div class="title">
        ‰∏ã‰∏ÄÁØá: <i class="fas fa-angle-right"></i>
        <div class="title-text">Learn-SpringCloud</div>
      </div>
      <!-- <div class="content">
        


SpingBoot Â§ç‰π†maven
‰∏ª pom.xml&lt;?xml version="1.0" encodin
      </div> -->
    </a>
  </div>

</div>

    
    

    <!-- ÊâìËµè -->
    
      <div id="appDonate" class="post-donate">
  <div id="donate_board" class="donate_bar center" ref="donate">
    <a id="btn_donate" class="btn_donate" href="javascript:;" title="ÊâìËµè" @click="showDialogDrawer()"></a>
  </div>
  <transition name="fade">
    <div 
      class="donate-box-mask"
      v-cloak 
      v-show="visible"
      @click="cancelDialogDrawer()"
    >
    </div>
  </transition>
  <transition name="bounce">
    <div class="donate-box" v-cloak v-show="visible">
      <div class="donate-box_close">
        <i class="fas fa-times" aria-hidden="true" @click="cancelDialogDrawer" pointer></i>
      </div>
      <div class="donate-box_title">
        <h4>
          ‰Ω†ÁöÑËµèËØÜÊòØÊàëÂâçËøõÁöÑÂä®Âäõ
        </h4>
      </div>
      <div class="donate-box_tab">
        <div class="Alipay" pointer :class="{'active': tabActive === 'Alipay'}" @click="changeTabActive('Alipay')">
          ÊîØ‰ªòÂÆù
        </div>
        <div class="WeChatpay" pointer :class="{'active': tabActive === 'WeChatpay'}" @click="changeTabActive('WeChatpay')">
          ÂæÆ‰ø°
        </div>
      </div>
      <div class="donate-box_img">
        <div class="AlipayImg" v-show="tabActive === 'Alipay'">
          <img src="/medias/zfb.jpg" class="lazyload placeholder" data-srcset="/medias/zfb.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="ÊîØ‰ªòÂÆùÊâìËµè" />
        </div> 
        <div class="WeChatpayImg" v-show="tabActive === 'WeChatpay'">
          <img src="/medias/wx.jpg" class="lazyload placeholder" data-srcset="/medias/wx.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="ÂæÆ‰ø°ÊâìËµè" />
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDonate',
    data: {
      visible: false,
      tabActive: 'Alipay',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialogDrawer() {
        this.visible = true;
        // Èò≤Ê≠¢È°µÈù¢ÊªöÂä®ÔºåÂè™ËÉΩËÆ©ÂºπÊ°ÜÊªöÂä®
        // function getScroll() {
        //   return {
        //     left: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0,
        //     top: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0
        //   };
        // }
        this.top = $(document).scrollTop() // or getScroll().top
        // console.log('aa', $('.main-content'));
        body.style.cssText = 'overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
      changeTabActive(name) {
        this.tabActive = name;
      }
    },
    created() {}
  })
</script>
    

    <!-- ÂàÜ‰∫´ -->
    
      <!-- https://github.com/overtrue/share.js -->
<!-- ÊñáÁ´†ËØ¶ÊÉÖÈ°µÁöÑÂàÜ‰∫´ -->
<div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>ÂæÆ‰ø°Êâ´‰∏ÄÊâ´Âç≥ÂèØÂàÜ‰∫´ÔºÅ</p>"></div>

<script src="/js/shareJs/social-share.min.js"></script>
</script>

<style>
  .social-share {
    margin: 20px 0;
  }
</style>


    
    
    <!-- ËØÑËÆ∫ -->
    <!-- ËØÑËÆ∫ -->

  <div id="myComment">
    
      <div id="gitment-container"></div>

    
  </div>

<!-- comment script in themes\hexo-theme-bamboo\layout\_partial\scripts\index.ejs -->


  </div>

  <!-- ÁõÆÂΩï -->
  <!-- ÊñáÁ´†ËØ¶ÊÉÖÈ°µÂè≥‰æßÁõÆÂΩï -->

  <div class="toc-aside">
    <div class="toc-main">
      <div class="toc-aside-title">
        <i class="fas fa-list-ul" aria-hidden="true"></i><span>Êú¨ÊñáÁõÆÂΩï</span>
        
          <div class="toc-open-close">Êú¨ÊñáÁõÆÂΩï</div>
        
      </div>
      <div class="toc-content">
        <div class="toc"></div>
      </div>
    </div>
  </div>

  <!-- ÊâãÊú∫Á´ØÁõÆÂΩïÊåâÈíÆ -->
  <div id="toc-mobile-btn">
    <i class="fas fa-list-ul" aria-hidden="true"></i>
  </div>
  <!-- jsÂú®scriptsÁõÆÂΩï‰∏ãÁöÑÁöÑtoc.ejsÈáåÈù¢ -->
  

  <script>
    function openBtnClickFn () {
      let openOrCloseBtn = $('.toc-aside .toc-aside-title .toc-open-close');
      let open = eval('' || 'true');
      openOrCloseBtn.click(function() {
        if (open === true) {
          $(".toc-aside").css({'width': 0, 'padding': 0});
          $(".toc-content").css({'width': 0});
          $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
          $(".main-content").css({'width': '75%', 'margin': '10px auto'});
          open = false;
        } else {
          $(".toc-aside").css({'width': '350px', 'padding': '0 10px'});
          $(".toc-content").css({'width': '350px'});
          $(".toc-aside-title span, .toc-aside-title i").css({'display': 'inline-block'});
          $(".main-content").css({'width': '60%', 'margin-right': '10px', 'margin-left': 'calc(40% - 400px)'});
          open = true;
        }
      });
    };
    openBtnClickFn();
    document.addEventListener('pjax:complete', function () {
      openBtnClickFn();
    })
    
  </script>


  <!-- ÂõæÁâáÊîæÂ§ß Wrap images with fancybox support -->
  <script src="/js/wrapImage.js"></script>
</div>

<!-- ÊñáÁ´†ËØ¶ÊÉÖÈ°µËÉåÊôØÂõæ -->
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;"
	:style="{'background-color': bgColor ? bgColor : 'transparent'}">
	<transition-group tag="ul" :name="names">
		<li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
			<img :src="image" class="bg-swiper-img no-lazy">
		</li>
	</transition-group>
</div>
<script>
	var vm = new Vue({
		el: '#appBgSwiper',
		data: {
			names: '' || 'fade' || 'fade', // translate-fade fade
			mark: 0,
			img: [],
			bgColor: '',
			time: null
		},
		methods: {   //Ê∑ªÂä†ÊñπÊ≥ï
			change(i, m) {
				if (i > m) {
					// this.names = 'fade';
				} else if (i < m) {
					// this.names = 'fade';
				} else {
					return;
				}
				this.mark = i;
			},
			prev() {
				// this.names = 'fade';
				this.mark--;
				if (this.mark === -1) {
					this.mark = 3;
					return
				}
			},
			next() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			autoPlay() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			play() {
				let bgImgDelay = '' || '100000'
				let delay = parseInt(bgImgDelay) || 180000;
				this.time = setInterval(this.autoPlay, delay);
			},
			enter() {
				clearInterval(this.time);
			},
			leave() {
				this.play();
			}
		},
		created() {
			this.play()
		},
		beforeDestroy() {
			clearInterval(this.time);
		},
		mounted() {
			let prop = '' || '';
			let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://')
			if (isImg) {
				let img = prop.split(',');
				let configRoot = '/'
				let arrImg = [];
				img.forEach(el => {
					var Expression = /http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
					var objExp = new RegExp(Expression);

					if (objExp.test(el)) {
						// http or https
						arrImg.push(el);
					} else {
						// Èùûhttp or httpsÂºÄÂ§¥
						// Êú¨Âú∞Êñá‰ª∂
						let firstStr = el.charAt(0);
						if (firstStr == '/') {
							el = el.substr(1); // Âà†Èô§Á¨¨‰∏Ä‰∏™Â≠óÁ¨¶ '/',Âõ†‰∏∫ configRootÊúÄÂêé‰∏Ä‰∏™Â≠óÁ¨¶‰∏∫ /
						}
						el = configRoot + el;
						arrImg.push(el);
					}
				})
				this.img = arrImg;
			} else {
				this.bgColor = prop;
			}
		}
	})
</script>

<style>
	.bg-swiper-box {
		position: absolute;
		display: block;
		width: 100%;
		height: 100%;
	}

	.bg-swiper-img {
		object-fit: cover;
		width: 100%;
		height: 100%;
	}
</style>




  <script>
  function loadMermaid() {
    if (document.getElementsByClassName('mermaid').length) {
      if (window.mermaidJsLoad) mermaid.init()
      else {
        loadScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
          window.mermaidJsLoad = true
          mermaid.initialize({
            theme: 'default',
          })
          if ('true') {
            mermaid.init();
          }
        })
      }
    }
  };
  document.addEventListener("DOMContentLoaded", function () {
    loadMermaid();
  })

  document.addEventListener('pjax:complete', function () {
    loadMermaid();
  })
  
</script>


      </main>
    </div>

    <!-- È°µËÑö -->
    
  
  <div class="footer bg-color">

	<div class="footer-main">
      
        
          <div class="link">
            
          </div>
        
      
        
          <div class="footer-copyright">
            <p>Copyright ¬© 2019 - 2022 <a target="_blank" rel="noopener" href="https://github.com/ctrl-github">ctrl-github</a> | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/yuang01/theme">Bamboo</a> </p>

          </div>
        
      
        
          
            <!-- ‰∏çËíúÂ≠êÁªüËÆ° -->
            <!-- ‰∏çËíúÂ≠êÁªüËÆ° -->
<span id="busuanzi_container_site_pv">
      <i class="fas fa-eye" aria-hidden="true"></i>Êú¨Á´ôÊÄªËÆøÈóÆÈáèÔºö<span id="busuanzi_value_site_pv"></span> Ê¨°
</span>
<span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_uv" style='display:none'>
      <i class="fas fa-users" aria-hidden="true"></i>Êú¨Á´ôËÆøÂÆ¢Êï∞Ôºö<span id="busuanzi_value_site_uv"></span> ‰∫∫
</span>

          
        
      
        
          <div class="footer-custom">
            
          </div>
        
      
    </div>
	<div>
	Â§áÊ°àÂè∑Ôºö<a style="color:#666" target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">	<img class="img" style="border: 0;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAA5z2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgICAgICAgICB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIgogICAgICAgICAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICAgICAgICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx4bXA6Q3JlYXRlRGF0ZT4yMDE5LTA5LTIzVDEyOjA5OjI4KzA4OjAwPC94bXA6Q3JlYXRlRGF0ZT4KICAgICAgICAgPHhtcDpNZXRhZGF0YURhdGU+MjAxOS0wOS0yM1QxMjowOToyOCswODowMDwveG1wOk1ldGFkYXRhRGF0ZT4KICAgICAgICAgPHhtcDpNb2RpZnlEYXRlPjIwMTktMDktMjNUMTI6MDk6MjgrMDg6MDA8L3htcDpNb2RpZnlEYXRlPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjg0OTNiNTZlLWM2MmMtY2I0Zi1hMzBmLWM5ZDk3MGNjZTkyMjwveG1wTU06SW5zdGFuY2VJRD4KICAgICAgICAgPHhtcE1NOkRvY3VtZW50SUQ+eG1wLmRpZDo5MmFhMDM0YS1lMDk3LTc3NDktYWI1YS03ZTJiMTI1MTk2ZjY8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDo5MmFhMDM0YS1lMDk3LTc3NDktYWI1YS03ZTJiMTI1MTk2ZjY8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6OTJhYTAzNGEtZTA5Ny03NzQ5LWFiNWEtN2UyYjEyNTE5NmY2PC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE5LTA5LTIzVDEyOjA5OjI4KzA4OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDo4NDkzYjU2ZS1jNjJjLWNiNGYtYTMwZi1jOWQ5NzBjY2U5MjI8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTktMDktMjNUMTI6MDk6MjgrMDg6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cyk8L3N0RXZ0OnNvZnR3YXJlQWdlbnQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpjaGFuZ2VkPi88L3N0RXZ0OmNoYW5nZWQ+CiAgICAgICAgICAgICAgIDwvcmRmOmxpPgogICAgICAgICAgICA8L3JkZjpTZXE+CiAgICAgICAgIDwveG1wTU06SGlzdG9yeT4KICAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9wbmc8L2RjOmZvcm1hdD4KICAgICAgICAgPHBob3Rvc2hvcDpDb2xvck1vZGU+MzwvcGhvdG9zaG9wOkNvbG9yTW9kZT4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WVJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+NjU1MzU8L2V4aWY6Q29sb3JTcGFjZT4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjIwPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjIyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/eHBhY2tldCBlbmQ9InciPz4jh4n+AAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAATMSURBVHjarNVbbBR1FMfx78zOzs5Od7v3btcuEmgFilyqgNdaBI1cAgUxIWCMikFEjRqJPGh8IRgDLxjReAliFEKMCglJIQSoNcolgjEQAbmUUqC7pbS73XZnd2d3ZmfHB7GKwfji7+08/D/5n+T/P0ewbZv/MxJAme4bRTVQBcZxOvcd4I5FL9YWLp1o/X7fz8+X9LL88GNTtwSnTNl9dtdXicaFS0CuB/pJX9gNQGjcmj/AW2QWsPqLF19vtfVOpaek4gj4Kew894H+Sdt7zY+MbQM+B/b886B4C0zp+Hhrx9Or2pfmileUcR4HK5XrrFZ6eOD+KMH7o9LKVQcfP7B5Qxvg+i8wXjqxfv/7O4ZZvnIsz8az+D49Q/q8RbrLYnjBJyyyTvHatmVs2WVin//sW0D5N7Dx6p63u1oWnGrxN0R5OXyK7h1ZxFF+LM2AUgUh4ufoK0dYqp4g+uBdPLpg78KBw1svAeNvAvNnu5CK+z1t573y8d7pzJuukTuZRbw6jOB34Rq0KB65jnNMCCWnk/ryGEvmGHRcnMj2Q1bMI+TdwTHP3HTDeOWn7zZVBDdIBaq1XrJ94LRMGCwi1KvI0/yI1/LIVEh169QFSyAIZHIiroi0CRgzAl45d/AJI5lsDnhkKLuwYzHCzbXksNEeCGEtj+NZ14T62hTEiErNtDD5ggG2TaxGhcTJWYM9R58bAVVPoDGrmYyNFEEJceCYijS7mvTC0VhJDeHXPIW91zG7h5DXNhN8fSo7t2WAKpomS+S7+ikmuuIjYGWwd2E2IzEprhG/R+aj7VX8sCFB04wYPtVL4UyGSn+J4qkM3uQQp9dfYPM2F9EmP5PrhkklS5iD55pHQFHK+7WsSPXABZbOsSibHsw9fYS+/gWxzokRcVCpkQjPjhHruERqy2nyhoMlrU686U60rITkFZ0jX8+t3t4ujr/cakXrWHGvxqa6CB8lGzF7zhBKdyL63OhnMmgNNSQDMb4R3VDtZ8V9/ZS9cfx3CqiBUXtHQBBr7KxNb5fGpMZu3nljGm+vbWGPNhmyJq2FNEG/yM69XnKoQIA1LynMaOiktxMoFqiUtakjoOQ3ppe9Ucw+k0T/WV5tdrGkvYqOfQXOiVOYO/EiMXeKclsdRkZn1ASVt+Ze5vrRyxRMBSUsI/nlCQCCbduUcsefTB/buEPvMyilTEhcoX5xE66oAlYaKy2R69fxjQnC6BAkUnTvPo/uDeMZ68Fdq+JrWD5TDsz/8U8Qh+B6avD0pg+tou5LHepDqrKpndmINahjFvKIqoISrEKQnaSPdlG2JHzT6zGLpH3jW5bJTrVdDsz/o+VSqgLoyWKfW1eiFV90dgPWcB5Ly4Iq45D9yG4whnLkExmU0SGUeJTSUIFiUrPdo3IY5AgGbjwbB4dxcPjNmru9tc5AjNJwhYolUbEcFAc0sCsY6WFynQMIDicIAsVrKZxukehDsbCsai/IqvbXxHaFZgAszvQe2mgkflshOwpVashFOW+AYOIoDVHWDbwTwjgUB4aeQ6wKIwRqr5al+i2KGnn3phVwIwXglczZ6Dp9eGBeyeyZedvEyMSKJngUvxiU3F60a1x1R/wFqabl5GBXf7t+JXNg9ENU/j4Phf97Sf0+ADr3CMhtMiuNAAAAAElFTkSuQmCC" alt="">
	ÊπòICPÂ§á2022006791Âè∑</a>    

	</div>
    
  </div>



    <!-- Ê∏≤ÊüìÊöóÈªëÊåâÈíÆ -->
    
      <div class="dark">
  <div class="dark-content">
    <i class="fas fa-moon" aria-hidden="true"></i>
    <!-- <span>ÂÖ≥ÁÅØ</span> -->
  </div>
  
</div>

<script>
  $(function() {
    let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
    if (isDark) {
      $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
    }
    $('.dark').click(function() {
      if ($(document.body).is('.darkModel')) {
        $(document.body).removeClass('darkModel');
        localStorage.setItem('dark', false);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-moon" aria-hidden="true"></i>
          </div>
          `
        );
      } else {
        $(document.body).addClass('darkModel');
        localStorage.setItem('dark', true);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
      }
    })
  })
</script>
    
    <!-- Ê∏≤ÊüìÂõûÂà∞È°∂ÈÉ®ÊåâÈíÆ -->
    
      <div class="goTop top-btn-color" pointer>
  <i class="fas fa-arrow-up" aria-hidden="true"></i>
</div>
<script src="/js/goTop.js"></script>

    
    <!-- Ê∏≤ÊüìÂ∑¶‰∏ãËßíÈü≥‰πêÊí≠ÊîæÂô® -->
    
      <link rel="stylesheet" href="/js/aplayer/APlayer@1.10.1.min.css">
<style>
.aplayer .aplayer-lrc p {
  
  font-size: 12px;
  font-weight: 700;
  line-height: 16px !important;
}

.aplayer .aplayer-lrc p.aplayer-lrc-current {
  
  font-size: 15px;
  color: #42b983;
}


.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
  left: -66px !important;
}

.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
  left: 0px !important;
}


</style>
<meting-js  
  class=""
  server="tencent"
  type="playlist"
  id="8062553743"
  fixed='true'
  autoplay='true'
  theme='#42b983'
  loop='all'
  order='random'
  preload='auto'
  volume='0.7'
  list-folded='true'
>
</meting-js>

<!-- <style>
  #aplayer {
    position: fixed;
    left: 0;
    bottom: 300px;
  }
</style> -->
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    

    <!-- ÂõæÁâáÊîæÂ§ß -->
    
      <script src="/js/fancybox/jquery.fancybox.min.js"></script>
    

    <!-- ÁôæÂ∫¶Ëß£Êûê -->
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <!-- ËÉåÊôØÂΩ©Â∏¶ -->
    
      <script type="text/javascript" size="100" alpha='0.4' zIndex="-1" src="/js/ribbon.min.js"></script>
    

    <script src="/js/utils/index.js"></script>
    <script src="/js/app.js" data-pjax></script>
    
    <!-- ÊñáÁ´†ÁõÆÂΩïÊâÄÈúÄjs -->
<link href="/js/tocbot/tocbot.css" rel="stylesheet">
<script src="/js/tocbot/tocbot.min.js"></script>

<script>
  var headerEl = 'h1, h2, h3, h4, h5, h6',  //headers 
    content = '.post-detail',//ÊñáÁ´†ÂÆπÂô®
    idArr = {};  //Ê†áÈ¢òÊï∞ÁªÑ‰ª•Á°ÆÂÆöÊòØÂê¶Â¢ûÂä†Á¥¢Âºïid
  //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -80,
    headingsOffset: -($(window).height() * 0.4 - 45),
    positionFixedSelector: '.toc-main',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    activeLinkClass: 'is-active-link',
    // onClick: function (e) {},
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //ÂéªÈô§Á©∫Ê†º‰ª•ÂèäÂ§ö‰ΩôÊ†áÁÇπ
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\Ôºö|\Ôºå|\„ÄÇ]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //idÂ∑≤ÁªèÂ≠òÂú®
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //idÊú™Â≠òÂú®
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      tocbot.init(option);
      mobileTocClick();
    });

  }

  window.tocScrollFn = function () {
    return bamboo.throttle(function () {
      findHeadPosition();
    }, 100)()
  }
  window.addEventListener('scroll', tocScrollFn);

  const findHeadPosition = function (top) {
    if ($('.toc-list').length <= 0) {
      return false;
    }
    setTimeout(() => {  // or DOMContentLoaded 
      autoScrollToc();
    }, 0);
  }

  const autoScrollToc = function () {
    const $activeItem = document.querySelector('.is-active-link');
    const $cardToc = document.querySelector('.toc-content');
    const activePosition = $activeItem.getBoundingClientRect().top
    const sidebarScrollTop = $cardToc.scrollTop
    if (activePosition > (document.documentElement.clientHeight - 100)) {
      $cardToc.scrollTop = sidebarScrollTop + 150
    }
    if (activePosition < 100) {
      $cardToc.scrollTop = sidebarScrollTop - 150
    }
  }

  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
      mobileTocClick();
    }
  });
  
  // ÊâãÊú∫Á´ØtocÊåâÈíÆÁÇπÂáªÂá∫Áé∞ÁõÆÂΩï
  const mobileTocClick = function () {
    const $cardTocLayout = document.getElementsByClassName('toc-aside')[0];
    const $cardToc = $cardTocLayout.getElementsByClassName('toc-content')[0];
    let right = '45px';
    if (window.innerWidth >= 551 && window.innerWidth <= 992) {
      right = '100px'
    }
    const mobileToc = {
      open: () => {
        $cardTocLayout.style.cssText = 'animation: toc-open .3s; opacity: 1; right: ' + right
      },

      close: () => {
        $cardTocLayout.style.animation = 'toc-close .2s'
        setTimeout(() => {
          $cardTocLayout.style.cssText = "opacity:''; animation: ''; right: ''"
        }, 100)
      }
    }
    document.getElementById('toc-mobile-btn').addEventListener('click', () => {
      if (window.getComputedStyle($cardTocLayout).getPropertyValue('opacity') === '0') mobileToc.open()
      else mobileToc.close()
    })

    $cardToc.addEventListener('click', (e) => {
      if (window.innerWidth < 992) { // Â∞è‰∫é992pxÁöÑÊó∂ÂÄô
        mobileToc.close()
      }
    })
  }
</script>

<style>
  .is-position-fixed {
    position: sticky !important;
    top: 74px;
  }

  .toc-main ul {
    counter-reset: show-list;
  }

  .toc-main ul li::before {
    content: counter(item)".";
    display: block;
    position: absolute;
    left: 12px;
    top: 0;
  }
</style> 

<!-- Ê∏≤ÊüìissuesÊ†áÁ≠æÈáåÁöÑÂÜÖÂÆπ -->
<script>
  function loadIssuesJS() {
    if ($(".post-detail").find(".issues-api").length == 0) {
      return;
    } 
    loadScript('/js/issues/index.js');
  };
  $(function () {
    loadIssuesJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof IssuesAPI == "undefined") {
      loadIssuesJS();
    }
  })
</script>

<!-- ËæìÂÖ•Ê°ÜÊâìÂ≠óÁâπÊïà -->
<!-- ËæìÂÖ•Ê°ÜÊâìÂ≠óÁâπÊïà -->

  <script src="/js/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;  // ÊâìÂºÄÈöèÊú∫È¢úËâ≤ÁâπÊïà
    POWERMODE.shake = false;    // ÂÖ≥Èó≠ËæìÂÖ•Ê°ÜÊäñÂä®
    document.body.addEventListener('input', POWERMODE);//ÁõëÂê¨ÊâìÂ≠ó‰∫ã‰ª∂
  </script>


<!-- markdown‰ª£Á†Å‰∏ÄÈîÆÂ§çÂà∂ÂäüËÉΩ -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.css">
  <script src="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.umd.min.js"></script>
  <script src="/js/clipboard/clipboard.min.js"></script>
  <div id="appCopy">
  </div>
  <script data-pjax>
    var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = 'Â§çÂà∂';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fas fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
          }
        })

        function doSomething() {
          that.$notify({
            title: "ÊàêÂäü",
            content: "‰ª£Á†ÅÂ∑≤Â§çÂà∂ÔºåËØ∑ÈÅµÂÆàÁõ∏ÂÖ≥ÊéàÊùÉÂçèËÆÆ„ÄÇ",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })
  </script>
  

<!-- ÂõæÁâáÊáíÂä†ËΩΩ -->
<script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>


<!-- Âç°ÁâáÊªöÂä®Âä®Áîª -->
   

<!-- ËØÑËÆ∫ÊâÄÈúÄjs -->

  
    <script type="text/javascript">
  var utteranceCommon = {};

  function check_utterance() {
    let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');
    if (isDark) {
      utteranceCommon.Theme = 'github-dark';
    } else {
      utteranceCommon.Theme = 'github-light';
    }

    return document.getElementById("gitment-container");
  }
  comment_el = '#gitment-container';
  load_utterance = function () {
    if ($(comment_el).length) {
      // ÂåøÂêçÂáΩÊï∞ÔºåÈò≤Ê≠¢Ê±°ÊüìÂÖ®Â±ÄÂèòÈáè
      const HEAD = check_utterance();

      var utterances = document.createElement('script');
      utterances.type = 'text/javascript';
      utterances.async = true;
      utterances.setAttribute('issue-term', 'pathname')
      utterances.setAttribute('theme', utteranceCommon.Theme)
      utterances.setAttribute('repo', '')
      utterances.crossorigin = 'anonymous';
      utterances.src = 'https://utteranc.es/client.js';
      // content ÊòØË¶ÅÊèíÂÖ•ËØÑËÆ∫ÁöÑÂú∞Êñπ
      document.getElementById('gitment-container').appendChild(utterances);

    }
  }

  function dark_utterance() {
    const HEAD = check_utterance();
    if (!HEAD) return;
    const message = {
      type: 'set-theme',
      theme: utteranceCommon.Theme
    };
    const utteranceIframe = document.querySelector('iframe');
    utteranceIframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }

  $(document).ready(load_utterance);
  document.addEventListener('pjax:complete', function () {
    load_utterance();
  });

  $('.dark').click(function () {
    setTimeout(() => {
      dark_utterance();
    });
  })

</script>

<style>
  .utterances {
    max-width: inherit !important;
  }
</style>
  


<!-- Èº†Ê†áÁÇπÂáªÁâπÊïà -->
<!-- Áà±ÂøÉÁÇπÂáª -->

  
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 999; pointer-events: none;" ></canvas>
    <script src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script src="/js/cursor/explosion.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" data-pjax></script>


    <!-- pjax -->
    

<!-- pjax -->


  <script src="/js/pjax@0.2.8/index.js"></script>
  
    <!-- Ê†∑Âºè‰Ωç‰∫éÔºösource/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <div class="loading-circle"><div id="loader-circle"></div></div>
    <script>
      window.ShowLoading = function() {
        $(".loading-circle").css("display", "block");
      };
      window.HideLoading = function() {
        $(".loading-circle").css("display", "none");
      }
    </script>
  
	<script>
    document.addEventListener('pjax:complete', function () {
      window.HideLoading();
    })
    document.addEventListener('pjax:send', function () {
      window.ShowLoading();
    })
    document.addEventListener('pjax:error', function () {
      window.HideLoading();
    })
	</script>
</div>

  

  <script>
    var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([no-pjax])',   // Êã¶Êà™Ê≠£Â∏∏Â∏¶ÈìæÊé•ÁöÑ a Ê†áÁ≠æ
      selectors: ["#pjax-container","title"],                                   // Ê†πÊçÆÂÆûÈôÖÈúÄË¶ÅÁ°ÆËÆ§ÈáçËΩΩÂå∫Âüü
      cacheBust: false,   // url Âú∞ÂùÄËøΩÂä†Êó∂Èó¥Êà≥ÔºåÁî®‰ª•ÈÅøÂÖçÊµèËßàÂô®ÁºìÂ≠ò
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
    
    // Âà∑Êñ∞‰∏ç‰ªéÈ°∂ÈÉ®ÂºÄÂßã
    document.addEventListener("DOMContentLoaded", function () {
      history.scrollRestoration = 'auto';
    })
  </script>



  </body>
</html>